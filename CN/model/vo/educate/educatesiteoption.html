<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educatesiteoption.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educatesiteoption.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateSiteOption&quot;, import(&quot;model.vo.BaseVO&quot;))
slot0.TYPE_SHOP = 1
slot0.TYPE_EVENT = 2
slot0.TYPE_SITE = 3

slot0.Ctor = function(slot0, slot1, slot2)
	slot0.id = slot1
	slot0.configId = slot0.id
	slot0.usedCnt = slot2 or 0
	slot0.remainCnt = slot0:GetOriginalCnt() - slot0.usedCnt
	slot0.curTime = getProxy(EducateProxy):GetCurTime()

	slot0:initTime()
	slot0:initRefreshTime()
end

slot0.bindConfigTable = function(slot0)
	return pg.child_site_option
end

slot0.initTime = function(slot0)
	if slot0:IsLimitTime() then
		slot0.startTime, slot0.endTime = EducateHelper.CfgTime2Time(slot0:getConfig(&quot;time_limit&quot;))
	end
end

slot0.initRefreshTime = function(slot0)
	if slot0:IsEventType() and slot0:IsCountLimit() then
		slot0.refreshWeeks = {}
		slot2 = 60
		slot3 = slot0:getConfig(&quot;count_limit&quot;)[2]

		table.insert(slot0.refreshWeeks, 9)

		while slot1 &lt; slot2 do
			table.insert(slot0.refreshWeeks, slot1 + slot3)
		end
	end
end

slot0.IsShowLimit = function(slot0)
	return slot0:getConfig(&quot;is_limit&quot;) == 1 and slot0.remainCnt &gt; 0
end

slot0.IsLimitTime = function(slot0)
	return #slot0:getConfig(&quot;time_limit&quot;) ~= 0
end

slot0.IsCountLimit = function(slot0)
	return slot0:getConfig(&quot;count_limit&quot;) ~= &quot;&quot; and #slot0:getConfig(&quot;count_limit&quot;) == 2
end

slot0.IsShow = function(slot0)
	if slot0:IsLimitTime() then
		return EducateHelper.InTime(slot0.curTime, slot0.startTime, slot0.endTime)
	else
		return true
	end
end

slot0.GetType = function(slot0)
	return slot0:getConfig(&quot;type&quot;)
end

slot0.IsEventType = function(slot0)
	return slot0:getConfig(&quot;type&quot;) == uv0.TYPE_EVENT
end

slot0.IsReplace = function(slot0)
	return slot0:getConfig(&quot;replace&quot;) ~= 0
end

slot0.GetCost = function(slot0)
	return slot0:getConfig(&quot;cost&quot;)
end

slot0.GetLinkId = function(slot0)
	return slot0:getConfig(&quot;param&quot;)[1]
end

slot0.GetOriginalCnt = function(slot0)
	return slot0:IsCountLimit() and slot0:getConfig(&quot;count_limit&quot;)[1] or 999
end

slot0.GetRemainCnt = function(slot0)
	return slot0.remainCnt
end

slot0.GetCntText = function(slot0)
	if not slot0:IsCountLimit() then
		return &quot;&quot;
	end

	return string.format(&quot;(%d/%d)&quot;, slot0.remainCnt, slot0:getConfig(&quot;count_limit&quot;)[1])
end

slot0.CanTrigger = function(slot0)
	return slot0.remainCnt &gt; 0
end

slot0.ReduceCnt = function(slot0)
	slot0.remainCnt = slot0.remainCnt - 1
end

slot0.IsShowPolaroid = function(slot0)
	if #slot0:getConfig(&quot;polarid_list&quot;) == 0 then
		return false
	end

	return underscore.any(slot0:getConfig(&quot;polarid_list&quot;), function (slot0)
		return not getProxy(EducateProxy):IsExistPolaroidByGroup(slot0) and getProxy(EducateProxy):CanGetPolaroidByGroup(slot0)
	end)
end

slot0.GetResults = function(slot0)
	if EducateHelper.IsShowNature() then
		return slot0:getConfig(&quot;result_display&quot;)
	else
		return underscore.select(slot0:getConfig(&quot;result_display&quot;), function (slot0)
			return slot0[1] ~= EducateConst.DROP_TYPE_ATTR or not getProxy(EducateProxy):GetCharData():IsPersonalityAttr(slot0[2])
		end)
	end
end

slot0.IsResetWeek = function(slot0, slot1)
	return table.contains(slot0.refreshWeeks, slot1)
end

slot0.OnWeekUpdate = function(slot0, slot1)
	slot0.curTime = slot1

	slot0:CheckCntReset()
end

slot0.CheckCntReset = function(slot0)
	if slot0:IsEventType() and slot0:IsCountLimit() and slot0:IsResetWeek(EducateHelper.GetWeekIdxWithTime(slot0.curTime)) then
		slot0.remainCnt = slot0:GetOriginalCnt()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>