<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>monthlyshop.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>monthlyshop.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MonthlyShop&quot;, import(&quot;.BaseShop&quot;))

slot0.Ctor = function(slot0)
	slot0.goods = {}
end

slot0.GoodsType = nil

slot0.IsSameKind = function(slot0, slot1)
	return isa(slot1, MonthlyShop)
end

slot0.GetCommodityById = function(slot0, slot1)
	return slot0:getGoodsById(slot1)
end

slot0.GetCommodities = function(slot0)
	return slot0:getSortGoods()
end

slot0.isOpen = function(slot0)
	if not slot0.id then
		return false
	end

	slot1 = false

	if slot0:bindConfigTable()[slot0.id] then
		slot3 = pg.TimeMgr.GetInstance()
		slot1 = slot3:STimeDescS(slot3:GetServerTime(), &quot;*t&quot;).month == slot0.id
	end

	return slot1
end

slot0.getRestDays = function(slot0)
	if not slot0.id then
		return 0
	end

	slot1 = pg.TimeMgr.GetInstance()
	slot3 = Clone(slot1:STimeDescS(slot1:GetServerTime(), &quot;*t&quot;))
	slot3.month = slot0.id

	if slot3.month &gt;= 12 then
		slot3.month = 0
		slot3.year = slot3.year + 1
	end

	slot3.month = slot3.month + 1
	slot3.day = 0

	return math.max(os.date(&quot;%d&quot;, os.time(slot3)) - slot2.day + 1, 1)
end

slot0.GetRestTime = function(slot0)
	if not slot0.id then
		return 0
	end

	slot1 = pg.TimeMgr.GetInstance()
	slot3 = Clone(slot1:STimeDescS(slot1:GetServerTime(), &quot;*t&quot;))
	slot3.month = slot0.id

	if slot3.month &gt;= 12 then
		slot3.month = 0
		slot3.year = slot3.year + 1
	end

	slot3.month = slot3.month + 1
	slot3.day = 0
	slot3.hour = 23
	slot3.min = 59
	slot3.sec = 59
	slot3.isdst = false

	return math.max(os.time(slot3) - slot1:GetServerTime(), 0)
end

slot0.getSortGoods = function(slot0)
	slot1 = {}

	for slot5, slot6 in pairs(slot0.goods) do
		table.insert(slot1, slot6)
	end

	slot2 = function(slot0)
		return math.floor(slot0 * 0.1)
	end

	table.sort(slot1, function (slot0, slot1)
		slot2 = 100
		slot3 = 1000
		slot4 = slot0:getConfig(&quot;order&quot;) + slot0.id / 100000
		slot5 = slot1:getConfig(&quot;order&quot;) + slot1.id / 100000
		slot6 = getProxy(CollectionProxy)

		slot8 = function(slot0)
			return not slot0:canPurchase()
		end

		if (function (slot0)
			return slot0:isSham() and slot0:checkCommodityType(DROP_TYPE_SHIP) and uv0:getShipGroup(uv1(slot0:getConfig(&quot;commodity_id&quot;)))
		end)(slot0) and not slot8(slot0) then
			slot4 = slot4 + slot2
		end

		if slot7(slot1) and not slot8(slot1) then
			slot5 = slot5 + slot2
		end

		if slot8(slot0) then
			slot4 = slot4 + slot3
		end

		if slot8(slot1) then
			slot5 = slot5 + slot3
		end

		return slot4 &lt; slot5
	end)

	return slot1
end

slot0.getGoodsCfg = function(slot0, slot1)
	return pg.activity_shop_template[slot1]
end

slot0.getGoodsById = function(slot0, slot1)
	return slot0.goods[slot1]
end

slot0.bindConfigTable = function(slot0)
	return pg.month_shop_template
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>