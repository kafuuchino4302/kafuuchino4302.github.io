<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>compensateproxy.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>compensateproxy.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CompensateProxy&quot;, import(&quot;.NetProxy&quot;))
slot0.Compensate_Remove = &quot;CompensateProxy Compensate_Remove&quot;
slot0.All_Compensate_Remove = &quot;CompensateProxy All_Compensate_Remove&quot;
slot0.UPDATE_ATTACHMENT_COUNT = &quot;CompensateProxy UPDATE_ATTACHMENT_COUNT&quot;

slot0.register = function(slot0)
	slot0.data = {}

	slot0:on(30101, function (slot0)
		uv0:unpdateLatestTime(slot0.max_timestamp)
		uv0:unpdateUnreadCount(slot0.number)
		uv0:SetDirty(true)
	end)
end

slot0.RefreshRewardList = function(slot0, slot1)
	slot0.data = {}

	for slot5, slot6 in ipairs(slot1) do
		slot0.data[slot6.id] = slot6
	end
end

slot0.GetAllRewardList = function(slot0)
	slot1 = {}

	for slot5, slot6 in pairs(slot0.data) do
		if slot6.timestamp - pg.TimeMgr.GetInstance():GetServerTime() &gt; 0 then
			table.insert(slot1, slot6)
		end
	end

	return slot1
end

slot0.GetCompensateAttachments = function(slot0, slot1)
	slot2 = {}

	if not slot0.data[slot1].attachFlag then
		for slot7, slot8 in ipairs(slot3.attachments) do
			table.insert(slot2, Clone(slot8))
		end
	end

	return PlayerConst.MergeSameDrops(slot2)
end

slot0.DealMailOperation = function(slot0, slot1)
	if slot0.data[slot1] then
		slot0.data[slot1]:setAttachFlag(true)
	end
end

slot0.timeCall = function(slot0)
	return {
		[ProxyRegister.SecondCall] = function (slot0)
			slot1 = nil

			for slot5, slot6 in pairs(uv0.data) do
				if slot6:isEnd() then
					if slot1 == nil then
						slot1 = {}
					end

					table.insert(slot1, slot5)
				end
			end

			if slot1 ~= nil then
				for slot5, slot6 in ipairs(slot1) do
					uv0.data[slot6] = nil
				end

				uv0:sendNotification(uv1.Compensate_Remove)
			end

			if uv0.max_timestamp ~= 0 and uv0.max_timestamp - pg.TimeMgr.GetInstance():GetServerTime() &lt; 0 then
				uv0.max_timestamp = 0

				uv0:sendNotification(uv1.All_Compensate_Remove)
			end
		end
	}
end

slot0.unpdateLatestTime = function(slot0, slot1)
	slot0.max_timestamp = slot1
end

slot0.unpdateUnreadCount = function(slot0, slot1)
	slot0._existUnreadCount = slot1

	slot0:sendNotification(uv0.UPDATE_ATTACHMENT_COUNT)
end

slot0.IsDirty = function(slot0)
	return slot0.isDirty
end

slot0.SetDirty = function(slot0, slot1)
	slot0.isDirty = slot1
end

slot0.hasRewardCount = function(slot0)
	return slot0._existUnreadCount &gt; 0 and slot0.max_timestamp - pg.TimeMgr.GetInstance():GetServerTime() &gt; 0
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>