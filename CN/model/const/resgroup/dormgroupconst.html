<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dormgroupconst.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>dormgroupconst.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot1 = {
	room = &quot;dorm3d/scenesres/scenes/&quot;,
	apartment = &quot;dorm3d/character/&quot;
}
slot2 = nil

return {
	DormGroupName = &quot;DORM&quot;,
	DormMgr = nil,
	GetDormMgr = function ()
		if not uv0.DormMgr then
			uv0.DormMgr = BundleWizard.Inst:GetGroupMgr(uv0.DormGroupName)
		end

		return uv0.DormMgr
	end,
	NotifyDormDownloadStart = &quot;DormGroupConst.NotifyDormDownloadStart&quot;,
	NotifyDormDownloadProgress = &quot;DormGroupConst.NotifyDormDownloadProgress&quot;,
	NotifyDormDownloadFinish = &quot;DormGroupConst.NotifyDormDownloadFinish&quot;,
	VerifyDormFileName = function (slot0)
		return GroupHelper.VerifyFile(uv0.DormGroupName, slot0)
	end,
	CalcDormListSize = function (slot0)
		slot2 = GroupHelper.CalcSizeWithFileArr(uv0.DormGroupName, GroupHelper.CreateArrByLuaFileList(uv0.DormGroupName, slot0))

		return slot2, HashUtil.BytesToString(slot2)
	end,
	IsDormNeedCheck = function ()
		if Application.isEditor then
			return false
		end

		if GroupHelper.IsGroupVerLastest(uv0.DormGroupName) then
			return false
		end

		if not GroupHelper.IsGroupWaitToUpdate(uv0.DormGroupName) then
			return false
		end

		return true
	end,
	DormDownload = function (slot0)
		slot1 = {}

		if uv0.IsDormNeedCheck() then
			slot4 = IsUsingWifi()
			slot5 = slot0.isShowBox and pg.FileDownloadMgr.GetInstance():IsNeedRemind()

			if #slot0.fileList &gt; 0 then
				if slot5 then
					slot7, slot8 = uv0.CalcDormListSize(slot6)

					if slot7 &gt; 0 then
						table.insert(slot1, function (slot0)
							pg.MsgboxMgr.GetInstance():ShowMsgBox({
								modal = true,
								locked = true,
								hideToggle = true,
								type = MSGBOX_TYPE_FILE_DOWNLOAD,
								content = string.format(i18n(&quot;file_down_msgbox&quot;, uv0)),
								onYes = slot0,
								onNo = uv1.onNo,
								onClose = uv1.onClose
							})
						end)
					end
				end

				table.insert(slot1, function (slot0)
					uv0.DormDownloadLock = {
						curSize = 0,
						totalSize = 1,
						roomId = uv1.roomId
					}

					uv0.ExtraDownload({
						dataList = {
							{
								groupName = uv0.DormGroupName,
								fileNameList = uv2
							}
						},
						onFinish = slot0
					})
				end)
				table.insert(slot1, function (slot0, slot1)
					uv0.DormDownloadLock = nil

					pg.m02:sendNotification(uv0.NotifyDormDownloadFinish, uv0.DormDownloadLock.roomId)
					slot0(slot1)
				end)
			end
		end

		seriesAsync(slot1, slot0.finishFunc)
	end,
	ExtraDownload = function (slot0)
		slot1 = slot0.onFinish
		slot2 = slot0.dataList[1]

		if (#slot2.fileNameList &lt;= 0 or not GroupHelper.CreateArrByLuaFileList(slot2.groupName, slot2.fileNameList)) and not nil or slot4.Length == 0 then
			slot1()

			return
		end

		slot8 = pg.m02

		slot8:sendNotification(uv0.NotifyDormDownloadStart)

		slot8 = BundleWizardUpdater.Inst
		slot9 = BundleWizardUpdater.Inst
		slot10 = BundleWizardUpdater.Inst

		slot10:StartUpdate(slot9:CreateListInfo(slot2.groupName, slot8:GetFileList(slot2.groupName, slot2.fileNameList), function (slot0, slot1, slot2)
		end, function (slot0, slot1)
			pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataDownload(uv0.DormDownloadLock.roomId, slot0 and 1 or 2))

			if slot0 then
				uv1(true)
			else
				slot3 = function()
					uv0()
				end

				pg.MsgboxMgr.GetInstance():ShowMsgBox({
					modal = true,
					locked = true,
					content = i18n(&quot;file_down_mgr_error&quot;, &quot;&quot;, &quot;&quot;),
					onYes = function ()
						uv0.ExtraDownload(uv1)
					end,
					onNo = slot3,
					onClose = slot3,
					weight = LayerWeightConst.TOP_LAYER
				})
			end
		end, function (slot0, slot1, slot2, slot3, slot4, slot5)
			slot7 = tonumber(tostring(slot4))

			if uv0.DormDownloadLock.curSize ~= tonumber(tostring(slot3)) then
				uv0.DormDownloadLock.curSize = slot6
				uv0.DormDownloadLock.totalSize = slot7

				pg.m02:sendNotification(uv0.NotifyDormDownloadProgress)
			end
		end))
	end,
	IsDownloading = function ()
		slot0 = GroupHelper.GetGroupMgrByName(uv0.DormGroupName)

		return uv0.DormDownloadLock or GroupHelper.GetGroupMgrByName(uv0.DormGroupName).state == DownloadState.Updating
	end,
	GetDownloadList = function ()
		slot0 = {}

		if GroupHelper.GetGroupMgrByName(uv0.DormGroupName).toUpdate then
			for slot6 = 0, slot1.toUpdate.Count - 1 do
				slot7 = slot1.toUpdate[slot6]
				slot9 = slot7[1]
				slot10 = slot7[2]

				table.insert(slot0, slot7[0])
			end
		end

		return slot0
	end,
	GetDownloadResourceDic = function ()
		if not uv0 then
			uv0 = {}

			for slot3, slot4 in ipairs(pg.dorm3d_rooms.all) do
				if pg.dorm3d_rooms[slot4].is_common ~= 1 then
					uv0[string.lower(slot5.resource_name)] = true
				end
			end
		end

		slot0 = {}

		for slot4, slot5 in ipairs(DormGroupConst.GetDownloadList()) do
			slot6 = &quot;common&quot;

			for slot10, slot11 in pairs(uv1) do
				slot12, slot13 = string.find(slot5, slot11)

				if slot13 then
					if uv0[string.split(string.sub(slot5, slot13 + 1), &quot;/&quot;)[1]] then
						slot6 = slot10 .. &quot;_&quot; .. slot14
					end

					break
				end
			end

			slot0[slot6] = slot0[slot6] or {}

			table.insert(slot0[slot6], slot5)
		end

		return slot0
	end,
	GetFilePathList = function (slot0)
		slot1 = Application.persistentDataPath .. &quot;/AssetBundles/&quot;
		slot2 = slot1 .. slot0

		if not slot1:match(&quot;/$&quot;) then
			slot1 = slot1 .. &quot;/&quot;
		end

		originalPrint(&quot;fullCacheDirPath&quot;, tostring(slot1))
		originalPrint(&quot;shortDirPath:&quot;, tostring(slot0))
		originalPrint(&quot;fullDirPath&quot;, tostring(slot2))

		slot3 = {}
		slot4 = System.IO.Directory
		slot5 = ReflectionHelp.RefGetField(typeof(&quot;System.IO.SearchOption&quot;), &quot;AllDirectories&quot;, nil)

		originalPrint(&quot;fullDirPath Exist:&quot;, tostring(slot4.Exists(slot2)))

		if slot4.Exists(slot2) then
			for slot10, slot11 in ipairs(slot4.GetFiles(slot2, &quot;*&quot;, slot5):ToTable()) do
				table.insert(slot3, string.sub(slot11.gsub(slot11, &quot;\\&quot;, &quot;/&quot;), #slot1 + 1))
			end
		end

		originalPrint(&quot;filePathList first:&quot;, tostring(slot3[1]))
		originalPrint(&quot;filePathList last:&quot;, tostring(slot3[#slot3]))

		return slot3
	end,
	DelDir = function (slot0)
		if #uv0.GetFilePathList(slot0) &gt; 0 then
			slot3 = System.Array.CreateInstance(typeof(System.String), slot2)

			for slot7 = 0, slot2 - 1 do
				slot3[slot7] = slot1[slot7 + 1]
			end

			HotfixHelper.DeleteFileByShortPathArr(uv0.DormGroupName, slot3)
		end
	end,
	GetDelRoomSize = function (slot0, slot1)
		slot2 = 0

		for slot6, slot7 in ipairs(slot1) do
			slot2 = slot2 + uv1.GetDormMgr():GetCacheFileSize(uv1.GetFilePathList(uv0[slot7] .. slot0))
		end

		return HashUtil.BytesToString(slot2)
	end,
	DelRoom = function (slot0, slot1)
		for slot5, slot6 in ipairs(slot1) do
			uv0.DelDir(uv1[slot6] .. slot0)
		end
	end
}
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>