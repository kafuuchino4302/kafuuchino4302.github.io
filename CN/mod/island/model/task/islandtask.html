<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandtask.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandtask.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandTask&quot;, import(&quot;model.vo.BaseVO&quot;))

slot0.Ctor = function(slot0, slot1)
	slot0.id = slot1.id
	slot0.configId = slot0.id
	slot0.acceptTime = slot1.timestamp or 0

	slot0:InitEndTime()
	slot0:UpdateTargetData(slot1.process_list)
end

slot0.bindConfigTable = function(slot0)
	return pg.island_task
end

slot0.GetAcceptTime = function(slot0)
	return slot0.acceptTime
end

slot0.InitEndTime = function(slot0)
	if slot0:getConfig(&quot;unlock_condition&quot;) == &quot;&quot; or #slot1 == 0 then
		slot0.endTime = 0
	end

	if not underscore.detect(slot1, function (slot0)
		return slot0[1] == IslandTaskConditionType.IN_TIME
	end) then
		slot0.endTime = 0
	else
		slot0.endTime = pg.TimeMgr.GetInstance():parseTimeFromConfig(slot2[2][2])
	end
end

slot0.SetEndTime = function(slot0, slot1)
	slot0.endTime = slot1
end

slot0.UpdateTargetData = function(slot0, slot1)
	slot2 = {}

	for slot6, slot7 in ipairs(slot1) do
		slot2[slot7.target_id] = slot7
	end

	slot0.targetList = {}
	slot6 = &quot;target_id&quot;

	for slot6, slot7 in ipairs(slot0:getConfig(slot6)) do
		table.insert(slot0.targetList, IslandTaskTarget.New(slot2[slot7] or {
			target_id = slot7
		}))
	end
end

slot0.GetTargetList = function(slot0)
	return slot0.targetList
end

slot0.GetTargetById = function(slot0, slot1)
	return underscore.detect(slot0.targetList, function (slot0)
		return slot0.id == uv0
	end)
end

slot0.GetRecycleItemInfos = function(slot0)
	underscore.each(slot0.targetList, function (slot0)
		if slot0:GetType() == IslandTaskTargetType.RECYCLE then
			table.insert(uv0, Drop.New({
				type = DROP_TYPE_ISLAND_ITEM,
				id = slot0:GetTargetId(),
				count = slot0:GetTargetNum()
			}))
		end
	end)

	return {}
end

slot0.ExistTargetType = function(slot0, slot1)
	return underscore.any(slot0.targetList, function (slot0)
		return slot0:GetType() == uv0
	end)
end

slot0.GetTargetIdByTypeAndParam = function(slot0, slot1, slot2)
	slot3 = {}

	for slot7, slot8 in ipairs(slot0.targetList) do
		if slot8:CheckTypeAndTargetId(slot1, slot2) and not table.contains(slot3, slot8.id) then
			table.insert(slot3, slot8.id)
		end
	end

	return slot3
end

slot0.GetRemainTimeStr = function(slot0)
	slot1 = slot0.endTime - pg.TimeMgr.GetInstance():GetServerTime()

	return i18n(&quot;island_task_lefttime&quot;, math.floor(slot1 / 86400), math.floor(slot1 % 86400 / 3600))
end

slot0.IsFinish = function(slot0)
	return underscore.all(slot0.targetList, function (slot0)
		return slot0:IsFinish()
	end)
end

slot0.IsSubmitOnUI = function(slot0)
	return slot0:getConfig(&quot;complete_type&quot;) == 3
end

slot0.GetSubmitObjectId = function(slot0)
	return slot0:getConfig(&quot;complete_data&quot;)
end

slot0.IsSubmitImmediately = function(slot0)
	return slot0:getConfig(&quot;complete_type&quot;) == 2 and slot0:GetSubmitObjectId() == 0
end

slot0.CheckSubmitOnApproach = function(slot0, slot1)
	return slot0:GetSubmitObjectId() == slot1 and slot0:getConfig(&quot;complete_type&quot;) == 2
end

slot0.GetFinishedDesc = function(slot0)
	return slot0:getConfig(&quot;complete_tips&quot;)
end

slot0.InTime = function(slot0)
	if slot0.endTime == 0 then
		return true
	end

	return pg.TimeMgr.GetInstance():GetServerTime() &lt; slot0.endTime
end

slot0.GetType = function(slot0)
	return slot0:getConfig(&quot;type&quot;)
end

slot0.GetShowType = function(slot0)
	return IslandTaskType.Type2ShowType[slot0:getConfig(&quot;type&quot;)]
end

slot0.GetName = function(slot0)
	return slot0:getConfig(&quot;name&quot;)
end

slot0.GetDesc = function(slot0)
	return slot0:getConfig(&quot;task_desc&quot;)
end

slot0.IsSeries = function(slot0)
	return slot0:getConfig(&quot;series&quot;) ~= &quot;&quot;
end

slot0.GetSeriesTitle = function(slot0)
	return slot0:getConfig(&quot;series&quot;) .. &quot; &quot; .. slot0:getConfig(&quot;series_name&quot;)
end

slot0.GetAddedStory = function(slot0)
	return slot0:getConfig(&quot;rec_perform&quot;)
end

slot0.GetSubmitStory = function(slot0)
	return slot0:getConfig(&quot;com_perform&quot;)
end

slot0.GetTraceId = function(slot0)
	return slot0:getConfig(&quot;navigation&quot;)
end

slot0.GetTraceParam = function(slot0)
	for slot4, slot5 in ipairs(slot0.targetList) do
		if not slot5:IsFinish() then
			return slot5:GetTrackParma(), slot4
		end
	end

	return slot0:GetSubmitObjectId() ~= 0 and slot0:GetSubmitObjectId() or &quot;&quot;
end

slot0.GetAwards = function(slot0)
	slot1 = underscore.map(slot0:getConfig(&quot;reward_show&quot;), function (slot0)
		return Drop.Create(slot0)
	end)

	if slot0:GetExpAward() then
		table.insert(slot1, slot0:GetExpAward())
	end

	return slot1
end

slot0.GetExp = function(slot0)
	return slot0:getConfig(&quot;reward_exp&quot;)
end

slot0.GetExpAward = function(slot0)
	if slot0:GetExp() ~= 0 then
		return {
			id = 2,
			type = DROP_TYPE_ISLAND_ITEM,
			count = slot0:GetExp()
		}
	end

	return nil
end

slot0.GetAwardsStatic = function(slot0)
	return underscore.map(pg.island_task[slot0].reward_show, function (slot0)
		return Drop.Create(slot0)
	end)
end

slot0.GetSubmitPlayInfo = function(slot0)
	if pg.island_task[slot0].com_perform == &quot;&quot; or #slot1 == 0 then
		return nil
	end

	return slot1[1], slot1[2]
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>