<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandnormalhudpanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandnormalhudpanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandNormalHudPanel&quot;, import(&quot;Mod.Island.Core.View.IslandBaseHudPanel&quot;))

slot0.GetUIName = function(slot0)
	return &quot;IslandNormalNpcHud&quot;
end

slot0.Ctor = function(slot0, slot1, slot2, slot3)
	uv0.super.Ctor(slot0, slot1, slot2, slot3)

	slot0.hud_name_range = pg.island_set.hud_name_range.key_value_int
	slot0.currentTaskType = -1
	slot0.currentTaskId = -1
end

slot0.OnInit = function(slot0)
	slot0.npcId = tonumber(slot0.param1)
	slot0.hudImageTF = slot0._tf:Find(&quot;hud_bg/hudImage&quot;)
	slot0.hudImageBg = slot0._tf:Find(&quot;hud_bg&quot;)
	slot1 = pg.island_npc_hud[slot0.npcId]
	slot0.hudImageIcon = slot1.icon
	slot0.hudTitle = slot0._tf:Find(&quot;title&quot;)
	slot0.hudName = slot0._tf:Find(&quot;name&quot;)

	setText(slot0.hudTitle, slot1.title)
	setText(slot0.hudName, slot1.name)

	slot0.playerTF = slot0:GetPlayer().transform
	slot0.isNear = slot0:CheckIsNear()

	setActive(slot0.hudTitle, slot0.isNear)
	setActive(slot0.hudName, slot0.isNear)
	slot0:UpdateTaskDisplay()
end

slot0.OnDispose = function(slot0)
	uv0.super.OnDispose(slot0)
end

slot0.GetPlayer = function(slot0)
	for slot6, slot7 in ipairs(GameObject.Find(&quot;Root&quot;):GetComponentsInChildren(typeof(&quot;WorldObjectItem&quot;)):ToTable()) do
		if slot7.isPlayer then
			return slot7.gameObject
		end
	end

	return nil
end

slot0.CheckIsNear = function(slot0)
	slot2 = slot0.view:GetUnitModuleWithType(slot0.unitType, slot0.unitId) and slot1._go or nil

	if not slot1 or IsNil(slot2) then
		return false
	end

	if (slot0.playerTF.position - slot2.transform.position).magnitude &lt; slot0.hud_name_range then
		return true
	end

	return false
end

slot0.OnUpdate = function(slot0)
	if slot0:CheckIsNear() == slot0.isNear then
		return
	end

	slot0.isNear = slot1

	setActive(slot0.hudTitle, slot0.isNear)
	setActive(slot0.hudName, slot0.isNear)
end

slot0.RefreshHud = function(slot0)
	slot0:UpdateTaskDisplay()
end

slot0.UpdateTaskDisplay = function(slot0)
	slot1, slot2 = IslandObjectTaskHudHelper.GetObjectTaskHud(slot0.unitId)

	if slot0.currentTaskId ~= slot2 then
		slot0.currentTaskId = slot2

		if slot2 then
			slot3, slot4 = IslandObjectTaskHudHelper.GetHudDislayInfoByTaskId(slot2)

			setActive(slot0.hudImageBg, true)
			GetImageSpriteFromAtlasAsync(&quot;island/IslandHudIcon&quot;, slot3, slot0.hudImageBg)
			setImageColor(slot0.hudImageTF, Color.NewHex(slot4))
		else
			setActive(slot0.hudImageBg, slot0.hudImageIcon ~= &quot;&quot;)
			GetImageSpriteFromAtlasAsync(&quot;island/IslandHudIcon&quot;, &quot;hud_main&quot;, slot0.hudImageBg)
			setImageColor(slot0.hudImageTF, Color.NewHex(&quot;78787a&quot;))
		end
	end

	if slot1 ~= slot0.currentTaskType then
		slot0.currentTaskType = slot1
		slot3 = IslandObjectTaskHudHelper.TaskProcessToHudIcon[slot1] or slot0.hudImageIcon

		setActive(slot0.hudImageBg, slot3 ~= &quot;&quot;)

		if slot3 ~= &quot;&quot; then
			GetImageSpriteFromAtlasAsync(&quot;island/IslandHudIcon&quot;, slot3, slot0.hudImageTF)
		end
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>