<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandtechquickpanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandtechquickpanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandTechQuickPanel&quot;, import(&quot;view.base.BaseSubView&quot;))
slot0.TOGGLE_STATUS = {
	NORMAL = &quot;normal&quot;,
	FINISHED = &quot;finished&quot;,
	STUDYING = &quot;studying&quot;
}

slot0.getUIName = function(slot0)
	return &quot;IslandTechQuickPanel&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.toggle = slot0._tf:Find(&quot;toggle&quot;)
	slot0.panel = slot0._tf:Find(&quot;panel&quot;)
	slot1 = slot0.panel:Find(&quot;content&quot;)
	slot0.uiList = UIItemList.New(slot1, slot1:Find(&quot;tpl&quot;))

	setText(slot1:Find(&quot;tpl/content/get/Image/Text&quot;), i18n(&quot;island_tech_can_get&quot;))
	setText(slot0.toggle:Find(&quot;normal/Text&quot;), i18n(&quot;island_tech_nodev&quot;))
	setText(slot0.toggle:Find(&quot;studying/Text&quot;), i18n(&quot;island_tech_dev_starting&quot;))
	setText(slot0.toggle:Find(&quot;finished/Text&quot;), i18n(&quot;island_tech_dev_finish_1&quot;))
end

slot0.OnInit = function(slot0)
	slot0.slotIds = IslandTechnologyAgency.GetSlotIds()
	slot1 = slot0.uiList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:UpdateItem(slot1, slot2)
		end
	end)

	slot0.timeMgr = pg.TimeMgr.GetInstance()
	slot3 = slot0._tf

	onButton(slot0, slot3:Find(&quot;off&quot;), function ()
		triggerToggle(uv0.toggle, false)
	end, SFX_PANEL)
	onToggle(slot0, slot0.toggle, function (slot0)
		if slot0 then
			pg.UIMgr.GetInstance():OverlayPanelPB(uv0._tf, {
				pbList = {
					uv0.panel
				},
				groupName = LayerWeightConst.GROUP_ISLAND
			})
		else
			pg.UIMgr.GetInstance():UnOverlayPanel(uv0._tf, uv0._parentTf)
		end
	end, SFX_PANEL)
end

slot0.UpdateItem = function(slot0, slot1, slot2)
	slot5 = slot0.buildingData:GetDelegationSlotData(slot0.slotIds[slot1 + 1]) and slot4:GetFormulaId()

	setActive(slot2:Find(&quot;lock&quot;), not slot4)
	setActive(slot2:Find(&quot;empty&quot;), slot4 and not slot5)
	setActive(slot2:Find(&quot;content&quot;), slot5)

	if slot5 then
		slot6 = slot2:Find(&quot;content&quot;)

		setText(slot6:Find(&quot;title&quot;), slot0.technologyAgency:GetTechnologyByFormulaId(slot5):getConfig(&quot;tech_name&quot;))

		slot8 = slot4:GetSlotRoleData()

		setActive(slot6:Find(&quot;icon_bg&quot;), slot8)

		if slot8 then
			GetImageSpriteFromAtlasAsync(&quot;squareicon/&quot; .. IslandShip.StaticGetPrefab(slot8.ship_id), &quot;&quot;, slot6:Find(&quot;icon_bg/mask/icon&quot;))

			slot10 = slot8:GetFinishTime() - slot0.timeMgr:GetServerTime()

			setSlider(slot6:Find(&quot;silder&quot;), 0, 1, 1 - slot10 / slot8:GetAllTime())
			setText(slot6:Find(&quot;silder/Text&quot;), slot0.timeMgr:DescCDTime(slot10))
		end

		slot9 = slot4:GetSlotRewardData()

		setActive(slot6:Find(&quot;get&quot;), slot9)
		setActive(slot6:Find(&quot;silder&quot;), not slot9)
	end
end

slot0.Flush = function(slot0)
	slot0:StopTimer()

	slot1 = getProxy(IslandProxy):GetIsland()
	slot0.technologyAgency = slot1:GetTechnologyAgency()
	slot0.buildingData = slot1:GetBuildingAgency():GetBuilding(IslandTechnologyAgency.PLACE_ID)

	slot0.uiList:align(#slot0.slotIds)
	slot0:StartTimer()
	slot0:UpdateTime()
end

slot0.GetToggleStatus = function(slot0)
	for slot4, slot5 in ipairs(slot0.slotIds) do
		if slot0.buildingData:GetDelegationSlotData(slot5) and slot6:GetSlotRewardData() then
			return uv0.TOGGLE_STATUS.FINISHED
		end

		if slot6 and slot6:GetSlotRoleData() then
			return uv0.TOGGLE_STATUS.STUDYING
		end
	end

	return uv0.TOGGLE_STATUS.NORMAL
end

slot0.UpdateToggleStatus = function(slot0)
	eachChild(slot0.toggle, function (slot0)
		setActive(slot0, slot0.name == uv0.status)
	end)
end

slot0.QuickGetAward = function(slot0)
	slot1 = underscore.detect(slot0.slotIds, function (slot0)
		return uv0.buildingData:GetDelegationSlotData(slot0) and slot1:GetSlotRewardData()
	end)
	slot2 = slot0.buildingData
	slot2 = slot2:GetDelegationSlotData(slot1)
	slot3 = slot0.technologyAgency
	slot3 = slot3:GetTechnologyByFormulaId(slot2:GetSlotRewardData().formula_id).id

	slot0:emit(IslandMediator.GET_DELEGATION_AWARD, IslandTechnologyAgency.PLACE_ID, slot1, 2, function ()
		existCall(uv0.contextData.onGetAwardDone, uv1)
	end)
end

slot0.UpdateTime = function(slot0)
	slot0.status = slot0:GetToggleStatus()

	slot0.uiList:eachActive(function (slot0, slot1)
		if uv0.buildingData:GetDelegationSlotData(uv0.slotIds[slot0 + 1]) and slot3:GetFormulaId() then
			slot6 = slot3:GetSlotRoleData()

			setActive(slot1:Find(&quot;content&quot;):Find(&quot;icon_bg&quot;), slot6)

			if slot6 then
				slot7 = slot6:GetFinishTime() - uv0.timeMgr:GetServerTime()

				setSlider(slot5:Find(&quot;silder&quot;), 0, 1, 1 - slot7 / slot6:GetAllTime())
				setText(slot5:Find(&quot;silder/Text&quot;), uv0.timeMgr:DescCDTime(slot7))
			end

			slot7 = slot3:GetSlotRewardData()

			setActive(slot5:Find(&quot;get&quot;), slot7)
			setActive(slot5:Find(&quot;silder&quot;), not slot7)
			onButton(uv0, slot1, function ()
				if not uv0 then
					return
				end

				uv1:QuickGetAward()
			end, SFX_PANEL)

			return
		end

		removeOnButton(slot1)
	end)
	slot0:UpdateToggleStatus()
end

slot0.StartTimer = function(slot0)
	slot0.timer = Timer.New(function ()
		uv0:UpdateTime()
	end, 1, -1)

	slot0.timer:Start()
end

slot0.StopTimer = function(slot0)
	if slot0.timer ~= nil then
		slot0.timer:Stop()

		slot0.timer = nil
	end
end

slot0.OffToggle = function(slot0)
	triggerToggle(slot0.toggle, false)
end

slot0.Hide = function(slot0)
	slot0:OffToggle()
	uv0.super.Hide(slot0)
end

slot0.OnDestroy = function(slot0)
	slot0:StopTimer()
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf, slot0._parentTf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>