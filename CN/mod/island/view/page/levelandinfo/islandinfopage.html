<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandinfopage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandinfopage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandInfoPage&quot;, import(&quot;...base.IslandBasePage&quot;))

slot0.getUIName = function(slot0)
	return &quot;IslandInfoUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.backBtn = slot0:findTF(&quot;frame/back&quot;)
	slot0.levelTxt = slot0:findTF(&quot;frame/left/level&quot;):GetComponent(typeof(Text))
	slot0.expTxt = slot0:findTF(&quot;frame/left/objective/exp&quot;):GetComponent(typeof(Text))
	slot0.goldTxt = slot0:findTF(&quot;frame/left/objective/gold&quot;):GetComponent(typeof(Text))
	slot0.expProgress = slot0:findTF(&quot;frame/left/exp/bar&quot;)
	slot0.preViewBtn = slot0:findTF(&quot;frame/left/preview&quot;)
	slot0.prosperityLevel = slot0:findTF(&quot;frame/right/prosperity/level&quot;):GetComponent(typeof(Text))
	slot0.prosperityExp = slot0:findTF(&quot;frame/right/prosperity/exp&quot;):GetComponent(typeof(Text))
	slot0.prosperityIcon = slot0:findTF(&quot;frame/right/prosperity/icon&quot;)
	slot0.nameTxt = slot0:findTF(&quot;frame/left/name/Text&quot;):GetComponent(typeof(Text))
	slot0.editNameBtn = slot0:findTF(&quot;frame/left/name&quot;)
	slot0.uiShipList = UIItemList.New(slot0:findTF(&quot;frame/right/ships/list&quot;), slot0:findTF(&quot;frame/right/ships/list/tpl&quot;))
	slot0.upgradePreviewPanel = slot0:findTF(&quot;frame/left/upgrade_preview&quot;)
	slot0.upgradeAwardList = UIItemList.New(slot0:findTF(&quot;frame/left/upgrade_preview/content/awards/list/content&quot;), slot0:findTF(&quot;frame/left/upgrade_preview/content/awards/list/content/tpl&quot;))
	slot0.upgradeUnlockList = UIItemList.New(slot0:findTF(&quot;frame/left/upgrade_preview/content/unlock/list/content&quot;), slot0:findTF(&quot;frame/left/upgrade_preview/content/awards/list/content/tpl&quot;))
	slot0.prosperityLevelList = UIItemList.New(slot0:findTF(&quot;frame/right/prosperity/objective/content&quot;), slot0:findTF(&quot;frame/right/prosperity/objective/content/tpl&quot;))
	slot0.prosperityAwardList = UIItemList.New(slot0:findTF(&quot;frame/right/prosperity/objective/awards&quot;), slot0:findTF(&quot;frame/right/prosperity/objective/awards/tpl&quot;))
	slot0.getProsperityBtn = slot0:findTF(&quot;frame/right/prosperity/objective/get_btn&quot;)
	slot0.goProsperityBtn = slot0:findTF(&quot;frame/right/prosperity/objective/go_btn&quot;)
	slot0.goProsperityBtnTxt = slot0:findTF(&quot;frame/right/prosperity/objective/go_btn/Text&quot;):GetComponent(typeof(Text))

	setText(slot0:findTF(&quot;frame/left/preview/Text&quot;), i18n(&quot;island_upgrade_preview&quot;))
	setText(slot0:findTF(&quot;frame/left/objective/label_exp&quot;), i18n(&quot;island_upgrade_exp&quot;))
	setText(slot0:findTF(&quot;frame/left/objective/label_gold&quot;), i18n(&quot;island_upgrade_res&quot;))
	setText(slot0:findTF(&quot;frame/left/upgrade_preview/content/awards/label&quot;), i18n(&quot;island_word_award&quot;))
	setText(slot0:findTF(&quot;frame/left/upgrade_preview/content/unlock/label&quot;), i18n(&quot;island_word_unlock&quot;))
	setText(slot0:findTF(&quot;frame/right/prosperity/objective/get_btn/Text&quot;), i18n(&quot;island_word_get&quot;))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.editNameBtn, function ()
		uv0:OpenPage(IslandEditNamePage)
	end, SFX_PANEL)

	slot0.showPreviewPanel = false
	slot0.displayPreviewLevel = -1

	onButton(slot0, slot0.preViewBtn, function ()
		if getProxy(IslandProxy):GetIsland():IsMaxLevel() then
			return
		end

		uv0.showPreviewPanel = not uv0.showPreviewPanel

		setActive(uv0.upgradePreviewPanel, uv0.showPreviewPanel)

		slot1 = slot0:GetLevel()

		if uv0.showPreviewPanel and uv0.displayPreviewLevel ~= slot1 then
			uv0.displayPreviewLevel = slot1

			uv0:InitUpgradeAwards(slot0)
		end
	end, SFX_PANEL)
end

slot0.AddListeners = function(slot0)
	slot0:AddListener(GAME.ISLAND_UPGRADE_DONE, slot0.OnUpgrade)
	slot0:AddListener(GAME.ISLAND_PROSPERITY_AWARD_DONE, slot0.OnGetAward)
	slot0:AddListener(GAME.ISLAND_SET_NAME_DONE, slot0.OnModifyName)
end

slot0.RemoveListeners = function(slot0)
	slot0:RemoveListener(GAME.ISLAND_UPGRADE_DONE, slot0.OnUpgrade)
	slot0:RemoveListener(GAME.ISLAND_PROSPERITY_AWARD_DONE, slot0.OnGetAward)
	slot0:RemoveListener(GAME.ISLAND_SET_NAME_DONE, slot0.OnModifyName)
end

slot0.OnUpgrade = function(slot0)
	slot0:UpdateLevel(getProxy(IslandProxy):GetIsland())
end

slot0.OnGetAward = function(slot0)
	slot0:UpdateProsperity(getProxy(IslandProxy):GetIsland())
end

slot0.OnModifyName = function(slot0)
	slot0:UpdateName(getProxy(IslandProxy):GetIsland())
end

slot0.Show = function(slot0)
	uv0.super.Show(slot0)

	slot1 = getProxy(IslandProxy):GetIsland()

	slot0:UpdateLevel(slot1)
	slot0:UpdateProsperity(slot1)
	slot0:UpdateName(slot1)
	slot0:UpdateShips(slot1)
	pg.UIMgr.GetInstance():OverlayPanel(slot0._tf, {
		pbList = {
			slot0:findTF(&quot;frame/right&quot;)
		},
		weight = LayerWeightConst.SECOND_LAYER
	})
end

slot0.Hide = function(slot0)
	uv0.super.Hide(slot0)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf, slot0._parentTf)
end

slot0.InitUpgradeAwards = function(slot0, slot1)
	slot0.upgradeAwardList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			updateCustomDrop(slot2, Drop.Create(uv0[slot1 + 1]))
		end
	end)
	slot0.upgradeAwardList:align(#slot1:GetUpgradeAwards())
	slot0.upgradeUnlockList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			updateCustomDrop(slot2, Drop.Create(uv0[slot1 + 1]))
		end
	end)
	slot0.upgradeUnlockList:align(#slot1:GetUnlockBuildingList())
end

slot0.UpdateLevel = function(slot0, slot1)
	slot0.levelTxt.text = slot1:GetLevel()
	slot2 = slot1:GetExp()
	slot3 = slot1:GetTargeExp()

	customColorCount(slot0.expTxt, slot2, slot3, &quot;#39bfff&quot;, &quot;#f36c6e&quot;)
	setFillAmount(slot0.expProgress, Mathf.Clamp01(slot2 / slot3))
end

slot0.UpdateProsperity = function(slot0, slot1)
	slot0.prosperityLevelList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = pg.island_prosperity.all[slot1 + 1]

			uv0:UpdateProsperityCard(slot2, slot3, uv1)

			uv2[slot3] = slot2
		end
	end)
	slot0.prosperityLevelList:align(#pg.island_prosperity.all)

	if ({})[slot1:GetProsperityLevel()] or slot2[1] then
		triggerToggle(slot4, true)
	end
end

slot0.UpdateProsperityCard = function(slot0, slot1, slot2, slot3)
	slot4 = slot3:CanGetProsperityAwards(slot2)
	slot5 = slot3:IsReceiveProsperityAwards(slot2)
	slot6 = slot3:GetProsperityLevel() == slot2

	setActive(slot1:Find(&quot;line&quot;), slot3:GetMaxProsperityLevel() ~= slot2)
	setActive(slot1:Find(&quot;got&quot;), slot5)
	setActive(slot1:Find(&quot;get&quot;), slot4)
	setActive(slot1:Find(&quot;lock&quot;), not slot4 and not slot5 and not slot6)
	setActive(slot1:Find(&quot;curr&quot;), slot6 and not slot5)
	onToggle(slot0, slot1, function ()
		uv0:FlushProsperity(uv1, uv2, uv3, uv4)
	end, SFX_PANEL)
end

slot0.FlushProsperity = function(slot0, slot1, slot2, slot3, slot4)
	slot0.prosperityLevel.text = ArabicToRoman(slot2)
	slot0.prosperityExp.text = i18n(&quot;island_prosperity_level_display&quot;, slot1:GetProsperity() .. &quot;/&quot; .. slot1:GetTargetProsperityByLevel(slot2))

	slot0.prosperityAwardList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			updateCustomDrop(slot2, Drop.Create(uv0[slot1 + 1]))
		end
	end)
	slot0.prosperityAwardList:align(#slot1:GetProsperityAward(slot2))
	setActive(slot0.getProsperityBtn, slot3)
	setActive(slot0.goProsperityBtn, not slot4 and not slot3)

	slot0.goProsperityBtnTxt.text = i18n(&quot;island_prosperity_value_display&quot;, slot7)

	onButton(slot0, slot0.getProsperityBtn, function ()
		uv0:emit(IslandMediator.GET_PROSPERITY_AWARD, uv1)
	end, SFX_PANEL)
	GetImageSpriteFromAtlasAsync(&quot;island/IslandProsperityIcon/&quot; .. slot2, &quot;&quot;, slot0.prosperityIcon)
end

slot0.UpdateName = function(slot0, slot1)
	slot0.nameTxt.text = slot1:GetName()
end

slot0.UpdateShips = function(slot0, slot1)
	slot2 = slot1:GetCharacterAgency():GetShips()

	slot0.uiShipList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv1:UpdateShipCard(slot2, uv0[slot1 + 1])
		end
	end)
	slot0.uiShipList:align(5)
end

slot0.UpdateShipCard = function(slot0, slot1, slot2)
	slot3 = slot2 == nil

	setActive(slot1:Find(&quot;add&quot;), slot3)
	setActive(slot1:Find(&quot;ship&quot;), not slot3)

	if not slot3 then
		GetImageSpriteFromAtlasAsync(&quot;SquareIcon/&quot; .. slot2:GetPrefab(), &quot;&quot;, slot1:Find(&quot;ship/mask/icon&quot;))
	end

	onButton(slot0, slot1, function ()
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_comingSoon&quot;))
	end, SFX_PANEL)
end

slot0.OnDestroy = function(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>