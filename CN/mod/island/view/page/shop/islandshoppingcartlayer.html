<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandshoppingcartlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandshoppingcartlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandShoppingCartLayer&quot;, import(&quot;...base.IslandBasePage&quot;))

slot0.getUIName = function(slot0)
	return &quot;IslandShoppingCartUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.panel = slot0._tf:Find(&quot;panel&quot;)
	slot0.closeBtn = slot0.panel:Find(&quot;closeBtn&quot;)
	slot0.commodityList = slot0.panel:Find(&quot;commodityList/Viewport/Content&quot;)
	slot0.cancelBtn = slot0.panel:Find(&quot;cancelBtn&quot;)
	slot0.buyBtn = slot0.panel:Find(&quot;buyBtn&quot;)
	slot0.consumeIcon = slot0.buyBtn:Find(&quot;consume/icon&quot;)
	slot0.consumeCount = slot0.buyBtn:Find(&quot;consume/count&quot;)
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)

	slot3 = slot0._tf

	onButton(slot0, slot3:Find(&quot;bg&quot;), function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.cancelBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
end

slot0.SetUp = function(slot0, slot1)
	slot2, slot3 = nil
	slot4 = 0

	for slot8 = 1, 3 do
		setActive(slot0.commodityList:Find(&quot;commodity&quot; .. slot8):Find(&quot;normal&quot;), slot8 &lt;= #slot1)
		setActive(slot9:Find(&quot;nothing&quot;), slot8 &gt; #slot1)

		if slot8 &lt;= #slot1 then
			slot10 = slot1[slot8]

			GetImageSpriteFromAtlasAsync(slot10:GetIcon(), &quot;&quot;, slot9:Find(&quot;normal/IslandItemTpl/icon_bg/icon&quot;))
			setText(slot9:Find(&quot;normal/name&quot;), slot10:GetName())
			setActive(slot9:Find(&quot;normal/count&quot;), false)

			if #slot10:GetItems() == 1 then
				slot11 = 0

				if slot10:GetItems()[1][1] == DROP_TYPE_ISLAND_FURNITURE then
					for slot17, slot18 in ipairs(getProxy(IslandProxy):GetIsland():GetAgoraAgency():GetFurnitures()) do
						if slot18.id == slot10:GetItems()[1][2] then
							slot11 = slot18.count

							break
						end
					end

					setActive(slot9:Find(&quot;normal/count&quot;), true)
					setText(slot9:Find(&quot;normal/count&quot;), &quot;拥有数量(&quot; .. slot11 .. &quot;)&quot;)
				elseif slot10:GetItems()[1][1] == DROP_TYPE_ISLAND_DRESS and pg.island_dress_template[slot10:GetItems()[1][2]].belongto == 2 then
					setActive(slot9:Find(&quot;normal/count&quot;), true)
					setText(slot9:Find(&quot;normal/count&quot;), &quot;拥有数量(&quot; .. getProxy(IslandProxy):GetIsland():GetCharacterAgency():GetOwnDressCountByDressId(slot12) .. &quot;)&quot;)
				end
			end

			slot11 = slot10:GetResourceConsume()

			GetImageSpriteFromAtlasAsync(Drop.New({
				type = slot11[1],
				id = slot11[2]
			}):getIcon(), &quot;&quot;, slot9:Find(&quot;normal/consumeIcon&quot;))
			setText(slot9:Find(&quot;normal/consumeNum&quot;), slot11[3])

			slot2 = slot11[1]
			slot3 = slot11[2]
			slot4 = slot4 + slot11[3]
		end
	end

	slot6 = Drop.New({
		type = slot2,
		id = slot3
	})

	GetImageSpriteFromAtlasAsync(slot6:getIcon(), &quot;&quot;, slot0.consumeIcon)
	setText(slot0.consumeCount, slot4)
	onButton(slot0, slot0.buyBtn, function ()
		slot0 = {}

		for slot4, slot5 in ipairs(uv0) do
			table.insert(slot0, {
				value2 = 1,
				key = slot5.shopId,
				value1 = slot5.id
			})
		end

		uv1:emit(IslandMediator.BUY_COMMODITY, slot0)
	end, SFX_PANEL)
end

slot0.Refresh = function(slot0)
	slot0:SetUp(slot0.commodities)
end

slot0.OnShow = function(slot0, slot1)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false, {
		groupName = &quot;IslandShop&quot;
	})

	slot0.commodities = slot1

	slot0:SetUp(slot0.commodities)
end

slot0.OnHide = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf, slot0._parentTf)
end

slot0.OnDestroy = function(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>