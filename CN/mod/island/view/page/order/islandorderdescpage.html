<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>islandorderdescpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>islandorderdescpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;IslandOrderDescPage&quot;, import(&quot;...base.IslandBasePage&quot;))

slot0.getUIName = function(slot0)
	return &quot;IslandOrderDescUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.infoPanel = slot0:findTF(&quot;info&quot;)
	slot0.nameTxt = slot0:findTF(&quot;info/name/Text&quot;):GetComponent(typeof(Text))
	slot0.consumeUIList = UIItemList.New(slot0:findTF(&quot;info/subtitle_item/list&quot;), slot0:findTF(&quot;info/subtitle_item/list/tpl&quot;))
	slot0.awardUIList = UIItemList.New(slot0:findTF(&quot;info/subtitle_reward/list&quot;), slot0:findTF(&quot;info/subtitle_reward/list/tpl&quot;))
	slot0.submitBtn = slot0:findTF(&quot;info/btns/submit&quot;)
	slot0.submitBtnMark = slot0:findTF(&quot;info/btns/submit/mask&quot;)
	slot0.replaceBtn = slot0:findTF(&quot;info/btns/cancel&quot;)
	slot0.speedUpBtn = slot0:findTF(&quot;loading/submit&quot;)
	slot0.loadingPanel = slot0:findTF(&quot;loading&quot;)
	slot0.loadingTimeTxt = slot0.loadingPanel:Find(&quot;Text/time&quot;):GetComponent(typeof(Text))

	setText(slot0:findTF(&quot;info/btns/cancel/Text&quot;), i18n(&quot;island_word_turndown&quot;))
	setText(slot0:findTF(&quot;info/btns/submit/Text&quot;), i18n(&quot;island_word_sbumit&quot;))
	setText(slot0:findTF(&quot;loading/Text&quot;), i18n(&quot;island_order_cd_tip&quot;))
	setText(slot0:findTF(&quot;loading/submit/Text&quot;), i18n(&quot;island_word_speedup&quot;))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.replaceBtn, function ()
		uv0:emit(IslandMediator.ON_REPLACE_ORDER, uv0.slot.id)
	end, SFX_PANEL)
	onButton(slot0, slot0.submitBtn, function ()
		slot1, slot2 = getProxy(IslandProxy):GetIsland():GetOrderAgency():CanSubmitOrder()

		if not slot1 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;island_submit_order_cd_tip&quot;, pg.TimeMgr.GetInstance():DescCDTime(slot2 - pg.TimeMgr.GetInstance():GetServerTime())))

			return
		end

		uv0:emit(IslandMediator.ON_SUBMIT_ORDER, uv0.slot.id)
	end, SFX_PANEL)
	onButton(slot0, slot0.speedUpBtn, function ()
	end, SFX_PANEL)
end

slot0.AddListeners = function(slot0)
	slot0:AddListener(GAME.ISLAND_SUBMIT_ORDER_DONE, slot0.OnSubmitOrder)
	slot0:AddListener(GAME.ISLAND_REPLACE_ORDER_DONE, slot0.OnReplaceOrder)
	slot0:AddListener(IslandOrderAgency.GEN_NEW_ORDER, slot0.OnGenNewOrder)
	slot0:AddListener(IslandOrderAgency.UDPATE_ORDER, slot0.OnFlushOrder)
end

slot0.RemoveListener = function(slot0)
	slot0:RemoveListener(GAME.ISLAND_SUBMIT_ORDER_DONE, slot0.OnSubmitOrder)
	slot0:RemoveListener(GAME.ISLAND_REPLACE_ORDER_DONE, slot0.OnReplaceOrder)
	slot0:RemoveListener(IslandOrderAgency.GEN_NEW_ORDER, slot0.OnGenNewOrder)
	slot0:RemoveListener(IslandOrderAgency.UDPATE_ORDER, slot0.OnFlushOrder)
end

slot0.OnSubmitOrder = function(slot0, slot1)
	slot0:Flush(getProxy(IslandProxy):GetIsland():GetOrderAgency():GetSlot(slot1.slotId))
end

slot0.OnReplaceOrder = function(slot0, slot1)
	slot0:Flush(getProxy(IslandProxy):GetIsland():GetOrderAgency():GetSlot(slot1.slotId))
end

slot0.OnFlushOrder = function(slot0, slot1)
	slot0:TryFlushOrderInfo(slot1.slotId)
end

slot0.OnGenNewOrder = function(slot0, slot1)
	slot0:TryFlushOrderInfo(slot1.slotId)
end

slot0.TryFlushOrderInfo = function(slot0, slot1)
	slot2 = getProxy(IslandProxy):GetIsland():GetOrderAgency():GetSlot(slot1)

	if not slot0.slot then
		return
	end

	if slot0.slot.id ~= slot2.id then
		return
	end

	slot0:Flush(slot2)
end

slot0.Show = function(slot0, slot1)
	uv0.super.Show(slot0)
	slot0:Flush(slot1)
end

slot0.Flush = function(slot0, slot1)
	slot0.slot = slot1

	if not slot1 or slot1:IsEmpty() then
		slot0:Hide()

		return
	end

	slot2 = slot1:IsLoading()

	setActive(slot0.infoPanel, not slot2)
	setActive(slot0.loadingPanel, slot2)
	slot0:RemoveSubmitCdTimer()
	slot0:RemoveLoadingTimer()
	slot0:RemoveDisappearTimer()

	if slot2 then
		slot0:FlushLoadingPanel(slot1)
	else
		slot0:FlusInfoPanel(slot1)
	end

	if slot1:GetOrder():IsUrgency() then
		slot0:AddDisappearTimer(slot1)
	end
end

slot0.AddDisappearTimer = function(slot0, slot1)
	slot0:RemoveDisappearTimer()

	if slot1:GetDisappearTime() &lt;= pg.TimeMgr.GetInstance():GetServerTime() then
		slot0:Hide()

		return
	end

	slot0.disappearTimer = Timer.New(function ()
		if uv0 - pg.TimeMgr.GetInstance():GetServerTime() &lt; 0 then
			uv1:Hide()
		end
	end, 1, -1)

	slot0.disappearTimer.func()
	slot0.disappearTimer:Start()
end

slot0.RemoveDisappearTimer = function(slot0)
	if slot0.disappearTimer then
		slot0.disappearTimer:Stop()

		slot0.disappearTimer = nil
	end
end

slot0.FlushLoadingPanel = function(slot0, slot1)
	slot2 = function()
		uv0.loadingTimeTxt.text = &quot;&quot;

		uv0:Flush(uv1)
	end

	if slot1:GetCanSubmitTime() &lt;= pg.TimeMgr.GetInstance():GetServerTime() then
		slot2()

		return
	end

	slot0.loadingTimer = Timer.New(function ()
		slot1 = uv0 - pg.TimeMgr.GetInstance():GetServerTime()
		uv1.loadingTimeTxt.text = pg.TimeMgr.GetInstance():DescCDTime(slot1)

		if slot1 &lt; 0 then
			uv1:RemoveLoadingTimer()
			uv2()
		end
	end, 1, -1)

	slot0.loadingTimer:Start()
	slot0.loadingTimer.func()
end

slot0.RemoveLoadingTimer = function(slot0)
	if slot0.loadingTimer then
		slot0.loadingTimer:Stop()

		slot0.loadingTimer = nil
	end
end

slot0.FlusInfoPanel = function(slot0, slot1)
	slot2 = slot1:GetOrder()

	slot0:FlushAwards(slot2)
	slot0:FlushConsume(slot2)
	setActive(slot0.replaceBtn, not slot2:IsUrgency())

	slot0.nameTxt.text = slot2:GetRoleName()
	slot4, slot5 = getProxy(IslandProxy):GetIsland():GetOrderAgency():CanSubmitOrder()

	setActive(slot0.submitBtnMark, not slot2:CanFinish())

	if slot4 then
		slot0:SetMaskFillAmount(slot0.submitBtnMark, 1)

		return
	end

	slot6 = pg.island_set.order_complete_refresh_time.key_value_int
	slot0.submitTimer = Timer.New(function ()
		slot1 = (uv0 - pg.TimeMgr.GetInstance():GetServerTime()) / uv1

		uv2:SetMaskFillAmount(uv2.submitBtnMark, 1 - slot1)

		if slot1 &lt;= 0 then
			uv2:RemoveSubmitCdTimer()
		end
	end, 1, -1)

	slot0.submitTimer:Start()
	slot0.submitTimer.func()
end

slot0.SetMaskFillAmount = function(slot0, slot1, slot2)
	slot1:GetComponent(typeof(RectMask2D)).padding = Vector4(slot1.sizeDelta.x * slot2, 0, 0, 0)
end

slot0.FlushAwards = function(slot0, slot1)
	slot0.awardUIList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			updateCustomDrop(slot2, uv0[slot1 + 1])
		end
	end)
	slot0.awardUIList:align(#slot1:GetDisplayAwards())
end

slot0.FlushConsume = function(slot0, slot1)
	slot0.consumeUIList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0[slot1 + 1]
			slot4 = {
				count = 0,
				type = slot3.type,
				id = slot3.id
			}

			updateCustomDrop(slot2:Find(&quot;tpl&quot;), slot4)
			setText(slot2:Find(&quot;Text&quot;), slot4.cfg.name)

			if slot3.count &lt;= Drop.New({
				type = slot4.type,
				id = slot4.id
			}):getOwnedCount() then
				setText(slot2:Find(&quot;count&quot;), slot5 .. &quot;/&quot; .. slot3.count)
			else
				setText(slot2:Find(&quot;count&quot;), setColorStr(slot5, COLOR_RED) .. &quot;/&quot; .. slot3.count)
			end

			setActive(slot2:Find(&quot;finish&quot;), slot6)
			setActive(slot2:Find(&quot;line&quot;), slot1 + 1 ~= #uv0)
		end
	end)
	slot0.consumeUIList:align(#slot1:GetConsume())
end

slot0.RemoveSubmitCdTimer = function(slot0)
	if slot0.submitTimer then
		slot0.submitTimer:Stop()

		slot0.submitTimer = nil
	end
end

slot0.OnDestroy = function(slot0)
	slot0:RemoveSubmitCdTimer()
	slot0:RemoveLoadingTimer()
	slot0:RemoveDisappearTimer()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>