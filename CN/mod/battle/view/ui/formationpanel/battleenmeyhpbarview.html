<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>battleenmeyhpbarview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>battleenmeyhpbarview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">ys = ys or {}
slot1 = class(&quot;BattleEnmeyHpBarView&quot;)
ys.Battle.BattleEnmeyHpBarView = slot1
slot1.__name = &quot;BattleEnmeyHpBarView&quot;

slot1.Ctor = function(slot0, slot1)
	slot0._monsterTF = slot1
	slot0.orgPos = slot1.anchoredPosition
	slot0.HidePos = slot0.orgPos + Vector2(0, 100)
	slot0._hpBarTF = slot1:Find(&quot;hpbar&quot;)
	slot0._hpBar = slot0._hpBarTF.gameObject
	slot0._hpBarProgress = slot0._hpBarTF:GetComponent(typeof(Image))
	slot0._hpBarText = slot0._hpBarTF:Find(&quot;Text&quot;):GetComponent(typeof(Text))
	slot0._nameTF = slot1:Find(&quot;nameContain/name&quot;)
	slot0._lvText = slot1:Find(&quot;nameContain/Text&quot;):GetComponent(typeof(Text))
	slot0._level = slot1:Find(&quot;level&quot;)
	slot0._typeIcon = slot1:Find(&quot;typeIcon/icon&quot;):GetComponent(typeof(Image))
	slot0._eliteLabel = slot1:Find(&quot;grade/elite&quot;)
	slot0._generalLabel = slot1:Find(&quot;grade/general&quot;)
	slot0._flag = true
	slot0._isExistBoos = false

	slot0:Show(false)
end

slot1.GetCurrentTarget = function(slot0)
	return slot0._targetUnit
end

slot1.Show = function(slot0, slot1)
	if slot0._curActive ~= slot1 then
		slot0._curActive = slot1

		if slot1 then
			slot0._monsterTF.anchoredPosition = slot0.orgPos
		else
			slot0._monsterTF.anchoredPosition = slot0.HidePos
		end
	end
end

slot1.SetIconType = function(slot0, slot1)
	if slot0._eliteType == slot1 then
		return
	end

	slot0._eliteType = slot1

	setActive(slot0._generalLabel, not slot1)
	setActive(slot0._eliteLabel, slot1)
end

slot1.SwitchTarget = function(slot0, slot1, slot2)
	for slot6, slot7 in pairs(slot2) do
		if slot7:IsBoss() then
			slot0._isExistBoos = true

			break
		end
	end

	if slot0._flag == false or slot0._isExistBoos == true then
		slot0:Show(false)

		return
	end

	slot0._targetUnit = slot1

	slot0:Show(true)

	slot0._hpBarProgress.fillAmount = slot1:GetHPRate()

	slot0:UpdateHpText(slot1)
	slot0:SetIconType(slot1:GetTemplate().icon_type ~= 0)

	slot0._typeIcon.sprite = GetSpriteFromAtlas(&quot;shiptype&quot;, shipType2Battleprint(uv0.Battle.BattleDataFunction.GetEnemyTypeDataByType(slot1:GetTemplate().type).type))

	slot0._typeIcon:SetNativeSize()
	changeToScrollText(slot0._nameTF, slot1._tmpData.name)

	slot0._lvText.text = &quot; Lv.&quot; .. slot1:GetLevel()
end

slot1.UpdateHpText = function(slot0)
	slot1, slot2 = slot0._targetUnit:GetHP()
	slot0._hpBarText.text = tostring(math.floor(slot1) .. &quot;/&quot; .. math.floor(slot2))
end

slot1.UpdateHpBar = function(slot0)
	if slot0._flag == false or slot0._isExistBoos == true then
		return
	end

	LeanTween.cancel(slot0._hpBar)
	slot0:UpdateHpText(target)

	if slot0._targetUnit:GetHPRate() &lt; slot0._hpBarProgress.fillAmount then
		LeanTween.value(slot0._hpBar, slot2, slot1, 0.5):setOnUpdate(System.Action_float(function (slot0)
			uv0._hpBarProgress.fillAmount = slot0
		end))
	else
		slot0._hpBarProgress.fillAmount = slot1
	end

	if slot1 == 0 then
		slot0:RemoveUnit()
	end
end

slot1.RemoveUnit = function(slot0, slot1)
	slot0._targetUnit = nil
	slot0._flag = false

	slot2 = function()
		uv0._flag = true

		uv0:Show(false)
	end

	if slot1 then
		slot0._deathTimer = pg.TimeMgr.GetInstance():AddBattleTimer(&quot;death&quot;, 0, 1, function ()
			uv0()
			pg.TimeMgr.GetInstance():RemoveBattleTimer(uv1._deathTimer)
		end)
	else
		slot2()
	end
end

slot1.Dispose = function(slot0)
	slot0:Show(false)
	pg.TimeMgr.GetInstance():RemoveBattleTimer(slot0._deathTimer)
	LeanTween.cancel(slot0._hpBar)

	slot0._hpBarProgress = nil
	slot0._hpBar = nil
	slot0._hpBarTF = nil
	slot0._monsterTF = nil
	slot0._monster = nil
end
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>