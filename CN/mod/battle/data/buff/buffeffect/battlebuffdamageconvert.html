<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>battlebuffdamageconvert.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>battlebuffdamageconvert.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">ys = ys or {}
slot0 = ys
slot1 = slot0.Battle.BattleDataFunction
slot2 = slot0.Battle.BattleAttr
slot3 = slot0.Battle.BattleConst
slot4 = class(&quot;BattleBuffDamageConvert&quot;, slot0.Battle.BattleBuffEffect)
slot0.Battle.BattleBuffDamageConvert = slot4
slot4.__name = &quot;BattleBuffDamageConvert&quot;
slot4.ATTR_PRE = {
	[slot3.WeaponDamageAttr.CANNON] = &quot;injureRatioByCannon&quot;,
	[slot3.WeaponDamageAttr.TORPEDO] = &quot;injureRatioByBulletTorpedo&quot;,
	[slot3.WeaponDamageAttr.AIR] = &quot;injureRatioByAir&quot;
}

slot4.Ctor = function(slot0, slot1)
	uv0.super.Ctor(slot0, slot1)
end

slot4.SetArgs = function(slot0, slot1, slot2)
	slot3 = slot0._tempData.arg_list
	slot0._convert = slot3.convert_rate
	slot0._duration = slot3.duration
	slot0._buffSkinID = slot3.buff_skin_id
	slot0._attrTable = {}
end

slot4.onTakeDamage = function(slot0, slot1, slot2, slot3)
	if slot3.damageAttr then
		slot0._attrTable[slot4] = (slot0._attrTable[slot4] or 0) + slot3.damage
	end
end

slot4.onRemove = function(slot0, slot1, slot2)
	slot3 = 0
	slot4 = nil

	for slot8, slot9 in pairs(slot0._attrTable) do
		if slot3 &lt;= slot9 then
			slot3 = slot9
			slot4 = slot8
		end
	end

	if not slot4 then
		return
	end

	slot6 = uv0.generateBuff(slot0._buffSkinID, slot0._duration, uv0.ATTR_PRE[slot4], slot3 * slot0._convert)

	slot1:AddBuff(uv1.Battle.BattleBuffSelfModifyUnit.New(slot6.id, 1, slot1, slot6))
end

slot4.generateBuff = function(slot0, slot1, slot2, slot3)
	return {
		{
			time = slot1
		},
		name = &quot;代码生成buff&quot;,
		init_effect = &quot;jinengchufablue&quot;,
		picture = &quot;&quot;,
		desc = &quot;代码生成buff-指定属性减伤&quot;,
		stack = 1,
		last_effect = &quot;&quot;,
		id = slot0,
		icon = slot0,
		time = slot1,
		blink = {
			0,
			0.7,
			1,
			0.3,
			0.3
		},
		effect_list = {
			{
				type = &quot;BattleBuffAddAttr&quot;,
				trigger = {
					&quot;onAttach&quot;,
					&quot;onRemove&quot;
				},
				arg_list = {
					attr = slot2,
					number = slot3,
					group = slot0
				}
			}
		}
	}
end
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>