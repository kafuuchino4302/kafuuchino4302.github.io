<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>courtyardplaythelutepage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>courtyardplaythelutepage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CourtyardPlayTheLutePage&quot;, import(&quot;.CourtYardBaseSubPage&quot;))

slot0.getUIName = function(slot0)
	return &quot;CourtyardPlayTheLuteui&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.backBtn = slot0:findTF(&quot;back&quot;)
	slot0.tpl = slot0:findTF(&quot;keys/key&quot;)
	slot0.noteTr = slot0:findTF(&quot;prints/tansou_yinfu&quot;)
	slot0.keyTplPool = {
		slot0.tpl
	}
	slot0.tpls = {}
end

slot0.Show = function(slot0, slot1)
	slot0.furniture = slot1
	Input.multiTouchEnabled = true

	if slot0.isInit then
		slot0:BlurPanel()
	else
		seriesAsync({
			function (slot0)
				uv0:InitKeys(slot0)
			end,
			function (slot0)
				uv0.isInit = true

				uv0:RegisetEvent()
				onNextTick(slot0)
			end,
			function (slot0)
				uv0:BlurPanel()
				slot0()
			end
		})
	end
end

slot0.BlurPanel = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	uv0.super.Show(slot0)
end

slot0.GetKeys = function(slot0)
	return {
		{
			&quot;7D&quot;,
			&quot;pipa_1&quot;
		},
		{
			&quot;1&quot;,
			&quot;pipa_2&quot;
		},
		{
			&quot;2&quot;,
			&quot;pipa_5&quot;
		},
		{
			&quot;3&quot;,
			&quot;pipa_7&quot;
		},
		{
			&quot;4&quot;,
			&quot;pipa_9&quot;
		},
		{
			&quot;5&quot;,
			&quot;pipa_11&quot;
		},
		{
			&quot;6&quot;,
			&quot;pipa_13&quot;
		},
		{
			&quot;7&quot;,
			&quot;pipa_15&quot;
		},
		{
			&quot;D1&quot;,
			&quot;pipa_3&quot;
		},
		{
			&quot;D2&quot;,
			&quot;pipa_6&quot;
		},
		{
			&quot;D3&quot;,
			&quot;pipa_8&quot;
		},
		{
			&quot;D4&quot;,
			&quot;pipa_10&quot;
		},
		{
			&quot;D5&quot;,
			&quot;pipa_12&quot;
		},
		{
			&quot;D6&quot;,
			&quot;pipa_14&quot;
		},
		{
			&quot;D7&quot;,
			&quot;pipa_16&quot;
		},
		{
			&quot;DD1&quot;,
			&quot;pipa_4&quot;
		}
	}
end

slot0.GetTpl = function(slot0)
	if #slot0.keyTplPool &gt; 0 then
		return table.remove(slot0.keyTplPool, 1)
	else
		slot1 = slot0.tpl

		return Object.Instantiate(slot1, slot1.parent)
	end
end

slot0.InitKeys = function(slot0, slot1)
	slot3 = {}

	for slot7, slot8 in ipairs(slot0:GetKeys()) do
		table.insert(slot3, function (slot0)
			slot1 = uv0:GetTpl()

			uv0:InitKey(slot1, uv1[1], uv1[2])
			table.insert(uv0.tpls, slot1)

			if uv2 % 3 == 0 then
				onNextTick(slot0)
			else
				slot0()
			end
		end)
	end

	seriesAsync(slot3, slot1)
end

slot0.InitKey = function(slot0, slot1, slot2, slot3)
	slot4 = slot1:Find(&quot;Text&quot;)
	slot4 = slot4:GetComponent(typeof(Image))
	slot4.sprite = GetSpriteFromAtlas(&quot;ui/CourtyardLute_atlas&quot;, slot2)

	slot4:SetNativeSize()

	slot5 = slot1:Find(&quot;sel&quot;)

	onButton(slot0, slot1, function ()
		setActive(uv0, true)
		uv1:AnimationForKey(uv2)
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(&quot;event:/ui/&quot; .. uv3)
		uv1:OnStartPlay(uv4)
	end)

	slot6 = slot1:Find(&quot;animation&quot;)
	slot6 = slot6:GetComponent(typeof(DftAniEvent))

	slot6:SetEndEvent(function ()
		setActive(uv0, false)
		uv1:OnEndPlay(uv2)
	end)
end

slot0.OnStartPlay = function(slot0, slot1)
end

slot0.OnEndPlay = function(slot0, slot1)
end

slot0.AnimationForKey = function(slot0, slot1)
	slot2 = slot1:Find(&quot;animation&quot;):GetComponent(typeof(Animation))

	slot2:Stop()
	slot2:Play()
end

slot0.ClearAnimationForKey = function(slot0, slot1)
	slot1:Find(&quot;animation&quot;):GetComponent(typeof(Animation)):Stop()
	slot1:Find(&quot;animation&quot;):GetComponent(typeof(DftAniEvent)):SetEndEvent(nil)
end

slot0.RegisetEvent = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:Hide()
	end, SFX)
end

slot0.Hide = function(slot0)
	Input.multiTouchEnabled = false

	uv0.super.Hide(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf, slot0._parentTf)
	slot0:Emit(&quot;StopPlayMusicalInstruments&quot;, slot0.furniture.id)
end

slot0.ClearAllAnimation = function(slot0)
	for slot4, slot5 in ipairs(slot0.tpls) do
		slot0:ClearAnimationForKey(slot5)
	end
end

slot0.OnDestroy = function(slot0)
	slot0:ClearAllAnimation()

	if slot0:isShowing() then
		slot0:Hide()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>