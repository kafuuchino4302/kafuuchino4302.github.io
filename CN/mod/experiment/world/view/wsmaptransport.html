<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wsmaptransport.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>wsmaptransport.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WSMapTransport&quot;, import(&quot;...BaseEntity&quot;))
slot0.Fields = {
	map = &quot;table&quot;,
	column = &quot;number&quot;,
	wsMapPath = &quot;table&quot;,
	transform = &quot;userdata&quot;,
	dir = &quot;number&quot;,
	rtForbid = &quot;userdata&quot;,
	updateTimer = &quot;table&quot;,
	row = &quot;number&quot;,
	rtClick = &quot;userdata&quot;,
	rtBottom = &quot;userdata&quot;,
	rtDanger = &quot;userdata&quot;
}
slot0.Listeners = {
	onArrived = &quot;OnArrived&quot;,
	onStartTrip = &quot;OnStartTrip&quot;
}

slot0.GetResName = function()
	return &quot;world_cell_transport&quot;
end

slot0.GetName = function(slot0, slot1, slot2)
	return &quot;transport_&quot; .. slot0 .. &quot;_&quot; .. slot1 .. &quot;_&quot; .. slot2
end

slot0.Setup = function(slot0, slot1, slot2, slot3, slot4)
	slot0.row = slot1
	slot0.column = slot2
	slot0.dir = slot3
	slot0.map = slot4

	slot0.wsMapPath:AddListener(WSMapPath.EventStartTrip, slot0.onStartTrip)
	slot0.wsMapPath:AddListener(WSMapPath.EventArrived, slot0.onArrived)
	slot0:Init()
end

slot0.Dispose = function(slot0)
	slot0.wsMapPath:RemoveListener(WSMapPath.EventStartTrip, slot0.onStartTrip)
	slot0.wsMapPath:RemoveListener(WSMapPath.EventArrived, slot0.onArrived)
	slot0:DisposeUpdateTimer()
	slot0:UpdateAlpha(1)
	slot0:Clear()
end

slot0.Init = function(slot0)
	slot1 = slot0.transform
	slot0.rtClick = slot1:Find(&quot;click&quot;)
	slot0.rtBottom = slot1:Find(&quot;bottom&quot;)
	slot0.rtDanger = slot1:Find(&quot;danger&quot;)
	slot0.rtForbid = slot1:Find(&quot;forbid&quot;)
	slot4 = slot0.dir
	slot1.name = uv0.GetName(slot0.row, slot0.column, slot4)
	slot5 = 0

	if slot4 == WorldConst.DirDown then
		slot2 = slot2 + 1
		slot5 = -90
	elseif slot4 == WorldConst.DirLeft then
		slot3 = slot3 - 1
		slot5 = 180
	elseif slot4 == WorldConst.DirUp then
		slot2 = slot2 - 1
		slot5 = 90
	elseif slot4 == WorldConst.DirRight then
		slot3 = slot3 + 1
		slot5 = 0
	end

	slot1.localEulerAngles = Vector3(0, 0, slot5)
	slot1.anchoredPosition = slot0.map.theme:GetLinePosition(slot2, slot3)
	slot6 = slot0.map.theme.cellSize
	slot1.localScale = Vector3(slot6.x / slot1.sizeDelta.x, slot6.y / slot1.sizeDelta.y, 1)

	if slot0.wsMapPath:IsMoving() then
		slot0:OnStartTrip()
	end
end

slot0.UpdateAlpha = function(slot0, slot1)
	setImageAlpha(slot0.rtBottom, slot1)
	setImageAlpha(slot0.rtDanger, slot1)
	setImageAlpha(slot0.rtForbid, slot1)
end

slot0.OnStartTrip = function(slot0)
	slot0:StartUpdateTimer()
end

slot0.OnArrived = function(slot0)
	slot0:DisposeUpdateTimer()
end

slot0.StartUpdateTimer = function(slot0)
	if slot0.wsMapPath.wsObject.class == WSMapFleet then
		slot0:DisposeUpdateTimer()

		slot2 = slot0.map.theme
		slot3 = slot2:GetLinePosition(slot0.row, slot0.column)
		slot4 = math.min(slot2.cellSize.x + slot2.cellSpace.x, slot2.cellSize.y + slot2.cellSpace.y)
		slot5 = slot1.fleet
		slot7 = _.map(slot0.map:GetNormalFleets(), function (slot0)
			return Vector3.Distance(uv0:GetLinePosition(slot0.row, slot0.column), uv1)
		end)
		slot0.updateTimer = Timer.New(function ()
			uv0[uv1.index] = Vector3.Distance(uv2.transform.anchoredPosition3D, uv3)

			uv5:UpdateAlpha(math.max(1 - _.min(uv0) / uv4, 0))
		end, 0.033, -1)

		slot0.updateTimer:Start()
		slot0.updateTimer.func()
	end
end

slot0.DisposeUpdateTimer = function(slot0)
	if slot0.updateTimer then
		slot0.updateTimer:Stop()

		slot0.updateTimer = nil
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>