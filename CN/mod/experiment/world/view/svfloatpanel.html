<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>svfloatpanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>svfloatpanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;SVFloatPanel&quot;, import(&quot;view.base.BaseSubView&quot;))
slot0.ShowView = &quot;SVFloatPanel.ShowView&quot;
slot0.HideView = &quot;SVFloatPanel.HideView&quot;
slot0.ReturnCall = &quot;SVFloatPanel.ReturnCall&quot;

slot0.getUIName = function(slot0)
	return &quot;SVFloatPanel&quot;
end

slot0.OnLoaded = function(slot0)
end

slot0.OnInit = function(slot0)
	slot1 = slot0._tf
	slot0.rtBasePoint = slot1:Find(&quot;point&quot;)
	slot1 = slot0.rtBasePoint
	slot0.rtInfoPanel = slot1:Find(&quot;line/bg&quot;)
	slot1 = slot0.rtInfoPanel
	slot0.rtMarking = slot1:Find(&quot;icon/marking&quot;)
	slot1 = slot0._tf
	slot0.rtRes = slot1:Find(&quot;res&quot;)
	slot2 = slot0.rtInfoPanel
	slot3 = slot0.rtInfoPanel
	slot0.awardItemList = UIItemList.New(slot2:Find(&quot;pressing_award&quot;), slot3:Find(&quot;pressing_award/award_tpl&quot;))
	slot1 = slot0.awardItemList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0.awardConfig[slot1 + 1]

			updateDrop(slot2:Find(&quot;IconTpl&quot;), {
				type = slot3[1],
				id = slot3[2],
				count = slot3[3]
			})
			onButton(uv0, slot2:Find(&quot;IconTpl&quot;), function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)

			slot5 = uv0.mapList[uv0.destIndex]

			setActive(slot2:Find(&quot;is_pressing&quot;), slot5.isPressing)
			setActive(slot2:Find(&quot;IconTpl&quot;), not slot5.isPressing)
		end
	end)

	slot1 = slot0.rtInfoPanel
	slot0.btnBack = slot1:Find(&quot;back&quot;)

	onButton(slot0, slot0.btnBack, function ()
		uv0:emit(WorldScene.SceneOp, &quot;OpSetInMap&quot;, true)
	end, SFX_CONFIRM)

	slot1 = slot0.rtInfoPanel
	slot0.btnEnter = slot1:Find(&quot;enter&quot;)

	onButton(slot0, slot0.btnEnter, function ()
		slot0 = {}

		if WorldConst.HasDangerConfirm(uv0.mapList[uv0.destIndex].config.entrance_ui) then
			table.insert(slot0, function (slot0)
				slot1 = uv0

				slot1:emit(WorldScene.SceneOp, &quot;OpCall&quot;, function (slot0)
					slot0()
					pg.MsgboxMgr.GetInstance():ShowMsgBox({
						content = i18n(&quot;world_map_dangerous_confirm&quot;),
						onYes = uv0
					})
				end)
			end)
		end

		seriesAsync(slot0, function ()
			slot0 = nowWorld().staminaMgr

			if not uv0.isCost and slot0:GetTotalStamina() &lt; uv0.config.enter_cost then
				slot0:Show()
			else
				uv1:emit(WorldScene.SceneOp, &quot;OpTransport&quot;, uv1.entrance, uv0)
			end
		end)
	end, SFX_CONFIRM)

	slot1 = slot0.rtInfoPanel
	slot0.btnLock = slot1:Find(&quot;lock&quot;)
	slot1 = slot0.rtInfoPanel
	slot0.btnReturn = slot1:Find(&quot;return&quot;)

	onButton(slot0, slot0.btnReturn, function ()
		uv0:emit(uv1.ReturnCall, uv0.entrance)
	end, SFX_CONFIRM)

	slot1 = slot0.rtInfoPanel
	slot0.btnSwitch = slot1:Find(&quot;switch&quot;)

	onButton(slot0, slot0.btnSwitch, function ()
		if uv0.isTweening then
			return
		end

		uv0:ShowToggleMask()
	end, SFX_PANEL)

	slot1 = slot0._tf
	slot0.rtSelectMask = slot1:Find(&quot;select_mask&quot;)
	slot3 = slot0.rtSelectMask

	onButton(slot0, slot3:Find(&quot;bg&quot;), function ()
		if uv0.isTweening then
			return
		end

		uv0:HideToggleMask()
	end, SFX_PANEL)

	slot1 = slot0.rtSelectMask
	slot0.rtMaskMarking = slot1:Find(&quot;marking&quot;)
	slot1 = slot0.rtMaskMarking
	slot0.rtToggles = slot1:Find(&quot;toggles&quot;)
	slot3 = slot0.rtToggles
	slot0.toggleItemList = UIItemList.New(slot0.rtToggles, slot3:Find(&quot;toggle&quot;))
	slot1 = slot0.toggleItemList

	slot1:make(function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			slot4, slot5 = World.ReplacementMapType(uv0.entrance, uv0.mapList[slot1])

			setText(slot2:Find(&quot;Text&quot;), slot5)
			onToggle(uv0, slot2, function (slot0)
				if slot0 then
					uv0:HideToggleMask()

					uv0.destIndex = uv1

					uv0:UpdatePanel()
				end
			end, SFX_PANEL)
			triggerToggle(slot2, false)
		end
	end)
end

slot0.OnDestroy = function(slot0)
end

slot0.Show = function(slot0)
	setActive(slot0._tf, true)
end

slot0.Hide = function(slot0)
	setActive(slot0._tf, false)
end

slot0.Setup = function(slot0, slot1, slot2, slot3, slot4)
	slot0.entrance = slot1
	slot8 = slot0._tf
	slot10 = GameObject.Find(&quot;OverlayCamera&quot;)
	slot10 = slot10:GetComponent(typeof(Camera))

	setAnchoredPosition(slot0.rtBasePoint, slot8:InverseTransformPoint(slot10:ScreenToWorldPoint(slot4:GetMapScreenPos(Vector2(slot1.config.area_pos[1], slot1.config.area_pos[2])))))

	slot6 = nowWorld()
	slot0.mapList = slot6:EntranceToReplacementMapList(slot1)
	slot7 = slot0.toggleItemList

	slot7:align(#slot0.mapList)

	slot8 = slot0.rtToggles

	triggerToggle(slot8:GetChild((function ()
		if uv0 then
			for slot3, slot4 in ipairs(uv1.mapList) do
				if slot4.id == uv0 then
					return slot3
				end
			end
		end

		if uv2 then
			for slot3, slot4 in ipairs(uv2) do
				for slot8, slot9 in ipairs(uv1.mapList) do
					if slot4 == World.ReplacementMapType(uv3, slot9) then
						return slot8
					end
				end
			end
		end

		if uv3.active then
			for slot3, slot4 in ipairs(uv1.mapList) do
				if slot4.active then
					return slot3
				end
			end
		end

		return 1
	end)() - 1), true)
end

slot0.setColorfulImage = function(slot0, slot1, slot2, slot3)
	setImageSprite(slot1, getImageSprite(slot0.rtRes:Find(slot1.name .. &quot;/&quot; .. slot2)), defaultValue(slot3, true))
end

slot0.UpdatePanel = function(slot0)
	slot1 = nowWorld()
	slot3, slot4 = World.ReplacementMapType(slot0.entrance, slot0.mapList[slot0.destIndex])
	slot5 = slot3 == &quot;complete_chapter&quot; and &quot;safe&quot; or WorldConst.GetMapIconState(slot2.config.entrance_ui)

	slot0:setColorfulImage(slot0.rtBasePoint, slot5)
	slot0:setColorfulImage(slot0.rtInfoPanel, slot5, false)
	setImageSprite(slot0.rtInfoPanel:Find(&quot;icon&quot;), GetSpriteFromAtlas(&quot;world/mapicon/&quot; .. slot2.config.entrance_mapicon, &quot;&quot;))
	slot0:setColorfulImage(slot0.btnBack, slot5)
	slot0:setColorfulImage(slot0.btnEnter, slot5)
	slot0:setColorfulImage(slot0.rtMarking, slot5)
	slot0:setColorfulImage(slot0.rtMarking:Find(&quot;mark_bg&quot;), slot5)
	slot0:setColorfulImage(slot0.rtMaskMarking, slot5)
	slot0:setColorfulImage(slot0.rtMaskMarking:Find(&quot;mark_bg&quot;), slot5)
	setText(slot0.rtMarking:Find(&quot;Text&quot;), slot4)
	setText(slot0.rtMaskMarking:Find(&quot;Text&quot;), slot4)
	setActive(slot0.rtInfoPanel:Find(&quot;sairen&quot;), slot3 == &quot;sairen_chapter&quot;)
	setText(slot0.rtInfoPanel:Find(&quot;sairen/Text&quot;), i18n(&quot;area_yaosai_2&quot;))
	setText(slot0.rtInfoPanel:Find(&quot;danger_text&quot;), slot2:IsMapOpen() and slot2:GetDanger() or &quot;?&quot;)
	changeToScrollText(slot0.rtInfoPanel:Find(&quot;title/name&quot;), slot2:GetName(slot0.entrance))

	slot8, slot9, slot10 = slot1:CountAchievements(slot0.entrance)

	setText(slot0.rtInfoPanel:Find(&quot;title/achievement/number&quot;), slot8 + slot9 .. &quot;/&quot; .. slot10)
	setActive(slot0.rtInfoPanel:Find(&quot;pressing_award&quot;), slot1:GetPressingAward(slot2.id) and slot11.flag)

	if slot11 and slot11.flag then
		slot0.awardConfig = pg.world_event_complete[slot11.id].tips_icon

		slot0.awardItemList:align(#slot0.awardConfig)
	end

	slot0:UpdateCost()

	slot14, slot15 = nowWorld():GetAtlas():GetActiveMap():CkeckTransport()

	setActive(slot0.btnBack, not false and slot12:GetActiveEntrance() == slot0.entrance and slot13 == slot2)

	slot16 = slot16 or isActive(slot0.btnBack)

	setActive(slot0.btnEnter, not slot16 and slot14 and slot6 and slot12.transportDic[slot0.entrance.id])

	slot16 = slot16 or isActive(slot0.btnEnter)

	setText(slot0.btnLock:Find(&quot;Text&quot;), slot6 and i18n(&quot;world_map_locked_border&quot;) or i18n(&quot;world_map_locked_stage&quot;))
	setActive(slot0.btnLock, not slot16 and slot14)

	slot16 = slot16 or isActive(slot0.btnLock)

	setActive(slot0.btnReturn, not slot16)

	slot16 = slot16 or isActive(slot0.btnReturn)
end

slot0.UpdateCost = function(slot0)
	slot1 = slot0.mapList[slot0.destIndex]
	slot2 = slot0.btnEnter:Find(&quot;cost&quot;)

	setActive(slot2, not slot1.isCost)

	slot3 = nowWorld().staminaMgr:GetTotalStamina()

	setText(slot2:Find(&quot;Text&quot;), setColorStr(slot3, slot3 &lt; slot1.config.enter_cost and COLOR_RED or COLOR_GREEN) .. &quot;/&quot; .. slot4)
end

slot0.ShowToggleMask = function(slot0)
	slot0.isTweening = true

	setActive(slot0.rtMarking, false)
	setActive(slot0.rtSelectMask, true)
	setActive(slot0.rtToggles, false)

	slot0.rtMaskMarking.position = slot0.rtMarking.position
	slot1 = LeanTween.moveY(slot0.rtMaskMarking, slot0.rtMaskMarking.anchoredPosition.y + 150, 0.2)

	slot1:setOnComplete(System.Action(function ()
		setActive(uv0.rtToggles, true)

		uv0.isTweening = false
	end))
	setActive(slot0.btnSwitch, false)
end

slot0.HideToggleMask = function(slot0)
	slot0.isTweening = true

	setActive(slot0.rtToggles, false)

	slot0.rtMaskMarking.position = slot0.rtMarking.position

	setAnchoredPosition(slot0.rtMaskMarking, {
		y = slot0.rtMaskMarking.anchoredPosition.y + 150
	})

	slot1 = LeanTween.moveY(slot0.rtMaskMarking, slot0.rtMaskMarking.anchoredPosition.y - 150, 0.2)

	slot1:setOnComplete(System.Action(function ()
		setActive(uv0.rtSelectMask, false)
		setActive(uv0.rtMarking, true)

		uv0.isTweening = false

		setActive(uv0.btnSwitch, #uv0.mapList &gt; 1)
	end))
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>