<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>verticaltextinjector.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>verticaltextinjector.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot1 = function(slot0)
	return ReflectionHelp.RefGetField(typeof(&quot;UnityEngine.UILineInfo&quot;), &quot;startCharIdx&quot;, slot0)
end

slot2 = function(slot0)
	slot1 = {}

	for slot5 = 0, #slot0 - 1 do
		slot1[slot5] = 0
	end

	for slot5, slot6 in ipairs({
		&quot; &quot;,
		&quot;\n&quot;
	}) do
		slot8 = 0
		slot9 = string.find(Clone(slot0), slot6)

		while slot9 do
			for slot13 = 0, #slot6 - 1 do
				slot1[slot8 + slot9 + slot13] = 3
			end

			slot8 = slot8 + slot9 + #slot6
			slot9 = string.find(string.sub(slot7, slot9 + #slot6), slot6)
		end
	end

	slot2 = nil

	for slot6, slot7 in ipairs({
		&quot;b&quot;,
		&quot;i&quot;,
		&quot;size&quot;,
		&quot;color&quot;,
		&quot;material&quot;
	}) do
		slot8 = &quot;&lt;/&quot; .. slot7 .. &quot;&gt;&quot;
		slot9 = string.match(slot0, &quot;&lt;/*&quot; .. slot7 .. &quot;[^&gt;]*&gt;&quot;)
		slot2 = {}

		while slot9 do
			slot10 = string.find(slot0, slot9)

			if slot9 == slot8 then
				if #slot2 &gt; 0 then
					for slot15 = 0, #table.remove(slot2).str - 1 do
						slot1[slot11.start + slot15] = 1
					end

					for slot15 = 0, #slot9 - 1 do
						slot1[slot10 + slot15] = 2
					end
				end
			else
				table.insert(slot2, {
					str = slot9,
					start = slot10
				})
			end
		end

		slot9 = string.match(slot0, &quot;&lt;/*&quot; .. slot7 .. &quot;[^&gt;]*&gt;&quot;)
	end

	slot3 = {}
	slot4 = 0

	for slot8 = 0, #slot0 - 1 do
		if slot1[slot8] == 0 then
			slot3[slot8] = slot4
			slot4 = slot4 + 1
		else
			slot3[slot8] = -2
		end
	end

	for slot8 = 0, #slot0 - 1 do
		if slot3[slot8] == -2 then
			if slot1[slot8] == 0 then
				-- Nothing
			elseif slot1[slot8] == 1 then
				slot3[slot8] = findRight(slot1, slot3, #slot0, slot8 + 1)
			elseif slot1[slot8] == 2 then
				slot3[slot8] = slot3[slot8 - 1]
			elseif slot1[slot8] == 3 then
				slot3[slot8] = -1
			end
		end
	end

	return slot3
end

slot3 = function(slot0, slot1, slot2, slot3)
	if slot3 &lt; slot2 then
		if slot0[slot3] == 0 then
			return slot1[slot3]
		elseif slot0[slot3] == 1 then
			slot1[slot3] = uv0(slot0, slot1, slot2, slot3 + 1)

			return slot1[slot3]
		elseif slot0[slot3] == 2 then
			return -1
		elseif slot0[slot3] == 3 then
			slot1[slot3] = uv0(slot0, slot1, slot2, slot3 + 1)

			return slot1[slot3]
		end
	end

	return -1
end

InjectByName(&quot;VerticalText&quot;, {
	ModifyMesh = function ()
		return function (slot0, slot1)
			if not ReflectionHelp.RefCallMethod(typeof(&quot;VerticalText&quot;), &quot;IsActive&quot;, slot0) then
				return
			end

			slot2 = GetComponent(ReflectionHelp.RefGetProperty(typeof(&quot;VerticalText&quot;), &quot;gameObject&quot;, slot0), typeof(Text))

			ReflectionHelp.RefSetField(typeof(&quot;VerticalText&quot;), &quot;lineSpacing&quot;, slot0, slot2.fontSize * slot2.lineSpacing)
			ReflectionHelp.RefSetField(typeof(&quot;VerticalText&quot;), &quot;textSpacing&quot;, slot0, slot2.fontSize * ReflectionHelp.RefGetField(typeof(&quot;VerticalText&quot;), &quot;spacing&quot;, slot0))
			ReflectionHelp.RefSetField(typeof(&quot;VerticalText&quot;), &quot;xOffset&quot;, slot0, slot2.rectTransform.sizeDelta.x / 2 - slot2.fontSize / 2)
			ReflectionHelp.RefSetField(typeof(&quot;VerticalText&quot;), &quot;yOffset&quot;, slot0, slot2.rectTransform.sizeDelta.y / 2 - slot2.fontSize / 2)

			slot11 = slot2.text
			slot6 = ReflectionHelp.RefCallStaticMethod(typeof(&quot;UnityEngine.UI.RichText&quot;), &quot;RichStringProjection&quot;, {
				typeof(&quot;System.String&quot;)
			}, {
				slot11
			})

			for slot11 = 0, ReflectionHelp.RefGetProperty(typeof(&quot;UnityEngine.TextGenerator&quot;), &quot;lines&quot;, slot2.cachedTextGenerator).Count - 1 do
				slot12 = slot7 &gt; slot11 + 1 and uv0(slot5[slot11 + 1]) or utf8_len(slot2.text)
				slot13 = 0

				for slot17 = uv0(slot5[slot11]), slot12 - 1 do
					if slot6[slot17] &gt;= 0 then
						ReflectionHelp.RefCallMethod(typeof(&quot;VerticalText&quot;), &quot;modifyText&quot;, slot0, {
							typeof(&quot;UnityEngine.UI.VertexHelper&quot;),
							typeof(&quot;System.Int32&quot;),
							typeof(&quot;System.Int32&quot;),
							typeof(&quot;System.Int32&quot;)
						}, {
							slot1,
							slot6[slot17],
							slot13,
							slot11
						})
					end

					slot13 = slot13 + 1
				end
			end
		end, LuaInterface.InjectType.Replace
	end
})
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>