<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>worldmediacollectionrecorddetaillayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>worldmediacollectionrecorddetaillayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WorldMediaCollectionRecordDetailLayer&quot;, import(&quot;.WorldMediaCollectionSubLayer&quot;))
slot0.TypeStory = 1
slot0.TypeBattle = 2

slot0.getUIName = function(slot0)
	return &quot;WorldMediaCollectionMemoryDetailUI&quot;
end

slot0.OnInit = function(slot0)
	uv0.super.OnInit(slot0)
	assert(slot0.viewParent, &quot;Need assign ViewParent for &quot; .. slot0.__cname)
	setActive(slot0._tf:Find(&quot;ItemRect/TitleRecord&quot;), true)
	setActive(slot0._tf:Find(&quot;ItemRect/TitleMemory&quot;), false)

	slot0.recordItemList = slot0:findTF(&quot;ItemRect&quot;):GetComponent(&quot;LScrollRect&quot;)

	slot0.recordItemList.onInitItem = function(slot0)
		uv0:OnInitRecordItem(slot0)
	end

	slot0.recordItemList.onUpdateItem = function(slot0, slot1)
		uv0:OnUpdateRecordItem(slot0 + 1, slot1)
	end

	slot0.recordItems = {}

	setActive(slot0:findTF(&quot;Item&quot;, slot0.recordItemList), false)

	slot0.loader = AutoLoader.New()

	setText(slot0._tf:Find(&quot;ItemRect/ProgressDesc&quot;), i18n(&quot;world_collection_2&quot;))
end

slot0.OnInitRecordItem = function(slot0, slot1)
	if slot0.exited then
		return
	end

	onButton(slot0, slot1, function ()
		slot1 = nowWorld():GetCollectionProxy()

		if uv0.recordItems[uv1] and uv0.CheckRecordIsUnlock(slot0) then
			uv0:PlayMemory(slot0)
		end
	end, SOUND_BACK)
end

slot0.OnUpdateRecordItem = function(slot0, slot1, slot2)
	if slot0.exited then
		return
	end

	slot3 = slot0.records and slot0.records[slot1]

	assert(&quot;Not Initialize RecordGroups ID: &quot; .. (slot0.contextData.recordGroup or &quot;NIL&quot;))

	slot0.recordItems[slot2] = slot3
	slot4 = tf(slot2)

	if slot0.CheckRecordIsUnlock(slot3) then
		setActive(slot4:Find(&quot;normal&quot;), true)
		setActive(slot4:Find(&quot;lock&quot;), false)

		slot4:Find(&quot;normal/title&quot;):GetComponent(typeof(Text)).text = slot3.name

		slot0.loader:GetSpriteQuiet(&quot;memoryicon/&quot; .. slot3.icon, &quot;&quot;, slot4:Find(&quot;normal&quot;))
		setText(slot4:Find(&quot;normal/id&quot;), string.format(&quot;#%u&quot;, slot3.group_ID))
	else
		setActive(slot4:Find(&quot;normal&quot;), false)
		setActive(slot4:Find(&quot;lock&quot;), true)
		setText(slot4:Find(&quot;lock/condition&quot;), slot3.condition)
	end

	onButton(slot0, slot4, function ()
		if not uv0.CheckRecordIsUnlock(uv1) then
			return
		end

		uv0:PlayMemory(uv1)
	end, SFX_PANEL)
end

slot0.SetStoryMask = function(slot0, slot1)
	slot0.memoryMask = slot1
end

slot0.PlayMemory = function(slot0, slot1)
	if slot1.type == uv0.TypeBattle then
		slot0:emit(WorldMediaCollectionMediator.BEGIN_STAGE, {
			memory = true,
			system = SYSTEM_PERFORM,
			stageId = pg.NewStoryMgr.GetInstance():StoryName2StoryId(slot1.story)
		})
	else
		slot2 = findTF(slot0.memoryMask, &quot;pic&quot;)

		if string.len(slot1.mask) &gt; 0 then
			setActive(slot2, true)

			slot2:GetComponent(typeof(Image)).sprite = LoadSprite(slot1.mask)
		else
			setActive(slot2, false)
		end

		setActive(slot0.memoryMask, true)

		slot3 = pg.NewStoryMgr.GetInstance()

		slot3:Play(slot1.story, function ()
			setActive(uv0.memoryMask, false)
		end, true)
	end
end

slot0.ShowRecordGroup = function(slot0, slot1)
	slot0.contextData.recordGroup = slot1

	assert(&quot;Missing Record Group Config ID: &quot; .. (slot1 or &quot;NIL&quot;))

	slot0.records = _.map(WorldCollectionProxy.GetCollectionRecordGroupTemplate(slot1).child, function (slot0)
		return WorldCollectionProxy.GetCollectionTemplate(slot0)
	end)

	slot0.recordItemList:SetTotalCount(#slot0.records, 0)
	setText(slot0._tf:Find(&quot;ItemRect/ProgressText&quot;), _.reduce(slot0.records, 0, function (slot0, slot1)
		if uv0.CheckRecordIsUnlock(slot1) then
			slot0 = slot0 + 1
		end

		return slot0
	end) .. &quot;/&quot; .. #slot0.records)
end

slot0.CheckRecordIsUnlock = function(slot0)
	return nowWorld():GetCollectionProxy():IsUnlock(slot0.id) or pg.NewStoryMgr.GetInstance():IsPlayed(slot0.story, true)
end

slot0.CleanList = function(slot0)
	slot0.records = nil

	slot0.recordItemList:SetTotalCount(0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>