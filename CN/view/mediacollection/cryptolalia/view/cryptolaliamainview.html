<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cryptolaliamainview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>cryptolaliamainview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CryptolaliaMainView&quot;)

slot0.Ctor = function(slot0, slot1)
	setmetatable(slot0, {
		__index = function (slot0, slot1)
			return rawget(slot0, &quot;class&quot;)[slot1] and slot2[slot1] or uv0[slot1]
		end
	})

	slot0.downloadBtnAnim = slot0.downloadBtn:GetComponent(typeof(Animation))
end

slot0.Flush = function(slot0, slot1, slot2, slot3)
	if not slot0.cryptolalia or slot0.cryptolalia.id ~= slot1.id then
		slot0.shipName.text = slot1:GetShipName()
		slot0.nameTxt.text = slot1:GetName()
		slot0.descTxt.text = slot1:GetDescription()

		slot0.auditionTxt:SetText(slot1:GetAuditionTitle())
		slot0:LoadCryptolaliaSpriteForShipGroup(slot1:GetShipGroupId())

		slot4 = not slot1:IsForever() and slot1:IsLock()

		setActive(slot0.timeLimit, slot4)
		slot0:RemoveTimer()
		slot0:AddTimer(slot1, slot4)
	end

	slot0.authorTxt.text = &quot;CV:&quot; .. slot1:GetCvAuthor(slot2)

	slot0:FlushState(slot1, slot2, slot3)

	slot0.cryptolalia = slot1
end

slot0.AddTimer = function(slot0, slot1, slot2)
	if slot2 then
		slot3 = &quot;&quot;
		slot0.timer = Timer.New(function ()
			if uv1 ~= uv0:GetExpiredTimeStr() then
				uv1 = slot0
				uv2.timeTxt.text = slot0
			end
		end, 1, -1)

		slot0.timer:Start()
		slot0.timer.func()

		return
	end

	slot0.timeTxt.text = &quot;&quot;
end

slot0.FlushState = function(slot0, slot1, slot2, slot3)
	slot4 = slot3 and Cryptolalia.STATE_DOWNLOADING or slot1:GetState(slot2)

	setActive(slot0.lockBtn, Cryptolalia.STATE_LOCK == slot4)
	setActive(slot0.downloadBtn, Cryptolalia.STATE_DOWNLOADABLE == slot4)

	if slot0.state and slot0.state == Cryptolalia.STATE_LOCK and slot4 == Cryptolalia.STATE_DOWNLOADABLE then
		slot0.downloadBtnAnim:Stop()
		slot0.downloadBtnAnim:Play(&quot;anim_Cryptolalia_dowmload&quot;)
	end

	setSlider(slot0.downloadingBtn, 0, 1, 0)
	setActive(slot0.downloadingBtn, slot4 == Cryptolalia.STATE_DOWNLOADING)
	setActive(slot0.playBtn, Cryptolalia.STATE_PLAYABLE == slot4)
	setActive(slot0.deleteBtn, Cryptolalia.STATE_PLAYABLE == slot4)
	setText(slot0.deleteBtn:Find(&quot;label&quot;), i18n(&quot;cryptolalia_delete_res&quot;, slot1:GetResSize(slot2)))
	setActive(slot0.stateBtn, Cryptolalia.STATE_PLAYABLE ~= slot4)
	setActive(slot0.switchBtn, slot4 ~= Cryptolalia.STATE_DOWNLOADING and PLATFORM_CODE == PLATFORM_CH and slot1:IsMultiVersion())

	slot5 = Vector2(0, 0)
	slot6 = Vector2(20, -9.2)
	slot7 = slot2 == Cryptolalia.LANG_TYPE_CH

	setAnchoredPosition(slot0.switchBtn:Find(&quot;ch&quot;), slot7 and slot5 or slot6)
	setAnchoredPosition(slot0.switchBtn:Find(&quot;jp&quot;), slot7 and slot6 or slot5)
	setActive(slot0.listBtn, slot4 ~= Cryptolalia.STATE_DOWNLOADING)

	if Cryptolalia.STATE_LOCK == slot4 then
		slot0.stateBtnTxt.text = i18n(&quot;cryptolalia_lock_res&quot;)
	elseif Cryptolalia.STATE_PLAYABLE ~= slot4 then
		slot0.stateBtnTxt.text = i18n(&quot;cryptolalia_not_download_res&quot;)
	else
		slot0.stateBtnTxt.text = &quot;&quot;
	end

	slot0.state = slot4
end

slot1 = function(slot0, slot1, slot2)
	LoadSpriteAtlasAsync(&quot;CryptolaliaShip/&quot; .. slot1, &quot;cd&quot;, function (slot0)
		if uv0.exited then
			return
		end

		uv0.cdImg.sprite = slot0

		uv0.cdImg:SetNativeSize()
		uv1()
	end)
end

slot2 = function(slot0, slot1, slot2)
	LoadSpriteAtlasAsync(&quot;CryptolaliaShip/&quot; .. slot1, &quot;name&quot;, function (slot0)
		if uv0.exited then
			return
		end

		uv0.cdSignatureImg.sprite = slot0

		uv0.cdSignatureImg:SetNativeSize()
		uv1()
	end)
end

slot3 = function(slot0, slot1, slot2)
	LoadSpriteAtlasAsync(&quot;CryptolaliaShip/&quot; .. slot1, &quot;name&quot;, function (slot0)
		if uv0.exited then
			return
		end

		uv0.signatureImg.sprite = slot0

		uv0.signatureImg:SetNativeSize()
		uv1()
	end)
end

slot0.LoadCryptolaliaSpriteForShipGroup = function(slot0, slot1)
	slot0.cg.blocksRaycasts = false

	parallelAsync({
		function (slot0)
			uv0(uv1, uv2, slot0)
		end
	}, function ()
		uv0.cg.blocksRaycasts = true
	end)
end

slot0.RemoveTimer = function(slot0)
	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end
end

slot0.Dispose = function(slot0)
	slot0.exited = true

	slot0:RemoveTimer()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>