<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>navalacademymediator.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>navalacademymediator.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NavalAcademyMediator&quot;, import(&quot;..base.ContextMediator&quot;))
slot0.ON_OPEN_CLASSROOM = &quot;NavalAcademyMediator:ON_OPEN_CLASSROOM&quot;
slot0.ON_OPEN_COMMANDER = &quot;NavalAcademyMediator:ON_OPEN_COMMANDER&quot;
slot0.ON_OPEN_COLLECTION = &quot;NavalAcademyMediator:ON_OPEN_COLLECTION&quot;
slot0.ON_OPEN_OILRESFIELD = &quot;NavalAcademyMediator:ON_OPEN_OILRESFIELD&quot;
slot0.ON_OPEN_GOLDRESFIELD = &quot;NavalAcademyMediator:ON_OPEN_GOLDRESFIELD&quot;
slot0.ON_OPEN_SUPPLYSHOP = &quot;NavalAcademyMediator:ON_OPEN_SUPPLYSHOP&quot;
slot0.ON_OPEN_TACTICROOM = &quot;NavalAcademyMediator:ON_OPEN_TACTICROOM&quot;
slot0.ON_OPEN_MINIGAMEHALL = &quot;NavalAcademyMediator:ON_OPEN_MINIGAMEHALL&quot;
slot0.UPGRADE_FIELD = &quot;NavalAcademyMediator:UPGRADE_FIELD&quot;
slot0.GO_SCENE = &quot;NavalAcademyMediator:GO_SCENE&quot;
slot0.OPEN_ACTIVITY_PANEL = &quot;NavalAcademyMediator:OPEN_ACTIVITY_PANEL&quot;
slot0.OPEN_ACTIVITY_SHOP = &quot;NavalAcademyMediator:OPEN_ACTIVITY_SHOP&quot;
slot0.OPEN_SCROLL = &quot;NavalAcademyMediator:OPEN_SCROLL&quot;
slot0.ACTIVITY_OP = &quot;NavalAcademyMediator:ACTIVITY_OP&quot;
slot0.TASK_GO = &quot;NavalAcademyMediator:TASK_GO&quot;
slot0.GO_TASK_SCENE = &quot;NavalAcademyMediator:GO_TASK_SCENE&quot;
slot0.ON_GET_CLASS_RES = &quot;NavalAcademyMediator:ON_GET_CLASS_RES&quot;
slot0.ON_GET_RES = &quot;NavalAcademyMediator:ON_GET_RES&quot;

slot0.register = function(slot0)
	slot0:bind(uv0.ON_GET_CLASS_RES, function (slot0)
		uv0:sendNotification(GAME.HARVEST_CLASS_RES)
	end)
	slot0:bind(uv0.ON_GET_RES, function (slot0, slot1)
		uv0:sendNotification(GAME.HARVEST_RES, slot1)
	end)
	slot0:bind(uv0.GO_TASK_SCENE, function (slot0, slot1)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.TASK, slot1)
	end)
	slot0:bind(uv0.TASK_GO, function (slot0, slot1)
		uv0:sendNotification(GAME.TASK_GO, slot1)
	end)
	slot0:bind(uv0.ACTIVITY_OP, function (slot0, slot1)
		uv0:sendNotification(GAME.ACTIVITY_OPERATION, slot1)
	end)
	slot0:bind(uv0.OPEN_SCROLL, function (slot0, slot1)
		assert(false, &quot;问卷系统已废弃&quot;)
	end)
	slot0:bind(uv0.OPEN_ACTIVITY_SHOP, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.SHOP, {
			warp = NewShopsScene.TYPE_ACTIVITY
		})
	end)
	slot0:bind(uv0.OPEN_ACTIVITY_PANEL, function (slot0, slot1)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.ACTIVITY, {
			id = slot1
		})
	end)
	slot0:bind(uv0.GO_SCENE, function (slot0, slot1)
		uv0:sendNotification(GAME.GO_SCENE, slot1[1], slot1[2])
	end)
	slot0:bind(uv0.UPGRADE_FIELD, function (slot0, slot1)
		uv0:sendNotification(GAME.SHOPPING, {
			count = 1,
			id = slot1
		})
	end)
	slot0:bind(uv0.ON_OPEN_CLASSROOM, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.CLASS)
	end)
	slot0:bind(uv0.ON_OPEN_COMMANDER, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.COMMANDERCAT, {
			fleetType = CommanderCatScene.FLEET_TYPE_COMMON
		})
	end)
	slot0:bind(uv0.ON_OPEN_COLLECTION, function (slot0)
		uv0:addSubLayers(Context.New({
			mediator = TrophyGalleryMediator,
			viewComponent = TrophyGalleryLayer
		}))
	end)
	slot0:bind(uv0.ON_OPEN_GOLDRESFIELD, function (slot0)
		uv0.viewComponent:OpenGoldResField()
	end)
	slot0:bind(uv0.ON_OPEN_OILRESFIELD, function (slot0)
		uv0.viewComponent:OpenOilResField()
	end)
	slot0:bind(uv0.ON_OPEN_SUPPLYSHOP, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.SHOP, {
			warp = NewShopsScene.TYPE_SHOP_STREET
		})
	end)
	slot0:bind(uv0.ON_OPEN_TACTICROOM, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.NAVALTACTICS, {
			shipToLesson = uv0.contextData.shipToLesson
		})

		uv0.contextData.shipToLesson = nil
	end)
	slot0:bind(uv0.ON_OPEN_MINIGAMEHALL, function (slot0)
		uv0:sendNotification(GAME.GO_SCENE, SCENE.GAME_HALL)
	end)

	slot1 = getProxy(NavalAcademyProxy)

	slot0.viewComponent:SetOilResField(slot1:GetOilVO())
	slot0.viewComponent:SetGoldResField(slot1:GetGoldVO())
	slot0.viewComponent:SetClassResField(slot1:GetClassVO())
	slot0.viewComponent:SetPlayer(getProxy(PlayerProxy):getData())
end

slot0.listNotificationInterests = function(slot0)
	return {
		GAME.LOAD_LAYERS,
		GAME.REMOVE_LAYERS,
		GAME.HARVEST_RES_DONE,
		PlayerProxy.UPDATED,
		NavalAcademyProxy.RESOURCE_UPGRADE,
		NavalAcademyProxy.RESOURCE_UPGRADE_DONE,
		CollectionProxy.TROPHY_UPDATE,
		GAME.BEGIN_STAGE_DONE,
		ActivityProxy.ACTIVITY_OPERATION_DONE,
		GAME.HARVEST_CLASS_RES_DONE
	}
end

slot0.handleNotification = function(slot0, slot1)
	slot3 = slot1:getBody()

	if slot1:getName() == GAME.LOAD_LAYERS then
		slot0.viewComponent:OnAddLayer()
	elseif slot2 == GAME.REMOVE_LAYERS then
		slot0.viewComponent:OnRemoveLayer(slot3)
	elseif slot2 == GAME.HARVEST_RES_DONE then
		slot0.viewComponent:OnGetRes(slot3.type, slot3.outPut)
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;battle_levelMediator_ok_takeResource&quot;))
	elseif slot2 == PlayerProxy.UPDATED then
		slot0.viewComponent:UpdatePlayer(slot3)
	elseif slot2 == NavalAcademyProxy.RESOURCE_UPGRADE then
		slot0.viewComponent:UpdatePlayer(getProxy(PlayerProxy):getData())
		slot0.viewComponent:OnStartUpgradeResField(slot3.resVO)
	elseif slot2 == NavalAcademyProxy.RESOURCE_UPGRADE_DONE then
		if isa(slot3.field, GoldResourceField) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;main_navalAcademyScene_upgrade_complete&quot;, pg.navalacademy_data_template[3].name, slot3.value))
		elseif isa(slot4, OilResourceField) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;main_navalAcademyScene_upgrade_complete&quot;, pg.navalacademy_data_template[4].name, slot3.value))
		elseif isa(slot4, ClassResourceField) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;main_navalAcademyScene_class_upgrade_complete&quot;, pg.navalacademy_data_template[1].name, slot3.value, slot3.rate, slot3.exp))
		end

		slot0.viewComponent:OnResFieldLevelUp(slot4)
	elseif slot2 == CollectionProxy.TROPHY_UPDATE then
		slot0.viewComponent:OnCollectionUpdate()
	elseif slot2 == GAME.BEGIN_STAGE_DONE then
		slot0:sendNotification(GAME.GO_SCENE, SCENE.COMBATLOAD, slot3)
	elseif slot2 == ActivityProxy.ACTIVITY_OPERATION_DONE then
		slot0.viewComponent:RefreshChars()
	elseif slot2 == GAME.HARVEST_CLASS_RES_DONE then
		slot0.viewComponent:OnGetRes(3, slot3.value)
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>