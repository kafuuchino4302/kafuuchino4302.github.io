<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>classlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>classlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ClassLayer&quot;, import(&quot;...base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;ClassUI&quot;
end

slot0.SetStudents = function(slot0, slot1)
	slot0.shipGroups = slot1
end

slot0.SetCourse = function(slot0, slot1)
	slot0.course = slot1
end

slot0.SetClass = function(slot0, slot1)
	slot0.resClass = slot1
end

slot0.OnUpdateResField = function(slot0, slot1)
	if not isa(slot1, ClassResourceField) then
		return
	end

	slot0:SetClass(slot1)
	slot0:InitClassInfo()

	if slot0.resFieldPage:GetLoaded() and slot0.resFieldPage:isShowing() then
		slot0.resFieldPage:Update(slot1)
	end
end

slot0.init = function(slot0)
	slot0.backBtn = slot0:findTF(&quot;blur_panel/adapt/top/back&quot;)
	slot0.lessonTxt = slot0:findTF(&quot;blur_panel/adapt/bottom/lesson/mask/Text&quot;):GetComponent(&quot;ScrollText&quot;)
	slot0.tranSpeedTxt = slot0:findTF(&quot;blur_panel/adapt/bottom/progress/proficiency/value&quot;):GetComponent(typeof(Text))
	slot0.proficiencyProgressTxt = slot0:findTF(&quot;blur_panel/adapt/bottom/progress/proficiency/Text&quot;):GetComponent(typeof(Text))
	slot0.proficiencyProgress = slot0:findTF(&quot;blur_panel/adapt/bottom/progress/proficiency/slider/Image&quot;)
	slot0.tranProgressTxt = slot0:findTF(&quot;blur_panel/adapt/bottom/progress/book/Text/value&quot;):GetComponent(typeof(Text))
	slot0.tranProgress = slot0:findTF(&quot;blur_panel/adapt/bottom/progress/book/slider/Image&quot;)
	slot0.exp2ProficiencyRatioTxt = slot0:findTF(&quot;blur_panel/adapt/top/proficiency/Text&quot;):GetComponent(typeof(Text))
	slot0.exp2ProficiencyRatio = slot0:findTF(&quot;blur_panel/adapt/top/proficiency&quot;)
	slot0.chatProficiency = slot0:findTF(&quot;blur_panel/adapt/top/proficiency/chat&quot;)
	slot1 = slot0.chatProficiency:Find(&quot;Text&quot;)
	slot0.chatProficiencyTxt = slot1:GetComponent(typeof(Text))
	slot0.helpBtn = slot0:findTF(&quot;blur_panel/adapt/top/btn_help&quot;)
	slot0.upgradeBtn = slot0:findTF(&quot;blur_panel/adapt/bottom/upgarde&quot;)
	slot0.teacherSeat = slot0:findTF(&quot;scene/desk0&quot;)
	slot0.studentSeats = {
		slot0:findTF(&quot;scene/desk1&quot;),
		slot0:findTF(&quot;scene/desk2&quot;),
		slot0:findTF(&quot;scene/desk3&quot;),
		slot0:findTF(&quot;scene/desk4&quot;),
		slot0:findTF(&quot;scene/desk5&quot;)
	}

	setText(slot0:findTF(&quot;blur_panel/adapt/bottom/progress/book/Text/label&quot;), i18n(&quot;class_label_gen&quot;))
	setText(slot0:findTF(&quot;blur_panel/adapt/bottom/progress/proficiency/label&quot;), i18n(&quot;class_label_tran&quot;))
	setText(slot0:findTF(&quot;blur_panel/adapt/bottom/upgarde/Text&quot;), i18n(&quot;word_levelup&quot;))

	slot0.chars = {}
	slot0.resFieldPage = ClassResourcePage.New(slot0._tf, slot0.event)
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:emit(BaseUI.ON_BACK)
	end, SFX_CANCEL)
	onButton(slot0, slot0.helpBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = i18n(&quot;course_class_help&quot;)
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.upgradeBtn, function ()
		uv0.resFieldPage:ExecuteAction(&quot;Flush&quot;, uv0.resClass)
	end, SFX_PANEL)
	onButton(slot0, slot0.exp2ProficiencyRatio, function ()
		uv0.chatProficiencyTxt.text = i18n(&quot;course_proficiency_tip&quot;, pg.gameset.level_get_proficency.key_value, uv0.resClass:GetExp2ProficiencyRatio() * uv0.course:getExtraRate())

		uv0:DisplayChatContent()
	end, SFX_PANEL)

	slot0.students = slot0:FilterStudents()

	slot0:InitClassInfo()
	slot0:LoadClassRoom()
end

slot0.DisplayChatContent = function(slot0)
	setActive(slot0.chatProficiency, true)
	setButtonEnabled(slot0.exp2ProficiencyRatio, false)

	slot1 = LeanTween.scale(rtf(slot0.chatProficiency), Vector3(1.5, 1.5, 1), 0.3)
	slot1 = slot1:setFrom(Vector3.zero)

	slot1:setOnComplete(System.Action(function ()
		slot0 = LeanTween.scale(rtf(uv0.chatProficiency), Vector3(0, 0, 0), 0.2)
		slot0 = slot0:setDelay(2)

		slot0:setOnComplete(System.Action(function ()
			if not IsNil(uv0.exp2ProficiencyRatio) then
				setButtonEnabled(uv0.exp2ProficiencyRatio, true)
				setActive(uv0.chatProficiency, false)
			end
		end))
	end))
end

slot0.FilterStudents = function(slot0)
	slot1 = {}
	slot2 = slot0.course:getConfig(&quot;type&quot;)

	for slot6, slot7 in pairs(slot0.shipGroups) do
		if table.contains(slot2, slot7.shipConfig.type) then
			table.insert(slot1, slot7)
		end
	end

	if #slot1 &gt; #slot0.studentSeats then
		shuffle(slot1)
	end

	return slot1
end

slot0.InitClassInfo = function(slot0)
	slot1 = slot0.resClass
	slot2 = slot0.course

	slot0.lessonTxt:SetText(i18n(&quot;course_class_name&quot;, slot2:getConfig(&quot;name_show&quot;)))

	slot0.tranSpeedTxt.text = &quot;-&quot; .. slot1:GetTranValuePreHour() .. &quot;/h&quot;
	slot3 = slot2:GetProficiency()
	slot4 = slot1:GetMaxProficiency()
	slot0.proficiencyProgressTxt.text = slot3 .. &quot;/&quot; .. slot4

	setFillAmount(slot0.proficiencyProgress, slot3 / slot4)

	slot6 = slot1:GetTarget()
	slot5 = slot1:GetPlayerRes() % slot6
	slot0.tranProgressTxt.text = &quot; &lt;color=#92FC63FF&gt;&quot; .. slot5 .. &quot;&lt;/color&gt;/&quot; .. slot6

	setFillAmount(slot0.tranProgress, slot5 / slot6)

	slot0.exp2ProficiencyRatioTxt.text = slot1:GetExp2ProficiencyRatio() * slot2:getExtraRate() .. &quot;%&quot;
end

slot0.LoadClassRoom = function(slot0)
	slot1 = {}
	slot5 = #slot0.studentSeats

	for slot5 = 1, math.min(#slot0.students, slot5) do
		table.insert(slot1, function (slot0)
			slot1 = uv0.students[uv1]
			slot2 = uv0

			slot2:LoadChar(slot1:GetSkin().prefab, function (slot0)
				uv0:AddStudent(slot0, uv0.studentSeats[uv1])
				uv2()
			end)
		end)
	end

	table.insert(slot1, function (slot0)
		slot3 = uv0.course
		slot1 = Ship.New({
			configId = slot3:getConfig(&quot;id&quot;)
		})
		slot2 = uv0

		slot2:LoadChar(slot1:getPrefab(), function (slot0)
			uv0:AddTeacher(slot0, uv0.teacherSeat)
			uv1()
		end)
	end)

	slot2 = pg.UIMgr.GetInstance()

	slot2:LoadingOn()
	seriesAsync(slot1, function ()
		pg.UIMgr.GetInstance():LoadingOff()
	end)
end

slot0.AddStudent = function(slot0, slot1, slot2)
	slot3 = slot1.transform
	slot3.localScale = Vector3(-0.9, 0.9, 1)
	slot3.localPosition = Vector3(37, 62, 0)

	setParent(slot3, slot2)
	setActive(slot2:Find(&quot;icon&quot;), true)
	slot1:GetComponent(&quot;SpineAnimUI&quot;):SetAction(&quot;sit&quot;, 0)
	slot3:SetSiblingIndex(0)
end

slot0.AddTeacher = function(slot0, slot1, slot2)
	slot3 = slot1.transform
	slot3.localScale = Vector3(0.9, 0.9, 1)
	slot3.localPosition = Vector3(0, 0, 0)

	setParent(slot3, slot2)
	slot1:GetComponent(&quot;SpineAnimUI&quot;):SetAction(&quot;stand2&quot;, 0)
end

slot0.willExit = function(slot0)
	slot0:ClearChars()
	slot0.resFieldPage:Destroy()

	slot0.resFieldPage = nil
end

slot0.LoadChar = function(slot0, slot1, slot2)
	slot3 = PoolMgr.GetInstance()

	slot3:GetSpineChar(slot1, true, function (slot0)
		if uv0.exited then
			PoolMgr.GetInstance():ReturnSpineChar(uv1, slot0)

			return
		end

		pg.ViewUtils.SetLayer(slot0.transform, Layer.UI)

		uv0.chars[uv1] = slot0

		uv2(slot0)
	end)
end

slot0.ClearChars = function(slot0)
	for slot4, slot5 in pairs(slot0.chars) do
		PoolMgr.GetInstance():ReturnSpineChar(slot4, slot5)
	end

	slot0.chars = {}
end

slot0.onBackPressed = function(slot0)
	if slot0.resFieldPage and slot0.resFieldPage:GetLoaded() and slot0.resFieldPage:isShowing() then
		slot0.resFieldPage:Hide()

		return
	end

	uv0.super.onBackPressed(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>