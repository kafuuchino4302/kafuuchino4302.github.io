<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>monthcardoutdatetippanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>monthcardoutdatetippanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MonthCardOutDateTipPanel&quot;, import(&quot;.MsgboxSubPanel&quot;))

slot0.SetMonthCardEndDateLocal = function()
	if not getProxy(PlayerProxy):getRawData() or not slot0.id then
		return
	end

	if not slot0:getCardById(VipCard.MONTH) or slot1.leftDate == 0 then
		return
	end

	PlayerPrefs.SetInt(&quot;MonthCardEndDate&quot; .. slot0.id, slot1:getLeftDate())
	PlayerPrefs.Save()
end

slot0.GetMonthCardEndDate = function()
	if not getProxy(PlayerProxy):getRawData() or not slot0.id then
		return 0
	end

	return PlayerPrefs.GetInt(&quot;MonthCardEndDate&quot; .. slot0.id, 0)
end

slot0.SetMonthCardTipDate = function(slot0)
	if not slot0 then
		return
	end

	if not getProxy(PlayerProxy):getRawData() or not slot1.id then
		return
	end

	PlayerPrefs.SetInt(&quot;MonthCardTipDate&quot; .. slot1.id, slot0)
	PlayerPrefs.Save()
end

slot0.GetMonthCardTipDate = function()
	if not getProxy(PlayerProxy):getRawData() or not slot0.id then
		return 0
	end

	return PlayerPrefs.GetInt(&quot;MonthCardTipDate&quot; .. slot0.id, 0)
end

slot0.SetMonthCardTagDate = function()
	if not getProxy(PlayerProxy):getRawData() or not slot0.id then
		return
	end

	PlayerPrefs.SetInt(&quot;MonthCardTagDate&quot; .. slot0.id, pg.TimeMgr.GetInstance():GetNextTime(0, 0, 0))
	PlayerPrefs.Save()
end

slot0.GetShowMonthCardTag = function()
	if not getProxy(PlayerProxy):getRawData() or not slot0.id then
		return false
	end

	if not slot0:getCardById(VipCard.MONTH) or slot1.leftDate == 0 then
		return false
	end

	if pg.TimeMgr.GetInstance():GetServerTime() &lt; slot1:getLeftDate() - 259200 or slot3 &lt; slot2 then
		return false
	end

	return PlayerPrefs.GetInt(&quot;MonthCardTagDate&quot; .. slot0.id, 0) &lt; slot2
end

slot0.TryShowMonthCardTipPanel = function(slot0)
	slot1 = function()
		if uv0 then
			uv0()
		end
	end

	if uv0.GetMonthCardEndDate() == 0 then
		slot1()

		return
	end

	slot4 = uv0.GetMonthCardTipDate()

	if pg.TimeMgr.GetInstance():GetServerTime() &gt;= slot2 - 259200 and slot4 &lt; slot2 - 259200 then
		uv0.SetMonthCardTipDate(slot3)

		slot5 = pg.TimeMgr.GetInstance():STimeDescS(math.min(slot3, slot2), &quot;*t&quot;)
		slot7 = pg.TimeMgr.GetInstance():STimeDescS(slot2, &quot;*t&quot;)

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			hideNo = true,
			type = MSGBOX_TYPE_MONTH_CARD_TIP,
			title = pg.MsgboxMgr.TITLE_INFORMATION,
			content = i18n(slot2 &lt;= slot3 and &quot;trade_card_tips2&quot; or &quot;trade_card_tips3&quot;, i18n(&quot;trade_card_tips4&quot;, slot7.year, slot7.month, slot7.day)),
			dateText = i18n(&quot;trade_card_tips4&quot;, slot5.year, slot5.month, slot5.day),
			yesText = i18n(&quot;trade_card_tips1&quot;),
			weight = LayerWeightConst.TOP_LAYER,
			onClose = slot1,
			onYes = function ()
				pg.m02:sendNotification(GAME.GO_SCENE, SCENE.CHARGE, {
					confirmMonthCard = true,
					wrap = ChargeScene.TYPE_DIAMOND
				})
			end
		})

		return
	end

	slot1()
end

slot0.getUIName = function(slot0)
	return &quot;Msgbox4MonthCardTip&quot;
end

slot0.Init = function(slot0)
	uv0.super.Init(slot0)
	setText(slot0._tf:Find(&quot;NameText&quot;), pg.ship_data_statistics[312011].name)
end

slot0.UpdateView = function(slot0, slot1)
	slot0:PreRefresh(slot1)

	rtf(slot0.viewParent._window).sizeDelta = Vector2.New(960, 685)

	setText(slot0._tf:Find(&quot;Desc&quot;), slot1.content)
	setText(slot0._tf:Find(&quot;Date&quot;), slot1.dateText)
	slot0:PostRefresh(slot1)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>