<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>commissioninfoclassitem.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>commissioninfoclassitem.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CommissionInfoClassItem&quot;, import(&quot;.CommissionInfoItem&quot;))

slot0.OnFlush = function(slot0)
	slot1 = getProxy(NavalAcademyProxy):getStudents()
	slot3 = table.getCount(slot1)
	slot4 = 0

	_.each(_.values(slot1), function (slot0)
		if slot0:getFinishTime() &lt;= pg.TimeMgr.GetInstance():GetServerTime() then
			uv0 = uv0 + 1
		end
	end)

	slot0.finishedCounter.text = slot4
	slot0.ongoingCounter.text = slot3 - slot4
	slot0.leisureCounter.text = getProxy(NavalAcademyProxy):getSkillClassNum() - slot3

	setActive(slot0.finishedCounterContainer, slot4 &gt; 0)
	setActive(slot0.ongoingCounterContainer, slot4 &lt; slot3)
	setActive(slot0.leisureCounterContainer, slot3 &lt; slot2)
	setActive(slot0.goBtn, slot4 == 0)
	setActive(slot0.finishedBtn, slot4 &gt; 0)

	slot0.list = slot1
end

slot0.UpdateListItem = function(slot0, slot1, slot2, slot3)
	slot5 = slot3:Find(&quot;unlock/name_bg&quot;)

	if slot2 then
		slot0:UpdateStudent(slot4, slot3)

		slot5.sizeDelta = Vector2(267, 45)
	else
		slot0:UpdateEmpty(slot3)

		slot5.sizeDelta = Vector2(400, 45)
	end

	slot6 = slot4 and slot4:getFinishTime() &lt;= pg.TimeMgr.GetInstance():GetServerTime()

	setActive(slot3:Find(&quot;unlock&quot;), true)
	setActive(slot3:Find(&quot;lock&quot;), false)
	setActive(slot3:Find(&quot;unlock/leisure&quot;), not slot4)
	setActive(slot3:Find(&quot;unlock/ongoging&quot;), slot4 and not slot6)
	setActive(slot3:Find(&quot;unlock/finished&quot;), slot4 and slot6)
end

slot0.UpdateStudent = function(slot0, slot1, slot2)
	slot5 = slot1:getShipVO()
	slot6 = nil

	setText(slot2:Find(&quot;unlock/name_bg/Text&quot;), shortenString(slot1:getSkillName(), 7))

	if pg.TimeMgr.GetInstance():GetServerTime() &lt; slot1:getFinishTime() then
		slot0:AddTimer(slot1, slot2)

		slot6 = slot2:Find(&quot;unlock/ongoging/shipicon&quot;)
	else
		onButton(slot0, slot2:Find(&quot;unlock/finished/finish_btn&quot;), function ()
			uv0:emit(CommissionInfoMediator.FINISH_CLASS, uv1.id, Student.CANCEL_TYPE_AUTO)
		end, SFX_PANEL)
		onButton(slot0, slot2, function ()
			triggerButton(uv0:Find(&quot;unlock/finished/finish_btn&quot;))
		end, SFX_PANEL)

		slot6 = slot2:Find(&quot;unlock/finished/shipicon&quot;)
	end

	updateShip(slot6, slot5)
end

slot0.AddTimer = function(slot0, slot1, slot2)
	slot0:RemoveTimer(slot1)

	slot3 = slot2:Find(&quot;unlock/ongoging/time&quot;):GetComponent(typeof(Text))
	slot4 = slot1:getFinishTime()
	slot0.timers[slot1.id] = Timer.New(function ()
		if uv0 - pg.TimeMgr.GetInstance():GetServerTime() &lt;= 0 then
			uv1:RemoveTimer(uv2)
			uv1:Update()
		else
			uv3.text = pg.TimeMgr.GetInstance():DescCDTime(slot0)
		end
	end, 1, -1)

	slot0.timers[slot1.id]:Start()
	slot0.timers[slot1.id]:func()
end

slot0.RemoveTimer = function(slot0, slot1)
	if slot0.timers[slot1.id] then
		slot0.timers[slot1.id]:Stop()

		slot0.timers[slot1.id] = nil
	end
end

slot0.UpdateEmpty = function(slot0, slot1)
	setText(slot1:Find(&quot;unlock/name_bg/Text&quot;), i18n(&quot;commission_idle&quot;))
	onButton(slot0, slot1:Find(&quot;unlock/leisure/go_btn&quot;), function ()
		uv0:emit(CommissionInfoMediator.ON_ACTIVE_CLASS)
	end, SFX_PANEL)
	onButton(slot0, slot1, function ()
		uv0:OnSkip()
	end, SFX_PANEL)
end

slot0.GetList = function(slot0)
	return slot0.list, getProxy(NavalAcademyProxy):getSkillClassNum()
end

slot0.OnSkip = function(slot0)
	slot0:emit(CommissionInfoMediator.ON_ACTIVE_CLASS)
end

slot0.OnFinishAll = function(slot0)
	slot0:emit(CommissionInfoMediator.FINISH_CLASS_ALL)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>