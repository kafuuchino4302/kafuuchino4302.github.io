<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chargetecshipgiftselllayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>chargetecshipgiftselllayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ChargeTecShipGiftSellLayer&quot;, import(&quot;...base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;ChargeTecShipGiftSellLayer&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
	slot0:initUIText()
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0:updateGiftList()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
end

slot0.initData = function(slot0)
	slot0.showGoodVO = slot0.contextData.showGoodVO
	slot0.chargedList = slot0.contextData.chargedList
	slot0.goodVOList = slot0.showGoodVO:getSameLimitGroupTecGoods()
	slot0.normalGoodVO = nil
	slot0.highGoodVO = nil
	slot0.upGoodVO = nil

	for slot4, slot5 in ipairs(slot0.goodVOList) do
		if slot5:getConfig(&quot;limit_arg&quot;) == 1 then
			slot0.highGoodVO = slot5
		elseif slot5:getConfig(&quot;limit_arg&quot;) == 2 then
			slot0.normalGoodVO = slot5
		elseif slot5:getConfig(&quot;limit_arg&quot;) == 3 then
			slot0.upGoodVO = slot5
		end
	end

	slot0.goodVOShowList = {}
	slot2 = ChargeConst.getBuyCount(slot0.chargedList, slot0.highGoodVO.id)
	slot3 = ChargeConst.getBuyCount(slot0.chargedList, slot0.upGoodVO.id)

	if ChargeConst.getBuyCount(slot0.chargedList, slot0.normalGoodVO.id) == 0 and slot2 == 0 and slot3 == 0 then
		table.insert(slot0.goodVOShowList, slot0.normalGoodVO)
		table.insert(slot0.goodVOShowList, slot0.highGoodVO)
	elseif slot1 &gt; 0 and slot2 == 0 and slot3 == 0 then
		table.insert(slot0.goodVOShowList, slot0.normalGoodVO)
		table.insert(slot0.goodVOShowList, slot0.upGoodVO)
	elseif (slot1 &lt;= 0 or slot3 &lt;= 0) and slot2 &gt; 0 then
		-- Nothing
	end
end

slot0.initUIText = function(slot0)
	setText(slot0:findTF(&quot;Adapt/TipBG/Text&quot;), i18n(&quot;tech_package_tip&quot;))
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot0.itemTpl = slot0:findTF(&quot;ItemTpl&quot;)

	setParent(Instantiate(GetComponent(slot0._tf, &quot;ItemList&quot;).prefabItem[0]), slot0:findTF(&quot;Container&quot;, slot0.itemTpl), false)

	slot0.giftTpl = slot0:findTF(&quot;GiftTpl&quot;)
	slot0.giftContainer = slot0:findTF(&quot;List&quot;)
	slot0.giftUIItemList = UIItemList.New(slot0.giftContainer, slot0.giftTpl)
	slot4 = slot0.giftUIItemList

	slot4:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateGiftTF(slot2, uv0.goodVOShowList[slot1 + 1])
		end
	end)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.bg, function ()
		uv0:closeView()
	end, SFX_PANEL)
end

slot0.updateGiftTF = function(slot0, slot1, slot2)
	slot9 = slot0:findTF(&quot;Title&quot;, slot1)
	slot10 = slot0:findTF(&quot;GiftImage&quot;, slot1)
	slot11 = slot0:findTF(&quot;Desc1&quot;, slot1)
	slot12 = slot0:findTF(&quot;Desc2&quot;, slot1)
	slot13 = slot0:findTF(&quot;List&quot;, slot1)
	slot15 = slot2:getConfig(&quot;limit_arg&quot;) == 2
	slot17 = ChargeConst.getBuyCount(slot0.chargedList, slot0.normalGoodVO.id) &gt; 0

	setActive(slot0:findTF(&quot;BG/Normal&quot;, slot1), slot15)
	setActive(slot0:findTF(&quot;BG/Special&quot;, slot1), not slot15)
	setActive(slot0:findTF(&quot;Buy/Normal&quot;, slot1), slot15 and not slot17)
	setActive(slot0:findTF(&quot;Buy/Special&quot;, slot1), slot2:getConfig(&quot;limit_arg&quot;) == 1)
	setActive(slot0:findTF(&quot;Buy/Up&quot;, slot1), slot2:getConfig(&quot;limit_arg&quot;) == 3)
	setActive(slot0:findTF(&quot;Buy/Disable&quot;, slot1), slot15 and slot17)

	if slot15 and slot17 then
		setGray(slot1, true, true)
	end

	slot18 = function()
		pg.m02:sendNotification(GAME.CHARGE_OPERATION, {
			shopId = uv0.id
		})
		uv1:closeView()
	end

	onButton(slot0, slot5, function ()
		uv0()
	end, SFX_PANEL)
	onButton(slot0, slot6, function ()
		uv0()
	end, SFX_PANEL)
	onButton(slot0, slot7, function ()
		uv0()
	end, SFX_PANEL)
	setText(slot9, slot2:getConfig(&quot;name_display&quot;))
	setText(slot11, slot2:getConfig(&quot;descrip&quot;))
	setText(slot12, slot2:getConfig(&quot;descrip_extra&quot;))

	slot24 = slot2

	setImageSprite(slot10, LoadSprite(&quot;chargeicon/&quot; .. slot2.getConfig(slot24, &quot;picture&quot;)), true)

	slot19 = {}
	slot23 = &quot;display&quot;

	for slot23, slot24 in ipairs(slot2:getConfig(slot23)) do
		table.insert(slot19, Drop.Create(slot24))
	end

	slot20 = UIItemList.New(slot13, slot0.itemTpl)

	slot20:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot4 = uv0:findTF(&quot;Container&quot;, slot2):GetChild(0)
			slot6 = uv1[slot1 + 1]

			updateDrop(slot4, slot6)
			onButton(uv0, slot4, function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)
			setScrollText(uv0:findTF(&quot;TextMask/Text&quot;, slot2), slot6:getName())
		end
	end)
	slot20:align(#slot19)
end

slot0.updateGiftList = function(slot0)
	slot0.giftUIItemList:align(#slot0.goodVOShowList)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>