<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>backyardshipcard.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>backyardshipcard.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BackYardShipCard&quot;, import(&quot;.BackYardBaseCard&quot;))

slot0.OnInit = function(slot0)
	slot0.info = BackYardFormationCard.New(slot0._go)

	onButton(slot0, slot0._content, function ()
		uv0:emit(NewBackYardShipInfoMediator.OPEN_CHUANWU, uv0.type, uv0.ship)
	end, SFX_PANEL)

	slot0.press = GetOrAddComponent(slot0._content, typeof(UILongPressTrigger))
	slot1 = slot0.press.onLongPressed

	slot1:RemoveAllListeners()

	slot1 = slot0.press.onLongPressed

	slot1:AddListener(function ()
		if not uv0.ship then
			return
		end

		uv0:emit(NewBackYardShipInfoMediator.LOOG_PRESS_SHIP, uv0.type, uv0.ship)
	end)
end

slot0.OnFlush = function(slot0)
	slot1 = slot0.ship
	slot2 = slot0.info

	if not slot0.targteShipId or slot0.targteShipId ~= slot1.id then
		slot2:update(slot1)

		slot0.targteShipId = slot1.id
	end

	slot3 = slot1:getLevelExpConfig()
	slot4 = slot0:CalcShipAddExpSpeed()
	slot5 = {}
	slot6 = getProxy(ActivityProxy)

	table.Foreach(slot6:getActivitiesByType(ActivityConst.ACTIVITY_TYPE_HOTSPRING), function (slot0, slot1)
		if slot1 and not slot1:isEnd() then
			slot2 = slot1:getConfig(&quot;config_data&quot;)[1][4]

			_.each(slot1:getData1List(), function (slot0)
				uv0[slot0] = (uv0[slot0] or 0) + uv1
			end)
		end
	end)

	slot7 = getProxy(ActivityProxy)

	table.Foreach(slot7:getActivitiesByType(ActivityConst.ACTIVITY_TYPE_HOTSPRING_2), function (slot0, slot1)
		if slot1 and not slot1:isEnd() then
			slot2 = slot1:getConfig(&quot;config_data&quot;)[1]

			_.each(slot1:getData1List(), function (slot0)
				uv0[slot0] = (uv0[slot0] or 0) + uv1
			end)
		end
	end)

	slot8 = 0
	slot9 = 0

	for slot13, slot14 in ipairs(BuffHelper.GetBackYardEnergyBuffs()) do
		slot9 = slot9 + tonumber(slot14:getConfig(&quot;benefit_effect&quot;))
	end

	if slot0.type == Ship.STATE_TRAIN then
		slot2:updateProps({
			{
				i18n(&quot;word_lv&quot;),
				slot1.level
			},
			{
				i18n(&quot;word_next_level&quot;),
				math.max(slot3.exp - slot1.exp, 0)
			},
			{
				i18n(&quot;word_exp_chinese&quot;) .. i18n(&quot;word_get&quot;),
				slot4
			},
			{
				i18n(&quot;word_nowenergy&quot;),
				slot1.energy
			},
			{
				i18n(&quot;word_energy_recov_speed&quot;),
				10 * (slot1:getRecoverEnergyPoint() + Ship.BACKYARD_1F_ENERGY_ADDITION + (slot5[slot1.id] or 0)) .. (slot9 &gt; 0 and setColorStr(&quot;+&quot; .. 10 * slot9, COLOR_GREEN) or &quot;&quot;) .. &quot;/h&quot;
			}
		})
	elseif slot0.type == Ship.STATE_REST then
		slot2:updateProps1({
			{
				i18n(&quot;word_lv&quot;),
				slot1.level
			},
			{
				i18n(&quot;word_nowenergy&quot;),
				slot1.energy
			},
			{
				i18n(&quot;word_energy_recov_speed&quot;),
				10 * (slot1:getRecoverEnergyPoint() + Ship.BACKYARD_2F_ENERGY_ADDITION + (slot5[slot1.id] or 0)) .. (slot9 &gt; 0 and setColorStr(&quot;+&quot; .. 10 * slot9, COLOR_GREEN) or &quot;&quot;) .. &quot;/h&quot;
			}
		})
	end

	setActive(slot2.propsTr, slot0.type == Ship.STATE_TRAIN)
	setActive(slot2.propsTr1, slot0.type == Ship.STATE_REST)
end

slot0.CalcShipAddExpSpeed = function(slot0)
	slot1 = 0
	slot2 = getProxy(DormProxy):getRawData()

	return math.floor(slot0:GetBaseExp(slot2) * 3600 / pg.dorm_data_template[slot2.id].time)
end

slot0.GetBaseExp = function(slot0, slot1)
	slot2 = getProxy(PlayerProxy):getRawData()

	if slot1:GetStateShipCnt(Ship.STATE_TRAIN) &lt;= 0 then
		return 0
	end

	slot4 = pg.dorm_data_template[slot1.id]
	slot6 = 1

	for slot10, slot11 in pairs(BuffHelper.GetBackYardExpBuffs()) do
		if slot11:isActivate() then
			slot6 = tonumber(slot11:getConfig(&quot;benefit_effect&quot;)) / 100 + slot6
		end
	end

	slot10 = slot1:getComfortable()

	return pg.gameset[&quot;dorm_exp_ratio_by_&quot; .. slot3].key_value / 100 * (pg.gameset.dorm_exp_base.key_value + slot4.exp * slot10 / (slot10 + pg.gameset.dorm_exp_ratio_comfort_degree.key_value)) * slot6 * (1 + 0.05 * slot2.level)
end

slot0.OnDispose = function(slot0)
	slot0.press.onLongPressed:RemoveAllListeners()
	slot0.press.onLongPressed:AddListener(nil)

	if slot0.info then
		slot0.info:clear()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>