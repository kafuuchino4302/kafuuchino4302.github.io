<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>backyarddecorationfurniturepage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>backyarddecorationfurniturepage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BackYardDecorationFurniturePage&quot;, import(&quot;.BackYardDecorationBasePage&quot;))
slot0.SELECTED_FURNITRUE = &quot;BackYardDecorationFurniturePage:SELECTED_FURNITRUE&quot;

slot1 = function(slot0)
	if not uv0.PageTypeList then
		uv0.PageTypeList = {
			0,
			1,
			7,
			2,
			3,
			4,
			5,
			6,
			8
		}
	end

	return uv0.PageTypeList[slot0]
end

slot0.getUIName = function(slot0)
	return &quot;BackYardDecorationFurniturePage&quot;
end

slot0.OnFurnitureUpdated = function(slot0, slot1)
	for slot5, slot6 in pairs(slot0.cards) do
		if slot6.furniture:getConfig(&quot;id&quot;) == slot1:getConfig(&quot;id&quot;) then
			slot7, slot8 = slot0:GetPutCntByConfigId(slot0.dorm, slot1:getConfig(&quot;id&quot;))

			slot6:Flush(slot1, slot7, slot8)
		end
	end
end

slot0.GetPutCntByConfigId = function(slot0, slot1, slot2)
	slot3 = 0
	slot4 = {}

	for slot8, slot9 in pairs(slot1:GetThemeList()) do
		slot10 = slot9:GetSameFurnitureCnt(slot2)
		slot3 = slot3 + slot10

		if slot10 &gt; 0 then
			table.insert(slot4, slot8)
		end
	end

	slot5 = 0

	if #slot4 &gt; 1 then
		slot5 = getProxy(DormProxy).floor
	elseif #slot4 == 1 then
		slot5 = slot4[1]
	end

	return slot3, slot5
end

slot0.OnDisplayList = function(slot0)
	slot0.displays = slot0:GetDisplays()

	slot0:SortDisplays()
end

slot0.SortDisplays = function(slot0)
	if not slot0.contextData.filterPanel:GetLoaded() then
		slot1 = {}

		for slot5, slot6 in ipairs(slot0.displays) do
			slot1[slot6.id] = slot6:GetOwnCnt() &lt;= slot0:GetPutCntByConfigId(slot0.dorm, slot6.configId) and 0 or 1
		end

		slot2 = slot0.orderMode

		table.sort(slot0.displays, function (slot0, slot1)
			if uv0[slot0.id] == uv0[slot1.id] then
				if (slot0.newFlag and 1 or 0) == (slot1.newFlag and 1 or 0) then
					if uv1 == BackYardDecorationFilterPanel.ORDER_MODE_ASC then
						return slot0.id &lt; slot1.id
					elseif uv1 == BackYardDecorationFilterPanel.ORDER_MODE_DASC then
						return slot1.id &lt; slot0.id
					end
				else
					return slot5 &lt; slot4
				end
			else
				return slot2 &lt; slot3
			end
		end)
		slot0:SetTotalCount()

		return
	end

	slot0.contextData.filterPanel:setFilterData(slot0:GetDisplays())
	slot0.contextData.filterPanel:filter()
	slot0:OnFilterDone(slot0.contextData.filterPanel:GetFilterData())
end

slot0.OnOrderModeUpdated = function(slot0)
	slot0:SortDisplays()
end

slot0.change2ScrPos = function(slot0, slot1)
	return LuaHelper.ScreenToLocal(slot0:GetComponent(&quot;RectTransform&quot;), slot1, GameObject.Find(&quot;UICamera&quot;):GetComponent(&quot;Camera&quot;))
end

slot0.OnLoaded = function(slot0)
	slot0:bind(BackYardDecorationPutlistPage.SELECTED_FURNITRUE, function ()
		uv0:ClearMark()
	end)
	slot0:bind(BackYardDecrationLayer.INNER_SELECTED_FURNITRUE, function (slot0, slot1)
		uv0:Selected(slot1)
	end)

	slot1 = slot0._tf
	slot0.scrollRect = slot1:GetComponent(&quot;LScrollRect&quot;)

	slot1 = function()
		if uv0.timer then
			uv0.timer:Stop()

			uv0.timer = nil
		end
	end

	slot2 = function(slot0)
		uv0.timer = Timer.New(slot0, 0.8, 1)

		uv0.timer:Start()
	end

	slot3 = function(slot0)
		slot1 = uv0.change2ScrPos(uv1._tf:Find(&quot;content&quot;), slot0.position)
		slot2 = nil

		for slot6, slot7 in pairs(uv1.cards) do
			slot8 = slot7._bg
			slot9 = slot7._tf.localPosition.x
			slot10 = slot7._tf.localPosition.y
			slot11 = Vector2(slot9 + slot8.rect.width / 2, slot10 + slot8.rect.height / 2)
			slot12 = Vector2(slot9 + slot8.rect.width / 2, slot10 - slot8.rect.height / 2)

			if Vector2(slot9 - slot8.rect.width / 2, slot10 - slot8.rect.height / 2).x &lt; slot1.x and slot1.x &lt; slot12.x and slot12.y &lt; slot1.y and slot1.y &lt; slot11.y then
				slot2 = slot7

				break
			end
		end

		return slot2
	end

	slot4 = GetOrAddComponent(slot0._tf, typeof(EventTriggerListener))

	slot4:AddPointDownFunc(function (slot0, slot1)
		uv0.downPosition = slot1.position

		if uv1(slot1) then
			uv2()
			uv3(function ()
				uv0.lock = true

				uv0.contextData.furnitureDescMsgBox:ExecuteAction(&quot;SetUp&quot;, uv1.furniture, uv1._tf.position)
			end)
		end
	end)
	slot4:AddPointUpFunc(function (slot0, slot1)
		uv0()

		if uv1.lock then
			slot2 = uv1.contextData.furnitureDescMsgBox

			slot2:ExecuteAction(&quot;Hide&quot;)
			onNextTick(function ()
				uv0.lock = false
			end)
		else
			if Vector2.Distance(slot1.position, uv1.downPosition) &gt; 1 then
				return
			end

			if uv2(slot1) and slot3:HasMask() and slot3.furniture:isPaper() then
				uv1:emit(BackYardDecorationMediator.REMOVE_PAPER, slot3.furniture)
			elseif slot3 and not slot3:HasMask() then
				uv1:emit(BackYardDecorationMediator.ADD_FURNITURE, Clone(slot3.furniture))
			elseif slot3 and slot3:HasMask() then
				uv1:ClearMark()

				uv1.selectedId = slot3.furniture.id

				slot3:UpdateMark(uv1.selectedId)
				uv1:emit(BackYardDecorationMediator.ON_SELECTED_FURNITRUE, slot3.furniture.id)
				uv1:emit(uv3.SELECTED_FURNITRUE)
			end
		end
	end)
end

slot0.ClearMark = function(slot0)
	for slot4, slot5 in pairs(slot0.cards) do
		slot5:UpdateMark(-1)
	end

	slot0.selectedId = nil
end

slot0.Selected = function(slot0, slot1)
	slot0:ClearMark()

	for slot5, slot6 in pairs(slot0.cards) do
		if slot6.furniture.id == slot1 then
			slot6:UpdateMark(slot1)
		end
	end

	slot0.selectedId = slot1
end

slot0.OnInitItem = function(slot0, slot1)
	slot0.cards[slot1] = BackYardDecorationCard.New(slot1)
end

slot0.OnUpdateItem = function(slot0, slot1, slot2)
	if not slot0.cards[slot2] then
		slot0:OnInitItem(slot2)

		slot3 = slot0.cards[slot2]
	end

	if not slot0.lastDiaplys[slot1 + 1] then
		return
	end

	slot10, slot11 = slot0:GetPutCntByConfigId(slot0.dorm, slot4:getConfig(&quot;id&quot;))

	slot3:Update(slot4, slot10, slot11, slot0.selectedId or -1)
	slot3:PlayEnterAnimation()
end

slot0.GetDisplays = function(slot0)
	slot1 = {}
	slot2 = slot0.dorm:GetPurchasedFurnitures()
	slot5 = ipairs
	slot6 = pg.furniture_data_template.get_id_list_by_tag[uv0(slot0.pageType)] or {}

	for slot8, slot9 in slot5(slot6) do
		if slot2[slot9] then
			table.insert(slot1, slot10)
		end
	end

	return slot1
end

slot0.OnFilterDone = function(slot0, slot1)
	slot0.displays = slot1

	slot0:SetTotalCount()
end

slot0.SetTotalCount = function(slot0)
	if not slot0.searchKey or slot0.searchKey == &quot;&quot; then
		slot0.lastDiaplys = slot0.displays
	else
		slot0.lastDiaplys = {}

		for slot4, slot5 in ipairs(slot0.displays) do
			if slot5:isMatchSearchKey(slot0.searchKey) then
				table.insert(slot0.lastDiaplys, slot5)
			end
		end
	end

	slot0.scrollRect:SetTotalCount(#slot0.lastDiaplys)
end

slot0.OnSearchKeyChanged = function(slot0)
	slot0:SetTotalCount()
end

slot0.OnDestroy = function(slot0)
	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end

	slot1 = pairs
	slot2 = slot0.cards or {}

	for slot4, slot5 in slot1(slot2) do
		slot5:Dispose()
	end

	slot0.cards = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>