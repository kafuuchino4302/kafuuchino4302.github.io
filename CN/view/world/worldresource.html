<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>worldresource.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>worldresource.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WorldResource&quot;, import(&quot;..base.BaseUI&quot;))
slot0.Listeners = {
	onUpdateInventory = &quot;OnUpdateInventory&quot;,
	onUpdateActivate = &quot;OnUpdateActivate&quot;,
	onUpdateStamina = &quot;OnUpdateStamina&quot;,
	onBossProgressUpdate = &quot;OnBossProgressUpdate&quot;
}

slot0.Ctor = function(slot0)
	uv0.super.Ctor(slot0)

	slot1 = PoolMgr.GetInstance()

	slot1:GetUI(&quot;WorldResPanel&quot;, false, function (slot0)
		slot0.transform:SetParent(pg.UIMgr.GetInstance().UIMain.transform, false)
		uv0:onUILoaded(slot0)
	end)
end

slot0.init = function(slot0)
	for slot4, slot5 in pairs(uv0.Listeners) do
		slot0[slot4] = function (...)
			uv0[uv1](uv2, ...)
		end
	end

	slot0.stamina = slot0:findTF(&quot;res/stamina&quot;)

	onButton(slot0, slot0.stamina, function ()
		uv0.staminaMgr:Show()
	end, SFX_PANEL)

	slot0.oil = slot0:findTF(&quot;res/oil&quot;)

	onButton(slot0, slot0.oil, function ()
		if not ShoppingStreet.getRiseShopId(ShopArgs.BuyOil, uv0.player.buyOilCount) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_today_buy_limit&quot;))

			return
		end

		slot1 = pg.shop_template[slot0]
		slot2 = slot1.num

		if slot1.num == -1 and slot1.genre == ShopArgs.BuyOil then
			slot2 = ShopArgs.getOilByLevel(uv0.player.level)
		end

		if uv0.player.buyOilCount &lt; pg.gameset.buy_oil_limit.key_value then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				type = MSGBOX_TYPE_SINGLE_ITEM,
				content = i18n(&quot;oil_buy_tip&quot;, slot1.resource_num, slot2, uv0.player.buyOilCount),
				drop = {
					id = 2,
					type = DROP_TYPE_RESOURCE,
					count = slot2
				},
				onYes = function ()
					pg.m02:sendNotification(GAME.SHOPPING, {
						isQuickShopping = true,
						count = 1,
						id = uv0
					})
				end
			})
		else
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				type = MSGBOX_TYPE_HELP,
				helps = i18n(&quot;help_oil_buy_limit&quot;),
				custom = {
					{
						text = &quot;text_iknow&quot;,
						sound = SFX_CANCEL
					}
				}
			})
		end
	end, SFX_PANEL)

	slot0.Whuobi = slot0:findTF(&quot;res/Whuobi&quot;)

	onButton(slot0, slot0.Whuobi, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_SINGLE_ITEM,
			drop = Drop.New({
				type = DROP_TYPE_WORLD_ITEM,
				id = WorldItem.MoneyId
			})
		})
	end, SFX_PANEL)

	slot0.bossProgress = slot0:findTF(&quot;res/boss_progress&quot;)

	onButton(slot0, slot0.bossProgress, function ()
		slot0 = WorldBossConst.GetCurrBossItemInfo()

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			hideNo = true,
			type = MSGBOX_TYPE_DROP_ITEM,
			name = slot0.name,
			content = slot0.display,
			iconPath = slot0.icon,
			frame = slot0.rarity,
			yesText = i18n(&quot;common_go_to_analyze&quot;),
			yesGray = not WorldBossConst.CanUnlockCurrBoss(),
			onYes = function ()
				if uv0 and uv1:GetBossProxy():IsOpen() then
					pg.m02:sendNotification(GAME.GO_SCENE, SCENE.WORLDBOSS)
				else
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;world_boss_progress_no_enough&quot;))
					pg.MsgboxMgr.GetInstance():hide()
				end
			end
		})
	end, SFX_PANEL)

	if nowWorld():GetActiveMap() then
		slot0:setStaminaMgr(slot1.staminaMgr)
	else
		slot0.atlas = slot1:GetAtlas()

		slot0.atlas:AddListener(WorldAtlas.EventUpdateActiveMap, slot0.onUpdateActivate)
		setActive(slot0.stamina, false)
	end

	slot0:setWorldInventory(slot1:GetInventoryProxy())
	slot0:SetWorldBossRes(slot1:GetBossProxy())
end

slot0.setParent = function(slot0, slot1, slot2)
	setParent(slot0._go, slot1, slot2)
end

slot0.setPlayer = function(slot0, slot1)
	assert(isa(slot1, Player), &quot;should be an instance of Player&quot;)

	slot0.player = slot1

	setText(slot0.oil:Find(&quot;max_value&quot;), &quot;MAX:&quot; .. pg.user_level[slot1.level].max_oil)
	setText(slot0.oil:Find(&quot;value&quot;), slot1.oil)
end

slot0.OnUpdateActivate = function(slot0)
	slot0:setStaminaMgr(nowWorld().staminaMgr)
	slot0.atlas:RemoveListener(WorldAtlas.EventUpdateActiveMap, slot0.onUpdateActivate)
end

slot0.setStaminaMgr = function(slot0, slot1)
	slot0.staminaMgr = slot1

	setText(slot0.stamina:Find(&quot;max_value&quot;), &quot;MAX:&quot; .. slot1:GetMaxStamina())
	slot0.staminaMgr:AddListener(WorldStaminaManager.EventUpdateStamina, slot0.onUpdateStamina)
	slot0:OnUpdateStamina()
	setActive(slot0.stamina, true)
end

slot0.setWorldInventory = function(slot0, slot1)
	slot0.inventoryProxy = slot1

	slot0.inventoryProxy:AddListener(WorldInventoryProxy.EventUpdateItem, slot0.onUpdateInventory)
	slot0:OnUpdateInventory()
end

slot0.OnUpdateStamina = function(slot0)
	setText(slot0.stamina:Find(&quot;value&quot;), slot0.staminaMgr:GetDisplayStanima())
end

slot0.OnUpdateInventory = function(slot0, slot1, slot2, slot3)
	if not slot1 or slot1 == WorldInventoryProxy.EventUpdateItem and slot3.id == WorldItem.MoneyId then
		setText(slot0.Whuobi:Find(&quot;value&quot;), slot0.inventoryProxy:GetItemCount(WorldItem.MoneyId))
	end
end

slot0.SetWorldBossRes = function(slot0, slot1)
	slot0.worldBossProxy = slot1

	slot0.worldBossProxy:AddListener(WorldBossProxy.EventUnlockProgressUpdated, slot0.onBossProgressUpdate)
	slot0:OnBossProgressUpdate()
end

slot0.OnBossProgressUpdate = function(slot0)
	slot2, slot3, slot4 = WorldBossConst.GetCurrBossItemCapacity()
	slot5, slot6 = WorldBossConst.GetCurrBossConsume()
	slot9 = slot4 &lt;= slot3 and COLOR_GREY or COLOR_WHITE

	setText(slot0.bossProgress:Find(&quot;value&quot;), &quot;&lt;color=&quot; .. slot9 .. &quot;&gt;&quot; .. WorldBossConst.GetCurrBossItemProgress() .. &quot;/&quot; .. slot6 .. &quot;&lt;/color&gt;&quot;)
	setText(slot0.bossProgress:Find(&quot;max_value&quot;), &quot;&lt;color=&quot; .. slot9 .. &quot;&gt;DAILY:&quot; .. slot3 .. &quot;/&quot; .. slot4 .. &quot;&lt;/color&gt;&quot;)
	setActive(slot0.bossProgress, nowWorld():IsSystemOpen(WorldConst.SystemWorldBoss))
end

slot0.willExit = function(slot0)
	if slot0.staminaMgr then
		slot0.staminaMgr:RemoveListener(WorldStaminaManager.EventUpdateStamina, slot0.onUpdateStamina)
	else
		slot0.atlas:RemoveListener(WorldAtlas.EventUpdateActiveMap, slot0.onUpdateActivate)
	end

	slot0.inventoryProxy:RemoveListener(WorldInventoryProxy.EventUpdateItem, slot0.onUpdateInventory)
	slot0.worldBossProxy:RemoveListener(WorldBossProxy.EventUnlockProgressUpdated, slot0.onBossProgressUpdate)
	PoolMgr.GetInstance():ReturnUI(&quot;WorldResPanel&quot;, slot0._go)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>