<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>worldinformationlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>worldinformationlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WorldInformationLayer&quot;, import(&quot;..base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;WorldInformationUI&quot;
end

slot0.Listeners = {
	onUpdateDailyTask = &quot;OnUpdateDailyTask&quot;,
	onUpdateTask = &quot;OnUpdateTask&quot;
}

slot0.init = function(slot0)
	for slot4, slot5 in pairs(uv0.Listeners) do
		slot0[slot4] = function (...)
			uv0[uv1](uv2, ...)
		end
	end

	slot0.rtLeftPanel = slot0:findTF(&quot;adapt/left_panel&quot;)

	setText(slot0.rtLeftPanel:Find(&quot;title/Text&quot;), i18n(&quot;world_map_title_tips&quot;))
	setText(slot0.rtLeftPanel:Find(&quot;title/Text_en&quot;), i18n(&quot;world_map_title_tips_en&quot;))

	slot0.wsWorldInfo = WSWorldInfo.New()
	slot0.wsWorldInfo.transform = slot0.rtLeftPanel:Find(&quot;world_info&quot;)

	slot0.wsWorldInfo:Setup()
	setText(slot0.wsWorldInfo.transform:Find(&quot;power/bg/Word&quot;), i18n(&quot;world_total_power&quot;))
	setText(slot0.wsWorldInfo.transform:Find(&quot;explore/mileage/Text&quot;), i18n(&quot;world_mileage&quot;))
	setText(slot0.wsWorldInfo.transform:Find(&quot;explore/pressing/Text&quot;), i18n(&quot;world_pressing&quot;))

	slot0.rtRightPanel = slot0:findTF(&quot;adapt/right_panel&quot;)
	slot0.rtNothingTip = slot0.rtRightPanel:Find(&quot;nothing_tip&quot;)
	slot0.btnClose = slot0.rtRightPanel:Find(&quot;title/close_btn&quot;)
	slot0.toggleAll = slot0.rtRightPanel:Find(&quot;title/task_all&quot;)
	slot0.toggleMain = slot0.rtRightPanel:Find(&quot;title/task_main&quot;)
	slot0.rtContainer = slot0.rtRightPanel:Find(&quot;main/viewport/content&quot;)
	slot0.taskItemList = UIItemList.New(slot0.rtContainer, slot0.rtContainer:Find(&quot;task_tpl&quot;))

	slot0.taskItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:UpdateTaskTpl(slot2, uv0.filterTaskList[slot1 + 1])
		end
	end)

	slot0.btnDailyTask = slot0.rtLeftPanel:Find(&quot;world_info/task_btn&quot;)
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0.btnClose, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0:findTF(&quot;bg&quot;), function ()
		triggerButton(uv0.btnClose)
	end, SFX_CANCEL)
	onToggle(slot0, slot0.toggleAll, function (slot0)
		if slot0 then
			uv0.filterType = nil

			uv0:UpdateFilterTaskList()
		end

		setTextColor(uv0.toggleAll, slot0 and Color.white or Color.New(0.48627450980392156, 0.5215686274509804, 0.6431372549019608))
	end, SFX_PANEL)
	onToggle(slot0, slot0.toggleMain, function (slot0)
		if slot0 then
			uv0.filterType = 0

			uv0:UpdateFilterTaskList()
		end

		setTextColor(uv0.toggleMain, slot0 and Color.white or Color.New(0.48627450980392156, 0.5215686274509804, 0.6431372549019608))
	end, SFX_PANEL)
	onButton(slot0, slot0.btnDailyTask, function ()
		if nowWorld():IsSystemOpen(WorldConst.SystemDailyTask) then
			uv0:emit(WorldInformationMediator.OnOpenDailyTaskPanel)
		else
			pg.TipsMgr.GetInstance(i18n(&quot;world_daily_task_lock&quot;))
		end
	end, SFX_PANEL)
	slot0:OnUpdateDailyTask()
	triggerToggle(slot0.toggleAll, true)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false)
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
	slot0.taskProxy:RemoveListener(WorldTaskProxy.EventUpdateTask, slot0.onUpdateTask)
	slot0.taskProxy:RemoveListener(WorldTaskProxy.EventUpdateDailyTaskIds, slot0.onUpdateDailyTask)
	slot0.wsWorldInfo:Dispose()
end

slot0.setWorldTaskProxy = function(slot0, slot1)
	slot0.taskProxy = slot1

	slot0.taskProxy:AddListener(WorldTaskProxy.EventUpdateTask, slot0.onUpdateTask)
	slot0.taskProxy:AddListener(WorldTaskProxy.EventUpdateDailyTaskIds, slot0.onUpdateDailyTask)

	slot0.taskList = slot0.taskProxy:getDoingTaskVOs()
end

slot0.UpdateFilterTaskList = function(slot0)
	slot0.filterTaskList = _.filter(slot0.taskList, function (slot0)
		return not uv0.filterType or slot0.config.type == uv0.filterType
	end)

	table.sort(slot0.filterTaskList, CompareFuncs(WorldTask.sortDic))
	slot0.taskItemList:align(#slot0.filterTaskList)
	setActive(slot0.rtNothingTip, #slot0.filterTaskList == 0)
end

slot0.UpdateTaskTpl = function(slot0, slot1, slot2)
	slot3 = slot1:Find(&quot;base_panel&quot;)

	GetImageSpriteFromAtlasAsync(&quot;ui/worldtaskfloatui_atlas&quot;, pg.WorldToastMgr.Type2PictrueName[slot2.config.type], slot3:Find(&quot;type&quot;), true)
	setText(slot3:Find(&quot;extend_show/title/Text&quot;), slot2.config.name)
	setText(slot3:Find(&quot;base_show/title/Text&quot;), slot2.config.name)
	setText(slot3:Find(&quot;base_show/desc&quot;), slot2.config.description)

	slot4 = slot3:Find(&quot;base_show/IconTpl&quot;)

	removeAllChildren(slot3:Find(&quot;base_show/award&quot;))

	slot10 = 2

	for slot10 = 1, math.min(#slot2.config.show, slot10) do
		slot11 = slot6[slot10]
		slot12 = cloneTplTo(slot4, slot5)

		updateDrop(slot12, {
			type = slot11[1],
			id = slot11[2],
			count = slot11[3]
		})
		onButton(slot0, slot12, function ()
			uv0:emit(uv1.ON_DROP, uv2)
		end, SFX_PANEL)
		setActive(slot12, true)
	end

	setActive(slot4, false)
	setSlider(slot3:Find(&quot;base_show/title/progress&quot;), 0, slot2:getMaxProgress(), slot2:getProgress())

	slot7 = slot3:Find(&quot;btn_go&quot;)

	onButton(slot0, slot7, function ()
		uv0:emit(WorldInformationMediator.OnTaskGoto, uv1.id)
		uv0:closeView()
	end, SFX_PANEL)
	setButtonEnabled(slot7, tobool(slot2:GetFollowingAreaId() or slot2:GetFollowingEntrance()))
	onButton(slot0, slot3:Find(&quot;btn_get&quot;), function ()
		uv0:emit(WorldInformationMediator.OnSubmitTask, uv1)
	end, SFX_CONFIRM)
	setActive(slot7, slot2:getState() == WorldTask.STATE_ONGOING)
	setActive(slot8, slot9 == WorldTask.STATE_FINISHED)

	slot10 = slot1:Find(&quot;extend_panel&quot;)

	if #slot2.config.rare_task_icon &gt; 0 then
		GetImageSpriteFromAtlasAsync(&quot;shipyardicon/&quot; .. slot11, &quot;&quot;, slot10:Find(&quot;card&quot;), true)
	else
		GetImageSpriteFromAtlasAsync(&quot;ui/worldinformationui_atlas&quot;, &quot;nobody&quot;, slot10:Find(&quot;card&quot;), true)
	end

	setText(slot10:Find(&quot;content/desc&quot;), slot2.config.rare_task_text)
	setText(slot10:Find(&quot;content/slider_progress/Text&quot;), slot2:getProgress() .. &quot;/&quot; .. slot2:getMaxProgress())
	setSlider(slot10:Find(&quot;content/slider&quot;), 0, slot2:getMaxProgress(), slot2:getProgress())

	slot12 = slot10:Find(&quot;content/item_tpl&quot;)

	removeAllChildren(slot10:Find(&quot;content/award_bg/panel/content&quot;))

	for slot18, slot19 in ipairs(slot2.config.show) do
		slot20 = cloneTplTo(slot12, slot13)

		updateDrop(slot20, {
			type = slot19[1],
			id = slot19[2],
			count = slot19[3]
		})
		onButton(slot0, slot20, function ()
			uv0:emit(uv1.ON_DROP, uv2)
		end, SFX_PANEL)
		setActive(slot20, true)
	end

	setActive(slot12, false)
	setActive(slot10:Find(&quot;content/award_bg/arror&quot;), #slot14 &gt; 3)
end

slot0.OnUpdateTask = function(slot0)
	slot0.taskList = slot0.taskProxy:getDoingTaskVOs()

	slot0:UpdateFilterTaskList()
end

slot0.OnUpdateDailyTask = function(slot0)
	setActive(slot0.btnDailyTask:Find(&quot;tip&quot;), slot0.taskProxy:canAcceptDailyTask())
	setActive(slot0.btnDailyTask:Find(&quot;locked&quot;), not nowWorld():IsSystemOpen(WorldConst.SystemDailyTask))
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>