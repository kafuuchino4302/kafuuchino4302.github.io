<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>worlddailytasklayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>worlddailytasklayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WorldDailyTaskLayer&quot;, import(&quot;view.base.BaseUI&quot;))
slot0.Listeners = {
	onUpdateTasks = &quot;OnUpdateTasks&quot;
}
slot0.optionsPath = {
	&quot;blur_panel/adapt/top/title/option&quot;
}

slot0.getUIName = function(slot0)
	return &quot;WorldDailyTaskUI&quot;
end

slot0.init = function(slot0)
	for slot4, slot5 in pairs(uv0.Listeners) do
		slot0[slot4] = function (...)
			uv0[uv1](uv2, ...)
		end
	end

	slot0.rtBg = slot0:findTF(&quot;bg&quot;)
	slot0.rtBlurPanel = slot0:findTF(&quot;blur_panel&quot;)
	slot1 = slot0.rtBlurPanel
	slot0.rtTasks = slot1:Find(&quot;adapt/tasks&quot;)
	slot2 = slot0.rtTasks

	setText(slot2:Find(&quot;frame/empty/Text&quot;), i18n(&quot;world_daily_task_none&quot;))

	slot2 = slot0.rtTasks

	setText(slot2:Find(&quot;frame/empty/Text_en&quot;), i18n(&quot;world_daily_task_none_2&quot;))

	slot1 = slot0.rtBlurPanel
	slot0.rtTop = slot1:Find(&quot;adapt/top&quot;)
	slot1 = slot0.rtTop
	slot0.btnBack = slot1:Find(&quot;title/back_button&quot;)
	slot1 = slot0.rtTop
	slot0.btnAllAccept = slot1:Find(&quot;title/btn_accept_all&quot;)
	slot1 = slot0.rtTop
	slot0.rtTopTitle = slot1:Find(&quot;title&quot;)
	slot1 = slot0.rtTopTitle
	slot0.rtImageTitle = slot1:Find(&quot;print/title&quot;)
	slot1 = slot0.rtTopTitle
	slot0.rtImageTitleTask = slot1:Find(&quot;print/title_task&quot;)
	slot1 = slot0.rtTopTitle
	slot0.rtImageTitleShop = slot1:Find(&quot;print/title_shop&quot;)
	slot0.rtTaskWindow = slot0:findTF(&quot;task_window&quot;)
	slot0.wsTasks = {}
	slot1 = slot0.rtTasks
	slot1 = slot1:Find(&quot;frame/viewport/content&quot;)
	slot0.taskItemList = UIItemList.New(slot1, slot1:GetChild(0))
	slot3 = slot0.taskItemList

	slot3:make(function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			if not uv0.wsTasks[slot1] then
				slot3 = WSPortTask.New(slot2)

				onButton(uv0, slot3.btnInactive, function ()
					slot0, slot1 = WorldTask.canTrigger(uv0.task.id)

					if slot0 then
						uv1:emit(WorldDailyTaskMediator.OnAccepetTask, {
							uv0.task.id
						})
					else
						pg.TipsMgr.GetInstance():ShowTips(slot1)
					end
				end, SFX_PANEL)
				onButton(uv0, slot3.btnOnGoing, function ()
					uv0:showTaskWindow(uv1.task)
				end, SFX_PANEL)
				onButton(uv0, slot3.btnFinished, function ()
					uv0:emit(WorldDailyTaskMediator.OnSubmitTask, uv1.task)
				end, SFX_PANEL)

				slot3.onDrop = function(slot0)
					uv0:emit(uv1.ON_DROP, slot0)
				end

				uv0.wsTasks[slot1] = slot3
			end

			slot3:Setup(uv0.taskVOs[slot1])
		end
	end)
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, {
		groupName = slot0:getGroupNameFromData()
	})
	pg.UIMgr.GetInstance():BlurPanel(slot0.rtBlurPanel, false, {
		blurLevelCamera = true
	})
	onButton(slot0, slot0.btnBack, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0.btnAllAccept, function ()
		uv0:emit(WorldDailyTaskMediator.OnAccepetTask, underscore.map(uv0.taskVOs, function (slot0)
			return slot0.id
		end))
	end, SFX_CONFIRM)
	slot0:OnUpdateTasks()
end

slot0.onBackPressed = function(slot0)
	triggerButton(slot0.btnBack)
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0.rtBlurPanel, slot0._tf)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
	slot0:DisposeTasks()
	slot0.taskProxy:RemoveListener(WorldTaskProxy.EventUpdateDailyTaskIds, slot0.onUpdateTasks)

	slot0.taskProxy = nil
end

slot0.SetTaskProxy = function(slot0, slot1)
	slot0.taskProxy = slot1

	slot0.taskProxy:AddListener(WorldTaskProxy.EventUpdateDailyTaskIds, slot0.onUpdateTasks)
end

slot0.OnUpdateTasks = function(slot0)
	slot0.taskVOs = underscore.map(slot0.taskProxy:getDailyTaskIds(), function (slot0)
		return WorldTask.New({
			id = slot0
		})
	end)

	table.sort(slot0.taskVOs, CompareFuncs(WorldTask.sortDic))
	slot0.taskItemList:align(#slot0.taskVOs)
	setActive(slot0.rtTasks:Find(&quot;frame/empty&quot;), #slot0.taskVOs == 0)
	setActive(slot0.btnAllAccept, slot0.taskProxy:canAcceptDailyTask())
end

slot0.DisposeTasks = function(slot0)
	_.each(slot0.wsTasks, function (slot0)
		slot0:Dispose()
	end)

	slot0.wsTasks = nil
end

slot0.showTaskWindow = function(slot0, slot1)
	setActive(slot0.rtTaskWindow:Find(&quot;main_window/left_panel&quot;):Find(&quot;bg&quot;), slot1:IsSpecialType())

	if #slot1.config.rare_task_icon &gt; 0 then
		GetImageSpriteFromAtlasAsync(&quot;shipyardicon/&quot; .. slot2, &quot;&quot;, slot3:Find(&quot;card&quot;), true)
	else
		GetImageSpriteFromAtlasAsync(&quot;ui/worldportui_atlas&quot;, &quot;nobody&quot;, slot3:Find(&quot;card&quot;), true)
	end

	slot4 = slot0.rtTaskWindow:Find(&quot;main_window/right_panel&quot;)

	setText(slot4:Find(&quot;title/Text&quot;), slot1.config.name)
	setText(slot4:Find(&quot;content/desc&quot;), slot1.config.rare_task_text)
	setText(slot4:Find(&quot;content/slider_progress/Text&quot;), slot1:getProgress() .. &quot;/&quot; .. slot1:getMaxProgress())
	setSlider(slot4:Find(&quot;content/slider&quot;), 0, slot1:getMaxProgress(), slot1:getProgress())

	slot5 = slot4:Find(&quot;content/item_tpl&quot;)

	removeAllChildren(slot4:Find(&quot;content/award_bg/panel/content&quot;))

	for slot11, slot12 in ipairs(slot1.config.show) do
		slot13 = cloneTplTo(slot5, slot6)

		updateDrop(slot13, {
			type = slot12[1],
			id = slot12[2],
			count = slot12[3]
		})
		onButton(slot0, slot13, function ()
			uv0:emit(uv1.ON_DROP, uv2)
		end, SFX_PANEL)
		setActive(slot13, true)
	end

	setActive(slot5, false)
	setActive(slot4:Find(&quot;content/award_bg/arror&quot;), #slot7 &gt; 3)
	onButton(slot0, slot4:Find(&quot;btn_close&quot;), function ()
		uv0:hideTaskWindow()
	end, SFX_CANCEL)
	onButton(slot0, slot0.rtTaskWindow:Find(&quot;bg&quot;), function ()
		uv0:hideTaskWindow()
	end, SFX_CANCEL)
	onButton(slot0, slot4:Find(&quot;btn_go&quot;), function ()
		uv0:hideTaskWindow()
		uv0:emit(WorldDailyTaskMediator.OnTaskGoto, uv1.id)
	end, SFX_PANEL)
	setButtonEnabled(slot4:Find(&quot;btn_go&quot;), slot1:GetFollowingAreaId() or slot1:GetFollowingEntrance())
	setActive(slot0.rtTaskWindow, true)
	pg.UIMgr.GetInstance():BlurPanel(slot0.rtTaskWindow, slot0._tf)
end

slot0.hideTaskWindow = function(slot0)
	setActive(slot0.rtTaskWindow, false)
	pg.UIMgr.GetInstance():UnblurPanel(slot0.rtTaskWindow, slot0._tf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>