<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mapbuilderskirmish.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>mapbuilderskirmish.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MapBuilderSkirmish&quot;, import(&quot;.MapBuilderPermanent&quot;))

slot0.GetType = function(slot0)
	return MapBuilder.TYPESKIRMISH
end

slot0.getUIName = function(slot0)
	return &quot;skirmish_levels&quot;
end

slot0.UpdateView = function(slot0)
	slot1 = slot0._tf
	slot2 = 0.21875
	slot1.pivot = Vector2(slot2, 1)
	slot1.anchorMin = Vector2(0.5, 1)
	slot1.anchorMax = Vector2(0.5, 1)
	slot1.anchoredPosition = Vector2((slot2 - 0.5) * slot0._parentTf.rect.width, 0)
	slot0.map.pivot = Vector2(slot2, 1)
	slot6 = nil
	slot6 = slot0.map.rect.width / slot0.map.rect.height &lt; slot0._parentTf.rect.width / slot0._parentTf.rect.height and slot0._parentTf.rect.width / slot0._tf.rect.width or slot0._parentTf.rect.height / slot0._tf.rect.height
	slot0._tf.localScale = Vector3(slot6, slot6, slot6)

	uv0.super.UpdateView(slot0)
end

slot1 = Vector2(-193.5, 120.6)
slot2 = Vector2(211.3, 116.5263)
slot3 = Vector2(0, -622)
slot4 = Vector2(-114, -372)

slot0.UpdateMapItems = function(slot0)
	uv0.super.UpdateMapItems(slot0)

	if getProxy(SkirmishProxy):TryFetchNewTask() then
		return
	end

	slot2 = slot0._tf
	slot4 = slot2:Find(&quot;point_Links&quot;)
	slot5 = slot2:Find(&quot;levelinfo&quot;)

	slot1:UpdateSkirmishProgress()

	slot6 = slot1:getRawData()

	for slot10 = 1, slot2:Find(&quot;skirmish_items&quot;).childCount do
		go(slot3:GetChild(slot10 - 1)):SetActive(false)
	end

	for slot10 = 1, slot4.childCount do
		go(slot4:GetChild(slot10 - 1)):SetActive(false)
	end

	slot7 = 0
	slot8 = false
	slot9 = 0
	slot10 = 0

	for slot14, slot15 in ipairs(slot6) do
		slot16 = slot15
		slot17 = slot3:GetChild(slot14 - 1)

		if slot14 - 2 &gt;= 0 then
			go(slot4:GetChild(slot14 - 2)):SetActive(SkirmishVO.StateActive &lt; slot16:GetState())
		end

		setActive(slot17, SkirmishVO.StateActive &lt; slot15:GetState())
		setActive(slot17:Find(&quot;flag&quot;), slot18 == SkirmishVO.StateWorking)
		setActive(slot17:Find(&quot;clear&quot;), slot18 == SkirmishVO.StateClear)

		if SkirmishVO.StateInactive &lt; slot18 then
			slot9 = slot9 + 1
		end

		if slot18 == SkirmishVO.StateClear then
			slot10 = slot10 + 1
		end

		if slot18 == SkirmishVO.StateWorking then
			slot7 = slot14
		end

		if slot16.flagNew then
			slot16.flagNew = nil

			if slot14 ~= 1 then
				go(slot17):SetActive(false)

				slot8 = true
				slot4:GetChild(slot14 - 2):GetComponent(typeof(Image)).fillAmount = 0

				LeanTween.value(go(slot17), 0, 1, 2):setOnUpdate(System.Action_float(function (slot0)
					uv0.fillAmount = slot0
				end)):setOnComplete(System.Action(function ()
					go(uv0):SetActive(true)
					go(uv1):SetActive(true)
				end)):setDelay(0.5)
			end
		end

		slot19 = slot16:getConfig(&quot;task_id&quot;)

		onButton(slot0, slot17, function ()
			if uv0 ~= SkirmishVO.StateWorking then
				return
			end

			slot1 = uv1:GetEvent()

			if uv1:GetType() == SkirmishVO.TypeStoryOrExpedition then
				if tonumber(slot1) then
					slot2 = uv2.contextData
					slot3 = uv2

					slot3:emit(LevelMediator2.ON_PERFORM_COMBAT, tonumber(slot1), function ()
						uv0.preparedTaskList = uv0.preparedTaskList or {}

						table.insert(uv0.preparedTaskList, uv1)
					end)

					return
				end

				slot2 = pg.NewStoryMgr.GetInstance()

				slot2:Play(slot1, function ()
					uv0:emit(LevelMediator2.ON_SUBMIT_TASK, uv1)
				end)
			elseif slot0 == SkirmishVO.TypeChapter then
				uv2:TryOpenChapterInfo(tonumber(slot1))
			end
		end)
	end

	if slot7 &gt; 0 then
		setActive(slot5, not slot8)

		slot12 = slot3:GetChild(slot7 - 1).anchoredPosition
		slot5.anchoredPosition = slot12:Add(slot7 == 3 and uv1 or uv2)

		setActive(slot5:Find(&quot;line1&quot;), slot7 ~= 3)
		setActive(slot5:Find(&quot;line2&quot;), slot7 == 3)
		setText(slot5:Find(&quot;info/position&quot;), string.format(&quot;POSITION  %02d&quot;, slot7))
		setText(slot5:Find(&quot;info/name&quot;), slot6[slot7]:getConfig(&quot;name&quot;))
		onButton(slot0, slot5, function ()
			triggerButton(uv0)
		end)
	else
		setActive(slot5, false)
	end

	slot11 = slot2:Find(&quot;cloud&quot;)
	slot11.anchoredPosition = uv3

	LeanTween.value(go(slot11), uv3, uv4, 30):setOnUpdateVector2(function (slot0)
		uv0.anchoredPosition = slot0
	end)

	slot0.sceneParent.skirmishBar:Find(&quot;text&quot;):GetComponent(typeof(Text)).text = slot9 - slot10
end

slot0.OnShow = function(slot0)
	uv0.super.OnShow(slot0)
	setActive(slot0.sceneParent.topChapter:Find(&quot;type_skirmish&quot;), true)
	setActive(slot0.sceneParent.skirmishBar, true)
	setActive(slot0.sceneParent.leftChapter:Find(&quot;buttons&quot;), false)
	setActive(slot0.sceneParent.rightChapter, false)
end

slot0.OnHide = function(slot0)
	setActive(slot0.sceneParent.topChapter:Find(&quot;type_skirmish&quot;), false)
	setActive(slot0.sceneParent.skirmishBar, false)
	setActive(slot0.sceneParent.leftChapter:Find(&quot;buttons&quot;), true)
	setActive(slot0.sceneParent.rightChapter, true)

	for slot5 = 1, slot0._tf:Find(&quot;skirmish_items&quot;).childCount do
		LeanTween.cancel(go(slot1:GetChild(slot5 - 1)))
	end

	LeanTween.cancel(go(slot0._tf:Find(&quot;cloud&quot;)))
	uv0.super.OnHide(slot0)
end

slot0.HideFloat = function(slot0)
	setActive(slot0._tf:Find(&quot;skirmish_items&quot;), false)
end

slot0.ShowFloat = function(slot0)
	setActive(slot0._tf:Find(&quot;skirmish_items&quot;), true)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>