<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mapbuilderatelieryumia.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>mapbuilderatelieryumia.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MapBuilderAtelierYumia&quot;, import(&quot;.MapBuilderSPSeriesFull&quot;))

slot0.GetType = function(slot0)
	return MapBuilder.TYPEATELIERYUMIA
end

slot0.getUIName = function(slot0)
	return &quot;LevelSelectAtelierYumia&quot;
end

slot0.SetDisplayMode = function(slot0, slot1)
	uv0.super.SetDisplayMode(slot0, slot1)

	if slot0.contextData.displayMode == uv0.DISPLAY.BATTLE then
		quickPlayAnimation(slot0._tf, &quot;Anim_LevelSelectAtelierYumia_Battle_In&quot;)
	else
		quickPlayAnimation(slot0._tf, &quot;Anim_LevelSelectAtelierYumia_In&quot;)
	end
end

slot0.PlayerLevelTplAnimation = function(slot0, slot1, slot2)
	quickPlayAnimation(slot1, switch(slot2.status, {
		Lock = function ()
			return &quot;Anim_LevelSelectAtelierYumia_LevelTplLock_In&quot;
		end,
		Normal = function ()
			return &quot;Anim_LevelSelectAtelierYumia_LevelTpNormal_In&quot;
		end,
		Hard = function ()
			return &quot;Anim_LevelSelectAtelierYumia_LevelTpHard_In&quot;
		end
	}))
end

slot0.UpdateStory = function(slot0)
	slot1 = {}
	slot2 = pg.NewStoryMgr.GetInstance()
	slot3 = 0
	slot4 = 0

	for slot8, slot9 in pairs(slot0.storyNodesDict) do
		slot11 = slot9:IsActive(slot0.activity, slot0.ptActivity)
		slot12 = slot9:IsReaded()

		if not _G.isActive(slot0.storyHolder:Find(tostring(slot9.id))) and slot11 then
			setActive(slot10, slot11)
			quickPlayAnimation(slot10, switch(slot9:GetType(), {
				[BossRushStoryNode.NODE_TYPE.NORMAL] = function ()
					return &quot;Anim_LevelSelectAtelierYumia_storytpl_In&quot;
				end,
				[BossRushStoryNode.NODE_TYPE.BATTLE] = function ()
					return &quot;Anim_LevelSelectAtelierYumia_bettletpl_In&quot;
				end,
				[BossRushStoryNode.NODE_TYPE.LOCATION] = function ()
					return &quot;Anim_LevelSelectAtelierYumia_Item_Lock_In&quot;
				end
			}, function ()
				assert(false)
			end))
		else
			setActive(slot10, slot11)
		end

		if slot9:GetType() ~= BossRushStoryNode.NODE_TYPE.LOCATION then
			slot3 = slot3 + (slot12 and 1 or 0)
			slot4 = slot4 + 1
		end

		if slot11 then
			slot13 = nil
			slot15 = slot9:GetParams(&quot;item_lock&quot;) and Drop.Create(slot14[2]) or nil
			slot13 = slot15 and slot15:getOwnedCount() &lt; slot15.count and &quot;item_lock&quot; or switch(slot9:GetType(), {
				[BossRushStoryNode.NODE_TYPE.NORMAL] = function ()
					return &quot;story&quot;
				end,
				[BossRushStoryNode.NODE_TYPE.BATTLE] = function ()
					return &quot;battle&quot;
				end,
				[BossRushStoryNode.NODE_TYPE.LOCATION] = function ()
					return &quot;location&quot;
				end
			})

			eachChild(slot10, function (slot0, slot1)
				setActive(slot0, slot0.name == uv0)
			end)
			switch(slot13, {
				story = function (slot0)
					setText(slot0:Find(&quot;name/Text&quot;), uv0:GetName())
					onButton(uv1, slot0, function ()
						if uv0 then
							return
						end

						uv2:PlayStory(uv1:GetStory(), function ()
							uv0:UpdateView()
						end)
					end)
				end,
				battle = function (slot0)
					setText(slot0:Find(&quot;name/Text&quot;), uv0:GetName())
					onButton(uv1, slot0, function ()
						if uv0 then
							return
						end

						uv2:PlayStory(uv1:GetStory(), function ()
							uv0:UpdateView()
						end)
					end)
				end,
				location = function (slot0)
					setText(slot0:Find(&quot;name/Text&quot;), uv0:GetName())
					GetImageSpriteFromAtlasAsync(&quot;ui/levelselectatelieryumia_atlas&quot;, &quot;yumia_story_&quot; .. uv1, slot0:Find(&quot;name/Image&quot;), false)
				end,
				item_lock = function (slot0)
					setText(slot0:Find(&quot;name/Text&quot;), i18n(&quot;yumia_storymode_tip1&quot;, uv0:getName()))
					updateDrop(slot0:Find(&quot;IconTpl&quot;), uv0)
					setText(slot0:Find(&quot;IconTpl/count&quot;), string.format(&quot;&lt;color=#23ffedff&gt;%d&lt;/color&gt;/%d&quot;, uv0:getOwnedCount(), uv0.count))
					onButton(uv1, slot0, function ()
						pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;yumia_storymode_tip2&quot;))
					end, SFX_UI_CLICK)
				end
			}, function ()
				warning(&quot;error state without any display:&quot;, uv0)
			end, slot10:Find(slot13))
		end
	end

	setText(slot0.progressText, slot3 .. &quot;/&quot; .. slot4)
	setActive(slot0.storyAward, tobool(slot0.storyTask))

	if slot0.storyTask then
		updateDrop(slot0.storyAward:GetChild(0), Drop.Create(slot0.storyTask:getConfig(&quot;award_display&quot;)[1]))
		setActive(slot0.storyAward:Find(&quot;get&quot;), slot0.storyTask:getTaskStatus() == 1)
		setActive(slot0.storyAward:Find(&quot;got&quot;), slot7 == 2)
		onButton(slot0, slot0.storyAward, function ()
			uv0:emit(BaseUI.ON_DROP, uv1)
		end)
	end
end

slot0.UpdateButtons = function(slot0)
	uv0.super.UpdateButtons(slot0)
	setActive(slot0.sceneParent.actAtelierYumiaBuffBtn, slot0.contextData.displayMode == uv0.DISPLAY.BATTLE and slot0.contextData.map.configId == 1940002)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>