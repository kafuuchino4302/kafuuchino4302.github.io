<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>levelstagetotalrewardpanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>levelstagetotalrewardpanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;LevelStageTotalRewardPanel&quot;, import(&quot;view.level.BaseTotalRewardPanel&quot;))

slot0.getUIName = function(slot0)
	return &quot;LevelStageTotalRewardPanel&quot;
end

slot1 = 0.15

slot0.init = function(slot0)
	uv0.super.init(slot0)

	slot0.itemList = slot0.boxView:Find(&quot;Content/ItemGrid&quot;)
	slot1 = Instantiate(slot0.itemList:GetComponent(typeof(ItemList)).prefabItem[0])
	slot1.name = &quot;Icon&quot;

	setParent(slot1, slot0.itemList:Find(&quot;GridItem/Shell&quot;))

	slot0.itemListSub = slot0.boxView:Find(&quot;Content/ItemGridSub&quot;)

	cloneTplTo(slot1, slot0.itemListSub:Find(&quot;GridItem/Shell&quot;), slot1.name)

	slot0.spList = slot0.window:Find(&quot;Fixed/SpList&quot;)

	slot0.CloneIconTpl(slot0.spList:Find(&quot;Item/Active/Item&quot;), &quot;Icon&quot;)
	setText(slot0.boxView:Find(&quot;Content/Title/Text&quot;), i18n(&quot;battle_end_subtitle1&quot;))
	setText(slot0.boxView:Find(&quot;Content/TitleSub/Text&quot;), i18n(&quot;settle_rewards_text&quot;))
end

slot0.didEnter = function(slot0)
	uv0.super.didEnter(slot0)

	slot2 = PlayerPrefs.GetInt(AUTO_BATTLE_LABEL, 0) &gt; 0

	if slot0.contextData.isAutoFight and slot2 then
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(SFX_AUTO_BATTLE)
		LuaHelper.Vibrate()
	end

	if getProxy(MetaCharacterProxy):getMetaTacticsInfoOnEnd() and #slot3 &gt; 0 then
		slot0.metaExpView = MetaExpView.New(slot0.window:Find(&quot;Layout&quot;), slot0.event, slot0.contextData)
		slot4 = slot0.metaExpView

		slot4:setData(slot3)
		slot4:Reset()
		slot4:Load()
		slot4:ActionInvoke(&quot;Show&quot;)
	end
end

slot0.willExit = function(slot0)
	slot0:SkipAnim()

	if slot0.metaExpView then
		slot0.metaExpView:Destroy()
	end

	uv0.super.willExit(slot0)
end

slot0.UpdateView = function(slot0)
	slot1 = slot0.contextData

	onButton(slot0, slot0._tf:Find(&quot;BG&quot;), function ()
		if uv0.isRewardAnimating then
			uv0:SkipAnim()

			return
		end

		existCall(uv1.onClose)
		uv0:closeView()
	end)
	onButton(slot0, slot0.window:Find(&quot;Fixed/ButtonGO&quot;), function ()
		if uv0.contextData.spItemID and not (PlayerPrefs.GetInt(&quot;autoFight_firstUse_sp&quot;, 0) == 1) then
			PlayerPrefs.SetInt(&quot;autoFight_firstUse_sp&quot;, 1)
			PlayerPrefs.Save()

			slot2 = function()
				uv0.contextData.spItemID = nil

				uv0:UpdateSPItem()
			end

			uv0:HandleShowMsgBox({
				hideNo = true,
				content = i18n(&quot;autofight_special_operation_tip&quot;),
				onYes = slot2,
				onNo = slot2
			})

			return
		end

		PlayerPrefs.SetInt(Chapter.GetSPOperationItemCacheKey(uv0.contextData.chapter.id), uv0.contextData.spItemID or 0)
		uv0:emit(LevelMediator2.ON_RETRACKING, uv0.contextData.chapter, true)
		uv0:closeView()
	end, SFX_CONFIRM)
	onButton(slot0, slot0.window:Find(&quot;Fixed/ButtonExit&quot;), function ()
		existCall(uv0.onClose)
		uv1:closeView()
	end, SFX_CANCEL)
	slot0:UpdateSPItem()

	slot3 = slot1.resultRewards
	slot4 = slot1.events
	slot5 = slot1.guildTasks
	slot6 = slot1.guildAutoReceives
	slot8 = slot3 and #slot3 &gt; 0
	slot9 = slot4 and #slot4 &gt; 0
	slot10 = slot5 and table.getCount(slot5) &gt; 0
	slot11 = slot6 and table.getCount(slot6) &gt; 0
	slot12 = true
	slot13 = {}

	setActive(slot0.boxView:Find(&quot;Content/Title&quot;), false)
	setActive(slot0.itemList, false)

	if slot1.rewards and #slot2 &gt; 0 then
		slot12 = false
		slot0.hasRewards = true

		table.insert(slot13, function (slot0)
			setActive(uv0.boxView:Find(&quot;Content/Title&quot;), true)
			setActive(uv0.itemList, true)
			slot0()
		end)

		for slot18, slot19 in ipairs(CustomIndexLayer.Clone2Full(slot0.itemList, #slot2)) do
			slot21 = slot14[slot18]

			updateDrop(slot21:Find(&quot;Shell/Icon&quot;), slot2[slot18])
			onButton(slot0, slot21:Find(&quot;Shell/Icon&quot;), function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)
		end

		slot0.isRewardAnimating = true

		for slot18 = 1, #slot2 do
			setActive(slot14[slot18], false)
			table.insert(slot13, function (slot0)
				if uv0.exited then
					return
				end

				setActive(uv1, true)
				scrollTo(uv0.boxView:Find(&quot;Content&quot;), {
					y = 0
				})

				uv0.LTid = LeanTween.delayedCall(uv2, System.Action(slot0)).uniqueId
			end)
		end
	end

	setActive(slot0.boxView:Find(&quot;Content/TitleSub&quot;), false)
	setActive(slot0.itemListSub, false)

	if slot8 then
		slot12 = false
		slot0.hasResultRewards = true

		table.insert(slot13, function (slot0)
			setActive(uv0.boxView:Find(&quot;Content/TitleSub&quot;), true)
			setActive(uv0.itemListSub, true)
			slot0()
		end)

		for slot18, slot19 in ipairs(CustomIndexLayer.Clone2Full(slot0.itemListSub, #slot3)) do
			slot21 = slot14[slot18]

			updateDrop(slot21:Find(&quot;Shell/Icon&quot;), slot3[slot18])
			onButton(slot0, slot21:Find(&quot;Shell/Icon&quot;), function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)
		end

		slot0.isRewardAnimating = true
		slot15 = {}

		for slot19 = 1, #slot3 do
			setActive(slot14[slot19], false)
			table.insert(slot13, function (slot0)
				if uv0.exited then
					return
				end

				setActive(uv1, true)
				scrollTo(uv0.boxView:Find(&quot;Content&quot;), {
					y = 0
				})

				uv0.LTid = LeanTween.delayedCall(uv2, System.Action(slot0)).uniqueId
			end)
		end
	end

	setActive(slot0.boxView:Find(&quot;Content/TextArea&quot;), false)

	slot14 = {}

	if slot9 then
		for slot18, slot19 in ipairs(slot4) do
			table.insert(slot14, i18n(&quot;autofight_entrust&quot;, pg.collection_template[slot19] and pg.collection_template[slot19].title or &quot;&quot;))
		end
	end

	if slot10 then
		for slot18, slot19 in pairs(slot5) do
			table.insert(slot14, i18n(&quot;autofight_task&quot;, slot19))
		end
	end

	if slot11 then
		for slot18, slot19 in pairs(slot6) do
			table.insert(slot14, i18n(&quot;guild_task_autoaccept_1&quot;, slot19))
		end
	end

	if #slot14 &gt; 0 then
		slot12 = false
		slot0.hasEventMsg = true
		slot16 = slot0.boxView

		setText(slot16:Find(&quot;Content/TextArea/Text&quot;), table.concat(slot14, &quot;\n&quot;))
		table.insert(slot13, function (slot0)
			setActive(uv0.boxView:Find(&quot;Content/TextArea&quot;), true)
			slot0()
		end)
	end

	setActive(slot0.boxView, not slot12)
	setActive(slot0.emptyTip, slot12)
	seriesAsync(slot13, function ()
		uv0:SkipAnim()
	end)
end

slot0.UpdateSPItem = function(slot0)
	slot2 = getProxy(BagProxy):getItemsByType(Item.SPECIAL_OPERATION_TICKET)

	if slot0.contextData.chapter:getConfig(&quot;special_operation_list&quot;) == &quot;&quot; then
		slot3 = {} or slot3
	end

	slot4 = {}

	for slot8, slot9 in ipairs(pg.benefit_buff_template.all) do
		if pg.benefit_buff_template[slot9].benefit_type == Chapter.OPERATION_BUFF_TYPE_DESC and table.contains(slot3, slot9) then
			table.insert(slot4, slot10)
		end
	end

	slot5 = 1

	setActive(slot0.spList, #slot4 ~= 0 and slot0.contextData.chapter:GetRestDailyBonus() == 0)

	if #slot4 == 0 then
		return
	end

	slot8 = slot0.spList

	UIItemList.StaticAlign(slot0.spList, slot8:GetChild(0), slot5, function (slot0, slot1, slot2)
		if slot0 ~= UIItemList.EventUpdate then
			return
		end

		slot3 = uv0[slot1 + 1]
		slot4 = tonumber(slot3.benefit_condition)

		setText(slot2:Find(&quot;Active/Desc&quot;), slot3.desc)

		slot6 = _.detect(uv1, function (slot0)
			return slot0.configId == uv0
		end) and slot5.count &gt; 0

		setActive(slot2:Find(&quot;Active&quot;), slot6)
		setActive(slot2:Find(&quot;Block&quot;), not slot6)

		if not slot6 then
			setText(slot2:Find(&quot;Block&quot;):Find(&quot;Desc&quot;), i18n(&quot;levelScene_select_noitem&quot;))

			return
		end

		setActive(slot2:Find(&quot;Active/Item&quot;), true)
		updateDrop(slot2:Find(&quot;Active/Item/Icon&quot;), Drop.New({
			id = slot4,
			type = DROP_TYPE_ITEM,
			count = slot5 and slot5.count or 0
		}))
		onButton(uv2, slot2, function ()
			uv0.contextData.spItemID = not uv0.contextData.spItemID and uv1 or nil

			if uv0.contextData.spItemID then
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;levelScene_select_sp&quot;))
			end

			uv0:UpdateSPItem()
		end, SFX_PANEL)
		onButton(uv2, slot2:Find(&quot;Active/Item/Icon&quot;), function ()
			uv0:emit(BaseUI.ON_ITEM, uv1)
		end)
		setActive(slot2:Find(&quot;Active/Checkbox/Mark&quot;), tobool(uv2.contextData.spItemID))
	end)
end

slot0.SkipAnim = function(slot0)
	if not slot0.isRewardAnimating then
		return
	end

	slot0.isRewardAnimating = nil

	if slot0.LTid then
		LeanTween.cancel(slot0.LTid)

		slot0.LTid = nil
	end

	eachChild(slot0.itemList, function (slot0)
		setActive(slot0, true)
	end)
	eachChild(slot0.itemListSub, function (slot0)
		setActive(slot0, true)
	end)
	setActive(slot0.boxView:Find(&quot;Content/Title&quot;), slot0.hasRewards)
	setActive(slot0.itemList, slot0.hasRewards)
	setActive(slot0.boxView:Find(&quot;Content/TitleSub&quot;), slot0.hasResultRewards)
	setActive(slot0.itemListSub, slot0.hasResultRewards)
	setActive(slot0.boxView:Find(&quot;Content/TextArea&quot;), slot0.hasEventMsg)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>