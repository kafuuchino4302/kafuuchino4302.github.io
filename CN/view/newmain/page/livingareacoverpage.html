<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>livingareacoverpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>livingareacoverpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;LivingAreaCoverPage&quot;, import(&quot;...base.BaseSubView&quot;))

slot0.getUIName = function(slot0)
	return &quot;LivingAreaCoverUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.tpl = slot0:findTF(&quot;bg/tpl&quot;)

	setActive(slot0.tpl, false)

	slot0.frameTF = slot0:findTF(&quot;bg/frame&quot;)
	slot0.contentTF = slot0:findTF(&quot;view/content&quot;, slot0.frameTF)
	slot0.unlockTF = slot0:findTF(&quot;unlock&quot;, slot0.contentTF)

	setText(slot0:findTF(&quot;title/Text&quot;, slot0.unlockTF), i18n(&quot;word_unlock&quot;))

	slot0.unlockUIList = UIItemList.New(slot0:findTF(&quot;list&quot;, slot0.unlockTF), slot0.tpl)
	slot0.lockTF = slot0:findTF(&quot;lock&quot;, slot0.contentTF)

	setText(slot0:findTF(&quot;title/Text&quot;, slot0.lockTF), i18n(&quot;word_lock&quot;))

	slot0.lockUIList = UIItemList.New(slot0:findTF(&quot;list&quot;, slot0.lockTF), slot0.tpl)
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0._tf, function ()
		uv0:CheckSet()
	end, SFX_PANEL)
	onButton(slot0, slot0:findTF(&quot;close&quot;, slot0.frameTF), function ()
		uv0:CheckSet()
	end, SFX_PANEL)

	slot1 = slot0.unlockUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateItem(slot1, slot2, &quot;unlock&quot;)
		end
	end)

	slot1 = slot0.lockUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateItem(slot1, slot2, &quot;lock&quot;)
		end
	end)
end

slot0.updateItem = function(slot0, slot1, slot2, slot3)
	slot4 = slot1 + 1
	slot5 = slot3 == &quot;unlock&quot;
	slot6 = slot5 and slot0.unlockList[slot4] or slot0.lockList[slot4]

	LoadImageSpriteAsync(slot6:GetIcon(), slot0:findTF(&quot;icon&quot;, slot2), true)
	setText(slot0:findTF(&quot;lock/Image/Text&quot;, slot2), slot6:GetUnlockText())
	setActive(slot0:findTF(&quot;lock&quot;, slot2), not slot5)
	setActive(slot0:findTF(&quot;selected&quot;, slot2), slot5)
	onButton(slot0, slot2, function ()
		if not uv0 then
			return
		end

		if uv1.selectedIdx ~= uv2 then
			if uv3:IsNew() then
				uv3:ClearNew()
				getProxy(LivingAreaCoverProxy):UpdateCover(uv3)
			end

			uv1.selectedIdx = uv2

			uv1.unlockUIList:align(#uv1.unlockList)

			if uv1.contextData and uv1.contextData.onSelected then
				uv1.contextData.onSelected(uv3)
			end
		end
	end, SFX_CONFIRM)
	setActive(slot0:findTF(&quot;new&quot;, slot2), slot6:IsNew())
	setActive(slot0:findTF(&quot;selected&quot;, slot2), slot5 and slot0.selectedIdx == slot4)
end

slot0.Show = function(slot0)
	uv0.super.Show(slot0)

	slot1 = getProxy(LivingAreaCoverProxy)
	slot0.coverId = slot1:GetCoverId()
	slot0.unlockList = slot1:GetUnlockList()
	slot0.lockList = slot1:GetLockList()

	slot0:Sort()

	slot0.selectedIdx = 1

	slot0.unlockUIList:align(#slot0.unlockList)
	slot0.lockUIList:align(#slot0.lockList)
	quickPlayAnimation(slot0._tf, &quot;anim_dorm3d_areacover_in&quot;)
end

slot0.Sort = function(slot0)
	table.sort(slot0.unlockList, CompareFuncs({
		function (slot0)
			return slot0.id == uv0.coverId and 0 or 1
		end,
		function (slot0)
			return slot0.id
		end
	}))
	table.sort(slot0.lockList, CompareFuncs({
		function (slot0)
			return slot0.id
		end
	}))
end

slot0.CheckSet = function(slot0)
	if slot0.unlockList[slot0.selectedIdx].id ~= slot0.coverId then
		pg.m02:sendNotification(GAME.CHANGE_LIVINGAREA_COVER, {
			coverId = slot1,
			callback = function ()
				uv0:Hide()
			end
		})
	else
		slot0:Hide()
	end
end

slot0.Hide = function(slot0)
	if slot0:isShowing() and not slot0.inExitAnim then
		slot0.inExitAnim = nil

		quickPlayAnimation(slot0._tf, &quot;anim_dorm3d_areacover_out&quot;)
		onDelayTick(function ()
			uv0.inExitAnim = nil

			if uv0.contextData and uv0.contextData.onHide then
				uv0.contextData.onHide()
			end

			uv1.super.Hide(uv0)
		end, 0.2)
	end
end

slot0.OnDestroy = function(slot0)
	slot0:Hide()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>