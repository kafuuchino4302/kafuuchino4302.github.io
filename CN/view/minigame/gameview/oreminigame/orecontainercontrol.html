<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>orecontainercontrol.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>orecontainercontrol.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;OreContainerControl&quot;)
slot0.BREAK_MOVE_TIME = 0.5

slot0.Ctor = function(slot0, slot1, slot2)
	slot0.binder = slot1
	slot0._tf = slot2

	slot0:Init()
end

slot0.Init = function(slot0)
	slot0:AddListener()

	slot0.deliverSpeed = 50
	slot0.mainTF = slot0._tf:Find(&quot;Container_1/break&quot;)
end

slot0.AddListener = function(slot0)
	slot1 = slot0.binder

	slot1:bind(OreGameConfig.EVENT_DELIVER, function (slot0, slot1)
		uv0:PlayDeliverAnim(slot1.status, slot1.pos, slot1.oreTF)
	end)

	slot1 = slot0.binder

	slot1:bind(OreGameConfig.EVENT_PLAY_CONTAINER_HIT, function (slot0, slot1)
		uv0:PlayHitAnim(slot1.status, slot1.pos, slot1.hitPos, slot1.oreTF)
	end)
end

slot0.DeliveOffsetY = {
	-7,
	-7,
	-16
}

slot0.PlayDeliverAnim = function(slot0, slot1, slot2, slot3)
	slot0.mainTF = slot0._tf:Find(&quot;Container_&quot; .. slot1 .. &quot;/deliver&quot;)

	setAnchoredPosition(slot0.mainTF, {
		x = slot2.x,
		y = slot2.y + uv0.DeliveOffsetY[slot1]
	})
	setActive(slot0.mainTF, true)

	slot4 = slot0.mainTF:Find(&quot;ore/pos&quot;)

	removeAllChildren(slot4)
	cloneTplTo(slot3, slot4)
	slot0.mainTF:Find(&quot;BK/Image&quot;):GetComponent(typeof(Animator)):Play(&quot;Deliver_2_Lift_BK&quot;)
	slot0.mainTF:Find(&quot;FR/Image&quot;):GetComponent(typeof(Animator)):Play(&quot;Deliver_2_Lift_FR&quot;)

	slot0.deliverTime = 0
end

slot0.moveRata = {
	1,
	1.2,
	1.5
}

slot0.PlayHitAnim = function(slot0, slot1, slot2, slot3, slot4)
	if slot1 == OreAkashiControl.STATUS_NULL then
		return
	end

	slot5 = slot0._tf
	slot0.mainTF = slot5:Find(&quot;Container_&quot; .. slot1 .. &quot;/break&quot;)

	setAnchoredPosition(slot0.mainTF, slot2)
	setActive(slot0.mainTF, true)

	slot5 = slot0.mainTF.parent
	slot5 = slot5:Find(&quot;ore/pos&quot;)

	removeAllChildren(slot5)

	slot0.orePosList = {}
	slot6 = cloneTplTo(slot4, slot5)
	slot0.oreTFs = slot6:Find(&quot;oreTF&quot;)
	slot0.hitPos = {
		x = -slot3.x * uv0.moveRata[slot1],
		y = -slot3.y * uv0.moveRata[slot1]
	}

	setAnchoredPosition(slot5, Vector2(slot2.x + slot0.hitPos.x, slot2.y + slot0.hitPos.y))

	slot6 = slot0.mainTF
	slot6 = slot6:Find(&quot;main/Image&quot;)
	slot6 = slot6:GetComponent(typeof(Animator))

	slot6:Play(&quot;Break&quot;)

	slot0.breakTime = 0

	eachChild(slot0.oreTFs, function (slot0)
		uv0.orePosList[slot0.name] = {
			x = math.random(50) - 25,
			y = math.random(50) - 25
		}
	end)
end

slot0.Reset = function(slot0)
	slot0.deliverTime = nil
	slot0.breakTime = nil
	slot0.oreTFs = nil

	setActive(slot0.mainTF, false)
	setActive(slot0.mainTF.parent:Find(&quot;ore/pos&quot;), false)
	removeAllChildren(slot0.mainTF.parent:Find(&quot;ore/pos&quot;))
	setAnchoredPosition(slot0.mainTF, Vector2(0, 0))
end

slot0.OnTimer = function(slot0, slot1)
	if slot0.deliverTime then
		setAnchoredPosition(slot0.mainTF, {
			x = slot0.mainTF.anchoredPosition.x,
			y = slot0.mainTF.anchoredPosition.y - slot1 * slot0.deliverSpeed
		})

		slot0.deliverTime = slot0.deliverTime + slot1

		if slot0.mainTF.anchoredPosition.y &lt; -230 then
			removeAllChildren(slot0.mainTF:Find(&quot;ore/pos&quot;))
			slot0:Reset()
		end
	end

	if slot0.breakTime then
		setAnchoredPosition(slot0.mainTF, {
			x = slot0.mainTF.anchoredPosition.x + slot0.hitPos.x * slot1 / uv0.BREAK_MOVE_TIME,
			y = slot0.mainTF.anchoredPosition.y + slot0.hitPos.y * slot1 / uv0.BREAK_MOVE_TIME
		})

		slot0.breakTime = slot0.breakTime + slot1

		if slot0.breakTime &gt;= uv0.BREAK_MOVE_TIME / 3 then
			if not isActive(slot0.mainTF.parent:Find(&quot;ore/pos&quot;)) then
				setActive(slot0.mainTF.parent:Find(&quot;ore/pos&quot;), true)
			end

			eachChild(slot0.oreTFs, function (slot0)
				slot1 = uv0.orePosList[slot0.name]

				setAnchoredPosition(slot0, {
					x = slot0.anchoredPosition.x + slot1.x * uv1 / (uv2.BREAK_MOVE_TIME * 2 / 3),
					y = slot0.anchoredPosition.y + slot1.y * uv1 / (uv2.BREAK_MOVE_TIME * 2 / 3)
				})
			end)
		end

		if uv0.BREAK_MOVE_TIME &lt;= slot0.breakTime then
			slot0:Reset()
		end
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>