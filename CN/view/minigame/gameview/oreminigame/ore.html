<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ore.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>ore.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;Ore&quot;)
slot0.TYPE_SMALL = 1
slot0.TYPE_LA = 2
slot0.FallTime = 1

slot0.Ctor = function(slot0, slot1, slot2, slot3, slot4, slot5)
	slot0.binder = slot1
	slot0._tf = slot2
	slot0.collisionMgr = slot3
	slot0.id = slot4
	slot0.config = OreGameConfig.ORE_CONFIG[slot0.id]
	slot0.startPoint = slot5

	slot0:Init()
end

slot0.AddListener = function(slot0)
	slot1 = slot0.binder

	slot1:bind(OreGameConfig.EVENT_UPDATE_ORE_TARGET, function (slot0, slot1)
		if not uv0.isDestroy then
			setActive(findTF(uv0.effectTF, &quot;Frame&quot;), uv0.index == slot1.index)
		end

		uv0.isTarget = uv0.index == slot1.index
	end)

	slot1 = slot0.binder

	slot1:bind(OreGameConfig.EVENT_CHECK_CARRY, function (slot0, slot1)
		if not uv0.isDestroy and uv0.isTarget then
			if OreGameConfig.MAX_WEIGHT &lt; slot1.weight + uv0.config.weight then
				setActive(findTF(uv0.effectTF, &quot;Limit&quot;), true)
				setActive(findTF(uv0.effectTF, &quot;Full&quot;), true)
			else
				uv0.binder:emit(OreGameConfig.EVENT_DO_CARRY, {
					weight = uv0.config.weight,
					point = uv0.config.score,
					type = uv0.config.type
				})
				uv0.animator:Play(&quot;Vanish&quot;)
				uv0.collisionMgr:RemoveOreObject(uv0.index, uv0)
			end
		end
	end)
end

slot0.AddDftAniEvent = function(slot0)
	slot1 = findTF(slot0._tf, &quot;main&quot;)
	slot1 = slot1:GetComponent(typeof(DftAniEvent))

	slot1:SetEndEvent(function ()
		uv0:Destroy()
	end)

	slot1 = findTF(slot0._tf, &quot;main/Image&quot;)
	slot1 = slot1:GetComponent(typeof(DftAniEvent))

	slot1:SetEndEvent(function ()
		uv0:Destroy()
	end)

	slot1 = findTF(slot0.effectTF, &quot;Limit&quot;)
	slot1 = slot1:GetComponent(typeof(DftAniEvent))

	slot1:SetEndEvent(function ()
		setActive(findTF(uv0.effectTF, &quot;Limit&quot;), false)
	end)

	slot1 = findTF(slot0.effectTF, &quot;Full&quot;)
	slot1 = slot1:GetComponent(typeof(DftAniEvent))

	slot1:SetEndEvent(function ()
		setActive(findTF(uv0.effectTF, &quot;Full&quot;), false)
	end)
end

slot0.Init = function(slot0)
	setAnchoredPosition(slot0._tf, slot0.startPoint)

	slot0.effectTF = findTF(slot0._tf, &quot;effect&quot;)
	slot0.animator = findTF(slot0._tf, &quot;main/Image&quot;):GetComponent(typeof(Animator))
	slot0.index = slot0._tf.name
	slot0.endPoint = findTF(slot0._tf.parent.parent, &quot;pos/&quot; .. slot0._tf.name).anchoredPosition
	slot0.centerPoint = Vector2(slot0.startPoint.x + (math.random() &gt; 0.5 and -10 or 10), slot0.startPoint.y + 80)
	slot0.time = 0
	slot0.isFallEnd = false
	slot0.isTarget = false

	slot0:AddListener()
	slot0:AddDftAniEvent()
	slot0._tf:Find(&quot;main&quot;):GetComponent(typeof(Animator)):Play(&quot;Initial&quot;)
	slot0._tf:Find(&quot;main/Image&quot;):GetComponent(typeof(Animator)):Play(&quot;Fall&quot;)
	eachChild(slot0.effectTF, function (slot0)
		setActive(slot0, false)
	end)
end

slot0.FallEnd = function(slot0)
	slot0.animator:Play(&quot;Spawn&quot;)

	slot0.isFallEnd = true

	slot0.collisionMgr:AddOreObject(slot0.index, slot0)
end

slot0.PlayBlink = function(slot0)
	findTF(slot0._tf, &quot;main&quot;):GetComponent(typeof(Animator)):Play(&quot;Blink&quot;)
end

slot0.Destroy = function(slot0)
	if slot0.isDestroy then
		return
	end

	slot0.binder:emit(OreGameConfig.EVENT_ORE_DESTROY, {
		index = slot0.index,
		id = slot0.id
	})
	slot0.collisionMgr:RemoveOreObject(slot0.index, slot0)

	slot0.isDestroy = true
end

slot0.Dispose = function(slot0)
	slot0.isDestroy = true
end

slot0.OnTimer = function(slot0, slot1)
	if slot0.time &lt; uv0.FallTime then
		slot0.time = slot0.time + slot1

		setAnchoredPosition(slot0._tf, OreGameHelper.GetBeziersPoints(slot0.startPoint, slot0.endPoint, slot0.centerPoint, slot0.time))
	elseif not slot0.isFallEnd then
		slot0:FallEnd()
	end

	if slot0.isFallEnd then
		slot0.time = slot0.time + slot1

		if slot0.time &gt; uv0.FallTime + slot0.config.duration then
			slot0:PlayBlink()
		end
	end
end

slot0.GetAABB = function(slot0)
	if slot0.config.size == uv0.TYPE_SMALL then
		return {
			{
				-7,
				7
			},
			{
				7,
				-7
			}
		}
	else
		return {
			{
				-11,
				11
			},
			{
				13,
				-13
			}
		}
	end
end

slot0.GetCollisionInfo = function(slot0)
	return {
		pos = slot0._tf.anchoredPosition,
		aabb = slot0:GetAABB()
	}
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>