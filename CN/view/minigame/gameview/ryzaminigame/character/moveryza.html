<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>moveryza.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>moveryza.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MoveEnemy&quot;, import(&quot;view.miniGame.gameView.RyzaMiniGame.character.TargetMove&quot;))

slot0.InitUI = function(slot0, slot1)
	slot0.hp = slot1.hp or 3
	slot0.bomb = slot1.bomb or 4
	slot0.bombCount = slot0.bomb
	slot0.power = slot1.power or 4
	slot0.speed = slot1.speed or 4

	slot0:UpdateSpirit(defaultValue(slot1.spirit, true))

	slot0.neglectTime = 0
	slot0.invincibilityTime = 0

	slot0:PlayIdle()
	slot0.rtScale:Find(&quot;main/spirit&quot;):GetComponent(typeof(Image)).material:SetInt(&quot;_Overwrite&quot;, 0)

	slot2 = slot0.rtScale:Find(&quot;main/character&quot;):GetComponent(typeof(DftAniEvent))

	slot2:SetTriggerEvent(function ()
		switch(uv0.status, {
			Burn_S = function ()
				if uv0.spriteVanish then
					uv0.spriteVanish = false

					setActive(uv0.rtScale:Find(&quot;front/EF_Vanish&quot;), true)
				end
			end
		})
	end)
	slot2:SetEndEvent(function ()
		uv0.lock = false

		if uv0.hp &lt;= 0 then
			uv0.responder:GameFinish(false)
		end
	end)
	eachChild(slot0.rtScale:Find(&quot;front&quot;), function (slot0)
		slot0:GetComponent(typeof(DftAniEvent)):SetEndEvent(function ()
			setActive(uv0, false)
		end)
	end)
	slot0.rtScale:Find(&quot;front/EF_Summon&quot;):GetComponent(typeof(DftAniEvent)):SetTriggerEvent(function ()
		uv0.summonCount = defaultValue(uv0.summonCount, 0) + 1
		slot0 = uv0.rtScale:Find(&quot;main/spirit&quot;)

		switch(uv0.summonCount, {
			function ()
				GetOrAddComponent(uv0, typeof(CanvasGroup)).alpha = 0
			end,
			function ()
				GetOrAddComponent(uv0, typeof(CanvasGroup)).alpha = 1

				uv0:GetComponent(typeof(Image)).material:SetInt(&quot;_Overwrite&quot;, 1)
			end,
			function ()
				uv0:GetComponent(typeof(Image)).material:SetInt(&quot;_Overwrite&quot;, 0)
			end
		})

		uv0.summonCount = uv0.summonCount % 3
	end)
end

slot0.InitRegister = function(slot0, slot1)
	slot0:Register(&quot;feedback&quot;, function ()
		uv0.bombCount = math.min(uv0.bombCount + 1, uv0.bomb)
	end, {})
	slot0:Register(&quot;burn&quot;, function ()
		if uv0.invincibilityTime &gt; 0 then
			return
		end

		uv0:Hurt(1)

		if uv0.hp &gt; 0 then
			uv0:PlayAnim(&quot;Burn_S&quot;)
		else
			uv0:DeregisterAll()
			uv0:PlayAnim(&quot;Gameover_B&quot;)
		end
	end, {
		{
			0,
			0
		}
	})
	slot0:Register(&quot;hit&quot;, function (slot0, slot1)
		if uv0.invincibilityTime &gt; 0 then
			return
		end

		uv0:Hurt(slot0)
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(&quot;ui-ryza-minigame-damage&quot;)

		slot2 = slot1 - uv0.realPos
		slot2 = slot2 * 1 / math.sqrt(slot2:SqrMagnitude())

		setAnchoredPosition(uv0.rtScale:Find(&quot;front/EF_Hit&quot;), NewPos(slot2.x, -slot2.y) * 16)
		setActive(uv0.rtScale:Find(&quot;front/EF_Hit&quot;), true)

		if uv0.hp &gt; 0 then
			uv0:PlayAnim(&quot;Damage_&quot; .. (RyzaMiniGameConfig.GetFourDirMark(slot2) == &quot;&quot; and &quot;S&quot; or slot3))
			uv0:PlayDamage()
		else
			uv0:DeregisterAll()
			uv0:PlayAnim(&quot;Gameover_A&quot;)
		end
	end, {})
end

slot0.Hurt = function(slot0, slot1)
	if slot0.spirit then
		slot0.spriteVanish = true

		slot0:UpdateSpirit(false)
	else
		slot0.hp = slot0.hp - slot1

		slot0.responder:SyncStatus(slot0, &quot;hp&quot;, {
			num = slot0.hp,
			delta = -slot1
		})
	end

	slot0.invincibilityTime = 3
end

slot0.AddItem = function(slot0, slot1)
	slot2 = pg.CriMgr.GetInstance()

	slot2:PlaySoundEffect_V3(&quot;ui-ryza-minigame-powerup&quot;)
	switch(slot1, {
		bomb = function ()
			uv0.bomb = math.min(uv0.bomb + 1, 7)
			uv0.bombCount = uv0.bombCount + 1

			uv0.responder:SyncStatus(uv0, &quot;bomb&quot;, {
				num = uv0.bomb
			})
		end,
		power = function ()
			uv0.power = math.min(uv0.power + 1, 7)

			uv0.responder:SyncStatus(uv0, &quot;power&quot;, {
				num = uv0.power
			})
		end,
		speed = function ()
			uv0.speed = math.min(uv0.speed + 1, 7)

			uv0.responder:SyncStatus(uv0, &quot;speed&quot;, {
				num = uv0.speed
			})
		end,
		hp1 = function ()
			uv0.hp = math.min(uv0.hp + 1, 3)

			uv0.responder:SyncStatus(uv0, &quot;hp&quot;, {
				delta = 1,
				num = uv0.hp
			})
		end,
		hp2 = function ()
			uv0.hp = math.min(uv0.hp + 2, 3)

			uv0.responder:SyncStatus(uv0, &quot;hp&quot;, {
				delta = 2,
				num = uv0.hp
			})
		end,
		spirit = function ()
			if not uv0.spirit then
				uv0:UpdateSpirit(true)
				setActive(uv0.rtScale:Find(&quot;front/EF_Summon&quot;), true)
			end
		end
	})
end

slot0.UpdateSpirit = function(slot0, slot1)
	slot0.spirit = slot1

	eachChild(slot0.rtScale:Find(&quot;main&quot;), function (slot0)
		setActive(slot0, slot0.name == uv0)
		slot0:GetComponent(typeof(Image)).material:SetInt(&quot;_Overwrite&quot;, 0)
	end)

	slot0.mainTarget = slot0.rtScale:Find(&quot;main/&quot; .. (slot0.spirit and &quot;spirit&quot; or &quot;character&quot;))
end

slot0.SetBomb = function(slot0)
	if not slot0.lock and slot0.bombCount &gt; 0 and slot0.responder:GetCellCanBomb(slot0.pos) then
		slot0.bombCount = slot0.bombCount - 1

		slot0.responder:Create({
			name = &quot;Bomb&quot;,
			pos = {
				slot0.pos.x,
				slot0.pos.y
			},
			power = slot0.power
		})
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(&quot;ui-ryza-minigame-boom set&quot;)
	end
end

slot0.GetSpeed = function(slot0)
	return slot0.spirit and 7 or slot0.speed
end

slot1 = {
	S = {
		0,
		1
	},
	E = {
		1,
		0
	},
	N = {
		0,
		-1
	},
	W = {
		-1,
		0
	}
}
slot2 = 0.15

slot0.TimeUpdate = function(slot0, slot1)
	slot0.invincibilityTime = slot0.invincibilityTime - slot1

	if not slot0.lock then
		if slot0.invincibilityTime &gt; 0 then
			slot0.rtScale:Find(&quot;main/character&quot;):GetComponent(typeof(Image)).material:SetInt(&quot;_Overwrite&quot;, math.floor(slot0.invincibilityTime / uv0) % 2)
		end

		slot2, slot3 = slot0:GetMoveInfo()

		if RyzaMiniGameConfig.GetEightDirMark(RyzaMiniGameConfig.ReSetDir(slot3)) == &quot;&quot; then
			if slot0.spirit then
				slot0.neglectTime = 0

				slot0:PlayIdle()
			elseif slot0.neglectTime &lt; 5 then
				slot0.neglectTime = slot0.neglectTime + slot1

				slot0:PlayIdle()
			else
				slot0:PlayNeglect(slot1)
			end
		else
			slot0.neglectTime = 0

			if slot0:GetSpeed() &lt; 7 then
				slot0:PlayAnim(&quot;Trot_&quot; .. slot4)
			else
				slot0:PlayAnim(&quot;Run_&quot; .. slot4)
			end
		end

		slot0:MoveUpdate(slot0:MoveDelta(slot3, slot0:GetSpeedDis() * slot1))

		if #slot4 == 1 and uv1[slot4][1] * slot5.x + uv1[slot4][2] * slot5.y == 0 then
			slot0:Calling(&quot;touch&quot;, {
				slot0
			}, {
				uv1[slot4]
			})
		end
	end
end

slot0.GetMoveInfo = function(slot0)
	return nil, slot0.responder:GetJoyStick()
end

slot0.PlayNeglect = function(slot0, slot1)
	slot0.flowCount = defaultValue(slot0.flowCount, 0) + slot1

	if slot0.flowCount &lt; 0.2 then
		return
	else
		slot0.flowCount = 0
	end

	switch(slot0.status, {
		Idle_N = function ()
			uv0:PlayAnim(&quot;Idle_NE&quot;)
		end,
		Idle_NE = function ()
			uv0:PlayAnim(&quot;Idle_E&quot;)
		end,
		Idle_E = function ()
			uv0:PlayAnim(&quot;Idle_SE&quot;)
		end,
		Idle_SE = function ()
			uv0:PlayAnim(&quot;Idle_S&quot;)
		end,
		Idle_NW = function ()
			uv0:PlayAnim(&quot;Idle_W&quot;)
		end,
		Idle_W = function ()
			uv0:PlayAnim(&quot;Idle_SW&quot;)
		end,
		Idle_SW = function ()
			uv0:PlayAnim(&quot;Idle_S&quot;)
		end,
		Idle_S = function ()
			uv0:PlayAnim(&quot;Neglect&quot;)
		end,
		Neglect = function ()
		end
	})
end

slot0.PlayIdle = function(slot0)
	slot0:PlayAnim(&quot;Idle_&quot; .. (string.split(slot0.status, &quot;_&quot;)[2] or &quot;S&quot;))
end

slot0.PlayDamage = function(slot0)
	slot0:PlayAnim(&quot;Damage_&quot; .. (string.split(slot0.status, &quot;_&quot;)[2] or &quot;S&quot;))
end

slot0.loopDic = {
	Neglect = true,
	Trot = true,
	Idle = true,
	Run = true
}

slot0.UpdatePosition = function(slot0)
	uv0.super.UpdatePosition(slot0)
	slot0.responder:WindowFocrus(slot0._tf.localPosition)
end

slot0.SetHide = function(slot0, slot1)
	uv0.super.SetHide(slot0, slot1)

	GetOrAddComponent(slot0._tf, typeof(CanvasGroup)).alpha = slot1 and 0.7 or 1
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>