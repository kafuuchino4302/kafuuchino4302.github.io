<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>watermelongamemenuui.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>watermelongamemenuui.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WatermelonGameMenuUI&quot;)

slot0.Ctor = function(slot0, slot1, slot2, slot3)
	slot0._tf = slot1
	slot0._event = slot2
	slot0._gameVo = slot3
	slot0.menuUI = findTF(slot0._tf, &quot;ui/menuUI&quot;)
	slot0.battleScrollRect = GetComponent(findTF(slot0.menuUI, &quot;battList&quot;), typeof(ScrollRect))
	slot0.totalTimes = slot0._gameVo.totalTimes
	slot0.battleItems = {}
	slot0.dropItems = {}
	slot0.textLastTimes = findTF(slot0.menuUI, &quot;lastTimes/desc&quot;)
	slot0.btnRank = findTF(slot0.menuUI, &quot;btnRank&quot;)
	slot0.btnHome = findTF(slot0.menuUI, &quot;btnHome&quot;)
	slot4 = GetComponent(slot0.btnRank, typeof(Image))

	slot4:SetNativeSize()

	slot0.imgHelp = findTF(slot0.menuUI, &quot;imgHelp&quot;)
	slot0.highScore = findTF(slot0.menuUI, &quot;highScore/text&quot;)

	setActive(slot0.imgHelp, false)
	onButton(slot0._event, findTF(slot0.menuUI, &quot;rightPanelBg/arrowUp&quot;), function ()
		if uv0.battleScrollRect.normalizedPosition.y + 1 / (uv0.totalTimes - 4) &gt; 1 then
			slot0 = 1
		end

		scrollTo(uv0.battleScrollRect, 0, slot0)
	end, SFX_CANCEL)
	onButton(slot0._event, findTF(slot0.menuUI, &quot;rightPanelBg/arrowDown&quot;), function ()
		if uv0.battleScrollRect.normalizedPosition.y - 1 / (uv0.totalTimes - 4) &lt; 0 then
			slot0 = 0
		end

		scrollTo(uv0.battleScrollRect, 0, slot0)
	end, SFX_CANCEL)
	onButton(slot0._event, findTF(slot0.menuUI, &quot;btnBack&quot;), function ()
		uv0._event:emit(WatermelonGameEvent.CLOSE_GAME)
	end, SFX_CANCEL)
	onButton(slot0._event, findTF(slot0.menuUI, &quot;btnRule&quot;), function ()
		uv0._event:emit(WatermelonGameEvent.SHOW_RULE, true)
	end, SFX_CANCEL)
	onButton(slot0._event, slot0.imgHelp, function ()
		uv0._event:emit(WatermelonGameEvent.SHOW_RULE, false)
	end, SFX_CANCEL)

	slot0.btnStart = findTF(slot0.menuUI, &quot;btnStart&quot;)

	onButton(slot0._event, slot0.btnStart, function ()
		uv0._event:emit(WatermelonGameEvent.READY_START)
	end, SFX_CANCEL)
	onButton(slot0._event, slot0.btnRank, function ()
		pg.m02:sendNotification(GAME.SEND_MINI_GAME_OP, {
			hubid = uv0.mgHubData.id,
			cmd = MiniGameOPCommand.CMD_SPECIAL_TRACK,
			args1 = {
				uv0._gameVo.gameId,
				103
			}
		})
		uv0._event:emit(WatermelonGameEvent.SHOW_RANK)
	end, SFX_CANCEL)
	onButton(slot0._event, slot0.btnHome, function ()
		uv0._event:emit(WatermelonGameEvent.ON_HOME)
	end, SFX_CANCEL)

	slot4 = findTF(slot0.menuUI, &quot;tplBattleItem&quot;)
	slot5 = slot0._gameVo.drop

	for slot9 = 1, 7 do
		slot10 = slot9
		slot11 = tf(instantiate(slot4))
		slot11.name = &quot;battleItem_&quot; .. slot9

		setParent(slot11, findTF(slot0.menuUI, &quot;battList/Viewport/Content&quot;))
		GetSpriteFromAtlasAsync(WatermelonGameConst.ui_atlas, &quot;DAY&quot; .. slot9, function (slot0)
			if slot0 then
				setImageSprite(findTF(uv0, &quot;state_open/desc&quot;), slot0, true)
				setImageSprite(findTF(uv0, &quot;state_clear/desc&quot;), slot0, true)
				setImageSprite(findTF(uv0, &quot;state_current/desc&quot;), slot0, true)
				setImageSprite(findTF(uv0, &quot;state_closed/desc&quot;), slot0, true)
			end
		end)

		slot13 = findTF(slot11, &quot;icon&quot;)

		updateDrop(slot13, {
			type = slot5[slot9][1],
			id = slot5[slot9][2],
			count = slot5[slot9][3]
		})
		onButton(slot0._event, slot13, function ()
			uv0._event:emit(BaseUI.ON_DROP, uv1)
		end, SFX_PANEL)
		table.insert(slot0.dropItems, slot13)
		setActive(slot11, true)
		table.insert(slot0.battleItems, slot11)

		slot15 = slot0._gameVo:getGameUseTimes()
		slot16 = slot0._gameVo:getGameTimes()
	end
end

slot0.show = function(slot0, slot1)
	setActive(slot0.menuUI, slot1)
end

slot0.setGameRoomUI = function(slot0, slot1)
	if slot1 then
		setActive(findTF(slot0.menuUI, &quot;lastTimes&quot;), false)
		setActive(findTF(slot0.menuUI, &quot;btnRank&quot;), false)
	end
end

slot0.update = function(slot0, slot1)
	slot0.mgHubData = slot1
	slot2 = slot0:getGameUsedTimes(slot1)

	setText(slot0.textLastTimes, slot0:getGameTimes(slot1))

	for slot7 = 1, 7 do
		setActive(findTF(slot0.battleItems[slot7], &quot;state_open&quot;), false)
		setActive(findTF(slot0.battleItems[slot7], &quot;state_closed&quot;), false)
		setActive(findTF(slot0.battleItems[slot7], &quot;state_clear&quot;), false)
		setActive(findTF(slot0.battleItems[slot7], &quot;state_current&quot;), false)

		if slot7 &lt;= slot2 then
			SetParent(slot0.dropItems[slot7], findTF(slot0.battleItems[slot7], &quot;state_clear/icon&quot;))
			setActive(slot0.dropItems[slot7], true)
			setActive(findTF(slot0.battleItems[slot7], &quot;state_clear&quot;), true)
		elseif slot7 == slot2 + 1 and slot3 &gt;= 1 then
			setActive(findTF(slot0.battleItems[slot7], &quot;state_current&quot;), true)
			SetParent(slot0.dropItems[slot7], findTF(slot0.battleItems[slot7], &quot;state_current/icon&quot;))
			setActive(slot0.dropItems[slot7], true)
		elseif slot2 &lt; slot7 and slot7 &lt;= slot2 + slot3 then
			setActive(findTF(slot0.battleItems[slot7], &quot;state_open&quot;), true)
			SetParent(slot0.dropItems[slot7], findTF(slot0.battleItems[slot7], &quot;state_open/icon&quot;))
			setActive(slot0.dropItems[slot7], true)
		else
			setActive(findTF(slot0.battleItems[slot7], &quot;state_closed&quot;), true)
			SetParent(slot0.dropItems[slot7], findTF(slot0.battleItems[slot7], &quot;state_closed/icon&quot;))
			setActive(slot0.dropItems[slot7], true)
		end
	end

	if 1 - (slot2 - 3 &lt; 0 and 0 or slot2 - 3) / (slot0.totalTimes - 4) &gt; 1 then
		slot5 = 1
	end

	scrollTo(slot0.battleScrollRect, 0, slot5)
	setText(slot0.highScore, getProxy(MiniGameProxy):GetHighScore(slot0._gameVo.gameId) and #slot6 &gt; 0 and slot6[1] or 0)
end

slot0.CheckGet = function(slot0)
	setActive(findTF(slot0.menuUI, &quot;got&quot;), false)

	if slot0:getUltimate(slot0.mgHubData) and slot2 ~= 0 then
		setActive(findTF(slot0.menuUI, &quot;got&quot;), true)
	end

	if slot2 == 0 then
		if slot0:getGameUsedTimes(slot1) &lt; slot0._gameVo.totalTimes then
			return
		end

		pg.m02:sendNotification(GAME.SEND_MINI_GAME_OP, {
			hubid = slot1.id,
			cmd = MiniGameOPCommand.CMD_ULTIMATE,
			args1 = {}
		})
		setActive(findTF(slot0.menuUI, &quot;got&quot;), true)
	end
end

slot0.getGameTimes = function(slot0, slot1)
	return slot1.count
end

slot0.getGameUsedTimes = function(slot0, slot1)
	return slot1.usedtime
end

slot0.getUltimate = function(slot0, slot1)
	return slot1.ultimate
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>