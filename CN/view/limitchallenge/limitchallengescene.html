<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>limitchallengescene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>limitchallengescene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;LimitChallengeScene&quot;, import(&quot;..base.BaseUI&quot;))
slot1 = LimitChallengeConst

slot0.getUIName = function(slot0)
	return &quot;LimitChallengeUI&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
end

slot0.didEnter = function(slot0)
	uv0.SetRedPointMonth()
	slot0:updateLeftTime()
	slot0:updateToggleList()
	slot0:trigeHigestUnlockLevel()
end

slot0.onBackPressed = function(slot0)
	slot0:closeView()
end

slot0.willExit = function(slot0)
	if slot0.leftTimer then
		slot0.leftTimer:Stop()

		slot0.leftTimer = nil
	end
end

slot0.initData = function(slot0)
	slot0.proxy = getProxy(LimitChallengeProxy)
	slot0.levelList = {
		1,
		2,
		3
	}
	slot0.curMonth = uv0.GetCurMonth()
	slot0.descList = {}
	slot0.nextMonthTS = LimitChallengeConst.GetNextMonthTS()
	slot0.curLevel = 0
end

slot0.findUI = function(slot0)
	slot0.blurPanel = slot0:findTF(&quot;blur_panel&quot;)
	slot0.homeBtn = slot0:findTF(&quot;adapt/top/option&quot;, slot0.blurPanel)
	slot0.backBtn = slot0:findTF(&quot;adapt/top/back_button&quot;, slot0.blurPanel)
	slot0.helpBtn = slot0:findTF(&quot;adapt/top/HelpBtn&quot;, slot0.blurPanel)
	slot4 = slot0.blurPanel
	slot0.shareBtn = slot0:findTF(&quot;adapt/top/ShareBtn&quot;, slot4)
	slot0.levelPanel = slot0:findTF(&quot;Adapt/LevelPanel&quot;)
	slot0.levelToggleList = {}
	slot0.levelToggleLockList = {}

	for slot4, slot5 in ipairs(slot0.levelList) do
		slot7 = slot0:findTF(&quot;Level_&quot; .. slot5, slot0.levelPanel)
		slot0.levelToggleList[slot5] = slot0:findTF(&quot;Toggle&quot;, slot7)
		slot0.levelToggleLockList[slot5] = slot0:findTF(&quot;Lock&quot;, slot7)
	end

	slot0.timePanel = slot0:findTF(&quot;Adapt/TimePanel&quot;)
	slot1 = slot0:findTF(&quot;Left/LeftTime&quot;, slot0.timePanel)
	slot0.leftTipText = slot0:findTF(&quot;LeftTip&quot;, slot1)
	slot0.leftDayTipText = slot0:findTF(&quot;DayTip&quot;, slot1)
	slot0.leftDayValueText = slot0:findTF(&quot;DayValue&quot;, slot1)
	slot0.leftTimeValueText = slot0:findTF(&quot;TimeValue&quot;, slot1)
	slot0.passTimeValueText = slot0:findTF(&quot;Challenge/Value&quot;, slot0.timePanel)

	setText(slot0.leftTipText, i18n(&quot;time_remaining_tip&quot;))
	setText(slot0.leftDayTipText, i18n(&quot;word_date&quot;))

	slot0.iconContainer = slot0:findTF(&quot;Adapt/DescPanel/ScrollView/Viewport/Container&quot;)
	slot0.iconTpl = slot0:findTF(&quot;Adapt/DescPanel/IconTpl&quot;)
	slot2 = slot0:findTF(&quot;Adapt/Award&quot;)
	slot0.awardIconTF = slot0:findTF(&quot;IconTpl&quot;, slot2)
	slot0.awardGotTF = slot0:findTF(&quot;Got&quot;, slot2)
	slot0.startBtn = slot0:findTF(&quot;Adapt/StartBtn&quot;)
	slot0.bgImg = slot0:findTF(&quot;BG&quot;)
	slot0.nameImg = slot0:findTF(&quot;Left&quot;, slot0.timePanel)
	slot0.debugPanel = slot0:findTF(&quot;Adapt/Debug&quot;)
	slot0.debugText = slot0:findTF(&quot;Text&quot;, slot0.debugPanel)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.homeBtn, function ()
		uv0:emit(BaseUI.ON_HOME)
	end, SFX_PANEL)
	print(&quot;-----------&quot;, tostring(slot0.backBtn))
	onButton(slot0, slot0.backBtn, function ()
		uv0:closeView()
	end, SFX_PANEL)
	onButton(slot0, slot0.helpBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.challenge_help.tip
		})
	end, SFX_PANEL)

	slot4 = function()
		pg.ShareMgr.GetInstance():Share(pg.ShareMgr.TypeChallenge)
	end

	slot5 = SFX_PANEL

	onButton(slot0, slot0.shareBtn, slot4, slot5)

	for slot4, slot5 in ipairs(slot0.levelToggleList) do
		onToggle(slot0, slot5, function ()
			uv0.curLevel = uv1

			uv0:updatePassTime()
			uv0:updateAward()
			uv0:updateDescPanel()
			uv0:updateBossImg()
			uv0:updateDebug()
		end, SFX_CONFIRM, SFX_CANCEL)
	end

	onButton(slot0, slot0.startBtn, function ()
		uv1:emit(uv0.OPEN_PRE_COMBAT_LAYER, {
			stageID = uv0.GetStageIDByLevel(uv1.curLevel)
		})
	end, SFX_PANEL)

	slot0.iconUIItemList = UIItemList.New(slot0.iconContainer, slot0.iconTpl)
	slot1 = slot0.iconUIItemList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0:findTF(&quot;Icon&quot;, slot2)

			if uv0.descList[slot1 + 1] ~= false then
				slot5 = uv0
				slot5, slot6 = slot5:getBuffIconPath(uv1.GetChallengeIDByLevel(uv0.curLevel), slot1)

				setImageSprite(slot3, LoadSprite(slot5, slot6))

				slot9 = {}

				table.insert(slot9, {
					info = uv0.descList[slot1][1]
				})
				table.insert(slot9, {
					info = uv0.descList[slot1][2]
				})
				onButton(uv0, slot3, function ()
					pg.MsgboxMgr.GetInstance():ShowMsgBox({
						hideNo = true,
						type = MSGBOX_TYPE_DROP_ITEM,
						name = uv0,
						content = uv1,
						iconPath = {
							uv2,
							uv3
						}
					})
				end, SFX_PANEL)
			end
		end
	end)
end

slot0.updateDebug = function(slot0)
	slot9 = tostring(uv0.GetChallengeIDByLevel(slot0.curLevel))
	slot10 = tostring
	slot5 = string.format([[
 月份: %s 
 选择难度: %s 
 选择挑战ID: %s 
 选择关卡ID: %s 
]], tostring(slot0.curMonth), tostring(slot0.curLevel), slot9, slot10(uv0.GetStageIDByLevel(slot0.curLevel)))

	for slot9, slot10 in ipairs(slot0.levelList) do
		slot5 = slot5 .. (&quot; 难度&quot; .. slot10 .. &quot;奖励:&quot; .. (slot0.proxy:isAwardedByChallengeID(LimitChallengeConst.GetChallengeIDByLevel(slot10)) and &quot;已领取&quot; or &quot;未领取&quot;) .. &quot;\n&quot;)
	end

	for slot9, slot10 in ipairs(slot0.levelList) do
		slot5 = slot5 .. (&quot; 难度&quot; .. slot10 .. &quot;时间:&quot; .. (slot0.proxy:getPassTimeByChallengeID(LimitChallengeConst.GetChallengeIDByLevel(slot10)) and slot12 or &quot;没有记录&quot;) .. &quot;\n&quot;)
	end

	setText(slot0.debugText, slot5)
end

slot0.updateToggleList = function(slot0)
	slot1 = slot0:getHigestUnlockLevel()

	for slot5, slot6 in ipairs(slot0.levelToggleLockList) do
		slot7 = slot1 &lt; slot5

		setActive(slot6, slot7)
		setActive(slot0.levelToggleList[slot5], not slot7)
	end
end

slot0.updateLeftTime = function(slot0)
	if slot0.leftTimer then
		slot0.leftTimer:Stop()

		slot0.leftTimer = nil
	end

	if slot0.nextMonthTS - pg.TimeMgr.GetInstance():GetServerTime() &gt; 0 then
		if slot0.leftTimer then
			slot0.leftTimer:Stop()

			slot0.leftTimer = nil
		end

		slot4 = function()
			if uv0 &lt;= 0 and uv1.leftTimer then
				uv1.leftTimer:Stop()

				uv1.leftTimer = nil
			end

			slot0, slot1, slot2, slot3 = pg.TimeMgr.GetInstance():parseTimeFrom(uv0)

			setText(uv1.leftDayValueText, slot0)
			setText(uv1.leftTimeValueText, string.format(&quot;%02d:%02d:%02d&quot;, slot1, slot2, slot3))

			uv0 = uv0 - 1
		end

		slot0.leftTimer = Timer.New(slot4, 1, -1)

		slot0.leftTimer:Start()
		slot4()
	end
end

slot0.updateBossImg = function(slot0)
	slot2 = pg.expedition_constellation_challenge_template[uv0.GetChallengeIDByLevel(slot0.curLevel)]
	slot3 = slot2.painting
	slot4 = slot2.information_icon

	setImageSprite(slot0.bgImg, LoadSprite(&quot;limitchallenge/boss/&quot; .. slot3, slot3))
	setImageSprite(slot0.nameImg, LoadSprite(&quot;limitchallenge/name/&quot; .. slot4, slot4), true)

	slot7 = slot2.button_style .. &quot;_btn_start&quot;
	slot13 = slot7

	setImageSprite(slot0.startBtn, LoadSprite(&quot;limitchallenge/btn/&quot; .. slot7, slot13), true)

	slot9 = &quot;%d_level_%d_selected&quot;

	for slot13, slot14 in ipairs(slot0.levelList) do
		slot15 = string.format(slot9, slot2.button_style, slot14)

		setImageSprite(slot0:findTF(&quot;Selected&quot;, slot0.levelToggleList[slot14]), LoadSprite(&quot;limitchallenge/btn/&quot; .. slot15, slot15), true)
	end
end

slot0.updateDescPanel = function(slot0)
	slot0.descList = {}
	slot0.descList = pg.expedition_constellation_challenge_template[uv0.GetChallengeIDByLevel(slot0.curLevel)].description

	if 3 - #slot0.descList &gt; 0 then
		for slot8 = 1, slot4 do
			table.insert(slot0.descList, false)
		end
	end

	slot0.iconUIItemList:align(#slot0.descList)
end

slot0.updatePassTime = function(slot0)
	slot2 = slot0.proxy:getPassTimeByChallengeID(LimitChallengeConst.GetChallengeIDByLevel(slot0.curLevel)) or 0

	setText(slot0.passTimeValueText, string.format(&quot;%02d:%02d&quot;, math.floor(slot2 / 60), math.floor(slot2 % 60)))
end

slot0.updateAward = function(slot0)
	slot1 = LimitChallengeConst.GetChallengeIDByLevel(slot0.curLevel)

	setActive(slot0.awardGotTF, slot0.proxy:isAwardedByChallengeID(slot1))

	if pg.expedition_constellation_challenge_template[slot1].award_display[1] and #slot2 &gt; 0 then
		updateDrop(slot0.awardIconTF, {
			type = slot2[1],
			id = slot2[2],
			count = slot2[3] or 1
		})
		onButton(slot0, slot0.awardIconTF, function ()
			uv0:emit(BaseUI.ON_DROP, uv1)
		end, SFX_PANEL)
		setActive(slot0.awardIconTF, true)

		return
	end

	setActive(slot0.awardIconTF, false)
end

slot0.trigeHigestUnlockLevel = function(slot0)
	triggerToggle(slot0.levelToggleList[slot0:getHigestUnlockLevel()], true)
end

slot0.onReqInfo = function(slot0)
	slot0:initData()
	slot0:updateLeftTime()
	slot0:updateToggleList()
	slot0:trigeHigestUnlockLevel()
end

slot0.getHigestUnlockLevel = function(slot0)
	for slot5 = #slot0.levelList, 1, -1 do
		if slot0.proxy:isLevelUnlock(slot0.levelList[slot5]) then
			return slot6
		end
	end
end

slot0.getBuffIconPath = function(slot0, slot1, slot2)
	slot4 = string.format(&quot;%s_%d&quot;, pg.expedition_constellation_challenge_template[slot1].painting, slot2)

	return &quot;limitchallenge/icon/&quot; .. slot4, slot4
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>