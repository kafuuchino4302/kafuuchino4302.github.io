<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>favoritecard.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>favoritecard.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;FavoriteCard&quot;)

slot0.Ctor = function(slot0, slot1, slot2)
	slot0.go = slot1
	slot0.tr = tf(slot1)
	slot0.charTpl = slot2
	slot0.charContainer = slot0.tr:Find(&quot;char_list&quot;)
	slot0.isInitChar = false
	slot0.maxStar = 0
	slot0.nameTF = slot0.tr:Find(&quot;bonus/name_bg/Text&quot;):GetComponent(typeof(Text))
	slot0.unfinish = slot0.tr:Find(&quot;bonus/item_tpl/unfinish&quot;)
	slot0.get = slot0.tr:Find(&quot;bonus/item_tpl/get&quot;)
	slot0.got = slot0.tr:Find(&quot;bonus/item_tpl/got&quot;)
	slot0.lock = slot0.tr:Find(&quot;bonus/item_tpl/lock&quot;)
	slot0.tip = slot0.tr:Find(&quot;bonus/item_tpl/tip&quot;)
	slot0.starCount = slot0.tr:Find(&quot;bonus/process&quot;):GetComponent(typeof(Text))
	slot0.awardTF = slot0.tr:Find(&quot;bonus/item_tpl&quot;)
	slot0.iconTF = slot0.awardTF:Find(&quot;icon_bg&quot;)
	slot0.box = slot0.tr:Find(&quot;box&quot;)
end

slot1 = function(slot0)
	slot1 = {
		go = slot0,
		tr = tf(slot0)
	}
	slot2 = slot1.tr
	slot1.icon = slot2:Find(&quot;icon&quot;)
	slot2 = slot1.icon
	slot1.iconImg = slot2:GetComponent(typeof(Image))
	slot1.stars = findTF(slot1.tr, &quot;stars&quot;)
	slot1.starTpl = findTF(slot1.stars, &quot;star&quot;)
	slot2 = findTF(slot1.tr, &quot;name&quot;)
	slot1.name = slot2:GetComponent(typeof(Text))
	slot1.unkonwn = findTF(slot1.tr, &quot;unkonwn&quot;)

	slot1.update = function(slot0, slot1, slot2)
		uv0.name.text = slot1:getConfig(&quot;name&quot;)

		LoadSpriteAsync(&quot;shipmodels/&quot; .. Ship.getPaintingName(slot1.configId), function (slot0)
			if slot0 then
				rtf(uv0.icon).pivot = getSpritePivot(slot0)
				uv1.iconImg.sprite = slot0

				uv1.iconImg:SetNativeSize()

				uv0.icon.localPosition = Vector3(0, -85, 0)

				setActive(uv1.iconImg, true)
			end
		end)
		setActive(uv0.stars, slot2)

		if slot2 then
			slot7 = 1

			setImageColor(slot0.icon, Color.New(1, slot7, 1, 1))

			for slot7 = uv0.stars.childCount + 1, slot1:getMaxStar() do
				cloneTplTo(uv0.starTpl, uv0.stars)
			end

			slot4 = {
				[4] = {
					1,
					2,
					3,
					4
				},
				[5] = {
					1,
					2,
					5,
					3,
					4
				},
				[6] = {
					1,
					2,
					5,
					6,
					3,
					4
				}
			}

			for slot8 = 1, 6 do
				setActive(findTF(uv0.stars, &quot;star_&quot; .. slot8), slot8 &lt;= slot3)
				setActive(slot9:Find(&quot;startpl&quot;), false)
			end

			slot5 = slot4[slot3]

			for slot9 = 1, slot3 do
				setActive(findTF(uv0.stars, &quot;star_&quot; .. slot5[slot9]):Find(&quot;startpl&quot;), slot9 &lt;= slot2.star)
			end
		else
			setImageColor(slot0.icon, Color.New(0, 0, 0, 0.7))
		end

		setActive(uv0.unkonwn, not slot2)
	end

	return slot1
end

slot0.update = function(slot0, slot1, slot2, slot3)
	slot0.favoriteVO = slot1
	slot0.shipGroups = slot2
	slot0.awards = slot3
	slot4 = {}

	for slot9 = slot0.charContainer.childCount, #slot1:getConfig(&quot;char_list&quot;) - 1 do
		cloneTplTo(slot0.charTpl, slot0.charContainer)
	end

	for slot9 = 0, slot0.charContainer.childCount - 1 do
		setActive(slot0.charContainer:GetChild(slot9), slot9 &lt; #slot5)

		slot11 = slot5[slot9 + 1]

		if slot9 &lt; #slot5 then
			slot4[slot11] = uv0(slot10)
		end
	end

	slot6 = 0
	slot7 = 0

	for slot11, slot12 in pairs(slot4) do
		slot12:update(Ship.New({
			configId = slot11 * 10 + 1
		}), slot2[slot11])

		slot6 = slot6 + (slot2[slot11] and slot2[slot11].star or 0)
		slot7 = slot7 + slot14:getMaxStar()
	end

	slot0.nameTF.text = slot1:getConfig(&quot;name&quot;)

	slot0:updateBound()
end

slot0.updateBound = function(slot0)
	slot0.state = slot0.favoriteVO:getState(slot0.shipGroups, slot0.awards)

	setActive(slot0.unfinish, slot0.state == Favorite.STATE_WAIT)
	setActive(slot0.get, slot0.state == Favorite.STATE_AWARD)
	setActive(slot0.got, slot0.state == Favorite.STATE_FETCHED)
	setActive(slot0.lock, slot0.state == Favorite.STATE_LOCK)
	setActive(slot0.tip, slot0.state == Favorite.STATE_AWARD)

	slot3 = slot0.favoriteVO:getConfig(&quot;award_display&quot;)[slot0.favoriteVO:getNextAwardIndex(slot0.awards)] and slot2[slot1] or slot2[#slot2]

	updateDrop(slot0.awardTF, {
		type = slot3[1],
		id = slot3[2],
		count = slot3[3]
	})

	slot0.starCount.text = slot0.favoriteVO:getStarCount(slot0.shipGroups) .. &quot;/&quot; .. (slot0.favoriteVO:getConfig(&quot;level&quot;)[slot1] or slot4[#slot4])
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>