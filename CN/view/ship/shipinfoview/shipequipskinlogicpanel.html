<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shipequipskinlogicpanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>shipequipskinlogicpanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ShipEquipSkinLogicPanel&quot;, import(&quot;...base.BasePanel&quot;))
slot1 = 0.2

slot0.init = function(slot0)
	slot0.equipmentTFs = {
		slot0:findTF(&quot;equipment_r/skin/equipment_r1&quot;),
		slot0:findTF(&quot;equipment_r/skin/equipment_r2&quot;),
		slot0:findTF(&quot;equipment_r/skin/equipment_r3&quot;),
		slot0:findTF(&quot;equipment_l/skin/equipment_l1&quot;),
		slot0:findTF(&quot;equipment_l/skin/equipment_l2&quot;)
	}
	slot0.equipmentNormalTFs = {
		slot0:findTF(&quot;equipment_r/equipment/equipment_r1&quot;),
		slot0:findTF(&quot;equipment_r/equipment/equipment_r2&quot;),
		slot0:findTF(&quot;equipment_r/equipment/equipment_r3&quot;),
		slot0:findTF(&quot;equipment_l/equipment/equipment_l1&quot;),
		slot0:findTF(&quot;equipment_l/equipment/equipment_l2&quot;)
	}
	slot0.spweaponNormalTF = slot0:findTF(&quot;equipment_b/equipment&quot;)
	slot0.equipmentR = slot0:findTF(&quot;equipment_r/equipment&quot;)
	slot0.equipmentL = slot0:findTF(&quot;equipment_l/equipment&quot;)
	slot0.skinR = slot0:findTF(&quot;equipment_r/skin&quot;)
	slot0.skinL = slot0:findTF(&quot;equipment_l/skin&quot;)
	slot4 = slot0.equipmentTFs[1]
	slot0.infoPanel = slot0:findTF(&quot;info&quot;, slot4)
	slot0.inSkinPage = true

	for slot4 = 1, 3 do
		setText(findTF(slot0.skinR, &quot;equipment_r&quot; .. slot4 .. &quot;/info/equip/info/unMatch/txt&quot;), i18n(&quot;equipskin_typewrong&quot;))
		setText(findTF(slot0.skinR, &quot;equipment_r&quot; .. slot4 .. &quot;/info/equip/info/unMatch/forbid_en&quot;), i18n(&quot;equipskin_typewrong_en&quot;))
		setText(findTF(slot0.skinR, &quot;equipment_r&quot; .. slot4 .. &quot;/info/equip/add/Text&quot;), i18n(&quot;equipskin_add&quot;))
		setText(findTF(slot0.skinR, &quot;equipment_r&quot; .. slot4 .. &quot;/info/forbid&quot;), i18n(&quot;equipskin_none&quot;))
	end

	for slot4 = 1, 2 do
		if IsNil(slot0.equipmentTFs[3 + slot4]:Find(&quot;info&quot;)) then
			slot6 = cloneTplTo(slot0.infoPanel, slot5, &quot;info&quot;)
		end

		setActive(findTF(slot0.skinL, &quot;equipment_l&quot; .. slot4 .. &quot;/forbid&quot;), false)
		setText(findTF(slot0.skinL, &quot;equipment_l&quot; .. slot4 .. &quot;/info/equip/info/unMatch/txt&quot;), i18n(&quot;equipskin_typewrong&quot;))
		setText(findTF(slot0.skinL, &quot;equipment_l&quot; .. slot4 .. &quot;/info/equip/info/unMatch/forbid_en&quot;), i18n(&quot;equipskin_typewrong_en&quot;))
		setText(findTF(slot0.skinL, &quot;equipment_l&quot; .. slot4 .. &quot;/info/equip/add/Text&quot;), i18n(&quot;equipskin_add&quot;))
		setText(findTF(slot0.skinL, &quot;equipment_l&quot; .. slot4 .. &quot;/info/forbid&quot;), i18n(&quot;equipskin_none&quot;))
	end

	for slot4 = 1, #slot0.equipmentNormalTFs do
		setText(findTF(slot0.equipmentNormalTFs[slot4], &quot;empty/tip&quot;), i18n(&quot;equip_add&quot;))
	end

	setText(findTF(slot0.spweaponNormalTF, &quot;empty/tip&quot;), i18n(&quot;equip_add&quot;))
end

slot0.setLabelResource = function(slot0, slot1)
	slot0.resource = slot1
end

slot0.doSwitchAnim = function(slot0, slot1)
	if slot0:isTweening() then
		return
	end

	slot0.inSkinPage = slot1

	slot0:doAnim(slot0.equipmentR, slot0.skinR)
	slot0:doAnim(slot0.equipmentL, slot0.skinL)
end

slot0.isTweening = function(slot0)
	if LeanTween.isTweening(go(slot0.equipmentR)) or LeanTween.isTweening(go(slot0.skinR)) or LeanTween.isTweening(go(slot0.equipmentL)) or LeanTween.isTweening(go(slot0.skinL)) then
		return true
	end

	return false
end

slot0.doAnim = function(slot0, slot1, slot2)
	slot5 = slot1:GetComponent(typeof(CanvasGroup))
	slot6 = slot2:GetComponent(typeof(CanvasGroup))

	LeanTween.moveLocal(go(slot1), slot2.localPosition, uv0)
	LeanTween.moveLocal(go(slot2), slot1.localPosition, uv0)

	slot7 = 0.8
	slot8 = 1

	if not slot0.inSkinPage then
		slot8 = 0.8
		slot7 = 1
	end

	LeanTween.value(go(slot1), slot7, slot8, uv0):setOnUpdate(System.Action_float(function (slot0)
		uv0.alpha = slot0
	end))
	LeanTween.value(go(slot2), slot8, slot7, uv0):setOnUpdate(System.Action_float(function (slot0)
		uv0.alpha = slot0
	end))

	slot6.blocksRaycasts = not slot0.inSkinPage
	slot5.blocksRaycasts = slot0.inSkinPage

	(not slot0.inSkinPage and slot2 or slot1):SetAsLastSibling()
end

slot0.updateAll = function(slot0, slot1)
	if slot1 then
		for slot5, slot6 in ipairs(slot0.equipmentTFs) do
			if not not table.contains(ShipEquipView.UNLOCK_EQUIPMENT_SKIN_POS, slot5) then
				slot0:updateEquipmentTF(slot1, slot5)
			end

			if slot0:findTF(&quot;shadow&quot;, slot6) then
				setActive(slot8, slot0.inSkinPage)
			end
		end

		for slot5, slot6 in ipairs(slot0.equipmentNormalTFs) do
			if slot0:findTF(&quot;shadow&quot;, slot6) then
				setActive(slot7, not slot0.inSkinPage)
			end
		end
	end
end

slot0.updateEquipmentTF = function(slot0, slot1, slot2)
	slot0.shipVO = slot1

	if slot1 then
		slot3 = slot0.equipmentTFs[slot2]

		removeOnButton(slot3)

		slot4 = slot1:getEquip(slot2)
		slot5 = slot1:getEquipSkin(slot2)

		if IsNil(slot3:Find(&quot;info&quot;)) then
			slot6 = cloneTplTo(slot0.infoPanel, slot3, &quot;info&quot;)
		end

		slot0:findTF(&quot;panel_title/type&quot;, slot3):GetComponent(typeof(Text)).text = EquipType.LabelToName(EquipType.Types2Title(slot2, slot0.shipVO.configId))

		setActive(slot3:Find(&quot;unequip&quot;), false)

		slot10 = slot1:getCanEquipSkin(slot2)

		setActive(slot6:Find(&quot;forbid&quot;), not slot10)
		setActive(slot6:Find(&quot;equip&quot;), slot10)

		if slot10 then
			slot0:updateEquipmentPanel(slot11, slot2)
		end
	end
end

slot0.updateEquipmentPanel = function(slot0, slot1, slot2)
	if not slot0.shipVO:getCanEquipSkin(slot2) then
		return
	end

	slot4 = slot0.shipVO:getEquipSkin(slot2) ~= 0
	slot5 = slot0.shipVO:getEquip(slot2)
	slot7 = false

	if slot0.shipVO:getEquipSkin(slot2) ~= 0 then
		if slot5 then
			if not table.contains(pg.equip_skin_template[slot6].equip_type, slot5:getType()) then
				slot7 = true
			end
		else
			slot7 = true
		end
	end

	slot9 = slot1:Find(&quot;info&quot;)

	setActive(slot9, slot4)
	setActive(slot1:Find(&quot;add&quot;), not slot4)
	setActive(slot9:Find(&quot;unMatch&quot;), slot7)
	setActive(slot9:Find(&quot;desc&quot;), not slot7)

	if slot4 then
		slot0:updateSkinInfo(slot9, slot6)
		onButton(slot0, slot0.equipmentTFs[slot2], function ()
			uv0:emit(ShipMainMediator.ON_SELECT_EQUIPMENT_SKIN, uv1)
		end, SFX_PANEL)
	else
		onButton(slot0, slot8:Find(&quot;icon&quot;), function ()
			uv0:emit(ShipMainMediator.ON_SELECT_EQUIPMENT_SKIN, uv1)
		end, SFX_PANEL)
	end
end

slot0.updateSkinInfo = function(slot0, slot1, slot2)
	slot3 = pg.equip_skin_template[slot2]

	assert(slot3, &quot;miss config equip_skin_template &gt;&gt;&quot; .. slot2)
	setText(slot1:Find(&quot;desc&quot;), slot3.desc)
	setText(slot1:Find(&quot;cont/name_mask/name&quot;), shortenString(slot3.name, 10))
	updateDrop(slot1:Find(&quot;IconTpl&quot;), {
		type = DROP_TYPE_EQUIPMENT_SKIN,
		id = slot2
	})
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>