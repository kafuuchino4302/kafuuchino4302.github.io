<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>blueprintassigneditemview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>blueprintassigneditemview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BlueprintAssignedItemView&quot;, import(&quot;.AssignedItemView&quot;))

slot0.getUIName = function(slot0)
	return &quot;BlueprintItemAssignedView&quot;
end

slot0.OnInit = function(slot0)
	uv0.super.OnInit(slot0)

	slot1 = slot0._tf
	slot0.countOver = slot1:Find(&quot;operate/calc/value_bg/over_count&quot;)

	setText(slot0.countOver, i18n(&quot;blueprint_select_overflow&quot;))
	onButton(slot0, slot0.maxBtn, function ()
		if not uv0.itemVO or not uv0.selectedIndex then
			return
		end

		slot0 = uv0.displayDrops[uv0.selectedIndex]

		if uv0.count * slot0.count &lt; uv0:GetBlueprintNeed(slot0.id) then
			uv0.count = math.floor((slot2 + slot0.count - 1) / slot0.count)
			uv0.count = math.min(uv0.count, uv0.itemVO.count)
		else
			uv0.count = uv0.itemVO.count
		end

		uv0:updateValue()
	end, SFX_PANEL)
	onButton(slot0, slot0.confirmBtn, function ()
		if not uv0.selectedIndex or not uv0.itemVO or uv0.count &lt;= 0 then
			return
		end

		slot0 = uv0.displayDrops[uv0.selectedIndex]
		slot1 = uv0.count * slot0.count
		slot2 = uv0:GetBlueprintNeed(slot0.id)
		slot3 = {}

		if not uv0.isAllNeedZero and slot2 &lt; slot1 then
			table.insert(slot3, function (slot0)
				pg.MsgboxMgr.GetInstance():ShowMsgBox({
					content = i18n(&quot;blueprint_select_overflow_tip&quot;, uv0:getConfig(&quot;name&quot;), uv1 - uv2),
					onYes = slot0
				})
			end)
		end

		seriesAsync(slot3, function ()
			uv0:emit(EquipmentMediator.ON_USE_ITEM, uv0.itemVO.id, uv0.count, uv0.itemVO:getConfig(&quot;usage_arg&quot;)[uv0.selectedIndex])
			uv0:Hide()
		end)
	end, SFX_PANEL)

	slot1 = slot0._tf
	slot0.toggleSwitch = slot1:Find(&quot;operate/got/top/switch_btn&quot;)
	slot2 = slot0.toggleSwitch

	setText(slot2:Find(&quot;Text_off&quot;), i18n(&quot;show_design_demand_count&quot;))

	slot2 = slot0.toggleSwitch

	setText(slot2:Find(&quot;Text_on&quot;), i18n(&quot;show_fate_demand_count&quot;))
	onToggle(slot0, slot0.toggleSwitch, function (slot0)
		uv0.isSwitch = slot0

		uv0:updateValue()
	end, SFX_PANEL)
end

slot0.GetBlueprintNeed = function(slot0, slot1)
	slot0.technologyProxy = slot0.technologyProxy or getProxy(TechnologyProxy)
	slot2 = slot0.technologyProxy:getBluePrintById(slot0.technologyProxy:GetBlueprint4Item(slot1))
	slot0.bagProxy = slot0.bagProxy or getProxy(BagProxy)

	return math.max(slot2:getUseageMaxItem() + (slot0.isSwitch and slot2:getFateMaxLeftOver() or 0) - slot0.bagProxy:getItemCountById(slot2:getItemId()), 0)
end

slot0.checkBlueprintIsUnlock = function(slot0, slot1)
	slot0.technologyProxy = slot0.technologyProxy or getProxy(TechnologyProxy)

	return slot0.technologyProxy:getBluePrintById(slot0.technologyProxy:GetBlueprint4Item(slot1)):isUnlock()
end

slot0.updateValue = function(slot0)
	slot0.isAllNeedZero = underscore.all(slot0.displayDrops, function (slot0)
		return uv0:GetBlueprintNeed(slot0.id) == 0
	end)

	slot0:updateCountText()

	slot1 = slot0.ulist

	slot1:each(function (slot0, slot1)
		if not isActive(slot1) then
			return
		end

		slot2 = uv0.displayDrops[slot0 + 1]
		slot4 = uv0:GetBlueprintNeed(slot2.id)

		setText(slot1:Find(&quot;item/icon_bg/count&quot;), setColorStr(uv0.count * slot2.count, not uv0.isAllNeedZero and slot4 &lt; slot3 and &quot;#FF5A5A&quot; or &quot;#FFEC6E&quot;) .. &quot;/&quot; .. slot4)
	end)
end

slot0.updateCountText = function(slot0)
	slot1 = slot0.displayDrops[slot0.selectedIndex]
	slot2 = slot0.count * slot1.count
	slot3 = slot0:GetBlueprintNeed(slot1.id)

	setText(slot0.valueText, not slot0.isAllNeedZero and slot3 &lt; slot2 and setColorStr(slot0.count, &quot;#FF5A5A&quot;) or slot0.count)
	setActive(slot0.countOver, not slot0.isAllNeedZero and slot3 &lt; slot2)
end

slot0.update = function(slot0, slot1)
	slot0.count = 1
	slot0.selectedIndex = nil
	slot0.selectedItem = nil
	slot0.isSwitch = false
	slot0.itemVO = slot1
	slot0.displayDrops = underscore.map(slot1:getConfig(&quot;display_icon&quot;), function (slot0)
		return {
			type = slot0[1],
			id = slot0[2],
			count = slot0[3]
		}
	end)

	slot0.ulist:make(function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			updateDrop(slot2:Find(&quot;item&quot;), uv0.displayDrops[slot1])
			onToggle(uv0, slot2, function (slot0)
				if slot0 then
					uv0.selectedIndex = uv1
					uv0.selectedItem = uv2

					uv0:updateCountText()
				end
			end, SFX_PANEL)
			triggerToggle(slot2, slot1 == 1)
			setScrollText(slot2:Find(&quot;name_bg/Text&quot;), uv0.displayDrops[slot1]:getConfig(&quot;name&quot;))

			uv0.selectedItem = uv0.selectedItem or slot2

			setText(slot2:Find(&quot;item/tip/Text&quot;), i18n(&quot;tech_character_get&quot;))
			setActive(slot2:Find(&quot;item/tip&quot;), uv0:checkBlueprintIsUnlock(uv0.displayDrops[slot1].id))
		end
	end)
	slot0.ulist:align(#slot0.displayDrops)
	triggerToggle(slot0.selectedItem, true)
	triggerToggle(slot0.toggleSwitch, true)

	slot2 = Drop.New({
		type = DROP_TYPE_ITEM,
		id = slot1.id,
		count = slot1.count
	})

	updateDrop(slot0.itemTF:Find(&quot;left/IconTpl&quot;), setmetatable({
		count = 0
	}, {
		__index = slot2
	}))
	UpdateOwnDisplay(slot0.itemTF:Find(&quot;left/own&quot;), slot2)
	setText(slot0.nameTF, slot1:getConfig(&quot;name&quot;))
	setText(slot0.descTF, slot1:getConfig(&quot;display&quot;))
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>