<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>battleactivitybossresultlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>battleactivitybossresultlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BattleActivityBossResultLayer&quot;, import(&quot;.BattleResultLayer&quot;))

slot0.showRightBottomPanel = function(slot0)
	setActive(slot0._blurConatiner:Find(&quot;activitybossConfirmPanel&quot;), true)
	uv0.super.showRightBottomPanel(slot0)
	SetActive(slot0._rightBottomPanel, false)
	setActive(slot1:Find(&quot;playAgain&quot;), slot0.contextData.system ~= SYSTEM_BOSS_EXPERIMENT)
	onButton(slot0, slot1:Find(&quot;statisticsBtn&quot;), function ()
		setActive(uv0:Find(&quot;playAgain&quot;), uv1._atkBG.gameObject.activeSelf and uv2)
		triggerButton(uv1._statisticsBtn)
	end, SFX_PANEL)
	setText(slot1:Find(&quot;confirmBtn/Image&quot;), i18n(&quot;text_confirm&quot;))
	onButton(slot0, slot1:Find(&quot;confirmBtn&quot;), function ()
		triggerButton(uv0._confirmBtn)
	end, SFX_CONFIRM)
	setText(slot1:Find(&quot;confirmBtn/Image&quot;), i18n(&quot;text_confirm&quot;))
	setText(slot1:Find(&quot;playAgain/Image&quot;), i18n(&quot;re_battle&quot;))
	setText(slot1:Find(&quot;playAgain/bonus/title&quot;), i18n(&quot;expedition_extra_drop_tip&quot;))

	slot6 = slot1:Find(&quot;playAgain/bonus&quot;)
	slot8 = getProxy(ActivityProxy):getActivityById(slot0.contextData.actId)
	slot9 = slot0.contextData.stageId
	slot11 = pg.activity_event_worldboss[slot8:getConfig(&quot;config_id&quot;)]
	slot12 = slot11.ticket
	slot13 = slot8:GetStageBonus(slot9)

	(function (slot0, slot1)
		slot2 = slot0:GetCostSum().oil

		if slot1 &gt; 0 then
			slot2 = math.min(slot2, uv0[1])
		end

		uv1 = uv1 + slot2
	end)(getProxy(FleetProxy):getActivityFleets()[slot0.contextData.actId][slot0.contextData.mainFleetId], slot8:IsOilLimit(slot9) and slot11.use_oil_limit[slot0.contextData.mainFleetId][1] or 0)
	setText(slot1:Find(&quot;playAgain/Text&quot;), 0)

	slot18, slot19 = nil

	setActive(slot6, slot13 &gt; 0)
	setActive(slot1:Find(&quot;playAgain/ticket&quot;), slot13 &lt;= 0)
	setText(slot6:Find(&quot;Text&quot;), slot13)

	if slot13 &lt;= 0 then
		setImageSprite(slot7:Find(&quot;icon&quot;), GetSpriteFromAtlas(Drop.New({
			type = DROP_TYPE_RESOURCE,
			id = slot12
		}):getIcon(), &quot;&quot;))

		slot19 = getProxy(SettingsProxy):isTipActBossExchangeTicket() == 1
		slot18 = getProxy(PlayerProxy):getRawData():getResource(slot12) &gt; 0
		slot23 = 1
		slot24 = slot7:Find(&quot;checkbox&quot;)

		if slot2 == SYSTEM_BOSS_EXPERIMENT then
			slot23 = 0

			triggerToggle(slot24, false)
			setToggleEnabled(slot24, false)
		elseif slot2 == SYSTEM_HP_SHARE_ACT_BOSS then
			triggerToggle(slot24, true)
			setToggleEnabled(slot24, false)
		elseif slot2 == SYSTEM_ACT_BOSS then
			setToggleEnabled(slot24, slot18)
			triggerToggle(slot24, slot18 and slot19)
		end

		if slot22 &lt; slot23 then
			slot22 = setColorStr(slot22, COLOR_RED) or slot22
		end

		setText(slot7:Find(&quot;Text&quot;), slot23 .. &quot;/&quot; .. slot22)
		onToggle(slot0, slot24, function (slot0)
			uv0 = slot0

			getProxy(SettingsProxy):setActBossExchangeTicketTip(slot0 and 1 or 0)
		end, SFX_PANEL, SFX_CANCEL)
	end

	onButton(slot0, slot1:Find(&quot;playAgain&quot;), function ()
		if uv0.contextData.isLastBonus then
			uv0:PassMsgbox(&quot;lastBonus&quot;, {
				content = i18n(&quot;expedition_drop_use_out&quot;)
			})

			return
		end

		if uv1 == SYSTEM_HP_SHARE_ACT_BOSS and not uv2 then
			pg.m02:sendNotification(GAME.GO_BACK)
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;stage_beginStage_error_noTicket&quot;))

			return
		end

		slot2 = getProxy(PlayerProxy):getRawData().oil

		if pg.battle_cost_template[uv0.contextData.system].oil_cost &gt; 0 and slot2 &lt; uv3 then
			uv0:PassMsgbox(&quot;oil&quot;, uv3)

			return
		end

		if getProxy(PlayerProxy):getRawData():getMaxShipBag() &lt;= getProxy(BayProxy):getShipCount() then
			uv0:PassMsgbox(&quot;shipCapacity&quot;)

			return
		end

		if _.any(_.values(uv4[uv0.contextData.mainFleetId].ships), function (slot0)
			return getProxy(BayProxy):getShipById(slot0) and slot1.energy == Ship.ENERGY_LOW
		end) then
			uv0:PassMsgbox(&quot;energy&quot;, slot4)

			return
		end

		if uv1 == SYSTEM_ACT_BOSS and uv2 and uv5 then
			pg.m02:sendNotification(GAME.ACT_BOSS_EXCHANGE_TICKET, {
				stageId = uv6
			})

			return
		end

		uv0:emit(NewBattleResultMediator.REENTER_STAGE)
	end)
end

slot0.PassMsgbox = function(slot0, slot1, slot2)
	getProxy(ContextProxy):GetPrevContext(1).data.msg = {
		type = slot1,
		param = slot2
	}

	pg.m02:sendNotification(GAME.GO_BACK)
end

slot0.HideConfirmPanel = function(slot0)
	setActive(slot0._blurConatiner:Find(&quot;activitybossConfirmPanel&quot;), false)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>