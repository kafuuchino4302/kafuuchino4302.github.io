<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>allbuffdetaillayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>allbuffdetaillayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;AllBuffDetailLayer&quot;, import(&quot;..base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;TechnologyTreeAllBuffUI&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false, {
		weight = slot0:getWeightFromData()
	})
	slot0:addListener()
	slot0:updateDetail()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
end

slot0.initData = function(slot0)
	slot0.technologyNationProxy = getProxy(TechnologyNationProxy)
	slot0.tecList = slot0.technologyNationProxy:GetTecList()
	slot0.typeAttrTable, slot0.typeOrder, slot0.typeAttrOrderTable = slot0.technologyNationProxy:getTecBuff()
	slot0.typeOrder = ShipType.FilterOverQuZhuType(slot0.typeOrder)
end

slot0.findUI = function(slot0)
	slot0.backBtn = slot0:findTF(&quot;BG&quot;)
	slot0.scrollView = slot0:findTF(&quot;Scroll View&quot;)
	slot0.viewport = slot0:findTF(&quot;Viewport&quot;, slot0.scrollView)
	slot0.typeContainer = slot0:findTF(&quot;Content&quot;, slot0.viewport)
	slot0.typeItemTpl = slot0:findTF(&quot;TypeItemTpl&quot;)
	slot0.buffItemTpl = slot0:findTF(&quot;BuffItemTpl&quot;)
	slot0.scrollViewGroupCom = GetComponent(slot0.scrollView, &quot;VerticalLayoutGroup&quot;)
	slot0.scrollViewFitterCom = GetComponent(slot0.scrollView, &quot;ContentSizeFitter&quot;)
	slot0.viewportGroupCom = GetComponent(slot0.viewport, &quot;VerticalLayoutGroup&quot;)
	slot0.viewportFitterCom = GetComponent(slot0.viewport, &quot;ContentSizeFitter&quot;)
	slot0.setValueBtn = slot0:findTF(&quot;Scroll View/bg/SetValueBtn&quot;)
end

slot0.onBackPressed = function(slot0)
	triggerButton(slot0.backBtn)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:emit(uv1.ON_CLOSE)
	end, SFX_CANCEL)
	onButton(slot0, slot0.setValueBtn, function ()
		if getProxy(ChapterProxy):getActiveChapter(true) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;attrset_disable&quot;))
		else
			uv0:emit(AllBuffDetailMediator.OPEN_SET_VALUE_LAYER)
		end
	end, SFX_PANEL)
end

slot0.updateDetail = function(slot0)
	slot1 = UIItemList.New(slot0.typeContainer, slot0.typeItemTpl)

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot6 = uv0.typeOrder[slot1 + 1]

			setImageSprite(uv0:findTF(&quot;TypeTitle/TypeTextImg&quot;, slot2), GetSpriteFromAtlas(&quot;ShipType&quot;, &quot;ch_title_&quot; .. slot6))
			setImageSprite(uv0:findTF(&quot;TypeTitle/TypeImg&quot;, slot2), GetSpriteFromAtlas(&quot;ShipType&quot;, &quot;buffitem_tec_&quot; .. slot6), true)
			Canvas.ForceUpdateCanvases()
			uv0:updateBuffList(uv0:findTF(&quot;Container&quot;, slot2), slot6)
		end
	end)
	slot1:align(#slot0.typeOrder)
	Canvas.ForceUpdateCanvases()

	if slot0.scrollView.rect.height &gt;= 850 then
		slot0.viewportGroupCom.enabled = false
		slot0.viewportFitterCom.enabled = false
		slot0.scrollViewFitterCom.enabled = false
		slot0.scrollView.sizeDelta = Vector2.New(0, 850)
		GetComponent(slot0.scrollView, &quot;ScrollRect&quot;).enabled = true
	end

	setActive(slot0.scrollView, false)
	setActive(slot0.scrollView, true)
end

slot0.updateBuffList = function(slot0, slot1, slot2)
	slot3 = UIItemList.New(slot1, slot0.buffItemTpl)
	slot4 = slot0.typeAttrTable[slot2]

	slot3:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot4 = uv0:findTF(&quot;ValueText&quot;, slot2)
			slot5 = uv1[slot1 + 1]

			setText(uv0:findTF(&quot;AttrText&quot;, slot2), AttributeType.Type2Name(pg.attribute_info_by_type[slot5].name))

			slot8 = nil

			if uv0.technologyNationProxy:getSetableAttrAdditionValueByTypeAttr(uv3, slot5) == uv2[slot5] then
				slot8 = &quot;#00FF32FF&quot;
			elseif slot7 == 0 then
				slot8 = &quot;#CA5B5BFF&quot;
			elseif slot7 &lt; slot6 then
				slot8 = &quot;#A5BBD6FF&quot;
			end

			setText(slot4, setColorStr(&quot;+&quot; .. slot7, slot8))
		end
	end)
	slot3:align(#slot0.typeAttrOrderTable[slot2])
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>