<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tecspeeduplayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>tecspeeduplayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;TecSpeedUpLayer&quot;, import(&quot;..base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;TecSpeedUpUI&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
	slot0:initTaskPanel()
	slot0:initItem()
	setText(slot0.useCountText, 0)
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0:tryPlayGuide()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)

	if slot0.minusTimer then
		slot0.minusTimer:Stop()
	end

	if slot0.addTimer then
		slot0.addTimer:Stop(0)
	end
end

slot0.tryPlayGuide = function(slot0)
	pg.SystemGuideMgr.GetInstance():PlayByGuideId(&quot;NG0021&quot;)
end

slot0.initData = function(slot0)
	slot0.technologyProxy = getProxy(TechnologyProxy)
	slot0.taskProxy = getProxy(TaskProxy)
	slot0.bagProxy = getProxy(BagProxy)
	slot0.shipBluePrintOnDev = nil

	for slot5, slot6 in pairs(slot0.technologyProxy:getBluePrints()) do
		if slot6:isDeving() then
			slot0.shipBluePrintOnDev = slot6

			break
		end
	end

	slot2 = slot0.shipBluePrintOnDev:getTaskIds()
	slot4 = slot0.shipBluePrintOnDev:getTaskStateById(slot2[4])
	slot0.expTaskID = nil

	if slot0.shipBluePrintOnDev:getTaskStateById(slot2[1]) == ShipBluePrint.TASK_STATE_START then
		slot0.expTaskID = slot2[1]
	elseif slot4 == ShipBluePrint.TASK_STATE_START then
		slot0.expTaskID = slot2[4]
	end

	slot0.expTaskVO = slot0.taskProxy:getTaskVO(slot0.expTaskID)
	slot0.bluePrintVersion = slot0.shipBluePrintOnDev:getConfig(&quot;blueprint_version&quot;)
	slot0.itemID = pg.gameset.technology_catchup_itemid.description[slot0.bluePrintVersion][1]
	slot0.itemExp = pg.gameset.technology_catchup_itemid.description[slot0.bluePrintVersion][2]
	slot0.curUseNum = 0
	slot0.maxUseNum = math.min(math.ceil((slot0.expTaskVO:getConfig(&quot;target_num&quot;) - slot0.expTaskVO:getProgress()) / slot0.itemExp), slot0.bagProxy:getItemCountById(slot0.itemID))
end

slot0.findUI = function(slot0)
	setText(slot0:findTF(&quot;Window/top/bg/obtain/title&quot;), i18n(&quot;tec_speedup_title&quot;))

	slot2 = slot0:findTF(&quot;Window&quot;)
	slot0.backBtn = slot0:findTF(&quot;top/btnBack&quot;, slot2)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot3 = slot0:findTF(&quot;Panel&quot;, slot2)
	slot4 = slot0:findTF(&quot;Task&quot;, slot3)
	slot0.taskNameText = slot0:findTF(&quot;Name/Text&quot;, slot4)
	slot0.expProgressText = slot0:findTF(&quot;ExpProgressText&quot;, slot4)
	slot0.expProgressSlider = slot0:findTF(&quot;Slider&quot;, slot4)
	slot0.taskText = slot0:findTF(&quot;TaskText&quot;, slot4)
	slot0.progressNumText = slot0:findTF(&quot;ProgressNumText&quot;, slot4)
	slot5 = slot0:findTF(&quot;ItemPanel&quot;, slot3)
	slot0.itemIcon = slot0:findTF(&quot;Item/Icon&quot;, slot5)
	slot0.itemCountText = slot0:findTF(&quot;Item/CountText&quot;, slot5)
	slot0.itemNameText = slot0:findTF(&quot;NameText&quot;, slot5)
	slot0.minusBtn = slot0:findTF(&quot;UsePanel/MinusBtn&quot;, slot5)
	slot0.addBtn = slot0:findTF(&quot;UsePanel/AddBtn&quot;, slot5)
	slot0.maxBtn = slot0:findTF(&quot;UsePanel/MaxBtn&quot;, slot5)
	slot0.useCountText = slot0:findTF(&quot;UsePanel/UseCountText&quot;, slot5)
	slot0.confirmBtn = slot0:findTF(&quot;ConfirmBtn&quot;, slot2)
	slot0.helpBtn = slot0:findTF(&quot;HelpBtn&quot;, slot2)
	slot0.helpPanel = slot0:findTF(&quot;HelpPanel&quot;, slot2)
	slot0.helpText = slot0:findTF(&quot;Text&quot;, slot0.helpPanel)

	setText(slot0.helpText, pg.gametip.tec_speedup_help_tip.tip)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0.bg, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0.confirmBtn, function ()
		if uv0.curUseNum == 0 then
			return
		end

		slot0, slot1 = uv0:isExpOverFlow()

		if uv0:isExpOverFlow() then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;tec_speedup_overflow&quot;, slot1),
				onYes = function ()
					pg.m02:sendNotification(GAME.USE_TEC_SPEEDUP_ITEM, {
						blueprintid = uv0.shipBluePrintOnDev.id,
						itemid = uv0.itemID,
						number = uv0.curUseNum,
						taskID = uv0.expTaskID
					})
				end
			})
		else
			pg.m02:sendNotification(GAME.USE_TEC_SPEEDUP_ITEM, {
				blueprintid = uv0.shipBluePrintOnDev.id,
				itemid = uv0.itemID,
				number = uv0.curUseNum,
				taskID = uv0.expTaskID
			})
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.helpBtn, function ()
		if isActive(uv0.helpPanel) then
			setActive(uv0.helpPanel, false)
		else
			setActive(uv0.helpPanel, true)
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.maxBtn, function ()
		if uv0.curUseNum ~= uv0.maxUseNum then
			uv0.curUseNum = uv0.maxUseNum

			setText(uv0.useCountText, uv0.curUseNum)
			uv0:updateTaskPanel(uv0.curUseNum)
		end
	end, SFX_PANEL)

	slot1 = 0

	onButton(slot0, slot0.minusBtn, function ()
		if uv0.curUseNum &gt; 0 then
			uv0.curUseNum = uv0.curUseNum - 1

			setText(uv0.useCountText, uv0.curUseNum)
			uv0:updateTaskPanel(uv0.curUseNum)
		end
	end, SFX_PANEL)

	slot3 = GetOrAddComponent(slot0.minusBtn, typeof(EventTriggerListener))

	slot3:AddPointDownFunc(function (slot0, slot1)
		if not uv0.minusTimer then
			uv0.minusTimer = Timer.New(function ()
				if uv0 &lt; 1 then
					uv0 = uv0 + 0.2
				else
					uv1()
				end
			end, 0.2, -1, 1)
		end

		uv0.minusTimer:Start()
	end)
	slot3:AddPointUpFunc(function (slot0, slot1)
		if uv0.minusTimer then
			uv1 = 0

			uv0.minusTimer:Stop()
		end
	end)
	onButton(slot0, slot0.addBtn, function ()
		if uv0.curUseNum &lt; uv0.maxUseNum then
			uv0.curUseNum = uv0.curUseNum + 1

			setText(uv0.useCountText, uv0.curUseNum)
			uv0:updateTaskPanel(uv0.curUseNum)
		end
	end, SFX_PANEL)

	slot5 = GetOrAddComponent(slot0.addBtn, typeof(EventTriggerListener))

	slot5:AddPointDownFunc(function (slot0, slot1)
		if not uv0.addTimer then
			uv0.addTimer = Timer.New(function ()
				if uv0 &lt; 1 then
					uv0 = uv0 + 0.2
				else
					uv1()
				end
			end, 0.2, -1, 1)
		end

		uv0.addTimer:Start()
	end)
	slot5:AddPointUpFunc(function (slot0, slot1)
		if uv0.addTimer then
			uv1 = 0

			uv0.addTimer:Stop()
		end
	end)
end

slot0.initTaskPanel = function(slot0)
	setText(slot0.taskNameText, slot0.expTaskVO:getConfig(&quot;name&quot;))
	setText(slot0.taskText, string.split(slot0.expTaskVO:getConfig(&quot;desc&quot;), i18n(&quot;tech_catchup_sentence_pauses&quot;))[2])

	slot3 = slot0.expTaskVO:getProgress()
	slot4 = slot0.expTaskVO:getConfig(&quot;target_num&quot;)

	setText(slot0.expProgressText, i18n(&quot;tec_speedup_progress&quot;, math.floor(slot3 / 10000), math.floor(slot4 / 10000)))

	slot5 = slot3 / slot4

	setSlider(slot0.expProgressSlider, 0, 1, slot5)
	setText(slot0.progressNumText, math.floor(slot5 * 100) .. &quot;%&quot;)
end

slot0.updateTaskPanel = function(slot0, slot1)
	slot4 = slot0.expTaskVO:getConfig(&quot;target_num&quot;)
	slot5 = slot0.expTaskVO:getProgress() + slot0.curUseNum * slot0.itemExp

	setText(slot0.expProgressText, i18n(&quot;tec_speedup_progress&quot;, math.floor(slot5 / 10000), math.floor(slot4 / 10000)))

	slot6 = slot5 / slot4

	setSlider(slot0.expProgressSlider, 0, 1, slot6)
	setText(slot0.progressNumText, math.floor(slot6 * 100) .. &quot;%&quot;)
end

slot0.initItem = function(slot0)
	slot1 = Item.getConfigData(slot0.itemID)

	GetImageSpriteFromAtlasAsync(slot1.icon, &quot;&quot;, slot0.itemIcon)
	setText(slot0.itemCountText, slot0.bagProxy:getItemCountById(slot0.itemID))
	setText(slot0.itemNameText, slot1.name)
end

slot0.isExpOverFlow = function(slot0)
	return slot0.expTaskVO:getConfig(&quot;target_num&quot;) &lt; slot0.expTaskVO:getProgress() + slot0.curUseNum * slot0.itemExp, slot4 - slot3
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>