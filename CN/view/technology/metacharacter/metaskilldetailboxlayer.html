<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>metaskilldetailboxlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>metaskilldetailboxlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MetaSkillDetailBoxLayer&quot;, import(&quot;...base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;MetaSkillDetailBoxUI&quot;
end

slot0.init = function(slot0)
	slot0:initUITextTips()
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false)
	slot0:updateShipDetail()
	slot0:updateSkillList()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
end

slot0.initUITextTips = function(slot0)
	setText(slot0:findTF(&quot;Window/top/bg/infomation/title&quot;), i18n(&quot;battle_end_subtitle2&quot;))
	setText(slot0:findTF(&quot;Window/MetaSkillDetailBox/ExpDetail/ExpTipText&quot;), i18n(&quot;meta_skill_dailyexp&quot;))
	setText(slot0:findTF(&quot;Window/MetaSkillDetailBox/TipText&quot;), i18n(&quot;meta_skill_learn&quot;))
end

slot0.initData = function(slot0)
	slot0.metaProxy = getProxy(MetaCharacterProxy)
	slot0.metaShipID = slot0.contextData.metaShipID
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot0.window = slot0:findTF(&quot;Window&quot;)
	slot0.closeBtn = slot0:findTF(&quot;top/btnBack&quot;, slot0.window)
	slot0.panel = slot0:findTF(&quot;MetaSkillDetailBox&quot;, slot0.window)
	slot0.skillTpl = slot0:findTF(&quot;SkillTpl&quot;, slot0.panel)
	slot0.expDetailTF = slot0:findTF(&quot;ExpDetail&quot;, slot0.panel)
	slot0.shipIcon = slot0:findTF(&quot;IconTpl/Icon&quot;, slot0.expDetailTF)
	slot0.shipNameText = slot0:findTF(&quot;NameMask/Name&quot;, slot0.expDetailTF)
	slot0.expProgressText = slot0:findTF(&quot;ExpProgressText&quot;, slot0.expDetailTF)
	slot0.skillContainer = slot0:findTF(&quot;ScrollView/Content&quot;, slot0.panel)
	slot0.skillUIItemList = UIItemList.New(slot0.skillContainer, slot0.skillTpl)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.bg, function ()
		uv0:closeView()
	end, SFX_PANEL)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:closeView()
	end, SFX_PANEL)
end

slot0.updateSkillTF = function(slot0, slot1, slot2)
	slot3 = slot0:findTF(&quot;frame&quot;, slot1)
	slot4 = slot0:findTF(&quot;check_mark&quot;, slot1)
	slot5 = slot0:findTF(&quot;skillInfo&quot;, slot3)
	slot6 = slot0:findTF(&quot;mask&quot;, slot3)
	slot7 = slot0:findTF(&quot;Slider&quot;, slot3)
	slot9 = slot0:findTF(&quot;ExpProgressText&quot;, slot5)
	slot12 = slot0:findTF(&quot;Tag/learing&quot;, slot3)
	slot13 = slot0:findTF(&quot;Tag/unlockable&quot;, slot3)
	slot16 = getSkillConfig(slot2)

	setImageSprite(slot0:findTF(&quot;icon&quot;, slot5), LoadSprite(&quot;skillicon/&quot; .. slot16.icon))
	setText(slot0:findTF(&quot;name_contain/name&quot;, slot5), shortenString(getSkillName(slot16.id), 8))
	setText(slot0:findTF(&quot;name_contain/level_contain/Text&quot;, slot5), getProxy(BayProxy):getShipById(slot0.metaShipID):getMetaSkillLevelBySkillID(slot2))

	slot18 = slot2 == slot0.metaProxy:getMetaTacticsInfoByShipID(slot0.metaShipID).curSkillID
	slot19 = slot15 &gt; 0
	slot20 = slot14:isSkillLevelMax(slot2)
	slot21 = slot17:getSkillExp(slot2)

	if not (pg.skill_data_template[slot2].max_level &lt;= slot15) then
		if slot19 then
			slot25 = MetaCharacterConst.getMetaSkillTacticsConfig(slot2, slot15).need_exp

			setText(slot9, slot21 .. &quot;/&quot; .. slot25)
			setSlider(slot7, 0, slot25, slot21)
			setActive(slot9, true)
			setActive(slot7, true)
		else
			setActive(slot9, false)
			setActive(slot7, false)
		end
	else
		setText(slot9, slot21 .. &quot;/Max&quot;)
		setSlider(slot7, 0, 1, 1)
		setActive(slot9, true)
		setActive(slot7, true)
	end

	setActive(slot4, slot18 and not slot20)
	setActive(slot12, slot18 and not slot20)
	setActive(slot13, not slot19)
	setActive(slot6, not slot19)
	onToggle(slot0, slot1, function (slot0)
		if slot0 then
			if not uv0 then
				pg.MsgboxMgr:GetInstance():ShowMsgBox({
					hideYes = true,
					hideNo = true,
					type = MSGBOX_TYPE_META_SKILL_UNLOCK,
					weight = LayerWeightConst.TOP_LAYER,
					metaShipVO = uv1,
					skillID = uv2
				})
			elseif not uv3 and not uv4 then
				pg.MsgboxMgr.GetInstance():ShowMsgBox({
					content = i18n(&quot;meta_switch_skill_box_title&quot;, getSkillName(uv2)),
					onYes = function ()
						pg.m02:sendNotification(GAME.TACTICS_META_SWITCH_SKILL, {
							shipID = uv0.metaShipID,
							skillID = uv1
						})
					end,
					weight = LayerWeightConst.TOP_LAYER
				})
			elseif uv4 then
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;meta_skill_maxtip2&quot;))
			end
		end
	end, SFX_PANEL)
end

slot0.updateSkillList = function(slot0)
	slot0.skillUIItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv1:updateSkillTF(slot2, uv0[slot1 + 1])
		end
	end)
	slot0.skillUIItemList:align(#MetaCharacterConst.getTacticsSkillIDListByShipConfigID(getProxy(BayProxy):getShipById(slot0.metaShipID).configId))
end

slot0.updateShipDetail = function(slot0)
	slot1 = getProxy(BayProxy):getShipById(slot0.metaShipID)
	slot2 = slot1:getPainting()

	setImageSprite(slot0.shipIcon, LoadSprite(&quot;SquareIcon/&quot; .. slot2, slot2))
	setScrollText(slot0.shipNameText, slot1:getName())
	setText(slot0.expProgressText, setColorStr(slot0.metaProxy:getMetaTacticsInfoByShipID(slot0.metaShipID).curDayExp, &quot;#FFF152FF&quot;) .. &quot;/&quot; .. pg.gameset.meta_skill_exp_max.key_value)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>