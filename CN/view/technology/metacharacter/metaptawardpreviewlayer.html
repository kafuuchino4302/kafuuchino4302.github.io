<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>metaptawardpreviewlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>metaptawardpreviewlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MetaPTAwardPreviewLayer&quot;, import(&quot;...base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;MetaPTAwardPreviewUI&quot;
end

slot0.init = function(slot0)
	slot0:initUITextTips()
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
	slot0:initScrollList()
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false, {
		weight = LayerWeightConst.THIRD_LAYER
	})
	slot0:updatePTInfo()
	slot0:updateScrollList()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
end

slot0.initUITextTips = function(slot0)
	setText(slot0:findTF(&quot;Panel/AwardTpl/PointLight/PointTipText&quot;), i18n(&quot;meta_pt_point&quot;))
	setText(slot0:findTF(&quot;Panel/AwardTpl/PointGray/PointTipText&quot;), i18n(&quot;meta_pt_point&quot;))
	setText(slot0:findTF(&quot;Panel/AwardTpl/GetText&quot;), i18n(&quot;meta_award_get&quot;))
	setText(slot0:findTF(&quot;Panel/AwardTpl/GotText&quot;), i18n(&quot;meta_award_got&quot;))
end

slot0.initData = function(slot0)
	slot0.curMetaProgressVO = slot0.contextData.metaProgressVO
	slot0.ptData = slot0.curMetaProgressVO.metaPtData
	slot0.itemNum = #slot0.ptData.dropList
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot1 = slot0:findTF(&quot;Panel&quot;)
	slot2 = slot0:findTF(&quot;PT&quot;, slot1)
	slot0.ptNumText = slot0:findTF(&quot;NumText&quot;, slot2)
	slot0.ptIcon = slot0:findTF(&quot;PTIcon&quot;, slot2)
	slot0.scrollViewTF = slot0:findTF(&quot;ScrollView&quot;, slot1)
	slot0.awardContainerTF = slot0:findTF(&quot;ScrollView/Viewport/Content&quot;, slot1)
	slot0.awardTpl = slot0:findTF(&quot;AwardTpl&quot;, slot1)
	slot3 = slot0:findTF(&quot;NotchAdapt&quot;)
	slot0.nextArrow = slot0:findTF(&quot;NextBtn&quot;, slot3)
	slot0.preArrow = slot0:findTF(&quot;PreBtn&quot;, slot3)
	slot0.sizeW = GetComponent(slot0.awardTpl, &quot;LayoutElement&quot;).preferredWidth
	slot0.spaceW = GetComponent(slot0.awardContainerTF, &quot;HorizontalLayoutGroup&quot;).spacing
	slot0.leftW = GetComponent(slot0.awardContainerTF, &quot;HorizontalLayoutGroup&quot;).padding.left
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.bg, function ()
		uv0:closeView()
	end, SFX_PANEL)
end

slot0.initScrollList = function(slot0)
	slot0.awardUIItemList = UIItemList.New(slot0.awardContainerTF, slot0.awardTpl)
	slot1 = slot0.awardUIItemList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateAwardTpl(slot2, slot1 + 1)
		end
	end)

	slot1 = slot0.scrollViewTF
	slot0.scrollRectSC = slot1:GetComponent(&quot;ScrollRect&quot;)
	slot1 = slot0.scrollRectSC.onValueChanged

	slot1:AddListener(function (slot0)
		setActive(uv0.preArrow, slot0.x &gt;= 0.01)
		setActive(uv0.nextArrow, slot0.x &lt;= 0.99)
	end)
end

slot0.updateScrollList = function(slot0)
	slot1, slot2, slot3 = slot0.curMetaProgressVO.metaPtData:GetLevelProgress()

	slot0.awardUIItemList:align(slot2)
	setLocalPosition(slot0.awardContainerTF, {
		x = -((slot1 - 1) * (slot0.sizeW + slot0.spaceW))
	})

	if slot1 &gt; 1 then
		setActive(slot0.preArrow, true)
	end
end

slot0.updateAwardTpl = function(slot0, slot1, slot2)
	slot3 = slot0:findTF(&quot;Item&quot;, slot1)
	slot4 = slot0:findTF(&quot;mask&quot;, slot3)
	slot5 = slot0:findTF(&quot;Got&quot;, slot4)
	slot6 = slot0:findTF(&quot;Lock&quot;, slot4)
	slot11 = slot0:findTF(&quot;GetText&quot;, slot1)
	slot12 = slot0:findTF(&quot;GotText&quot;, slot1)
	slot14 = slot0:findTF(&quot;LineTpl&quot;, slot1)
	slot15 = slot0:findTF(&quot;LineTpl/Light&quot;, slot1)
	slot16 = slot0:findTF(&quot;LineTpl/Dark&quot;, slot1)
	slot17 = slot0.ptData.dropList[slot2]
	slot18 = slot0.ptData.targets[slot2]

	updateDrop(slot3, {
		type = slot17[1],
		id = slot17[2],
		count = slot17[3]
	}, {
		hideName = true
	})
	onButton(slot0, slot3, function ()
		uv0:emit(BaseUI.ON_DROP, uv1)
	end, SFX_PANEL)
	setText(slot0:findTF(&quot;NumText&quot;, slot0:findTF(&quot;PointLight&quot;, slot1)), slot18)
	setText(slot0:findTF(&quot;NumText&quot;, slot0:findTF(&quot;PointGray&quot;, slot1)), slot18)
	setText(slot0:findTF(&quot;LockText&quot;, slot1), &quot;PHASE &quot; .. math.floor(slot18 / slot0.curMetaProgressVO.unlockPTNum * 100) .. &quot;%&quot;)

	if slot2 &lt; slot0.ptData.level + 1 then
		setActive(slot4, true)
		setActive(slot5, true)
		setActive(slot6, false)
		setActive(slot7, false)
		setActive(slot9, true)
		setActive(slot15, false)
		setActive(slot16, true)
		setActive(slot11, false)
		setActive(slot12, true)
		setActive(slot13, false)
	elseif slot0.ptData.count &lt; slot18 then
		setActive(slot4, true)
		setActive(slot5, false)
		setActive(slot6, true)
		setActive(slot7, false)
		setActive(slot9, true)
		setActive(slot15, false)
		setActive(slot16, true)
		setActive(slot11, false)
		setActive(slot12, false)
		setActive(slot13, true)
	else
		setActive(slot4, false)
		setActive(slot5, false)
		setActive(slot6, false)
		setActive(slot7, true)
		setActive(slot9, false)
		setActive(slot15, true)
		setActive(slot16, false)
		setActive(slot11, true)
		setActive(slot12, false)
		setActive(slot13, false)
	end

	if slot2 == 1 then
		setActive(slot14, false)
	end
end

slot0.updatePTInfo = function(slot0)
	setImageSprite(slot0.ptIcon, LoadSprite(slot0.curMetaProgressVO:getPtIconPath()))
	setText(slot0.ptNumText, slot0.ptData.count)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>