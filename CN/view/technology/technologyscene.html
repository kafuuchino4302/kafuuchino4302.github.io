<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>technologyscene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>technologyscene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;TechnologyScene&quot;, import(&quot;..base.BaseUI&quot;))
slot0.PageBase = 1
slot0.PageQueue = 2
slot0.rarityColor = {
	[&quot;1&quot;] = {
		&quot;#4B7BC6FF&quot;,
		{
			0.06274509803921569,
			0.29411764705882354,
			0.8745098039215686,
			0.6705882352941176
		}
	},
	[&quot;2&quot;] = {
		&quot;#776AB0FF&quot;,
		{
			0.29411764705882354,
			0.23529411764705882,
			0.5764705882352941,
			0.6705882352941176
		}
	},
	[&quot;3&quot;] = {
		&quot;#B76642FF&quot;,
		{
			0.7490196078431373,
			0.28627450980392155,
			0.06274509803921569,
			0.6705882352941176
		}
	},
	[&quot;4&quot;] = {
		&quot;#368B78FF&quot;,
		{
			0.12941176470588237,
			0.4980392156862745,
			0.5019607843137255,
			0.6705882352941176
		}
	}
}

slot0.getUIName = function(slot0)
	return &quot;TechnologyUI&quot;
end

slot0.onBackPressed = function(slot0)
	if slot0.contextData.selectedIndex then
		slot0:cancelSelected()

		return
	end

	if slot0.contextData.page == uv0.PageQueue then
		slot0:setPage(uv0.PageBase)

		return
	end

	uv0.super.onBackPressed(slot0)
end

slot0.ResUISettings = function(slot0)
	return true
end

slot0.setTechnologys = function(slot0, slot1, slot2)
	slot0.technologyVOs = slot1
	slot0.technologyQueue = slot2
end

slot0.setRefreshFlag = function(slot0, slot1)
	slot0.flag = slot1
end

slot0.setPlayer = function(slot0, slot1)
	slot0.player = slot1
end

slot0.init = function(slot0)
	slot0.backBtn = slot0._tf:Find(&quot;blur_panel/adapt/top/back&quot;)
	slot0.basePage = slot0._tf:Find(&quot;main/base_page&quot;)
	slot0.srcollView = slot0.basePage:Find(&quot;srcoll_rect/content&quot;)
	slot0.srcollViewCG = slot0.srcollView:GetComponent(typeof(CanvasGroup))
	slot0.helpBtn = slot0.basePage:Find(&quot;help_btn&quot;)
	slot0.refreshBtn = slot0.basePage:Find(&quot;refresh_btn&quot;)

	setText(slot0.refreshBtn:Find(&quot;Text&quot;), i18n(&quot;technology_daily_refresh&quot;))

	slot0.settingsBtn = slot0.basePage:Find(&quot;settings_btn&quot;)
	slot0.selectetPanel = slot0.basePage:Find(&quot;selecte_panel&quot;)

	setActive(slot0.selectetPanel, false)
	setText(slot0.selectetPanel:Find(&quot;consume_panel/bg/label/Text&quot;), i18n(&quot;technology_consume&quot;))
	setText(slot0.selectetPanel:Find(&quot;consume_panel/bg/task_panel/label/Text&quot;), i18n(&quot;technology_request&quot;))

	slot0.arrLeftBtn = slot0.selectetPanel:Find(&quot;left_arr_btn&quot;)
	slot0.arrRightBtn = slot0.selectetPanel:Find(&quot;right_arr_btn&quot;)
	slot0.technologyTpl = slot0.selectetPanel:Find(&quot;technology_card&quot;)
	slot0.descTxt = slot0.selectetPanel:Find(&quot;desc/bg/Text&quot;):GetComponent(typeof(Text))
	slot0.timerTxt = slot0.selectetPanel:Find(&quot;timer/bg/Text&quot;):GetComponent(typeof(Text))
	slot0.itemContainer = slot0.selectetPanel:Find(&quot;consume_panel/bg/container&quot;)
	slot0.itemTpl = slot0:findTF(&quot;item_tpl&quot;, slot0.itemContainer)
	slot0.emptyTF = slot0.selectetPanel:Find(&quot;consume_panel/bg/empty&quot;)
	slot0.taskPanel = slot0.selectetPanel:Find(&quot;consume_panel/bg/task_panel&quot;)
	slot0.taskSlider = slot0.taskPanel:Find(&quot;slider&quot;):GetComponent(typeof(Slider))
	slot0.taskDesc = slot0.taskPanel:Find(&quot;slider/Text&quot;):GetComponent(typeof(Text))
	slot0.descBG = slot0.selectetPanel:Find(&quot;desc/bg&quot;):GetComponent(typeof(Image))
	slot0.queuePage = slot0._tf:Find(&quot;main/queue_page&quot;)
	slot0.queueView = slot0.queuePage:Find(&quot;queue_rect/content&quot;)
	slot1 = slot0._tf:Find(&quot;blur_panel/adapt/right&quot;)
	slot0.btnAwardQueue = slot1:Find(&quot;btn_award&quot;)

	setText(slot0.btnAwardQueue:Find(&quot;Text&quot;), i18n(&quot;technology_queue_getaward&quot;))

	slot0.btnAwardQueueDisable = slot1:Find(&quot;btn_award_disable&quot;)

	setText(slot0.btnAwardQueueDisable:Find(&quot;Text&quot;), i18n(&quot;technology_queue_getaward&quot;))

	slot0.btnQueue = slot0._tf:Find(&quot;blur_panel/adapt/left/btn_queue&quot;)
	slot0.cardtimer = {}
	slot0.queueTimer = {}
	slot0.queueCardTimer = {}
end

slot0.updateSettingsBtn = function(slot0)
	slot1 = slot0:findTF(&quot;RedPoint&quot;, slot0.settingsBtn)

	setText(slot0:findTF(&quot;TipText&quot;, slot0.settingsBtn), i18n(&quot;tec_settings_btn_word&quot;))

	slot4 = slot0:findTF(&quot;Selected&quot;, slot0:findTF(&quot;TargetCatchup&quot;, slot0.settingsBtn))
	slot5 = slot0:findTF(&quot;ActCatchup&quot;, slot0.settingsBtn)

	slot0:updateSettingBtnVersion()

	slot6 = false

	if getProxy(ActivityProxy):getActivityByType(ActivityConst.ACTIVITY_TYPE_BLUEPRINT_CATCHUP) and not slot7:isEnd() then
		slot9 = slot7:getConfig(&quot;config_id&quot;)
		slot10 = pg.activity_event_blueprint_catchup[slot9].char_choice

		if slot7.data1 &lt; pg.activity_event_blueprint_catchup[slot9].obtain_max then
			setImageSprite(slot0:findTF(&quot;Selected/CharImg&quot;, slot5), LoadSprite(&quot;TecCatchup/QChar&quot; .. slot10, tostring(slot10)))
			setText(slot0:findTF(&quot;Selected/ProgressText&quot;, slot5), slot8 .. &quot;/&quot; .. slot11)

			slot14 = slot7.stopTime - pg.TimeMgr.GetInstance():GetServerTime()

			if slot0.actCatchupTimer then
				slot0.actCatchupTimer:Stop()

				slot0.actCatchupTimer = nil
			end

			slot15 = slot0:findTF(&quot;TimeLeft/Day&quot;, slot5)
			slot16 = slot0:findTF(&quot;TimeLeft/Hour&quot;, slot5)
			slot17 = slot0:findTF(&quot;TimeLeft/Min&quot;, slot5)
			slot18 = slot0:findTF(&quot;TimeLeft/NumText&quot;, slot5)
			slot0.actCatchupTimer = Timer.New(function ()
				slot0, slot1, slot2, slot3 = pg.TimeMgr.GetInstance():parseTimeFrom(uv0)
				uv0 = uv0 - 1

				if slot0 &gt;= 1 then
					setActive(uv1, true)
					setActive(uv2, false)
					setActive(uv3, false)
					setText(uv4, slot0)
				elseif slot0 &lt;= 0 and slot1 &gt; 0 then
					setActive(uv1, false)
					setActive(uv2, true)
					setActive(uv3, false)
					setText(uv4, slot1)
				elseif slot0 &lt;= 0 and slot1 &lt;= 0 and (slot2 &gt; 0 or slot3 &gt; 0) then
					setActive(uv1, false)
					setActive(uv2, false)
					setActive(uv3, true)
					setText(uv4, math.max(slot2, 1))
				elseif slot0 &lt;= 0 and slot1 &lt;= 0 and slot2 &lt;= 0 and slot3 &lt;= 0 and uv5.actCatchupTimer then
					uv5.actCatchupTimer:Stop()

					uv5.actCatchupTimer = nil

					setActive(uv6, false)
				end
			end, 1, -1, 1)

			slot0.actCatchupTimer:Start()
			slot0.actCatchupTimer.func()

			slot6 = true
		end
	end

	setActive(slot5, slot6)
	setActive(slot3, true)

	slot8 = getProxy(TechnologyProxy)
	slot10 = slot8:isOnCatchup()

	if slot8:isOpenTargetCatchup() then
		if not slot10 then
			setActive(slot4, false)
			setActive(slot1, true)
		else
			slot11 = slot8:getCurCatchupTecInfo()

			if (slot8:getCatchupData(slot11.tecID):isUr(slot11.groupID) and pg.technology_catchup_template[slot12].obtain_max_per_ur or pg.technology_catchup_template[slot12].obtain_max) &lt;= slot11.printNum then
				setActive(slot4, false)
				setActive(slot1, false)
			else
				setActive(slot4, true)
				setActive(slot1, false)
				setImageSprite(slot0:findTF(&quot;CharImg&quot;, slot4), LoadSprite(&quot;TecCatchup/QChar&quot; .. slot13, tostring(slot13)))
				setText(slot0:findTF(&quot;ProgressText&quot;, slot4), slot14 .. &quot;/&quot; .. slot17)
			end
		end
	else
		setActive(slot4, false)
		setActive(slot1, false)
	end
end

slot0.updateSettingBtnVersion = function(slot0)
	setActive(slot0.settingsBtn:Find(&quot;tag&quot;), getProxy(TechnologyProxy):getTendency(2) &gt; 0)

	if slot1 &gt; 0 then
		GetImageSpriteFromAtlasAsync(&quot;technologycard&quot;, &quot;version_&quot; .. slot1, slot2:Find(&quot;Image&quot;), true)
	end
end

slot0.setPage = function(slot0, slot1)
	slot0.contextData.page = slot1

	setActive(slot0.basePage, slot1 == uv0.PageBase)
	setActive(slot0.queuePage, slot1 == uv0.PageQueue)
	setActive(slot0._tf:Find(&quot;blur_panel/adapt/top/title&quot;), slot1 == uv0.PageBase)
	setActive(slot0._tf:Find(&quot;blur_panel/adapt/left&quot;), slot1 == uv0.PageBase)
	setActive(slot0._tf:Find(&quot;blur_panel/adapt/top/title_queue&quot;), slot1 == uv0.PageQueue)
	setActive(slot0._tf:Find(&quot;blur_panel/adapt/right&quot;), slot1 == uv0.PageQueue)

	if slot1 == uv0.PageBase then
		for slot5, slot6 in ipairs(slot0.technologyVOs) do
			if slot6:isActivate() then
				if slot0.enhancelTimer then
					slot0.enhancelTimer:Stop()
				end

				slot0.enhancelTimer = Timer.New(function ()
					uv0.srcollView:GetComponent(&quot;EnhancelScrollView&quot;):SetHorizontalTargetItemIndex(uv0.technologyCards[uv1]:GetComponent(&quot;EnhanceItem&quot;).scrollViewItemIndex)

					uv0.enhancelTimer = nil
				end, 0.35, 1)

				slot0.enhancelTimer:Start()

				break
			end
		end
	end
end

slot0.didEnter = function(slot0)
	slot0:initTechnologys()
	slot0:initQueue()
	slot0:setPage(slot0.contextData.page or uv0.PageBase)
	onButton(slot0, slot0.helpBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.technology_help_text.tip
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.refreshBtn, function ()
		if tobool(getProxy(TechnologyProxy):getActivateTechnology()) then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;technology_canot_refresh&quot;)
			})

			return
		end

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			content = i18n(&quot;technology_refresh_tip&quot;),
			onYes = function ()
				uv0:emit(TechnologyMediator.ON_REFRESH)
			end
		})
	end, SFX_PANEL)

	slot1 = getProxy(TechnologyProxy):getConfigMaxVersion()

	onButton(slot0, slot0.settingsBtn, function ()
		uv0:emit(TechnologyMediator.ON_CLICK_SETTINGS_BTN)
	end, SFX_PANEL)
	onButton(slot0, slot0.backBtn, function ()
		uv0:onBackPressed()
	end, SOUND_BACK)
	onButton(slot0, slot0.selectetPanel, function ()
		uv0:cancelSelected()
	end, SFX_PANEL)
	slot0:updateRefreshBtn(slot0.flag)
	slot0:updateSettingsBtn()
end

slot0.initTechnologys = function(slot0)
	slot0.technologyCards = {}
	slot0.lastButtonListener = slot0.lastButtonListener or {}

	if not slot0.itemList then
		slot3 = slot0.srcollView
		slot0.itemList = UIItemList.New(slot0.srcollView, slot3:GetChild(0))
		slot1 = slot0.itemList

		slot1:make(function (slot0, slot1, slot2)
			slot1 = slot1 + 1

			if slot0 == UIItemList.EventUpdate then
				slot2.name = slot1
				uv0.technologyCards[slot1] = slot2

				uv0:updateTechnologyTF(slot2, slot1, &quot;base&quot;)

				slot3 = GetOrAddComponent(slot2, typeof(Button)).onClick

				if uv0.lastButtonListener[slot2] then
					slot3:RemoveListener(uv0.lastButtonListener[slot2])
				end

				uv0.lastButtonListener[slot2] = function ()
					pg.CriMgr.GetInstance():PlaySoundEffect_V3(SFX_PANEL)

					if uv0.technologyVOs[uv1]:isCompleted() then
						uv0:emit(TechnologyMediator.ON_FINISHED, {
							id = uv0.technologyVOs[uv1].id,
							pool_id = uv0.technologyVOs[uv1].poolId
						})
					else
						uv0:onSelected(uv2, uv1)
					end
				end

				slot3:AddListener(uv0.lastButtonListener[slot2])
			end
		end)
	end

	slot0.itemList:align(#slot0.technologyVOs)
	setActive(slot0.srcollView, true)
end

slot0.initQueue = function(slot0)
	if not slot0.queueItemList then
		slot3 = slot0.btnQueue
		slot0.queueItemList = UIItemList.New(slot0.btnQueue, slot3:GetChild(0))
		slot1 = slot0.queueItemList

		slot1:make(function (slot0, slot1, slot2)
			slot1 = slot1 + 1

			if slot0 == UIItemList.EventUpdate then
				slot2.name = slot1

				if uv0.queueTimer[slot1] then
					uv0.queueTimer[slot1]:Stop()

					uv0.queueTimer[slot1] = nil
				end

				slot3 = {}

				if not uv0.technologyQueue[slot1] then
					slot3.empty = true
				elseif pg.TimeMgr.GetInstance():GetServerTime() &lt; slot4.time - slot4:getConfig(&quot;time&quot;) then
					slot3.waiting = true
				elseif slot5 &lt; slot6 then
					slot3.doing = true
					uv0.queueTimer[slot1] = Timer.New(function ()
						if pg.TimeMgr.GetInstance():GetServerTime() &lt; uv0 then
							setSlider(uv1:Find(&quot;doing&quot;), 0, uv2, uv2 - uv0 + slot0)
						else
							uv3:updateQueueChange()
						end
					end, 1, -1)

					uv0.queueTimer[slot1]:Start()
					uv0.queueTimer[slot1].func()
				else
					slot3.complete = true
				end

				eachChild(slot2, function (slot0)
					setActive(slot0, uv0[slot0.name])
				end)
			end
		end)
	end

	slot1 = slot0.queueItemList

	slot1:align(TechnologyConst.QUEUE_TOTAL_COUNT)
	onButton(slot0, slot0.btnQueue, function ()
		uv0:setPage(uv1.PageQueue)
	end, SFX_PANEL)

	if not slot0.queueCardItemList then
		slot3 = slot0.queueView
		slot0.queueCardItemList = UIItemList.New(slot0.queueView, slot3:GetChild(0))
		slot1 = slot0.queueCardItemList

		slot1:make(function (slot0, slot1, slot2)
			slot1 = slot1 + 1

			if slot0 == UIItemList.EventUpdate then
				slot2.name = slot1

				uv0:updateTechnologyTF(slot2, slot1, &quot;queue&quot;)
			end
		end)
	end

	slot0.queueCardItemList:align(TechnologyConst.QUEUE_TOTAL_COUNT)
	onButton(slot0, slot0.btnAwardQueue, function ()
		if uv0.technologyQueue[1] and uv0.technologyQueue[1]:isCompleted() then
			uv0:emit(TechnologyMediator.ON_FINISH_QUEUE)
		end
	end, SFX_CONFIRM)
	setActive(slot0.btnAwardQueue, slot0.technologyQueue[1] and slot0.technologyQueue[1]:isCompleted())
	setActive(slot0.btnAwardQueueDisable, not isActive(slot0.btnAwardQueue))
end

slot0.updateRefreshBtn = function(slot0, slot1)
	setButtonEnabled(slot0.refreshBtn, slot1 == 0)
end

slot0.onSelected = function(slot0, slot1, slot2)
	if not slot2 then
		return
	end

	if not slot0.technologyVOs[slot2] then
		return
	end

	slot0.contextData.selectedIndex = slot2

	slot0:updateTechnologyTF(slot0.technologyTpl, slot2, &quot;desc&quot;)

	slot0.srcollViewCG.alpha = 0.3

	setActive(slot1, false)
	setActive(slot0.selectetPanel, true)

	slot3 = {}

	eachChild(slot0.srcollView, function (slot0)
		uv0[tonumber(slot0.name)] = slot0
	end)

	slot4 = function(slot0, slot1)
		slot2 = {}
		slot3 = slot0
		slot4 = uv0[slot0].localPosition.x

		for slot8, slot9 in ipairs(uv0) do
			slot2[slot8] = uv0[slot8].localPosition.x - slot4
		end

		for slot8, slot9 in ipairs(slot2) do
			if slot9 ~= 0 and (slot2[slot3] == 0 or slot1 and (slot9 &gt; 0 and slot2[slot3] &gt; 0 and slot2[slot3] &lt; slot9 or slot9 &lt; 0 and (slot2[slot3] &gt; 0 or slot2[slot3] &lt; slot9)) or not slot1 and (slot9 &lt; 0 and slot2[slot3] &lt; 0 and slot9 &lt; slot2[slot3] or slot9 &gt; 0 and (slot2[slot3] &lt; 0 or slot9 &lt; slot2[slot3]))) then
				slot3 = slot8
			end
		end

		return uv0[slot3]
	end

	onButton(slot0, slot0.arrLeftBtn, function ()
		if uv0.inAnim then
			return
		end

		uv0:cancelSelected()
		triggerButton(uv1(uv2, true))
	end, SFX_PANEL)
	onButton(slot0, slot0.arrRightBtn, function ()
		if uv0.inAnim then
			return
		end

		uv0:cancelSelected()
		triggerButton(uv1(uv2, false))
	end, SFX_PANEL)
end

slot0.cancelSelected = function(slot0)
	if not slot0.technologyVOs[slot0.contextData.selectedIndex or 0] then
		return
	end

	slot0.contextData.selectedIndex = nil

	setActive(slot0.technologyCards[slot0.contextData.selectedIndex], true)
	removeOnButton(slot0.arrLeftBtn)
	removeOnButton(slot0.arrRightBtn)
	setActive(slot0.selectetPanel, false)

	slot0.srcollViewCG.alpha = 1
	slot0.inAnim = true

	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end

	slot0.timer = Timer.New(function ()
		uv0.inAnim = nil
	end, 0.2, 1)

	slot0.timer:Start()

	if slot0.extraTimer then
		slot0.extraTimer:Stop()

		slot0.extraTimer = nil
	end
end

slot0.updateTechnology = function(slot0, slot1)
	slot2 = nil

	for slot6, slot7 in ipairs(slot0.technologyVOs) do
		if slot7.id == slot1.id then
			slot0.technologyVOs[slot6] = slot1
			slot2 = slot6

			break
		end
	end

	slot0:updateTechnologyTF(slot0.technologyCards[slot2], slot2, &quot;base&quot;)

	if slot0.contextData.selectedIndex and slot0.technologyVOs[slot0.contextData.selectedIndex].id == slot1.id then
		slot0:updateTechnologyTF(slot0.technologyTpl, slot2, &quot;desc&quot;)
	end
end

slot0.updateQueueChange = function(slot0)
	slot0.queueItemList:align(#slot0.technologyQueue)
	slot0.queueCardItemList:align(TechnologyConst.QUEUE_TOTAL_COUNT)
	setActive(slot0.btnAwardQueue, slot0.technologyQueue[1] and slot0.technologyQueue[1]:isCompleted())
	setActive(slot0.btnAwardQueueDisable, not isActive(slot0.btnAwardQueue))

	if getProxy(TechnologyProxy):getActivateTechnology() then
		slot0:updateTechnology(slot1)
	end
end

slot0.updateTechnologyTF = function(slot0, slot1, slot2, slot3)
	slot4 = nil

	if slot3 == &quot;queue&quot; then
		slot5 = not tobool(slot0.technologyQueue[slot2])

		setActive(slot1:Find(&quot;frame&quot;), not slot5)
		setActive(slot1:Find(&quot;empty&quot;), slot5)

		if slot5 then
			return
		end
	else
		slot4 = slot0.technologyVOs[slot2]
	end

	slot0:updateInfo(slot1, slot4, slot3)
	slot0:updateInfoVersionPickUp(slot1, slot4)

	slot5 = slot4:getConfig(&quot;time&quot;)
	slot6 = pg.TimeMgr.GetInstance()
	slot6 = slot6:GetServerTime()
	slot7 = slot4.time

	switch(slot3, {
		base = function ()
			if uv0.cardtimer[uv1] then
				uv0.cardtimer[uv1]:Stop()

				uv0.cardtimer[uv1] = nil
			end

			slot1 = uv2:Find(&quot;frame/marks/Text&quot;)
			GetComponent(uv2:Find(&quot;frame/marks/time&quot;), &quot;Shadow&quot;).effectColor = Color.New(unpack(uv3.rarityColor[uv4:getConfig(&quot;bg&quot;)][2]))
			slot4 = {}

			if uv5 &lt;= 0 then
				slot4.blue = true

				setText(slot1, setColorStr(i18n(&quot;technology_detail&quot;), slot2[1]))
				setText(slot0, pg.TimeMgr.GetInstance():DescCDTime(uv4:getConfig(&quot;time&quot;)))
			elseif uv6 &lt; uv5 - uv7 then
				slot4.blue = true

				setText(slot1, setColorStr(i18n(&quot;technology_queue_waiting&quot;), slot2[1]))
				setText(slot0, pg.TimeMgr.GetInstance():DescCDTime(uv4:getConfig(&quot;time&quot;)))

				uv0.cardtimer[uv1] = Timer.New(function ()
					uv0:updateTechnology(uv1)
				end, uv5 - uv7 - uv6)

				uv0.cardtimer[uv1]:Start()
			elseif uv6 &lt; uv5 then
				slot4.blue = true

				setText(slot1, setColorStr(i18n(&quot;technology_queue_processing&quot;), slot2[1]))

				uv0.cardtimer[uv1] = Timer.New(function ()
					if pg.TimeMgr.GetInstance():GetServerTime() &lt; uv0.time then
						setText(uv1, pg.TimeMgr.GetInstance():DescCDTime(slot0 - slot1))
					else
						uv2:updateTechnology(uv0)
					end
				end, 1, -1)

				uv0.cardtimer[uv1]:Start()
				uv0.cardtimer[uv1].func()
			else
				slot4.green = true

				if uv4:isCompleted() then
					setText(slot1, setColorStr(i18n(&quot;technology_queue_complete&quot;), slot2[1]))
				else
					setText(slot1, setColorStr(i18n(&quot;technology_mission_unfinish&quot;), slot2[1]))
				end

				setText(slot0, &quot;00:00:00&quot;)
			end

			slot6 = uv2

			eachChild(slot6:Find(&quot;frame/marks/line&quot;), function (slot0)
				setActive(slot0, uv0[slot0.name])
			end)
		end,
		queue = function ()
			if uv0.queueCardTimer[uv1] then
				uv0.queueCardTimer[uv1]:Stop()

				uv0.queueCardTimer[uv1] = nil
			end

			slot1 = uv2:Find(&quot;frame/marks/Text&quot;)
			GetComponent(uv2:Find(&quot;frame/marks/time&quot;), &quot;Shadow&quot;).effectColor = Color.New(unpack(uv3.rarityColor[uv4:getConfig(&quot;bg&quot;)][2]))
			slot4 = {}

			if uv5 &lt;= 0 then
				assert(false, &quot;error queue&quot;)
			elseif uv6 &lt; uv5 - uv7 then
				slot4.blue = true

				setText(slot1, setColorStr(i18n(&quot;technology_queue_waiting&quot;), slot2[1]))
				setText(slot0, pg.TimeMgr.GetInstance():DescCDTime(uv4:getConfig(&quot;time&quot;)))
			elseif uv6 &lt; uv5 then
				slot4.blue = true

				setText(slot1, setColorStr(i18n(&quot;technology_queue_processing&quot;), slot2[1]))

				uv0.queueCardTimer[uv1] = Timer.New(function ()
					if pg.TimeMgr.GetInstance():GetServerTime() &lt; uv0.time then
						setText(uv1, pg.TimeMgr.GetInstance():DescCDTime(slot0 - slot1))
					end
				end, 1, -1)

				uv0.queueCardTimer[uv1]:Start()
				uv0.queueCardTimer[uv1].func()
			else
				slot4.green = true

				setText(slot1, setColorStr(i18n(&quot;technology_queue_complete&quot;), slot2[1]))
				setText(slot0, &quot;00:00:00&quot;)
			end

			eachChild(uv2:Find(&quot;frame/marks/line&quot;), function (slot0)
				setActive(slot0, uv0[slot0.name])
			end)
			setActive(uv2:Find(&quot;frame/mask&quot;), uv5 &gt; 0 and uv6 &lt; uv5 - uv7)
		end,
		desc = function ()
			uv0.descTxt.text = uv1:getConfig(&quot;desc&quot;)
			uv0.descBG.sprite = GetSpriteFromAtlas(&quot;ui/TechnologyUI_atlas&quot;, uv1:getConfig(&quot;rarity&quot;))
			slot0 = uv1:getConfig(&quot;consume&quot;)
			slot1 = UIItemList.New(uv0.itemContainer, uv0.itemTpl)

			slot1:make(function (slot0, slot1, slot2)
				slot1 = slot1 + 1

				if slot0 == UIItemList.EventUpdate then
					uv0:updateItem(slot2, uv1, uv2[slot1])
					setActive(slot2:Find(&quot;check&quot;), uv1:isActivate())
					setActive(slot2:Find(&quot;icon_bg/count&quot;), not uv1:isActivate())
				end
			end)
			slot1:align(#slot0)
			setActive(uv0.emptyTF, not slot0 or #slot0 &lt;= 0)

			if uv1:getConfig(&quot;condition&quot;) &gt; 0 then
				slot3 = getProxy(TaskProxy):getTaskById(slot2) or Task.New({
					id = slot2
				})
				uv0.taskSlider.value = slot3.progress / slot3:getConfig(&quot;target_num&quot;)
				uv0.taskDesc.text = slot3:getConfig(&quot;desc&quot;) .. &quot;(&quot; .. slot3.progress .. &quot;/&quot; .. slot3:getConfig(&quot;target_num&quot;) .. &quot;)&quot;
			else
				uv0.taskDesc.text = i18n(&quot;technology_task_none_tip&quot;)
				uv0.taskSlider.value = 0
			end

			if uv0.extraTimer then
				uv0.extraTimer:Stop()

				uv0.extraTimer = nil
			end

			slot3 = {}

			if uv2 &lt;= 0 then
				slot3.start_btn = true
				uv0.timerTxt.text = pg.TimeMgr.GetInstance():DescCDTime(uv3)
			elseif uv4 &lt; uv2 - uv3 then
				slot3.stop_btn = true
				slot3.join_btn = uv1:finishCondition()
				slot3.lock_join_btn = not slot3.join_btn
				uv0.timerTxt.text = pg.TimeMgr.GetInstance():DescCDTime(uv3)
			elseif uv4 &lt; uv2 then
				slot3.stop_btn = true
				slot3.join_btn = uv1:finishCondition()
				slot3.lock_join_btn = not slot3.join_btn
				uv0.extraTimer = Timer.New(function ()
					if pg.TimeMgr.GetInstance():GetServerTime() &lt; uv0 then
						uv1.timerTxt.text = pg.TimeMgr.GetInstance():DescCDTime(uv0 - slot0)
					end
				end, 1, -1)

				uv0.extraTimer:Start()
				uv0.extraTimer.func()
			else
				if uv1:isCompleted() then
					slot3.finish_btn = true
				else
					slot3.stop_btn = true
					slot3.lock_join_btn = true
				end

				uv0.timerTxt.text = &quot;00:00:00&quot;
			end

			slot5 = uv5

			eachChild(slot5:Find(&quot;frame/btns&quot;), function (slot0)
				setActive(slot0, uv0[slot0.name])
			end)

			slot4 = uv5
			slot4 = slot4:Find(&quot;frame/btns/start_btn&quot;)

			onButton(uv0, slot4, function ()
				if getProxy(TechnologyProxy):getActivateTechnology() then
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;technology_is_actived&quot;))

					return
				end

				if #uv0:getConfig(&quot;consume&quot;) &gt; 0 then
					pg.MsgboxMgr.GetInstance():ShowMsgBox({
						content = i18n(&quot;technology_task_build_tip&quot;, getDropInfo(slot0)),
						onYes = function ()
							uv0:emit(TechnologyMediator.ON_START, {
								id = uv1.id,
								pool_id = uv1.poolId
							})
						end
					})
				else
					uv1:emit(TechnologyMediator.ON_START, {
						id = uv0.id,
						pool_id = uv0.poolId
					})
				end
			end, SFX_PANEL)

			slot7 = uv1

			setButtonEnabled(slot4, slot7:hasResToStart())

			slot5 = uv5

			onButton(uv0, slot5:Find(&quot;frame/btns/stop_btn&quot;), function ()
				if not uv0:isActivate() then
					return
				end

				pg.MsgboxMgr.GetInstance():ShowMsgBox({
					content = i18n(&quot;technology_stop_tip&quot;),
					onYes = function ()
						uv0:emit(TechnologyMediator.ON_STOP, {
							id = uv1.id,
							pool_id = uv1.poolId
						})
					end
				})
			end, SFX_PANEL)

			slot6 = uv5

			onButton(uv0, slot6:Find(&quot;frame/btns/join_btn&quot;), function ()
				if #uv0.technologyQueue == TechnologyConst.QUEUE_TOTAL_COUNT then
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;technology_queue_full&quot;))

					return
				end

				pg.MsgboxMgr.GetInstance():ShowMsgBox({
					content = i18n(&quot;technology_queue_in_doublecheck&quot;),
					onYes = function ()
						uv0:emit(TechnologyMediator.ON_JOIN_QUEUE, {
							id = uv1.id,
							pool_id = uv1.poolId
						})
					end
				})
			end, SFX_PANEL)

			slot7 = uv5

			onButton(uv0, slot7:Find(&quot;frame/btns/lock_join_btn&quot;), function ()
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;technology_queue_in_mission_incomplete&quot;))
			end, SFX_PANEL)

			slot8 = uv5

			onButton(uv0, slot8:Find(&quot;frame/btns/finish_btn&quot;), function ()
				uv0:emit(TechnologyMediator.ON_FINISHED, {
					id = uv1.id,
					pool_id = uv1.poolId
				})
			end, SFX_PANEL)
		end
	})
end

slot0.dfs = function(slot0, slot1, slot2)
	if slot1.name ~= &quot;item_tpl&quot; then
		for slot6 = 1, slot1.childCount do
			slot0:dfs(slot1:GetChild(slot6 - 1), slot2)
		end
	else
		slot2(slot1)
	end
end

slot1 = {
	tag_red = &quot;F15F34FF&quot;,
	tag_blue = &quot;2541E3FF&quot;
}

slot0.updateInfo = function(slot0, slot1, slot2, slot3)
	setImageSprite(slot1:Find(&quot;frame&quot;), GetSpriteFromAtlas(&quot;technologycard&quot;, slot2:getConfig(&quot;bg&quot;) .. (slot3 == &quot;desc&quot; and &quot;_l&quot; or &quot;&quot;)))
	setImageSprite(slot1:Find(&quot;frame/icon_mask/icon&quot;), GetSpriteFromAtlas(&quot;technologyshipicon/&quot; .. slot2:getConfig(&quot;bg_icon&quot;), slot2:getConfig(&quot;bg_icon&quot;)), true)
	setImageSprite(slot1:Find(&quot;frame/top/label&quot;), GetSpriteFromAtlas(&quot;technologycard&quot;, slot2:getConfig(&quot;label&quot;)))
	setImageSprite(slot1:Find(&quot;frame/top/label/text&quot;), GetSpriteFromAtlas(&quot;technologycard&quot;, slot2:getConfig(&quot;label_color&quot;)), true)
	setImageSprite(slot1:Find(&quot;frame/top/label/version&quot;), GetSpriteFromAtlas(&quot;technologycard&quot;, &quot;version_&quot; .. slot2:getConfig(&quot;blueprint_version&quot;)), true)
	setImageColor(slot1:Find(&quot;frame/top/pick_up&quot;), Color.NewHex(uv0[slot2:getConfig(&quot;label&quot;)]))
	setText(slot1:Find(&quot;frame/name_bg/Text&quot;), slot2:getConfig(&quot;name&quot;))
	setText(slot1:Find(&quot;frame/sub_name&quot;), slot2:getConfig(&quot;sub_name&quot;) or &quot;&quot;)

	slot4 = slot2:getConfig(&quot;drop_client&quot;)
	slot6 = 0

	slot0:dfs(slot1:Find(&quot;frame/item_container&quot;), function (slot0)
		uv0 = uv0 + 1

		setActive(slot0, uv0 &lt;= #uv1)

		if uv0 &lt;= #uv1 then
			uv2:updateItem(slot0, uv3, uv1[uv0])
		end
	end)
	switch(slot3, {
		desc = function ()
		end
	}, function ()
		setActive(uv0:GetChild(1), #uv1 &gt; 2)

		uv0:GetChild(0):GetComponent(&quot;HorizontalLayoutGroup&quot;).padding.right = #uv1 == 4 and 25 or 0
		uv0:GetChild(1):GetComponent(&quot;HorizontalLayoutGroup&quot;).padding.left = #uv1 == 4 and 25 or 0
	end)
end

slot0.updateInfoVersionPickUp = function(slot0, slot1, slot2)
	setActive(slot1:Find(&quot;frame/top/pick_up&quot;), getProxy(TechnologyProxy):getTendency(2) == slot2:getConfig(&quot;blueprint_version&quot;))
end

slot0.updateItem = function(slot0, slot1, slot2, slot3)
	updateDrop(slot1, setmetatable({
		count = 0
	}, {
		__index = Drop.Create(slot3)
	}))

	if not IsNil(slot0:findTF(&quot;icon_bg/count&quot;, slot1)) then
		setColorCount(slot5, slot4:getOwnedCount(), slot4.count)
	end

	onButton(slot0, slot1, function ()
		if #(uv0:getConfig(&quot;display_icon&quot;) or {}) &gt; 0 then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				type = MSGBOX_TYPE_ITEM_BOX,
				items = _.map(slot0, function (slot0)
					return {
						type = slot0[1],
						id = slot0[2]
					}
				end),
				content = uv0:getConfig(&quot;display&quot;),
				itemFunc = function (slot0)
					uv0:emit(uv1.ON_DROP, slot0, function ()
						pg.MsgboxMgr.GetInstance():ShowMsgBox(uv0)
					end)
				end
			})

			return
		end

		uv1:emit(uv2.ON_DROP, uv0)
	end, SFX_PANEL)
end

slot0.updatePickUpVersionChange = function(slot0)
	slot0:updateSettingBtnVersion()

	for slot4, slot5 in ipairs(slot0.technologyCards) do
		slot0:updateInfoVersionPickUp(slot5, slot0.technologyVOs[slot4])
	end

	for slot4, slot5 in ipairs(slot0.technologyQueue) do
		slot0:updateInfoVersionPickUp(slot0.queueCardItemList.container:GetChild(slot4 - 1), slot5)
	end
end

slot0.clearTimer = function(slot0, ...)
	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end

	if slot0.extraTimer then
		slot0.extraTimer:Stop()

		slot0.extraTimer = nil
	end

	if slot0.enhancelTimer then
		slot0.enhancelTimer:Stop()

		slot0.enhancelTimer = nil
	end

	for slot4, slot5 in pairs(slot0.cardtimer) do
		slot5:Stop()
	end

	slot0.cardtimer = {}

	for slot4, slot5 in pairs(slot0.queueTimer) do
		slot5:Stop()
	end

	slot0.queueTimer = {}

	for slot4, slot5 in pairs(slot0.queueCardTimer) do
		slot5:Stop()
	end

	slot0.queueCardTimer = {}

	if slot0.actCatchupTimer then
		slot0.actCatchupTimer:Stop()

		slot0.actCatchupTimer = nil
	end
end

slot0.willExit = function(slot0)
	slot0:clearTimer()

	slot0.cardtimer = nil
	slot0.queueTimer = nil
	slot0.queueCardTimer = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>