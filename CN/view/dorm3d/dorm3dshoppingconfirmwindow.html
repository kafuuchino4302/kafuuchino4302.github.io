<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dorm3dshoppingconfirmwindow.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>dorm3dshoppingconfirmwindow.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;Dorm3dShoppingConfirmWindow&quot;, import(&quot;view.base.BaseUI&quot;))
slot0.SELECTED_WIDTH = 52
slot0.UNSELECTED_WIDTH = 12
slot0.LOOP_DURATION = 5

slot0.getUIName = function(slot0)
	return &quot;Dorm3dShopWindow&quot;
end

slot0.init = function(slot0)
	slot1 = slot0._tf
	slot0.previewTf = slot1:Find(&quot;Window/Preview&quot;)
	slot1 = slot0._tf
	slot0.bubbleContent = slot1:Find(&quot;Window/Bubbles/content&quot;)
	slot1 = slot0._tf
	slot0.bubbleTpl = slot1:Find(&quot;Window/Bubbles/tpl&quot;)
	slot0.bubbleList = UIItemList.New(slot0.bubbleContent, slot0.bubbleTpl)
	slot2 = slot0._tf
	slot3 = slot0._tf
	slot0.scrollSnap = BannerScrollRect4Dorm.New(slot2:Find(&quot;Window/banner/mask/content&quot;), slot3:Find(&quot;Window/banner/dots&quot;))

	setActive(slot0.bubbleTpl, false)
	switch(slot0.contextData.drop.__cname, {
		Dorm3dGift = function ()
			uv0.unlockTips = pg.dorm3d_gift[uv0.contextData.drop.configId].unlock_tips or {}
			slot0 = uv0.contextData.groupId
			slot1 = pg.dorm3d_gift[uv0.contextData.drop.configId].unlock_banners or {}
			slot2 = table.Find(slot1, function (slot0, slot1)
				if uv0 == nil or slot1[1] == uv0 then
					return true
				end
			end) or table.Find(slot1, function (slot0)
				if slot0[1] == 0 then
					return true
				end
			end)
			uv0.unlockBanners = slot2 and slot2[2]
			uv0.isExclusive = pg.dorm3d_gift[uv0.contextData.drop.configId].ship_group_id ~= 0
			uv0.addFavor = pg.dorm3d_favor_trigger[pg.dorm3d_gift[uv0.contextData.drop.configId].favor_trigger_id].num

			setActive(uv0._tf:Find(&quot;Window/Title/gift&quot;), true)
		end,
		Dorm3dFurniture = function ()
			uv0.unlockTips = pg.dorm3d_furniture_template[uv0.contextData.drop.configId].unlock_tips or {}
			uv0.unlockBanners = pg.dorm3d_furniture_template[uv0.contextData.drop.configId].unlock_banners or {}
			uv0.isExclusive = pg.dorm3d_furniture_template[uv0.contextData.drop.configId].is_exclusive == 1
			uv0.isSpecial = pg.dorm3d_furniture_template[uv0.contextData.drop.configId].is_special == 1

			setActive(uv0._tf:Find(&quot;Window/Title/furniture&quot;), true)
		end,
		Dorm3dSkin = function ()
			uv0.unlockTips = pg.dorm3d_resource[uv0.contextData.drop.configId].unlock_tips or {}
			uv0.unlockBanners = pg.dorm3d_resource[uv0.contextData.drop.configId].unlock_banners or {}

			setActive(uv0._tf:Find(&quot;Window/Title/skin&quot;), true)
		end
	})
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0._tf:Find(&quot;Window/Confirm&quot;), function ()
		uv0:closeView()
		existCall(uv0.contextData.onYes)
	end, SFX_PANEL)
	onButton(slot0, slot0._tf:Find(&quot;Window/Cancel&quot;), function ()
		uv0:closeView()
		existCall(uv0.contextData.onNo)
	end, SFX_CANCEL)
	onButton(slot0, slot0._tf:Find(&quot;Mask&quot;), function ()
		uv0:closeView()
		existCall(uv0.contextData.onClose)
	end)
	slot0:InitUIList()
	slot0:InitDropIcon()
	slot0:InitBanner()

	slot1 = nil

	switch(slot0.contextData.drop.__cname, {
		Dorm3dGift = function ()
			if uv0.contextData.content.weekLimit then
				uv1 = uv1 .. i18n(&quot;dorm3d_purchase_weekly_limit&quot;, slot0[1], slot0[2])
			end
		end,
		Dorm3dFurniture = function ()
			if uv0.contextData.endTime and slot0 &gt; 0 then
				slot2 = uv1
				uv0.timerRefreshTime = Timer.New(function ()
					setText(uv3._tf:Find(&quot;Window/Content&quot;), uv0 .. string.format(&quot;\n&lt;size=28&gt;&lt;color=#7c7e81&gt;%s&lt;/color&gt;&lt;color=#169fff&gt;%s&lt;/color&gt;&lt;/size&gt;&quot;, i18n(&quot;time_remaining_tip&quot;), uv1(uv2)))
				end, 1, -1)

				uv0.timerRefreshTime:Start()

				uv1 = uv1 .. string.format(&quot;\n&lt;size=28&gt;&lt;color=#7c7e81&gt;%s&lt;/color&gt;&lt;color=#169fff&gt;%s&lt;/color&gt;&lt;/size&gt;&quot;, i18n(&quot;time_remaining_tip&quot;), (function (slot0)
					if math.floor(math.max(slot0 - pg.TimeMgr.GetInstance():GetServerTime(), 0) / 86400) &gt; 0 then
						return slot3 .. i18n(&quot;word_date&quot;)
					elseif math.floor(slot2 / 3600) &gt; 0 then
						return slot4 .. i18n(&quot;word_hour&quot;)
					elseif math.floor(slot2 / 60) &gt; 0 then
						return slot5 .. i18n(&quot;word_minute&quot;)
					else
						return slot2 .. i18n(&quot;word_second&quot;)
					end
				end)(slot0))
			end
		end
	})
	setText(slot0._tf:Find(&quot;Window/Content&quot;), (slot0.contextData.content.cost ~= 0 or i18n(&quot;dorm3d_purchase_confirm_free&quot;, slot0.contextData.content.icon, &quot;x&quot; .. slot0.contextData.content.cost, slot0.contextData.content.name)) and (slot0.contextData.content.off &lt;= 0 or i18n(&quot;dorm3d_purchase_confirm_discount&quot;, slot0.contextData.content.icon, &quot;x&quot; .. slot0.contextData.content.cost, slot0.contextData.content.old, slot0.contextData.content.name)) and i18n(&quot;dorm3d_purchase_confirm_original&quot;, slot0.contextData.content.icon, &quot;x&quot; .. slot0.contextData.content.cost, slot0.contextData.content.name))
	setText(slot0._tf:Find(&quot;Window/Confirm/Text&quot;), i18n(&quot;msgbox_text_confirm&quot;))
	setText(slot0._tf:Find(&quot;Window/Cancel/Text&quot;), i18n(&quot;msgbox_text_cancel&quot;))
	pg.UIMgr.GetInstance():OverlayPanel(slot0._tf, {
		weight = LayerWeightConst.THIRD_LAYER
	})
end

slot0.InitBanner = function(slot0)
	for slot4 = 1, #slot0.unlockBanners do
		LoadImageSpriteAsync(&quot;dorm3dbanner/&quot; .. slot0.unlockBanners[slot4], slot0.scrollSnap:AddChild())
	end

	slot0.scrollSnap:SetUp()
end

slot0.InitUIList = function(slot0)
	slot0.bubbleList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventInit then
			slot4 = uv0.unlockTips[slot1 + 1]

			LoadImageSpriteAtlasAsync(&quot;ui/shoptip_atlas&quot;, &quot;icon_&quot; .. slot4, slot2:Find(&quot;icon/icon&quot;), true)
			setText(slot2:Find(&quot;bubble/Text&quot;), i18n(&quot;dorm3d_shop_tag&quot; .. slot4))
			setActive(slot2:Find(&quot;bubble&quot;), false)
			onToggle(uv0, slot2, function (slot0)
				setActive(uv0:Find(&quot;icon/select&quot;), slot0)
				setActive(uv0:Find(&quot;icon/unselect&quot;), not slot0)
				setActive(uv0:Find(&quot;bubble&quot;), slot0)
			end)
		end
	end)
	slot0.bubbleList:align(#slot0.unlockTips)
end

slot0.InitDropIcon = function(slot0)
	LoadImageSpriteAtlasAsync(slot0.contextData.drop:GetIcon(), &quot;&quot;, slot0._tf:Find(&quot;Window/Item/Dorm3dIconTpl/icon&quot;), true)
	GetImageSpriteFromAtlasAsync(&quot;weaponframes&quot;, &quot;dorm3d_&quot; .. ItemRarity.Rarity2Print(slot0.contextData.drop:GetRarity()), slot0._tf:Find(&quot;Window/Item/Dorm3dIconTpl&quot;))
	setActive(slot0._tf:Find(&quot;Window/Item/sp&quot;), slot0.isExclusive or slot0.isSpecial)

	if slot0.isSpecial then
		setText(slot0._tf:Find(&quot;Window/Item/sp/Text&quot;), i18n(&quot;dorm3d_purchase_label_special&quot;))
	elseif slot0.isExclusive then
		setText(slot0._tf:Find(&quot;Window/Item/sp/Text&quot;), i18n(&quot;dorm3d_purchase_confirm_tip&quot;))
	end

	if slot0.addFavor then
		setActive(slot0._tf:Find(&quot;Window/Item/gift&quot;), true)
		setText(slot0._tf:Find(&quot;Window/Item/gift/Text&quot;), &quot;+&quot; .. slot0.addFavor)
	end
end

slot0.willExit = function(slot0)
	if slot0.timerRefreshTime then
		slot0.timerRefreshTime:Stop()

		slot0.timerRefreshTime = nil
	end

	slot0.scrollSnap:Dispose()

	slot0.scrollSnap = nil

	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>