<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dorm3dmemorysubview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>dorm3dmemorysubview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;Dorm3dMemorySubView&quot;, import(&quot;view.base.BaseSubView&quot;))

slot0.OnLoaded = function(slot0)
	slot1 = slot0._tf:Find(&quot;list/container&quot;)
	slot0.itemList = UIItemList.New(slot1, slot1:Find(&quot;tpl&quot;))

	slot0.itemList:make(function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			setText(slot2:Find(&quot;name&quot;), uv0.unlockDic[pg.dorm3d_recall[uv0.ids[slot1]].story_id] and slot4.name or i18n(&quot;dorm3d_recall_locked&quot;))
			GetImageSpriteFromAtlasAsync(string.format(&quot;dorm3dmemory/%s_list&quot;, slot4.image), &quot;&quot;, slot2:Find(&quot;Image&quot;))
			setImageAlpha(slot2:Find(&quot;Image&quot;), slot5 and 1 or 0.6)
			onToggle(uv0, slot2, function (slot0)
				if slot0 then
					uv0:UpdateDisplay(uv1, uv2)
				end
			end, SFX_PANEL)
		end
	end)

	slot0.rtInfo = slot0._tf:Find(&quot;info&quot;)
end

slot0.OnInit = function(slot0)
	slot0.ids = getProxy(ApartmentProxy):getRoom(slot0.contextData.roomId):getConfig(&quot;recall_list&quot;)
	slot0.unlockDic = {}
	slot2 = {}
	slot3 = 0

	for slot7, slot8 in ipairs(slot0.ids) do
		if slot2[pg.dorm3d_dialogue_group[pg.dorm3d_recall[slot8].story_id].char_id] == nil then
			slot2[slot10] = getProxy(ApartmentProxy):getApartment(slot10) or false
		end

		slot0.unlockDic[slot9] = slot2[slot10] and slot2[slot10].talkDic[slot9] or false

		if slot0.unlockDic[slot9] then
			slot3 = slot3 + 1
		end
	end

	setText(slot0.rtInfo:Find(&quot;count&quot;), string.format(&quot;&lt;color=#285cfc&gt;%d&lt;/color&gt;/%d&quot;, slot3, #slot0.ids))
	slot0.itemList:align(#slot0.ids)
	triggerToggle(slot0.itemList.container:GetChild(0), true)
end

slot0.UpdateDisplay = function(slot0, slot1, slot2)
	slot3 = slot0.rtInfo:Find(&quot;content&quot;)
	slot4 = pg.dorm3d_recall[slot2]

	GetImageSpriteFromAtlasAsync(string.format(&quot;dorm3dmemory/%s_info&quot;, slot4.image), &quot;&quot;, slot3:Find(&quot;icon&quot;))
	setImageAlpha(slot3:Find(&quot;icon&quot;), slot0.unlockDic[slot4.story_id] and 1 or 0.25)
	setText(slot3:Find(&quot;icon/lock/Text&quot;), i18n(&quot;dorm3d_reload_unlock&quot;))
	setActive(slot3:Find(&quot;icon/lock&quot;), not slot5)
	setActive(slot3:Find(&quot;icon/play&quot;), slot5)
	onButton(slot0, slot3:Find(&quot;icon/play&quot;), function ()
		uv0:emit(Dorm3dCollectionMediator.DO_TALK, uv1.story_id)
	end, SFX_CONFIRM)
	setText(slot3:Find(&quot;pro/Text&quot;), &quot;is pro&quot;)
	setActive(slot3:Find(&quot;pro&quot;), slot4.type == 2)
	setImageAlpha(slot3:Find(&quot;name/bg&quot;), slot5 and 1 or 0)
	setActive(slot3:Find(&quot;name&quot;), slot5)
	setActive(slot3:Find(&quot;name_lock&quot;), not slot5)

	if slot5 then
		setText(slot3:Find(&quot;name/number&quot;), string.format(&quot;%02d.&quot;, slot1))
		setText(slot3:Find(&quot;name/Text&quot;), slot4.name)
		setText(slot3:Find(&quot;name/Text/en&quot;), i18n(&quot;dorm3d_collection_title_en&quot;))
		setText(slot3:Find(&quot;desc&quot;), slot4.desc)
	else
		setText(slot3:Find(&quot;name_lock&quot;), i18n(&quot;dorm3d_reload_unlock_name&quot;))
		setText(slot3:Find(&quot;desc&quot;), slot4.unlock_text)
	end
end

slot0.OnDestroy = function(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>