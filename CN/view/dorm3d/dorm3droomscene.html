<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dorm3droomscene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>dorm3droomscene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;Dorm3dRoomScene&quot;, import(&quot;view.dorm3d.Dorm3dRoomTemplateScene&quot;))
slot0.NOTIFY_UI_STATE = &quot;Dorm3dRoomScene.NOTIFY_UI_STATE&quot;

slot0.getUIName = function(slot0)
	return &quot;Dorm3dMainUI&quot;
end

slot0.SetRoom = function(slot0, slot1)
	uv0.super.SetRoom(slot0, slot1)
	slot0:UpdateContactState()
end

slot0.SetApartment = function(slot0, slot1)
	slot0.apartment = slot1

	slot0:UpdateFavorDisplay()
end

slot0.init = function(slot0)
	uv0.super.init(slot0)

	slot0.videoPlayer = VoiceChatLoader.New(slot0._tf)

	Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 1)

	slot0.uiContianer = slot0._tf:Find(&quot;UI&quot;)
	slot1 = slot0.uiContianer:Find(&quot;base&quot;)

	onButton(slot0, slot1:Find(&quot;btn_back&quot;), function ()
		uv0:emit(BaseUI.ON_BACK)
	end, SFX_DORM_BACK)
	onButton(slot0, slot1:Find(&quot;btn_back/help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.help_dorm3d_info.tip
		})
	end, SFX_PANEL)

	slot0.rtFavorLevel = slot1:Find(&quot;top/favor_level&quot;)

	setActive(slot0.rtFavorLevel, slot0.room:isPersonalRoom())
	onButton(slot0, slot0.rtFavorLevel, function ()
		slot0 = {}

		uv0:emit(Dorm3dRoomMediator.OPEN_LEVEL_LAYER, {
			apartment = uv0.apartment,
			timeIndex = uv0.contextData.timeIndex,
			baseCamera = uv0.mainCameraTF,
			roomId = uv0.room:GetConfigID()
		})
	end, SFX_PANEL)
	onButton(slot0, slot1:Find(&quot;top/setting&quot;), function ()
		uv0:emit(Dorm3dRoomMediator.OPEN_SETTING_LAYER)
	end)
	onButton(slot0, slot1:Find(&quot;left/btn_photograph&quot;), function ()
		if #uv0.contextData.groupIds == 0 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;dorm3d_photo_no_role&quot;))

			return
		end

		slot0, slot1 = uv0:CheckSystemOpen(&quot;Photo&quot;)

		if not slot0 then
			pg.TipsMgr.GetInstance():ShowTips(slot1)

			return
		end

		if not uv0.apartment then
			slot2 = uv0.contextData.groupIds[1]

			for slot6, slot7 in pairs(uv0.ladyDict) do
				if slot7.ladyBaseZone == uv0:GetAttachedFurnitureName() then
					slot2 = slot6

					break
				end
			end

			uv0:SetApartment(getProxy(ApartmentProxy):getApartment(slot2))
		end

		slot2 = getProxy(Dorm3dChatProxy)

		slot2:TriggerEvent({
			{
				value = 1,
				event_type = uv0.contextData.timeIndex == 1 and 114 or 119,
				ship_id = uv0.apartment:GetConfigID()
			}
		})
		uv0:OutOfLazy(uv0.apartment:GetConfigID(), function ()
			uv0:emit(Dorm3dRoomMediator.OPEN_CAMERA_LAYER, uv0, uv0.apartment:GetConfigID())
		end)
	end, SFX_PANEL)
	onButton(slot0, slot1:Find(&quot;left/btn_collection&quot;), function ()
		slot0, slot1 = uv0:CheckSystemOpen(&quot;Collection&quot;)

		if not slot0 then
			pg.TipsMgr.GetInstance():ShowTips(slot1)

			return
		end

		setActive(uv1:Find(&quot;left/btn_collection/tip&quot;), false)
		PlayerPrefs.SetInt(&quot;apartment_collection_item&quot;, 0)
		PlayerPrefs.SetInt(&quot;apartment_collection_recall&quot;, 0)
		uv0:emit(Dorm3dRoomMediator.OPEN_COLLECTION_LAYER, uv0.room:GetConfigID())
	end, SFX_PANEL)
	onButton(slot0, slot1:Find(&quot;left/btn_furniture&quot;), function ()
		slot0, slot1 = uv0:CheckSystemOpen(&quot;Furniture&quot;)

		if not slot0 then
			pg.TipsMgr.GetInstance():ShowTips(slot1)

			return
		end

		uv0:RemoveExtraSystem({
			DormConst.EXTRA_SYSTEMS.FurnitureSlide
		})
		uv0:emit(Dorm3dRoomMediator.OPEN_FURNITURE_SELECT, {
			apartment = uv0.apartment
		})
	end, SFX_PANEL)

	if not slot0.room:isPersonalRoom() then
		slot2 = slot0:CheckSystemOpen(&quot;Furniture&quot;)

		setActive(slot1:Find(&quot;left/line_furniture&quot;), slot2)
		setActive(slot1:Find(&quot;left/btn_furniture&quot;), slot2)
	end

	onButton(slot0, slot1:Find(&quot;left/btn_accompany&quot;), function ()
		slot0, slot1 = uv0:CheckSystemOpen(&quot;Accompany&quot;)

		if not slot0 then
			pg.TipsMgr.GetInstance():ShowTips(slot1)

			return
		end

		slot3 = nil

		uv0:emit(Dorm3dRoomMediator.OPEN_ACCOMPANY_WINDOW, {
			groupId = uv0.apartment:GetConfigID(),
			confirmFunc = function (slot0)
				uv0 = slot0
			end
		}, function ()
			if uv0 then
				uv1:OutOfLazy(uv2, function ()
					uv0:EnterAccompanyMode(uv1)
				end)
			else
				uv1:CheckQueue()
			end
		end)
	end, SFX_PANEL)

	if not slot0.room:isPersonalRoom() then
		setActive(slot1:Find(&quot;left/line_accompany&quot;), false)
		setActive(slot1:Find(&quot;left/btn_accompany&quot;), false)
	end

	onButton(slot0, slot1:Find(&quot;left/btn_skin&quot;), function ()
		uv0:ActiveCamera(uv0.cameras[uv1.CAMERA.SKIN])
		uv0:emit(Dorm3dRoomMediator.OPEN_SKIN_SELECT_LAYER, uv0.apartment:GetConfigID(), uv0.ladyDict[uv0.apartment:GetConfigID()], nil, function ()
			uv0:ChangePlayerPosition()
			uv0:ActiveCamera(uv0.cameras[uv1.CAMERA.POV])
		end, false)
	end)

	if not slot0.room:isPersonalRoom() then
		setActive(slot1:Find(&quot;left/line_skin&quot;), false)
		setActive(slot1:Find(&quot;left/btn_skin&quot;), false)
	end

	onButton(slot0, slot1:Find(&quot;left/btn_invite&quot;), function ()
		uv0:emit(Dorm3dRoomMediator.OPEN_INVITE_WINDOW, uv0.room:GetConfigID(), underscore.rest(uv0.contextData.groupIds, 1))
	end, SFX_PANEL)

	if slot0.room:isPersonalRoom() then
		setActive(slot1:Find(&quot;left/line_invite&quot;), false)
		setActive(slot1:Find(&quot;left/btn_invite&quot;), false)
	end

	slot0.btnZone = slot1:Find(&quot;right/Zone&quot;)
	slot0.rtZoneList = slot1:Find(&quot;right/Zone/List&quot;)

	setActive(slot0.rtZoneList, false)
	onButton(slot0, slot0.btnZone, function ()
		setActive(uv0.rtZoneList, not isActive(uv0.rtZoneList))
	end, SFX_PANEL)
	UIItemList.StaticAlign(slot0.rtZoneList, slot0.rtZoneList:GetChild(0), #slot0.zoneDatas, function (slot0, slot1, slot2)
		if slot0 ~= UIItemList.EventUpdate then
			return
		end

		slot1 = slot1 + 1
		slot3 = uv0.zoneDatas[slot1]
		slot2.name = slot3:GetWatchCameraName()

		setText(slot2:Find(&quot;Name&quot;), slot3:GetName())
		setActive(slot2:Find(&quot;Line&quot;), slot1 &lt; #uv0.zoneDatas)
		onButton(uv0, slot2, function ()
			if uv0.uiState ~= &quot;base&quot; then
				return
			end

			setActive(uv0.rtZoneList, false)

			slot0 = {}

			if uv0.room:isPersonalRoom() and not uv0:GetBlackboardValue(uv0.ladyDict[uv0.apartment:GetConfigID()], &quot;inPending&quot;) then
				table.insert(slot0, function (slot0)
					uv0:OutOfLazy(uv0.apartment:GetConfigID(), slot0)
				end)
			end

			table.insert(slot0, function (slot0)
				uv0:ShiftZone(uv1, slot0)
			end)
			seriesAsync(slot0, function ()
				uv0:CheckQueue()
			end)
		end, SFX_PANEL)
	end)

	slot2 = slot0.uiContianer:Find(&quot;walk&quot;)
	slot3 = slot0.uiContianer:Find(&quot;ik&quot;)

	onButton(slot0, slot3:Find(&quot;btn_back&quot;), function ()
		if uv0.ikSpecialCall then
			uv0.ikSpecialCall = nil

			existCall(uv0.ikSpecialCall)
		else
			uv0:ExitTouchMode()
		end
	end, SFX_DORM_BACK)
	onButton(slot0, slot3:Find(&quot;btn_back_heartbeat&quot;), function ()
		uv0:ExitHeartbeatMode()
	end, SFX_DORM_BACK)
	setActive(slot3:Find(&quot;btn_back_heartbeat&quot;), false)
	onButton(slot0, slot3:Find(&quot;btn_back/help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = i18n(&quot;roll_gametip&quot;)
		})
	end, SFX_PANEL)
	onButton(slot0, slot3:Find(&quot;Right/btn_camera&quot;), function ()
		uv0:CycleIKCameraGroup()
	end, SFX_PANEL)
	onButton(slot0, slot3:Find(&quot;Right/MenuSmall&quot;), function ()
		setActive(uv0:Find(&quot;Right/MenuSmall&quot;), false)
		setActive(uv0:Find(&quot;Right/Menu&quot;), true)
	end, SFX_PANEL)
	onButton(slot0, slot3:Find(&quot;Right/Menu/Collapse&quot;), function ()
		setActive(uv0:Find(&quot;Right/Menu&quot;), false)
		setActive(uv0:Find(&quot;Right/MenuSmall&quot;), true)
	end, SFX_PANEL)
	onButton(slot0, slot3:Find(&quot;Right/Menu&quot;), function ()
		setActive(uv0:Find(&quot;Right&quot;), false)
		uv1:emit(Dorm3dRoomMediator.OPEN_SKIN_SELECT_LAYER, uv1.apartment:GetConfigID(), uv1.ladyDict[uv1.apartment:GetConfigID()], function (slot0, slot1, slot2)
			seriesAsync({
				function (slot0)
					uv0:SetIKState(false, slot0)
				end,
				function (slot0)
					uv0:SwitchCharacterSkin(uv1, uv2)
					uv3:SwitchIKConfig(uv0, uv0.ikConfig.id)
					uv3:SetIKState(true, slot0)
				end
			})
		end, function ()
			setActive(uv0:Find(&quot;Right&quot;), true)
		end, true)
	end, SFX_PANEL)

	slot4 = slot0._tf:Find(&quot;IKControl&quot;)
	slot0.ikTipsRoot = slot4:Find(&quot;Tips&quot;)

	setActive(slot0.ikTipsRoot, false)

	slot0.ikClickTipsRoot = slot4:Find(&quot;ClickTips&quot;)

	setActive(slot0.ikClickTipsRoot, false)

	slot0.ikHand = slot4:Find(&quot;Handler&quot;)

	setActive(slot0.ikHand, false)
	eachChild(slot0.ikHand, function (slot0)
		setActive(slot0, false)
	end)

	slot0.ikTextTipsRoot = slot4:Find(&quot;TextTips&quot;)

	setActive(slot0.ikTextTipsRoot, false)
	eachChild(slot0.ikTextTipsRoot, function (slot0)
		setActive(slot0, false)
	end)

	slot0.ikControlUI = slot4

	onButton(slot0, slot0.uiContianer:Find(&quot;accompany&quot;):Find(&quot;btn_back&quot;), function ()
		uv0:ExitAccompanyMode()
	end, SFX_DORM_BACK)

	slot0.unlockList = {}
	slot0.rtFavorUp = slot0._tf:Find(&quot;Toast/favor_up&quot;)

	slot0.rtFavorUp:GetComponent(&quot;DftAniEvent&quot;):SetEndEvent(function (slot0)
		setActive(uv0.rtFavorUp, false)

		if #uv0.unlockList &gt; 0 then
			setText(uv0.rtFavorUp:Find(&quot;Text&quot;), table.remove(uv0.unlockList, 1))
			setActive(uv0.rtFavorUp, true)
		end
	end)
	setActive(slot0.rtFavorUp, false)

	slot0.rtFavorUpDaily = slot0._tf:Find(&quot;Toast/favor_up_daily&quot;)

	setActive(slot0.rtFavorUpDaily, false)

	slot0.rtStaminaPop = slot0._tf:Find(&quot;Toast/stamina&quot;)
	slot6 = slot0.rtStaminaPop:GetComponent(&quot;DftAniEvent&quot;)

	slot6:SetTriggerEvent(function (slot0)
		slot1, slot2 = getProxy(ApartmentProxy):getStamina()

		setText(uv0.rtStaminaPop:Find(&quot;Text&quot;), string.format(&quot;%d/%d&quot;, slot1, slot2))
	end)
	slot6:SetEndEvent(function (slot0)
		setActive(uv0.rtStaminaPop, false)
	end)
	setActive(slot0.rtStaminaPop, false)

	slot0.rtLevelUpWindow = slot0._tf:Find(&quot;LevelUpWindow&quot;)

	setActive(slot0.rtLevelUpWindow, false)
	onButton(slot0, slot0.rtLevelUpWindow:Find(&quot;bg&quot;), function ()
		if uv0.isLock then
			return
		end

		uv0.isLock = true

		quickPlayAnimation(uv0.rtLevelUpWindow, &quot;anim_dorm3d_levelup_out&quot;)
		LeanTween.delayedCall(0.2, System.Action(function ()
			uv0.isLock = false

			setActive(uv0.rtLevelUpWindow, false)
			pg.UIMgr.GetInstance():UnOverlayPanel(uv0.rtLevelUpWindow, uv0._tf)
			existCall(uv0.levelUpCallback)
		end))
	end, SFX_PANEL)

	slot7 = slot0.uiContianer:Find(&quot;watch&quot;)

	onButton(slot0, slot7:Find(&quot;btn_back&quot;), function ()
		uv0:ExitWatchMode()
	end, SFX_DORM_BACK)
	onButton(slot0, slot7:Find(&quot;btn_back/help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = i18n(&quot;roll_gametip&quot;)
		})
	end, SFX_PANEL)

	slot0.rtStaminaDisplay = slot7:Find(&quot;stamina&quot;)
	slot0.rtRole = slot0.uiContianer:Find(&quot;watch/Role&quot;)

	onButton(slot0, slot0.rtRole:Find(&quot;Talk&quot;), function ()
		if #uv0.apartment:getFurnitureTalking(uv0.room:GetConfigID(), uv0.ladyDict[uv0.apartment:GetConfigID()].ladyBaseZone) == 0 then
			pg.TipsMgr.GetInstance():ShowTips(&quot;without topic&quot;)

			return
		end

		uv0:DoTalk(slot1[math.random(#slot1)], function ()
			uv0:emit(Dorm3dRoomMediator.TRIGGER_FAVOR, uv0.apartment.configId, getDorm3dGameset(&quot;drom3d_favir_trigger_talk&quot;)[1])
		end)
	end, SFX_DORM_CLICK)
	setText(slot0.rtRole:Find(&quot;Talk/bg/Text&quot;), i18n(&quot;dorm3d_talk&quot;))
	onButton(slot0, slot0.rtRole:Find(&quot;Touch&quot;), function ()
		getProxy(Dorm3dChatProxy):TriggerEvent({
			{
				value = 1,
				event_type = uv0.contextData.timeIndex == 1 and 111 or 116,
				ship_id = uv0.apartment:GetConfigID()
			},
			{
				value = 1,
				event_type = 156,
				ship_id = uv0.apartment:GetConfigID()
			}
		})
		uv0:EnterTouchPerformance()
	end, SFX_DORM_CLICK)
	setText(slot0.rtRole:Find(&quot;Touch/bg/Text&quot;), i18n(&quot;dorm3d_touch&quot;))
	onButton(slot0, slot0.rtRole:Find(&quot;Gift&quot;), function ()
		uv0:emit(uv0.SHOW_BLOCK)
		uv0:ActiveStateCamera(&quot;gift&quot;, function ()
			uv0:emit(uv0.HIDE_BLOCK)
		end)
		uv0:emit(Dorm3dRoomMediator.OPEN_GIFT_LAYER, {
			groupId = uv0.apartment:GetConfigID(),
			baseCamera = uv0.mainCameraTF
		})
	end, SFX_DORM_CLICK)
	setText(slot0.rtRole:Find(&quot;Gift/bg/Text&quot;), i18n(&quot;dorm3d_gift&quot;))
	onButton(slot0, slot0.rtRole:Find(&quot;MiniGame&quot;), function ()
		assert(not uv0.nowMiniGameId)

		uv0.nowMiniGameId = uv0.room:getMiniGames()[1]
		slot1 = uv0.ladyDict[uv0.apartment:GetConfigID()]
		slot2 = getProxy(Dorm3dChatProxy)

		slot2:TriggerEvent({
			{
				value = 1,
				event_type = uv0.contextData.timeIndex == 1 and 112 or 117,
				ship_id = uv0.apartment:GetConfigID()
			},
			{
				value = 1,
				event_type = 158,
				ship_id = uv0.apartment:GetConfigID()
			}
		})
		table.insert({}, function (slot0)
			uv0:SetAllBlackbloardValue(&quot;inLockLayer&quot;, true)
			uv0:TempHideUI(true, slot0)
		end)

		if pg.dorm3d_minigame[uv0.nowMiniGameId].area ~= &quot;&quot; and slot1.ladyBaseZone ~= slot0.area then
			table.insert(slot2, function (slot0)
				uv0:ShiftZone(uv1.area, slot0)
			end)
		end

		slot3, slot4 = nil

		if slot0.action ~= &quot;&quot; then
			slot3, slot4 = unpack(slot0.action)
		end

		table.insert(slot2, function (slot0)
			parallelAsync({
				function (slot0)
					if uv0 then
						uv1:PlaySingleAction(uv2, uv0, slot0)
					else
						slot0()
					end
				end,
				function (slot0)
					uv0:ActiveStateCamera(&quot;talk&quot;, slot0)
				end
			}, slot0)
		end)
		table.insert(slot2, function (slot0)
			pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataMiniGame(1))
			uv0:HandleGameNotification(Dorm3dMiniGameMediator.OPERATION, {
				operationCode = &quot;BEFORE_OPEN_GAME&quot;,
				miniGameId = uv0.nowMiniGameId
			})
			uv0:EnableMiniGameCutIn()
			uv0:emit(Dorm3dRoomMediator.OPEN_MINIGAME_WINDOW, {
				isDorm3d = true,
				minigameId = uv0.nowMiniGameId
			}, slot0)
		end)
		table.insert(slot2, function (slot0)
			uv0:DisableMiniGameCutIn()

			if uv1 then
				uv0:PlaySingleAction(uv2, uv1, slot0)
			else
				slot0()
			end
		end)
		seriesAsync(slot2, function ()
			uv0:SetAllBlackbloardValue(&quot;inLockLayer&quot;, false)
			uv0:TempHideUI(false)

			uv0.nowMiniGameId = nil
		end)
	end, SFX_DORM_CLICK)
	setText(slot0.rtRole:Find(&quot;MiniGame/bg/Text&quot;), i18n(&quot;dorm3d_minigame_button1&quot;))

	if not slot0.room:isPersonalRoom() then
		slot10 = slot0.rtRole

		onButton(slot0, slot10:Find(&quot;PublicGame&quot;), switch(slot0.room.id, {
			[4] = function ()
				return function ()
					uv0:emit(Dorm3dRoomMediator.ENTER_VOLLEYBALL, uv0.apartment:GetConfigID())
				end
			end,
			[16] = function ()
				return function ()
					uv0:emit(Dorm3dRoomMediator.ENTER_DANCE, uv0.apartment:GetConfigID())
				end
			end
		}), SFX_DORM_CLICK)

		slot9 = slot0.rtRole

		setText(slot9:Find(&quot;PublicGame/bg/Text&quot;), switch(slot0.room.id, {
			[4] = function ()
				return i18n(&quot;dorm3d_volleyball_button&quot;)
			end,
			[16] = function ()
				return i18n(&quot;dorm3d_dance_button&quot;)
			end
		}))
	end

	slot10 = slot0.rtRole

	onButton(slot0, slot10:Find(&quot;Performance&quot;), function ()
		slot0 = uv0

		slot0:DoTalk(20500, function ()
			pg.TipsMgr.GetInstance():ShowTips(&quot;Success!&quot;)
		end)
	end, SFX_DORM_CLICK)

	slot8 = slot0._tf
	slot0.rtFloatPage = slot8:Find(&quot;FloatPage&quot;)
	slot8 = slot0.rtFloatPage
	slot0.tplFloat = slot8:Find(&quot;tpl&quot;)

	setActive(slot0.tplFloat, false)
	eachChild(cloneTplTo(slot0.tplFloat, slot0.rtFloatPage, &quot;lady&quot;), function (slot0)
		setActive(slot0, slot0.name == &quot;walk&quot;)
	end)

	slot9 = slot0._tf
	slot0._joystick = slot9:Find(&quot;Stick&quot;)

	setActive(slot0._joystick, false)

	slot9 = slot0._joystick
	slot9 = slot9:GetComponent(typeof(SlideController))

	slot9:SetStickFunc(function (slot0)
		uv0:emit(uv0.ON_STICK_MOVE, slot0)
	end)

	slot10 = slot0._tf
	slot0.povLayer = slot10:Find(&quot;POVControl&quot;)

	setActive(slot0.povLayer, false)
	(function ()
		slot0 = uv0.povLayer
		slot0 = slot0:Find(&quot;Move&quot;)
		slot0 = slot0:GetComponent(typeof(SlideController))

		slot0:AddBeginDragFunc(function (slot0, slot1)
			uv0:emit(uv0.ON_POV_STICK_MOVE_BEGIN, slot1)
		end)
		slot0:SetStickFunc(function (slot0)
			uv0:emit(uv0.ON_POV_STICK_MOVE, slot0)
		end)
		slot0:AddDragEndFunc(function (slot0, slot1)
			uv0:emit(uv0.ON_POV_STICK_MOVE_END, slot1)
		end)

		slot1 = uv0.povLayer
		slot1 = slot1:Find(&quot;View&quot;)
		slot1 = slot1:GetComponent(typeof(SlideController))

		slot1:SetStickFunc(function (slot0)
			uv0:emit(uv0.ON_POV_STICK_VIEW, slot0)
		end)
	end)()

	slot0.ikControlLayer = slot4:Find(&quot;ControlLayer&quot;)

	(function ()
		slot0 = nil
		slot1 = uv0.ikControlLayer
		slot1 = slot1:GetComponent(typeof(SlideController))

		slot1:AddBeginDragFunc(function (slot0, slot1)
			if not uv0.ladyDict[uv0.apartment:GetConfigID()].IKSettings then
				return
			end

			if CameraMgr.instance:Raycast(slot2.IKSettings.CameraRaycaster, slot1.position).Length ~= 0 then
				slot5 = slot4[0].gameObject.transform
				slot6 = table.keyof(slot2.IKSettings.Colliders, slot5)

				warning(slot5, slot6)

				if slot6 then
					uv0:emit(uv1.ON_BEGIN_DRAG_CHARACTER_BODY, slot2, slot6, slot3)

					uv2 = tobool(slot2.ikHandler)

					return
				end
			end
		end)
		slot1:AddDragFunc(function (slot0, slot1)
			slot2 = slot1.position

			if uv0.ladyDict[uv0.apartment:GetConfigID()].ikHandler then
				uv0:emit(uv1.ON_DRAG_CHARACTER_BODY, slot3, slot2)

				return
			end

			if uv2 then
				return
			end

			uv0:emit(uv0.ON_STICK_MOVE, slot1.delta)
		end)
		slot1:AddDragEndFunc(function (slot0, slot1)
			uv0 = nil

			if uv1.ladyDict[uv1.apartment:GetConfigID()].ikHandler then
				uv1:emit(uv2.ON_RELEASE_CHARACTER_BODY, slot2)

				return
			end
		end)
	end)()

	slot12 = slot0._tf
	slot0.rtExtraScreen = slot12:Find(&quot;ExtraScreen&quot;)
	slot12 = slot0.rtExtraScreen
	slot0.rtTouchGamePanel = slot12:Find(&quot;TouchGame&quot;)
	slot12 = slot0.rtExtraScreen
	slot0.rtTimelineScreen = slot12:Find(&quot;TimelineScreen&quot;)
	slot14 = slot0.rtTimelineScreen

	onButton(slot0, slot14:Find(&quot;btn_skip&quot;), function ()
		existCall(uv0.timelineFinishCall)
	end, SFX_CANCEL)

	slot0.uiStack = {}
	slot0.uiStore = {}
end

slot0.BindEvent = function(slot0)
	uv0.super.BindEvent(slot0)
	slot0:bind(slot0.CLICK_CHARACTER, function (slot0, slot1)
		if uv0.uiState ~= &quot;base&quot; or not uv0.ladyDict[slot1].nowCanWatchState then
			return
		end

		slot2 = {}

		if uv0:GetBlackboardValue(uv0.ladyDict[slot1], &quot;inPending&quot;) then
			table.insert(slot2, function (slot0)
				uv0:OutOfPending(uv1, slot0)
			end)
		else
			table.insert(slot2, function (slot0)
				uv0:OutOfLazy(uv1, slot0)
			end)
		end

		seriesAsync(slot2, function ()
			if not uv0.room:isPersonalRoom() then
				uv0:SetApartment(getProxy(ApartmentProxy):getApartment(uv1))
			end

			uv0:EnterWatchMode()
		end)
		pg.CriMgr.GetInstance():PlaySE_V3(&quot;ui-dorm_touch_v1&quot;)
	end)
	slot0:bind(slot0.CLICK_CONTACT, function (slot0, slot1)
		uv0:TriggerContact(slot1)
	end)
	slot0:bind(slot0.DISTANCE_TRIGGER, function (slot0, slot1, slot2)
		if uv0.uiState == &quot;base&quot; then
			uv0:CheckDistanceTalk(slot1, slot2)
		end
	end)
	slot0:bind(slot0.WALK_DISTANCE_TRIGGER, function (slot0, slot1, slot2)
		if uv0.apartment and uv0.apartment:GetConfigID() == slot1 then
			existCall(uv0.walkNearCallback, slot2)
		end
	end)
	slot0:bind(slot0.CHANGE_WATCH, function (slot0, slot1)
		uv0:ChangeCanWatchState(uv0.ladyDict[slot1])
	end)
	slot0:bind(slot0.ON_TOUCH_CHARACTER, function (slot0, slot1)
		if not uv0:GetBlackboardValue(uv0.ladyDict[uv0.apartment:GetConfigID()], &quot;inIK&quot;) then
			return
		end

		uv0:OnTouchCharacterBody(slot1)
	end)
	slot0:bind(uv0.ON_IK_STATUS_CHANGED, function (slot0, slot1, slot2)
		if not uv0:GetBlackboardValue(uv0.ladyDict[uv0.apartment:GetConfigID()], &quot;inTouching&quot;) then
			return
		end

		uv0:DoTouch(slot1, slot2)
	end)
	slot0:bind(slot0.ON_ENTER_SECTOR, function (slot0, slot1)
		uv0:ChangeCanWatchState(uv0.ladyDict[slot1])
	end)
	slot0:bind(slot0.ON_CHANGE_DISTANCE, function (slot0, slot1, slot2)
		uv0:ChangeCanWatchState(uv0.ladyDict[slot1])
	end)
end

slot0.didEnter = function(slot0)
	slot0.resumeCallback = slot0.contextData.resumeCallback
	slot0.contextData.resumeCallback = nil

	uv0.super.didEnter(slot0)
	slot0:UpdateZoneList()
	slot0:SetUI(function ()
		uv0:didEnterCheck()
	end, &quot;base&quot;)
end

slot0.FinishEnterResume = function(slot0)
	if not slot0.resumeCallback then
		return
	end

	slot0.resumeCallback = nil

	return slot0.resumeCallback()
end

slot0.EnableJoystick = function(slot0, slot1)
	setActive(slot0._joystick, slot1)
end

slot0.EnablePOVLayer = function(slot0, slot1)
	setActive(slot0.povLayer, slot1)

	if not slot1 then
		slot0:emit(slot0.ON_POV_STICK_MOVE_END)
	end
end

slot0.SetUIStore = function(slot0, slot1, ...)
	table.insertto(slot0.uiStore, {
		...
	})
	existCall(slot1)
end

slot0.SetUI = function(slot0, slot1, ...)
	while rawget(slot0, &quot;class&quot;) ~= uv0 do
		slot0 = getmetatable(slot0).__index
	end

	table.insertto(slot0.uiStore, {
		...
	})

	for slot5, slot6 in ipairs(slot0.uiStore) do
		if slot6 == &quot;back&quot; then
			assert(#slot0.uiStack &gt; 0)

			slot0.uiState = table.remove(slot0.uiStack)
		elseif slot6 ~= slot0.uiState or slot6 ~= &quot;ik&quot; then
			table.insert(slot0.uiStack, slot0.uiState)

			slot0.uiState = slot6
		end
	end

	pg.m02:sendNotification(uv0.NOTIFY_UI_STATE, slot0.uiState)

	slot0.uiStore = {}

	eachChild(slot0.uiContianer, function (slot0)
		setActive(slot0, slot0.name == uv0.uiState)
	end)
	slot0:EnablePOVLayer(slot0.uiState == &quot;base&quot; or slot0.uiState == &quot;walk&quot;)
	slot0:TempHideContact(slot0.uiState ~= &quot;base&quot;)
	slot0:SetFloatEnable(slot0.uiState == &quot;walk&quot;)
	setActive(slot0.rtFloatPage, slot0.uiState == &quot;walk&quot;)
	setActive(slot0.ikControlUI, slot0.uiState == &quot;ik&quot;)
	switch(slot0.uiState, {
		base = function ()
			if not uv0.room:isPersonalRoom() then
				uv0:SetApartment(nil)
			end

			uv0:UpdateBtnState()
		end,
		watch = function ()
			eachChild(uv0.rtRole, function (slot0)
				setActive(slot0, false)
			end)

			slot1 = 0.05

			for slot5, slot6 in ipairs(underscore.filter({
				&quot;Talk&quot;,
				&quot;Touch&quot;,
				&quot;Gift&quot;,
				&quot;MiniGame&quot;,
				&quot;PublicGame&quot;,
				&quot;Performance&quot;
			}, function (slot0)
				return uv0:CheckSystemOpen(slot0)
			end)) do
				LeanTween.delayedCall(slot1, System.Action(function ()
					setActive(uv0.rtRole:Find(uv1), true)
				end))

				slot1 = slot1 + 0.066
			end

			setActive(uv0.rtRole:Find(&quot;Gift/bg/Tip&quot;), Dorm3dGift.NeedViewTip(uv0.apartment:GetConfigID()))
		end,
		ik = function ()
			setActive(uv0.uiContianer:Find(&quot;ik/Right/MenuSmall&quot;), uv0.room:isPersonalRoom() and not uv0.performanceInfo)
			setActive(uv0.uiContianer:Find(&quot;ik/Right/Menu&quot;), false)
		end,
		walk = function ()
			setText(uv0.uiContianer:Find(&quot;walk/dialogue/content&quot;), i18n(&quot;dorm3d_removable&quot;, uv0.apartment:getConfig(&quot;name&quot;)))
		end
	})
	slot0:ActiveStateCamera(slot0.uiState, function ()
		if uv0 then
			uv0()
		elseif uv1.uiState == &quot;base&quot; then
			uv1:CheckQueue()
		end
	end)
end

slot0.EnterWatchMode = function(slot0)
	slot1 = slot0.apartment
	slot1 = slot1:GetConfigID()

	seriesAsync({
		function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)
			uv0:SetBlackboardValue(uv0.ladyDict[uv1], &quot;inWatchMode&quot;, true)
			uv0:SetUI(slot0, &quot;watch&quot;)
		end,
		function (slot0)
			uv0:emit(uv0.HIDE_BLOCK)
		end
	})
end

slot0.ExitWatchMode = function(slot0)
	slot1 = slot0.apartment
	slot1 = slot1:GetConfigID()

	seriesAsync({
		function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)
			uv0:SetUI(slot0, &quot;back&quot;)
		end,
		function (slot0)
			uv0:SetBlackboardValue(uv0.ladyDict[uv1], &quot;inWatchMode&quot;, false)
			uv0:emit(uv0.HIDE_BLOCK)
			uv0:CheckQueue()
		end
	})
end

slot0.SetInPending = function(slot0, slot1, slot2)
	slot3 = slot0:GetBlackboardValue(slot1, &quot;groupId&quot;)
	slot4 = pg.dorm3d_welcome[slot2]

	slot0:SetBlackboardValue(slot1, &quot;inPending&quot;, true)
	slot0:ChangeCanWatchState(slot1)
	slot0:EnableHeadIK(slot1, false)

	slot0.contextData.ladyZone[slot3] = slot4.area

	slot1:SetZone(slot0.contextData.ladyZone[slot3], slot4.welcome_staypoint)
	slot0:ChangeCharacterPosition(slot1)

	if slot4.item_shield ~= &quot;&quot; then
		slot0.hideItemDic = {}

		for slot8, slot9 in ipairs(slot4.item_shield) do
			if not slot0.modelRoot:Find(slot9) then
				warning(string.format(&quot;welcome:%d without hide item:%s&quot;, slot2, slot9))
			else
				slot0.hideItemDic[slot9] = isActive(slot10)

				setActive(slot10, false)
			end
		end
	end

	onNextTick(function ()
		if uv0.tfPendintItem then
			setActive(uv0.tfPendintItem, true)
		end

		uv1:SwitchAnim(uv0, uv2.welcome_idle)
	end)

	slot0.wakeUpTalkId = slot4.welcome_talk
end

slot0.SetOutPending = function(slot0, slot1)
	slot0:SetBlackboardValue(slot1, &quot;inPending&quot;, false)
	slot0:ChangeCanWatchState(slot1)
	slot0:EnableHeadIK(slot1, true)

	slot0.wakeUpTalkId = nil

	if slot1.tfPendintItem then
		setActive(slot1.tfPendintItem, false)
	end

	if slot0.hideItemDic then
		for slot5, slot6 in pairs(slot0.hideItemDic) do
			setActive(slot0.modelRoot:Find(slot5), slot6)
		end

		slot0.hideItemDic = nil
	end
end

slot0.IsModeInHidePending = function(slot0, slot1)
	for slot5, slot6 in pairs(slot0.ladyDict) do
		if slot6.hideItemDic and slot6.hideItemDic[slot1] ~= nil then
			return true
		end
	end

	return false
end

slot0.EnterAccompanyMode = function(slot0, slot1)
	slot3, slot4 = nil

	if pg.dorm3d_accompany[slot1].sceneInfo ~= &quot;&quot; then
		slot3, slot4 = unpack(string.split(slot2.sceneInfo, &quot;|&quot;))
	end

	slot5 = {
		type = &quot;timeline&quot;,
		name = slot2.timeline,
		scene = slot3,
		sceneRoot = slot4,
		accompanys = {}
	}

	for slot9, slot10 in ipairs(slot2.jump_trigger) do
		slot11, slot5.accompanys[slot11] = unpack(slot10)
	end

	slot6, slot7 = unpack(slot2.favor)

	getProxy(Dorm3dChatProxy):TriggerEvent({
		{
			value = 1,
			event_type = 161,
			ship_id = slot0.apartment:GetConfigID()
		}
	})
	getProxy(ApartmentProxy):RecordAccompanyTime()

	slot8 = pg.m02

	slot8:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataAccompany(1, slot2.ship_id, slot2.performance_time, 0, slot3 or slot0.dormSceneMgr.artSceneInfo))

	slot8 = {}

	table.insert(slot8, function (slot0)
		uv0:SetUI(slot0, &quot;blank&quot;, &quot;accompany&quot;)
	end)
	table.insert(slot8, function (slot0)
		uv0.accompanyFavorCount = 0
		uv0.accompanyFavorTimer = Timer.New(function ()
			uv0.accompanyFavorCount = uv0.accompanyFavorCount + 1
		end, uv1, -1)

		uv0.accompanyFavorTimer:Start()

		uv0.accompanyPerformanceTimer = Timer.New(function ()
			uv0.canTriggerAccompanyPerformance = true
		end, uv2.performance_time, -1)

		uv0.accompanyPerformanceTimer:Start()
		uv0:PlayTimeline(uv3, function (slot0, slot1)
			slot1()
			uv0()
		end)
	end)
	seriesAsync(slot8, function ()
		assert(uv0.accompanyFavorTimer)
		uv0.accompanyFavorTimer:Stop()

		uv0.accompanyFavorTimer = nil

		assert(uv0.accompanyPerformanceTimer)
		uv0.accompanyPerformanceTimer:Stop()

		uv0.accompanyPerformanceTimer = nil
		uv0.canTriggerAccompanyPerformance = nil

		if math.min(uv0.accompanyFavorCount, getProxy(ApartmentProxy):getStamina()) &gt; 0 then
			slot1 = uv1[slot0]

			warning(slot1)
			uv0:emit(Dorm3dRoomMediator.TRIGGER_FAVOR, uv0.apartment.configId, slot1)
		end

		slot1 = 0

		if getProxy(ApartmentProxy):GetAccompanyTime() then
			slot1 = pg.TimeMgr.GetInstance():GetServerTime() - slot2
		end

		pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataAccompany(2, uv2.ship_id, uv2.performance_time, slot1, uv3 or uv0.dormSceneMgr.artSceneInfo))
		uv0:SetUI(nil, &quot;back&quot;, &quot;back&quot;)
	end)
end

slot0.ExitAccompanyMode = function(slot0)
	existCall(slot0.timelineFinishCall)
end

slot0.EnterTouchPerformance = function(slot0)
	if not slot0.room:getApartmentZoneConfig(slot0.ladyDict[slot0.apartment:GetConfigID()].ladyBaseZone, &quot;touch_performance&quot;, slot0.apartment:GetConfigID()) or slot2 == 0 then
		slot0:EnterTouchMode()
	else
		slot0:DoTalk(slot2)
	end
end

slot0.EnterTouchMode = function(slot0)
	if slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inTouching&quot;) then
		return
	end

	slot0.touchConfig = pg.dorm3d_touch_data[slot0.room:getApartmentZoneConfig(slot1.ladyBaseZone, &quot;touch_id&quot;, slot0.apartment:GetConfigID())]

	if not slot0.touchConfig then
		slot0:EnterTimelineTouchMode()

		return
	end

	slot0.inTouchGame = slot0.touchConfig.heartbeat_enable &gt; 0

	setActive(slot0.rtTouchGamePanel, slot0.inTouchGame)

	if slot0.inTouchGame then
		slot0.touchCount = 0
		slot0.touchLevel = 1
		slot0.lastCount = 0
		slot0.topCount = 0

		slot0:UpdateTouchGameDisplay()
		setSlider(slot0.rtTouchGamePanel:Find(&quot;slider&quot;), 0, 100, slot0.touchCount &gt;= 200 and 100 or slot0.touchCount % 100)
		quickPlayAnimation(slot0.rtTouchGamePanel, &quot;anim_dorm3d_touch_in&quot;)
		quickPlayAnimation(slot0.rtTouchGamePanel:Find(&quot;slider/icon&quot;), &quot;anim_dorm3d_touch_icon&quot;)

		slot0.downTimer = Timer.New(function ()
			slot0 = pg.dorm3d_set.reduce_interaction.key_value_int

			if uv0.touchLevel &gt; 1 then
				slot0 = pg.dorm3d_set.reduce_heartbeat.key_value_int
			end

			uv0:UpdateTouchCount(slot0)
		end, 1, -1)

		slot0.downTimer:Start()
	end

	slot3 = {}

	table.insert(slot3, function (slot0)
		uv0:SetBlackboardValue(uv1, &quot;inTouching&quot;, true)
		uv0:emit(uv0.SHOW_BLOCK)
		uv0:SetUI(slot0, &quot;blank&quot;)
	end)
	table.insert(slot3, function (slot0)
		uv0:SwitchIKConfig(uv1, uv0.touchConfig.ik_status[1])
		setActive(uv0.uiContianer:Find(&quot;ik/btn_back&quot;), true)
		uv0:SetIKState(true, slot0)
	end)
	table.insert(slot3, function (slot0)
		existCall(slot0)
	end)
	seriesAsync(slot3, function ()
		Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 0)
		uv0:emit(uv0.HIDE_BLOCK)
	end)
end

slot0.ExitTouchMode = function(slot0)
	if not slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inTouching&quot;) then
		return
	end

	if slot0.touchTimelineConfig then
		existCall(slot0.timelineFinishCall)

		return
	end

	slot2 = {}

	if slot0.inTouchGame then
		table.insert(slot2, function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)
			quickPlayAnimation(uv0.rtTouchGamePanel, &quot;anim_dorm3d_touch_out&quot;)
			onDelayTick(slot0, 0.5)
		end)
		table.insert(slot2, function (slot0)
			slot1 = 0

			for slot5, slot6 in ipairs(uv0.touchConfig.heartbeat_favor) do
				if uv0.topCount &lt; slot6[1] then
					break
				else
					slot1 = slot6[2]
				end
			end

			if slot1 &gt; 0 then
				uv0:emit(Dorm3dRoomMediator.TRIGGER_FAVOR, uv0.apartment.configId, slot1)
			end

			uv0.touchCount = nil
			uv0.touchLevel = nil
			uv0.topCount = nil

			if uv0.downTimer then
				uv0.downTimer:Stop()

				uv0.downTimer = nil
			end

			uv0.inTouchGame = false

			setActive(uv0.rtTouchGamePanel, false)
			Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 1)
			slot0()
		end)
	else
		table.insert(slot2, function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)

			if uv0.touchConfig.default_favor &gt; 0 then
				uv0:emit(Dorm3dRoomMediator.TRIGGER_FAVOR, uv0.apartment.configId, slot1)
			end

			Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 1)
			slot0()
		end)
	end

	table.insert(slot2, function (slot0)
		uv0.ikConfig = {
			character_position = uv0.ladyBaseZone,
			character_action = uv1.touchConfig.finish_action
		}

		uv1:SetIKState(false, slot0)
	end)
	table.insert(slot2, function (slot0)
		uv0.ikConfig = nil
		uv1.blockIK = nil

		uv1:SetUI(slot0, &quot;back&quot;)
	end)
	seriesAsync(slot2, function ()
		uv0:SetBlackboardValue(uv1, &quot;inTouching&quot;, false)
		uv0:emit(uv0.HIDE_BLOCK)

		uv0.touchConfig = nil
		uv0.touchExitCall = nil

		existCall(uv0.touchExitCall)
	end)
end

slot0.ChangeWalkScene = function(slot0, slot1, slot2, slot3)
	slot5 = slot0.apartment
	slot4 = slot0.ladyDict[slot5:GetConfigID()]

	seriesAsync({
		function (slot0)
			uv0:ChangeArtScene(uv1, slot0)
		end,
		function (slot0)
			uv0:ChangeSubScene(uv1, slot0)
		end,
		function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)

			if uv1 == &quot;back&quot; then
				uv0:SetUI(slot0, &quot;back&quot;)
			elseif uv1 == &quot;change&quot; and uv0.uiState ~= &quot;walk&quot; then
				uv0:SetUI(slot0, &quot;walk&quot;)
			else
				slot0()
			end
		end
	}, function ()
		uv0:emit(uv0.HIDE_BLOCK)
		uv0:SetBlackboardValue(uv1, &quot;inWalk&quot;, uv2 == &quot;change&quot;)
		existCall(uv3)
	end)
end

slot0.EnterTimelineTouchMode = function(slot0)
	if slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inIK&quot;) then
		return
	end

	slot2 = slot0.room:getApartmentZoneConfig(slot1.ladyBaseZone, &quot;touch_id&quot;, slot0.apartment:GetConfigID())

	assert(pg.dorm3d_ik_timeline[slot2], &quot;Missing config in dorm3d_ik_timeline ID: &quot; .. (slot2 or &quot;nil&quot;))

	slot0.touchTimelineConfig = slot3
	slot4 = {}

	table.insert(slot4, function (slot0)
		uv0:SetBlackboardValue(uv1, &quot;inIK&quot;, true)
		uv0:emit(uv0.SHOW_BLOCK)
		uv0:SetUI(slot0, &quot;ik&quot;)
	end)
	table.insert(slot4, function (slot0)
		setActive(uv0.uiContianer:Find(&quot;ik/btn_back&quot;), true)
		setActive(uv0.uiContianer:Find(&quot;ik/Right/btn_camera&quot;), false)
		setActive(uv0.uiContianer:Find(&quot;ik/Right/Menu&quot;), false)
		setActive(uv0.uiContianer:Find(&quot;ik/Right/MenuSmall&quot;), false)
		Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 0)
		uv0:emit(uv0.HIDE_BLOCK)
		uv0:HideCharacterBylayer(uv1)
		setActive(uv1.ladyCollider, false)

		slot1, slot2 = nil

		if #uv2.scene &gt; 0 then
			slot1, slot2 = unpack(string.split(uv2.scene, &quot;|&quot;))
		end

		uv0:PlayTimeline({
			name = uv2.timeline,
			scene = slot1,
			sceneRoot = slot2
		}, function (slot0, slot1)
			slot1()
			uv0:ExitTimelineTouchMode()
		end)
	end)
	seriesAsync(slot4, function ()
	end)
end

slot0.ExitTimelineTouchMode = function(slot0)
	if not slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inIK&quot;) then
		return
	end

	slot0.touchTimelineConfig = nil
	slot2 = {}

	table.insert(slot2, function (slot0)
		uv0:emit(uv0.SHOW_BLOCK)
		Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 1)
		slot0()
	end)
	table.insert(slot2, function (slot0)
		uv0:RevertCharacterBylayer(uv1)
		setActive(uv1.ladyCollider, true)
		uv0:SetUI(slot0, &quot;back&quot;)
	end)
	seriesAsync(slot2, function ()
		uv0:SetBlackboardValue(uv1, &quot;inIK&quot;, false)
		uv0:emit(uv0.HIDE_BLOCK)
	end)
end

slot0.EnterWalkMode = function(slot0)
	slot1 = slot0.apartment
	slot2 = slot0.ladyDict[slot1:GetConfigID()]

	seriesAsync({
		function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)
			uv0:HideCharacter(uv1)
			uv0:SetBlackboardValue(uv2, &quot;inWalk&quot;, true)
			uv0:SetUI(slot0, &quot;walk&quot;)
		end,
		function (slot0)
			uv0:emit(uv0.HIDE_BLOCK)
			uv0:ChangeArtScene(uv0.walkInfo.scene .. &quot;|&quot; .. uv0.walkInfo.sceneRoot, slot0)
		end,
		function (slot0)
			uv0:LoadSubScene(uv0.walkInfo, slot0)
		end
	}, function ()
	end)
end

slot0.ExitWalkMode = function(slot0)
	slot1 = slot0.apartment
	slot2 = slot0.ladyDict[slot1:GetConfigID()]

	seriesAsync({
		function (slot0)
			uv0:RevertArtScene(uv0.walkLastSceneInfo, slot0)
		end,
		function (slot0)
			uv0:UnloadSubScene(uv0.walkInfo, slot0)
		end,
		function (slot0)
			uv0:emit(uv0.SHOW_BLOCK)
			uv0:SetUI(slot0, &quot;back&quot;)
		end
	}, function ()
		uv0:emit(uv0.HIDE_BLOCK)
		uv0:RevertCharacter(uv1)
		uv0:SetBlackboardValue(uv2, &quot;inWalk&quot;, false)

		uv0.walkExitCall = nil
		uv0.walkLastSceneInfo = nil
		uv0.walkInfo = nil

		existCall(uv0.walkExitCall)
	end)
end

slot0.EnableMiniGameCutIn = function(slot0)
	if not slot0.tfCutIn then
		return
	end

	slot1 = slot0.rtExtraScreen:Find(&quot;MiniGameCutIn&quot;)

	setActive(slot1, true)

	slot2 = GetOrAddComponent(slot1:Find(&quot;bg/mask/cut_in&quot;), &quot;CameraRTUI&quot;)

	setActive(slot2, true)
	pg.CameraRTMgr.GetInstance():Bind(slot2, slot0.tfCutIn:Find(&quot;TestCamera&quot;):GetComponent(typeof(Camera)))
	quickPlayAnimator(slot0.modelCutIn.lady, &quot;Idle&quot;)
	quickPlayAnimator(slot0.modelCutIn.player, &quot;Idle&quot;)
	setActive(slot0.tfCutIn, true)
end

slot0.DisableMiniGameCutIn = function(slot0)
	if not slot0.tfCutIn then
		return
	end

	slot1 = slot0.rtExtraScreen:Find(&quot;MiniGameCutIn&quot;)

	pg.CameraRTMgr.GetInstance():Clean(GetOrAddComponent(slot1:Find(&quot;bg/mask/cut_in&quot;), &quot;CameraRTUI&quot;))
	setActive(slot1, false)
	setActive(slot0.tfCutIn, false)
end

slot0.SwitchIKConfig = function(slot0, slot1, slot2)
	warning(&quot;switchIkstatus&quot;, slot2)

	if pg.dorm3d_ik_status[slot2].skin_id ~= slot1.skinId then
		slot5 = _.detect(pg.dorm3d_ik_status.get_id_list_by_base[slot3.base], function (slot0)
			return pg.dorm3d_ik_status[slot0].skin_id == uv0.skinId
		end)

		assert(slot5, string.format(&quot;Missing Status Config By Skin: %s original Status: %s&quot;, slot1.skinId, slot2))

		slot3 = pg.dorm3d_ik_status[slot5]
	end

	slot1.ikConfig = slot3
end

slot0.SetIKState = function(slot0, slot1, slot2)
	slot3 = slot0.ladyDict[slot0.apartment:GetConfigID()]
	slot4 = {}

	if slot1 then
		table.insert(slot4, function (slot0)
			uv0:SetBlackboardValue(uv1, &quot;inIK&quot;, true)
			uv0:emit(uv0.SHOW_BLOCK)
			setActive(uv0.uiContianer:Find(&quot;ik/Right/btn_camera&quot;), #pg.dorm3d_ik_status.get_id_list_by_camera_group[uv1.ikConfig.camera_group] &gt; 1)
			setActive(uv0.ikControlUI, true)
			slot0()
		end)

		if slot0.uiState ~= &quot;ik&quot; then
			table.insert(slot4, function (slot0)
				uv0:SetUI(slot0, &quot;ik&quot;)
			end)
		end

		table.insert(slot4, function (slot0)
			Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 0)
			uv0:SetIKStatus(uv1, uv1.ikConfig, slot0)
		end)
		table.insert(slot4, function (slot0)
			uv0:emit(uv0.HIDE_BLOCK)
			slot0()
		end)
	else
		assert(slot0.uiState == &quot;ik&quot;)
		table.insert(slot4, function (slot0)
			setActive(uv0.ikControlUI, false)
			uv0:emit(uv0.SHOW_BLOCK)
			Shader.SetGlobalFloat(&quot;_ScreenClipOff&quot;, 1)
			slot0()
		end)
		table.insert(slot4, function (slot0)
			uv0:ExitIKStatus(uv1, uv1.ikConfig, slot0)
			uv0:ResetSceneItemAnimators()
		end)
		table.insert(slot4, function (slot0)
			uv0:SetUI(slot0, &quot;back&quot;)
		end)
		table.insert(slot4, function (slot0)
			uv0:SetBlackboardValue(uv1, &quot;inIK&quot;, false)
			uv0:emit(uv0.HIDE_BLOCK)
			slot0()
		end)
	end

	seriesAsync(slot4, slot2)
end

slot0.TouchModeAction = function(slot0, slot1, slot2, slot3, ...)
	return switch(slot3, {
		function (slot0, slot1)
			return function (slot0)
				seriesAsync({
					function (slot0)
						if not uv0 or uv0 == &quot;&quot; then
							return slot0()
						end

						uv1:PlaySingleAction(uv2, uv0, slot0)
					end,
					function (slot0)
						uv0:SwitchIKConfig(uv1, uv2)
						uv0:SetIKState(true, slot0)
					end,
					slot0
				})
			end
		end,
		function ()
			return function ()
				if uv0.ikSpecialCall then
					uv0.ikSpecialCall = nil

					existCall(uv0.ikSpecialCall)
				else
					uv0:ExitTouchMode()
				end
			end
		end,
		function (slot0, slot1)
			return function (slot0)
				uv0:PlaySingleAction(uv1, uv2, slot0)
			end
		end,
		function (slot0, slot1, slot2)
			return function (slot0)
				seriesAsync({
					function (slot0)
						uv0:DoTalk(uv1, slot0)
					end,
					function (slot0)
						if not uv0 or uv0 == 0 then
							return slot0()
						end

						uv1:SwitchIKConfig(uv2, uv0)
						uv1:SetIKState(true, slot0)
					end,
					slot0
				})
			end
		end,
		function (slot0, slot1, slot2, slot3)
			return function (slot0)
				uv0:PlaySceneItemAnim(uv1, uv2)
				uv0:PlaySingleAction(uv3, slot0)
			end
		end,
		function (slot0)
			return function (slot0)
				if #pg.dorm3d_ik_touch[uv0].scene_item == 0 then
					return
				end

				if not uv1:GetSceneItem(slot1.scene_item) then
					warning(string.format(&quot;dorm3d_ik_touch:%d without scene_item:%s&quot;, uv0, slot1.scene_item))

					return
				end

				if not IsNil(slot2:Find(uv2)) then
					setActive(slot3, false)
					setActive(slot3, true)
				end

				slot0()
			end
		end,
		function (slot0)
			slot1 = pg.dorm3d_ik_touch_move[slot0]
			slot2 = slot1.target_ik
			slot3 = slot1.move_time
			slot4 = slot1.ik_point
			slot5 = slot1.touch_step
			uv0.IKSettings.forceMove = uv0.IKSettings.forceMove or {}
			slot6[slot2] = uv0.IKSettings.forceMove[slot2] or {}
			slot6[slot2].count = slot6[slot2].count or 0

			return function (slot0)
				seriesAsync({
					function (slot0)
						if uv0[uv1].count &gt;= #uv2 then
							return slot0()
						end

						slot1 = Dorm3dIK.New({
							configId = uv1
						})
						slot3 = uv0[uv1].count
						slot4 = uv2[slot3 + 1] - (slot3 == 0 and 0 or uv2[slot3])
						uv0[uv1].count = slot3 + 1

						pg.IKMgr.GetInstance():ResetIK(slot1:GetTriggerBoneName())
						pg.IKMgr.GetInstance():PlayIKMove(uv5.raycastCamera:WorldToScreenPoint(uv4.IKSettings.Colliders[slot1:GetTriggerBoneName()].position), slot1:GetTriggerBoneName(), Vector2.New(unpack(uv3)), uv2[slot3 + 1], uv6, function ()
							uv0[uv1].count = 0

							uv2()
						end)
					end,
					slot0
				})
			end
		end
	}, function ()
		return function ()
		end
	end, ...)
end

slot0.OnTriggerIK = function(slot0, slot1)
	if slot0.ladyDict[slot0.apartment:GetConfigID()].ikTimelineMode then
		slot0:ExitIKTimelineStatus(slot2)

		if slot1:GetTimelineAction() then
			slot0.nowTimelinePlayer:TriggerEvent(slot3)
		end

		return
	end

	if not slot2.ikConfig then
		return
	end

	if not slot2.ikActionDict[slot1:GetControllerPath()] then
		return
	end

	slot0.blockIK = true

	slot0:TouchModeAction(slot2, slot1:GetConfigID(), unpack(slot4))(function ()
		uv0:ResetIKTipTimer()

		uv0.blockIK = nil
	end)
end

slot0.OnTouchCharacterBody = function(slot0, slot1)
	if not slot0.ladyDict[slot0.apartment:GetConfigID()].ikConfig then
		return
	end

	if type(slot2.ikConfig.touch_data) ~= &quot;table&quot; then
		return
	end

	for slot6, slot7 in ipairs(slot2.iKTouchDatas) do
		slot8, slot9, slot10 = unpack(slot7)

		if pg.dorm3d_ik_touch[slot8].body == slot1 then
			if #slot11.action_emote &gt; 0 then
				slot0:PlayFaceAnim(slot2, slot12)
			end

			if type(slot11.vibrate) == &quot;table&quot; and VibrateMgr.Instance:IsSupport() then
				slot14 = {}
				slot15 = {}
				slot16 = {}

				underscore.each(slot13, function (slot0)
					slot1 = slot0[1]

					if PLATFORM == PLATFORM_IPHONEPLAYER then
						slot1 = slot1 / 1000
					end

					table.insert(uv0, slot1)
					table.insert(uv1, slot0[2])
					table.insert(uv2, 1)
				end)

				if PLATFORM == PLATFORM_ANDROID then
					VibrateMgr.Instance:VibrateWaveform(slot14, slot15)
				elseif PLATFORM == PLATFORM_IPHONEPLAYER then
					VibrateMgr.Instance:VibrateWaveform(slot14, slot15, slot16)
				end
			end

			slot0.blockIK = true

			slot0:TouchModeAction(slot2, slot8, unpack(slot10))(function ()
				uv0:ResetIKTipTimer()

				uv0.blockIK = nil
			end)

			return
		end
	end
end

slot0.UpdateTouchGameDisplay = function(slot0)
	setActive(slot0.rtTouchGamePanel:Find(&quot;effect_bg&quot;), slot0.touchLevel == 2)
	setActive(slot0.rtTouchGamePanel:Find(&quot;slider/icon/beating&quot;), slot0.touchLevel == 2)

	if slot0.touchLevel == 1 then
		setActive(slot0.uiContianer:Find(&quot;ik/btn_back&quot;), true)
		setActive(slot0.uiContianer:Find(&quot;ik/btn_back_heartbeat&quot;), false)
		quickPlayAnimation(slot0.rtTouchGamePanel, &quot;anim_dorm3d_touch_change_out&quot;)
		quickPlayAnimation(slot0.rtTouchGamePanel:Find(&quot;slider/icon&quot;), &quot;anim_dorm3d_touch_icon&quot;)
	elseif slot0.touchLevel == 2 then
		setActive(slot0.uiContianer:Find(&quot;ik/btn_back&quot;), false)
		setActive(slot0.uiContianer:Find(&quot;ik/btn_back_heartbeat&quot;), true)
		quickPlayAnimation(slot0.rtTouchGamePanel, &quot;anim_dorm3d_touch_change&quot;)
		quickPlayAnimation(slot0.rtTouchGamePanel:Find(&quot;slider/icon&quot;), &quot;anim_dorm3d_touch_icon_1&quot;)
		pg.CriMgr.GetInstance():PlaySE_V3(&quot;ui-dorm_heartbeat&quot;)
	end
end

slot0.UpdateTouchCount = function(slot0, slot1)
	if slot0.touchLevel &gt; 1 then
		slot1 = math.min(0, slot1)
	end

	slot0.touchCount = math.clamp(slot0.touchCount + slot1, 0, 100)

	if slot0.sliderLT and LeanTween.isTweening(slot0.sliderLT) then
		LeanTween.cancel(slot0.sliderLT)

		slot0.sliderLT = nil
	end

	setSlider(slot0.rtTouchGamePanel:Find(&quot;slider&quot;), 0, 100, slot0.touchCount)

	slot2 = nil

	if slot0.touchCount &gt;= 100 then
		slot2 = 2
	elseif slot0.touchCount &lt;= 0 then
		slot2 = 1
	end

	if slot2 and slot2 ~= slot0.touchLevel then
		if slot0.blockIK then
			return
		end

		slot0.touchLevel = slot2

		if slot0.touchConfig.ik_status[slot2] then
			if slot2 &gt; 1 then
				slot0.touchCount = 200
			elseif slot2 == 1 then
				slot0.touchCount = 0
			end

			slot5 = slot0.apartment
			slot4 = slot0.ladyDict[slot5:GetConfigID()]

			seriesAsync({
				function (slot0)
					uv0:ShowBlackScreen(true, slot0)
				end,
				function (slot0)
					uv0:SwitchIKConfig(uv1, uv2)
					uv0:SetIKState(true, slot0)

					if uv3 &gt; 1 and uv0.touchConfig.heartbeat_enter_anim ~= &quot;&quot; then
						uv0:SwitchAnim(uv1, uv0.touchConfig.heartbeat_enter_anim)
					end
				end,
				function (slot0)
					uv0:ShowBlackScreen(false, slot0)
				end
			})
		end

		slot0:UpdateTouchCount(0)
		slot0:UpdateTouchGameDisplay()
	end

	slot0.topCount = math.max(slot0.topCount, slot0.touchCount)
end

slot0.ExitHeartbeatMode = function(slot0)
	if not slot0.touchLevel or slot0.touchLevel == 1 then
		return
	end

	slot0.touchCount = 0

	slot0:UpdateTouchCount(0)
end

slot0.DoTouch = function(slot0, slot1, slot2)
	if slot0.inTouchGame then
		switch(slot2, {
			function ()
				uv0:UpdateTouchCount(pg.dorm3d_set.rapport_heartbeat.key_value_int)
			end,
			function ()
				uv0:UpdateTouchCount(pg.dorm3d_set.rapport_heartbeat.key_value_int)
			end,
			function ()
				uv0:UpdateTouchCount(pg.dorm3d_set.rapport_heartbeat.key_value_int)
			end,
			function ()
				uv0:UpdateTouchCount(pg.dorm3d_set.rapport_heartbeat_trriger.key_value_int)
			end
		})
	end
end

slot0.DoTalk = function(slot0, slot1, slot2)
	while rawget(slot0, &quot;class&quot;) ~= uv0 do
		slot0 = getmetatable(slot0).__index
	end

	if slot0.apartment and slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inTalking&quot;) then
		errorMsg(&quot;Talking block:&quot; .. slot1)

		return
	end

	if not slot0.room:isPersonalRoom() then
		slot3 = pg.dorm3d_dialogue_group[slot1].char_id

		if slot0.apartment then
			assert(slot0.apartment:GetConfigID() == slot3)
		else
			slot0:SetApartment(getProxy(ApartmentProxy):getApartment(slot3))
		end
	end

	slot3 = slot0.ladyDict[slot0.apartment:GetConfigID()]

	if slot1 == 10010 and not slot0.apartment.talkDic[slot1] then
		slot0.firstTimelineTouch = true
		slot0.firstMoveGuide = true
	end

	getProxy(Dorm3dChatProxy):TriggerEvent({
		{
			value = 1,
			event_type = slot0.contextData.timeIndex == 1 and 110 or 115,
			ship_id = slot0.apartment:GetConfigID()
		},
		{
			value = 1,
			event_type = 155,
			ship_id = slot0.apartment:GetConfigID()
		}
	})

	slot4 = {}

	if slot0:GetBlackboardValue(slot3, &quot;inPending&quot;) then
		table.insert(slot4, function (slot0)
			uv0:OutOfLazy(uv0.apartment:GetConfigID(), slot0)
		end)
	end

	slot6 = pg.dorm3d_dialogue_group[slot1].performance_type == 1
	slot7 = nil

	table.insert(slot4, function (slot0)
		uv0:emit(uv0.SHOW_BLOCK)

		slot1 = uv0

		slot1:SetBlackboardValue(uv1, uv2 and &quot;inPerformance&quot; or &quot;inTalking&quot;, true)
		uv0:emit(Dorm3dRoomMediator.DO_TALK, uv3, function (slot0)
			uv0 = slot0

			uv1()
		end)
	end)
	table.insert(slot4, function (slot0)
		pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataDialog(uv0.apartment.configId, uv0.apartment.level, uv1, uv2.type, uv0.room:getZoneConfig(uv0.ladyDict[uv0.apartment:GetConfigID()].ladyBaseZone, &quot;id&quot;), uv2.action_type, table.CastToString(uv2.trigger_config), uv0.room:GetConfigID()))

		if pg.NewGuideMgr.GetInstance():IsBusy() then
			pg.NewGuideMgr.GetInstance():Pause()
		end

		uv0:SetUI(slot0, &quot;blank&quot;)
	end)

	if slot5.trigger_area and slot5.trigger_area ~= &quot;&quot; then
		table.insert(slot4, function (slot0)
			uv0:ShiftZone(uv1.trigger_area, slot0)
		end)
	end

	if slot5.performance_type == 0 then
		table.insert(slot4, function (slot0)
			uv0:emit(uv0.HIDE_BLOCK)

			if uv0.contextData.isVideoTalk then
				slot1 = uv0.videoPlayer

				slot1:ExecuteAction(&quot;Play&quot;, uv1.story, function ()
					onDelayTick(uv0, 0.001)
				end)
			else
				slot1 = pg.NewStoryMgr.GetInstance()

				slot1:ForceManualPlay(uv1.story, function ()
					onDelayTick(uv0, 0.001)
				end, true)
			end
		end)
	elseif slot5.performance_type == 1 then
		table.insert(slot4, function (slot0)
			uv0:emit(uv0.HIDE_BLOCK)
			uv0:PerformanceQueue(uv1.story, slot0)
		end)
	else
		assert(false)
	end

	table.insert(slot4, function (slot0)
		uv0:emit(uv0.SHOW_BLOCK)
		slot0()
	end)
	table.insert(slot4, function (slot0)
		if pg.NewStoryMgr.GetInstance():StoryName2StoryId(uv0.story) then
			pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataStory(slot1, &quot;1&quot;))
		end

		if uv1 and #uv1 &gt; 0 then
			uv2:emit(Dorm3dRoomMediator.OPEN_DROP_LAYER, uv1, slot0)
		else
			slot0()
		end
	end)
	table.insert(slot4, function (slot0)
		if pg.NewGuideMgr.GetInstance():IsPause() then
			pg.NewGuideMgr.GetInstance():Resume()
		end

		uv0:emit(uv0.HIDE_BLOCK)

		if uv0.contextData.isVideoTalk then
			existCall(slot0)
		else
			uv0:SetBlackboardValue(uv1, uv2 and &quot;inPerformance&quot; or &quot;inTalking&quot;, false)
			uv0:SetUI(slot0, &quot;back&quot;)
		end
	end)
	seriesAsync(slot4, function ()
		if uv0 then
			return uv0()
		else
			uv1:CheckQueue()
		end
	end)
end

slot0.DoTalkTouchOption = function(slot0, slot1, slot2, slot3)
	slot4 = slot0.rtExtraScreen
	slot4 = slot4:Find(&quot;TalkTouchOption&quot;)
	slot5 = nil
	slot6 = slot4:Find(&quot;content&quot;)

	UIItemList.StaticAlign(slot6, slot6:Find(&quot;clickTpl&quot;), #slot1.options, function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0.options[slot1]

			setAnchoredPosition(slot2, NewPos(unpack(slot3.pos)))
			onButton(uv1, slot2, function ()
				uv0(uv1.flag)
			end, SFX_CONFIRM)
			setActive(slot2, not table.contains(uv3, slot3.flag))
		end
	end)
	setActive(slot4, true)

	slot5 = function(slot0)
		setActive(uv0, false)
		uv1(slot0)
	end
end

slot0.DoTimelineOption = function(slot0, slot1, slot2)
	slot3 = slot0.rtTimelineScreen
	slot3 = slot3:Find(&quot;TimelineOption&quot;)
	slot4 = nil
	slot5 = slot3:Find(&quot;content&quot;)

	UIItemList.StaticAlign(slot5, slot5:Find(&quot;clickTpl&quot;), #slot1, function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			setText(slot2:Find(&quot;Text&quot;), HXSet.hxLan(uv0[slot1].content))
			onButton(uv1, slot2, function ()
				uv0(uv1)
			end, SFX_CONFIRM)
		end
	end)
	setActive(slot3, true)

	slot4 = function(slot0)
		setActive(uv0, false)
		uv1(slot0)
	end
end

slot0.DoTimelineTouch = function(slot0, slot1, slot2)
	slot3 = slot0.rtTimelineScreen
	slot3 = slot3:Find(&quot;TimelineTouch&quot;)
	slot4 = nil
	slot5 = slot3:Find(&quot;content&quot;)

	UIItemList.StaticAlign(slot5, slot5:Find(&quot;clickTpl&quot;), #slot1, function (slot0, slot1, slot2)
		slot1 = slot1 + 1

		if slot0 == UIItemList.EventUpdate then
			setAnchoredPosition(slot2, NewPos(unpack(uv0[slot1].pos)))
			onButton(uv1, slot2, function ()
				uv0(uv1)
			end, SFX_CONFIRM)

			if uv1.firstTimelineTouch then
				uv1.firstTimelineTouch = nil

				setActive(slot2:Find(&quot;finger&quot;), true)
			end
		end
	end)
	setActive(slot3, true)

	slot4 = function(slot0)
		setActive(uv0, false)
		uv1(slot0)
	end
end

slot0.DoShortWait = function(slot0, slot1)
	slot3 = getProxy(ApartmentProxy):getApartment(slot1)

	if not (slot0.room:getApartmentZoneConfig(slot0.ladyDict[slot1].ladyBaseZone, &quot;special_action&quot;, slot1) and slot4[math.random(#slot4)] or nil) then
		return
	end

	slot0:PlaySingleAction(slot2, slot5)
end

slot0.OutOfLazy = function(slot0, slot1, slot2)
	slot4 = {}

	if slot0:GetBlackboardValue(slot0.ladyDict[slot1], &quot;inPending&quot;) then
		table.insert(slot4, function (slot0)
			uv0.shiftLady = uv1

			uv0:ShiftZone(uv2.ladyBaseZone, slot0)
		end)
	end

	seriesAsync(slot4, slot2)
end

slot0.OutOfPending = function(slot0, slot1, slot2)
	assert(slot0.wakeUpTalkId)

	slot3 = slot0.wakeUpTalkId

	seriesAsync({
		function (slot0)
			uv0:SetUI(slot0, &quot;blank&quot;)
		end,
		function (slot0)
			uv0.shiftLady = uv1

			uv0:ShiftZone(uv0.ladyDict[uv1].ladyBaseZone, slot0)
		end,
		function (slot0)
			uv0:DoTalk(uv1, slot0)
		end
	}, function ()
		uv0:SetUIStore(uv1, &quot;back&quot;)
	end)
end

slot0.ChangeCanWatchState = function(slot0, slot1)
	slot2 = nil
	slot2 = (not slot0:GetBlackboardValue(slot1, &quot;inPending&quot;) or tobool(slot0:GetBlackboardValue(slot1, &quot;inDistance&quot;))) and tobool(slot0.activeLady[slot0:GetBlackboardValue(slot1, &quot;groupId&quot;)] and pg.NodeCanvasMgr.GetInstance():GetBlackboradValue(&quot;canWatch&quot;, slot1.ladyBlackboard))

	if slot1.blockCanWatch then
		slot2 = false
	end

	if (not slot1.nowCanWatchState or slot1.nowCanWatchState ~= slot2) and slot1.ladyWatchFloat then
		slot1.nowCanWatchState = slot2

		slot0:ShowOrHideCanWatchMark(slot1, slot1.nowCanWatchState)
	end
end

slot0.HandleGameNotification = function(slot0, slot1, slot2)
	slot4 = slot0.apartment
	slot3 = slot0.ladyDict[slot4:GetConfigID()]

	switch(slot1, {
		[Dorm3dMiniGameMediator.OPERATION] = function ()
			slot0 = uv0.miniGameId

			switch(uv0.miniGameId, {
				[67] = function ()
					if uv0.operationCode == &quot;GAME_HIT_AREA&quot; then
						slot1, slot2 = unpack(({
							{
								&quot;Face_XYX_1&quot;,
								&quot;zhongji&quot;
							},
							{
								&quot;Face_XYX_2&quot;,
								&quot;qingji&quot;
							},
							{
								&quot;Face_XYX_3&quot;,
								&quot;miss&quot;
							}
						})[uv0.index])

						uv1:PlayFaceAnim(uv2, slot1)

						if uv1.tfCutIn then
							quickPlayAnimator(uv1.modelCutIn.lady, slot2)
							quickPlayAnimator(uv1.modelCutIn.player, slot2)
						end
					elseif uv0.operationCode == &quot;GAME_RESULT&quot; then
						if uv0.win then
							uv1:PlayFaceAnim(uv2, &quot;Face_XYX_victory&quot;)
							uv1:PlaySingleAction(uv2, &quot;minigame_win&quot;)
						else
							uv1:PlayFaceAnim(uv2, &quot;Face_XYX_lose&quot;)
							uv1:PlaySingleAction(uv2, &quot;minigame_lose&quot;)
						end

						setActive(uv1.rtExtraScreen:Find(&quot;MiniGameCutIn&quot;), false)
					end
				end,
				[70] = function ()
					if uv0.operationCode == &quot;GAME_READY&quot; then
						uv1.cameras[uv2.CAMERA.TALK].Follow = nil
						uv1.cameras[uv2.CAMERA.TALK].LookAt = nil

						uv1:PlaySingleAction(uv3, &quot;shuohua_sikao&quot;)
					elseif uv0.operationCode == &quot;ROUND_RESULT&quot; then
						slot0 = nil

						seriesAsync(underscore.map((not uv0.success or {
							&quot;shuohua_wenhou&quot;,
							&quot;shuohua_sikao&quot;
						}) and {
							&quot;shuohua_yaotou&quot;,
							&quot;shuohua_sikao&quot;
						}, function (slot0)
							return function (slot0)
								uv0:PlaySingleAction(uv1, uv2, slot0)
							end
						end), function ()
						end)
					elseif uv0.operationCode == &quot;GAME_RESULT&quot; then
						slot0 = uv1.cameras[uv2.CAMERA.TALK].transform
						slot0.position = slot0.position + slot0.right * 0.11

						seriesAsync(underscore.map({
							&quot;shuohua_gandong&quot;
						}, function (slot0)
							return function (slot0)
								uv0:PlaySingleAction(uv1, uv2, slot0)
							end
						end), function ()
						end)
					end
				end,
				[75] = function ()
					if uv0.operationCode == &quot;BEFORE_OPEN_GAME&quot; then
						uv1.cameras[uv2.CAMERA.TALK].Follow = nil
						uv1.cameras[uv2.CAMERA.TALK].LookAt = nil
					elseif uv0.operationCode == &quot;GAME_RPS_RESULT&quot; then
						if uv0.index == 1 then
							uv1:PlaySingleAction(uv3, &quot;ab_shuohua_lianxuyaotou_01&quot;)
							uv1:PlayFaceAnim(uv3, &quot;Face_weixiao&quot;)
						elseif uv0.index == 2 then
							uv1:PlaySingleAction(uv3, &quot;ab_shuohua_lianxudiantou_01&quot;)
							uv1:PlayFaceAnim(uv3, &quot;Face_kaixin&quot;)
						end
					elseif uv0.operationCode == &quot;GAME_RESULT&quot; then
						if not uv0.win then
							uv1:PlaySingleAction(uv3, &quot;ab_shuohua_taibangle_01&quot;)
						end

						uv1:PlayFaceAnim(uv3, &quot;Face_kaixin&quot;)
					end
				end
			}, function ()
				warning(&quot;without miniGameId:&quot; .. uv0.miniGameId)
			end)

			if uv0.operationCode == &quot;BEFORE_OPEN_GAME&quot; then
				slot1 = getProxy(PlayerProxy):getPlayerId()
				slot2 = 0
				uv1.highScore = (slot0 ~= 67 and slot0 ~= 70 or PlayerPrefs.GetInt(&quot;mg_new_score_&quot; .. tostring(slot1) .. &quot;_&quot; .. uv0.miniGameId, 0)) and PlayerPrefs.GetInt(&quot;mg_score_&quot; .. tostring(slot1) .. &quot;_&quot; .. uv0.miniGameId, 0)
			elseif uv0.operationCode == &quot;GAME_RESULT&quot; then
				slot2 = getProxy(PlayerProxy):getPlayerId()

				if uv1.highScore &lt; uv0.score then
					if slot0 == 67 or slot0 == 70 then
						PlayerPrefs.SetInt(&quot;mg_new_score_&quot; .. tostring(slot2) .. &quot;_&quot; .. uv0.miniGameId, slot1)
					end

					getProxy(Dorm3dChatProxy):TriggerEvent({
						{
							event_type = 159,
							value = slot1,
							ship_id = uv1.apartment:GetConfigID()
						}
					})
				end

				pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataMiniGame(2, uv0.score))
			elseif uv0.operationCode == &quot;GAME_CLOSE&quot; and uv0.doTrack == false then
				pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataMiniGame(3))
			end
		end
	})
end

slot0.PerformanceQueue = function(slot0, slot1, slot2)
	slot3, slot4 = pcall(function ()
		return require(&quot;GameCfg.dorm.&quot; .. uv0)
	end)

	if not slot3 then
		errorMsg(&quot;不存在表演ID对应的Lua:&quot; .. slot1)
		existCall(slot2)

		return
	end

	warning(slot1)

	slot0.performanceInfo = {
		name = slot1
	}
	slot5 = {}

	table.insert(slot5, function (slot0)
		uv0:SetUI(slot0, &quot;blank&quot;)
	end)
	table.insertto(slot5, underscore.map(slot4, function (slot0)
		return switch(slot0.type, {
			function ()
				return function (slot0)
					uv1:DoTalk(unpack(uv0.params), slot0, true)
				end
			end,
			function ()
				return function (slot0)
					uv0.touchExitCall = slot0

					uv0:EnterTouchMode()
				end
			end,
			function ()
				return function (slot0)
					uv0:PlaySingleAction(uv0.ladyDict[uv0.apartment:GetConfigID()], uv1.name, slot0)
				end
			end,
			function ()
				return function (slot0)
					uv0:emit(uv0.PLAY_EXPRESSION, uv1)
					slot0()
				end
			end,
			function ()
				return function (slot0)
					uv0:ShiftZone(uv1.name, slot0)
				end
			end,
			function ()
				return function (slot0)
					uv0.contextData.timeIndex = uv1.params[1]
					slot1 = uv1.params[2] or false

					if Dorm3dSceneMgr.IsSameSceneInfo(uv0.dormSceneMgr.artSceneInfo, uv0.dormSceneMgr.sceneInfo) then
						uv0:SwitchDayNight(uv0.contextData.timeIndex)

						if slot1 then
							onNextTick(function ()
								uv0:RefreshSlots()
							end)
						end
					end

					uv0:UpdateContactState()
					onNextTick(slot0)
				end
			end,
			function ()
				return function (slot0)
					if uv0.name then
						uv1:ActiveCameraByName(uv0.name)
						existCall(slot0)
					else
						uv1:ActiveStateCamera(uv0.params[1], slot0)
					end
				end
			end,
			function ()
				return function (slot0)
					if uv0.name == &quot;base&quot; then
						uv1:RevertArtScene(uv1.dormSceneMgr.sceneInfo, slot0)
					else
						uv1:ChangeArtScene(uv0.params.scene .. &quot;|&quot; .. uv0.params.sceneRoot, slot0)
					end
				end
			end,
			function ()
				return function (slot0)
					slot1 = uv0.params.name

					if uv0.name == &quot;load&quot; then
						uv1:LoadTimelineScene(slot1, true, tobool(uv0.params.wait_timeline) and function (slot0)
							uv0.waitForTimeline = slot0
						end, slot0)
					elseif uv0.name == &quot;unload&quot; then
						uv1:UnloadTimelineScene(slot1, true, slot0)
					else
						assert(false)
					end
				end
			end,
			function ()
				return function (slot0)
					setActive(uv0.uiContianer:Find(&quot;walk/btn_back&quot;), false)

					slot1 = uv0.ladyDict[uv0.apartment:GetConfigID()]

					if uv1.name == &quot;change&quot; then
						slot1.walkBornPoint = uv1.params.point or &quot;Default&quot;

						uv0:ChangeWalkScene(uv1.name, uv1.params.scene .. &quot;|&quot; .. uv1.params.sceneRoot, slot0)
					elseif uv1.name == &quot;back&quot; then
						slot1.walkBornPoint = nil

						uv0:ChangeWalkScene(uv1.name, uv0.dormSceneMgr.sceneInfo, slot0)
					else
						if uv1.name == &quot;set&quot; then
							slot2 = function()
								uv0 = nil

								return existCall(uv0)
							end

							for slot6, slot7 in pairs(uv1.params) do
								switch(slot6, {
									back_button_trigger = function (slot0)
										onButton(uv0, uv0.uiContianer:Find(&quot;walk/btn_back&quot;), uv1, SFX_DORM_BACK)
										setActive(uv0.uiContianer:Find(&quot;walk/btn_back&quot;), IsUnityEditor and slot0)
									end,
									near_trigger = function (slot0)
										if slot0 == true then
											slot0 = 1.5
										end

										if slot0 then
											uv0.walkNearCallback = function(slot0)
												if slot0 &lt; uv0 then
													uv1.walkNearCallback = nil

													uv2()
												end
											end
										else
											uv0.walkNearCallback = nil
										end
									end
								}, nil, slot7)
							end

							if uv0.firstMoveGuide then
								setActive(uv0.povLayer:Find(&quot;Guide&quot;), uv0.firstMoveGuide)

								uv0.firstMoveGuide = nil
							end

							return
						end

						assert(false)
					end
				end
			end,
			function ()
				return function (slot0)
					if uv0.name == &quot;set&quot; then
						uv1:SwitchIKConfig(uv1.ladyDict[uv1.apartment:GetConfigID()], uv0.params.state)
						setActive(uv1.uiContianer:Find(&quot;ik/btn_back&quot;), not uv0.params.hide_back)

						uv1.ikSpecialCall = slot0

						uv1:SetIKState(true)
					else
						if uv0.name == &quot;back&quot; then
							slot2 = uv1.apartment
							uv1.ladyDict[slot2:GetConfigID()].ikConfig = uv0.params
							slot2 = uv1

							slot2:SetIKState(false, function ()
								uv0.ikConfig = nil

								existCall(uv1)
							end)

							return
						end

						assert(false)
					end
				end
			end,
			function ()
				return function (slot0)
					uv0.blackSceneInfo = setmetatable(uv1.params or {}, {
						__index = {
							color = &quot;#000000&quot;,
							time = 0.3,
							delay = uv1.name == &quot;show&quot; and 0 or 0.5
						}
					})

					if uv1.name == &quot;show&quot; then
						uv0:ShowBlackScreen(true, slot0)
					elseif uv1.name == &quot;hide&quot; then
						uv0:ShowBlackScreen(false, slot0)
					else
						assert(false)
					end

					uv0.blackSceneInfo = nil
				end
			end
		})
	end))
	table.insert(slot5, function (slot0)
		uv0:SetUI(slot0, &quot;back&quot;)

		uv0.performanceInfo = nil
	end)
	seriesAsync(slot5, slot2)
end

slot0.TriggerContact = function(slot0, slot1)
	slot0:emit(Dorm3dRoomMediator.COLLECTION_ITEM, {
		itemId = slot1,
		roomId = slot0.room:GetConfigID(),
		groupId = slot0.room:isPersonalRoom() and slot0.apartment:GetConfigID() or 0
	})
end

slot0.UpdateContactState = function(slot0)
	slot0:SetContactStateDic(slot0.room:getTriggerableCollectItemDic(slot0.contextData.timeIndex))
end

slot0.UpdateFavorDisplay = function(slot0)
	slot1, slot2 = getProxy(ApartmentProxy):getStamina()

	setText(slot0.rtStaminaDisplay:Find(&quot;Text&quot;), string.format(&quot;%d/%d&quot;, slot1, slot2))
	setActive(slot0.rtStaminaDisplay, false)

	if slot0.apartment then
		setText(slot0.rtFavorLevel:Find(&quot;rank/Text&quot;), slot0.apartment.level)

		slot3, slot4 = slot0.apartment:getFavor()
		slot5 = slot0.apartment:isMaxFavor()

		setActive(slot0.rtFavorLevel:Find(&quot;Max&quot;), slot5)
		setActive(slot0.rtFavorLevel:Find(&quot;Text&quot;), not slot5)
		setText(slot0.rtFavorLevel:Find(&quot;Text&quot;), string.format(&quot;&lt;color=#ff6698&gt;%d&lt;/color&gt;/%d&quot;, slot3, slot4))
	end

	setActive(slot0.rtFavorLevel:Find(&quot;red&quot;), Dorm3dLevelLayer.IsShowRed())
end

slot0.UpdateBtnState = function(slot0)
	slot1 = not slot0.room:isPersonalRoom() or slot0:CheckSystemOpen(&quot;Furniture&quot;)
	slot2 = Dorm3dFurniture.IsTimelimitShopTip(slot0.room:GetConfigID())

	setActive(slot0.uiContianer:Find(&quot;base/left/btn_furniture/tipTimelimit&quot;), slot1 and slot2)
	setActive(slot0.uiContianer:Find(&quot;base/left/btn_furniture/tip&quot;), slot1 and not slot2 and Dorm3dFurniture.NeedViewTip(slot0.room:GetConfigID()))
	setActive(slot0.uiContianer:Find(&quot;base/btn_back/main&quot;), underscore(getProxy(ApartmentProxy):getRawData()):chain():values():filter(function (slot0)
		return tobool(slot0)
	end):any(function (slot0)
		return #slot0:getSpecialTalking() &gt; 0 or slot0:getIconTip() == &quot;main&quot;
	end):value())
	setActive(slot0.uiContianer:Find(&quot;base/left/btn_collection/tip&quot;), PlayerPrefs.GetInt(&quot;apartment_collection_item&quot;, 0) &gt; 0 or PlayerPrefs.GetInt(&quot;apartment_collection_recall&quot;, 0) &gt; 0)
end

slot0.AddUnlockDisplay = function(slot0, slot1)
	table.insert(slot0.unlockList, slot1)

	if not isActive(slot0.rtFavorUp) then
		setText(slot0.rtFavorUp:Find(&quot;Text&quot;), table.remove(slot0.unlockList, 1))
		setActive(slot0.rtFavorUp, true)
	end
end

slot0.PopFavorTrigger = function(slot0, slot1)
	slot3 = slot1.delta
	slot4 = slot1.cost
	slot5 = slot1.apartment

	if pg.dorm3d_favor_trigger[slot1.triggerId].is_repeat == 0 then
		if slot2 == getDorm3dGameset(&quot;drom3d_favir_trigger_onwer&quot;)[1] then
			slot0:AddUnlockDisplay(i18n(&quot;dorm3d_own_favor&quot;))
		elseif slot2 == getDorm3dGameset(&quot;drom3d_favir_trigger_propose&quot;)[1] then
			slot0:AddUnlockDisplay(i18n(&quot;dorm3d_pledge_favor&quot;))
		else
			slot0:AddUnlockDisplay(string.format(&quot;unknow favor trigger:%d unlock&quot;, slot2))
		end
	elseif slot1.delta &gt; 0 then
		slot7, slot8 = slot5:getFavor()
		slot9 = slot7 + slot3

		setText(slot0.rtFavorUpDaily:Find(&quot;bg/Text&quot;), string.format(&quot;&lt;size=48&gt;+%d&lt;/size&gt;&quot;, math.min(9999, slot3)))
		setSlider(slot0.rtFavorUpDaily:Find(&quot;bg/slider&quot;), 0, slot8, slot7)
		setAnchoredPosition(slot0.rtFavorUpDaily:Find(&quot;bg&quot;), slot1.isGift and NewPos(-354, 223) or NewPos(-208, 105))

		slot10 = {}

		eachChild(slot0.rtFavorUpDaily:Find(&quot;bg/effect&quot;), function (slot0)
			setActive(slot0, false)
		end)

		slot12 = nil

		if slot6.effect and slot6.effect ~= &quot;&quot; then
			if not slot11:Find(slot6.effect .. &quot;(Clone)&quot;) then
				table.insert(slot10, function (slot0)
					LoadAndInstantiateAsync(&quot;Dorm3D/Effect/Prefab/ExpressionUI&quot;, &quot;uifx_dorm3d_yinfu01&quot;, function (slot0)
						setParent(slot0, uv0)

						uv1 = tf(slot0)

						uv2()
					end)
				end)
			else
				setActive(slot12, true)
			end
		end

		slot13 = slot0.rtFavorUpDaily
		slot13 = slot13:GetComponent(&quot;DftAniEvent&quot;)

		slot13:SetTriggerEvent(function (slot0)
			slot1 = GetComponent(uv0.rtFavorUpDaily:Find(&quot;bg/slider&quot;), typeof(Slider))

			LeanTween.value(uv1, uv2, 0.5):setOnUpdate(System.Action_float(function (slot0)
				uv0.value = slot0
			end)):setEase(LeanTweenType.easeInOutQuad):setDelay(0.165):setOnComplete(System.Action(function ()
				LeanTween.delayedCall(0.165, System.Action(function ()
					if uv0.exited then
						return
					end

					quickPlayAnimator(uv0.rtFavorUpDaily, &quot;favor_out&quot;)
				end))
			end))
			pg.CriMgr.GetInstance():PlaySE_V3(&quot;ui-dorm_progaress_bar&quot;)
		end)
		slot13:SetEndEvent(function (slot0)
			setActive(uv0.rtFavorUpDaily, false)
		end)
		seriesAsync(slot10, function ()
			setLocalPosition(uv0.rtFavorUpDaily, uv0:GetLocalPosition(uv0:GetScreenPosition(uv0.ladyDict[uv1:GetConfigID()].ladyHeadCenter.position), uv0.rtFavorUpDaily.parent))
			setActive(uv0.rtFavorUpDaily, true)
			SetCompomentEnabled(uv0.rtFavorUpDaily, typeof(Animator), true)
			quickPlayAnimator(uv0.rtFavorUpDaily, &quot;favor_open&quot;)

			if uv2 &gt; 0 then
				slot1, slot2 = getProxy(ApartmentProxy):getStamina()

				setText(uv0.rtStaminaPop:Find(&quot;Text/Text (1)&quot;), &quot;-&quot; .. uv2)
				setText(uv0.rtStaminaPop:Find(&quot;Text&quot;), string.format(&quot;%d/%d&quot;, slot1 + uv2, slot2))
				setActive(uv0.rtStaminaPop, true)
			end
		end)
	end
end

slot0.PopFavorLevelUp = function(slot0, slot1, slot2, slot3)
	slot0.isLock = true

	LeanTween.delayedCall(0.33, System.Action(function ()
		uv0.isLock = false
	end))

	slot4 = math.floor(slot1.level / 10)

	GetImageSpriteFromAtlasAsync(&quot;ui/favor_atlas&quot;, math.fmod(slot1.level, 10), slot0.rtLevelUpWindow:Find(&quot;panel/bg/item1/mark/level/digit2&quot;))
	GetImageSpriteFromAtlasAsync(&quot;ui/favor_atlas&quot;, slot4, slot0.rtLevelUpWindow:Find(&quot;panel/bg/item1/mark/level/digit1&quot;))
	setActive(slot0.rtLevelUpWindow:Find(&quot;panel/bg/item1/mark/level/digit1&quot;), slot4 &gt; 0)

	slot6 = nil
	slot0.clientAward, slot6 = Dorm3dIconHelper.SplitStory(slot1:getFavorConfig(&quot;levelup_client_item&quot;, slot1.level))
	slot0.serverAward = slot2
	slot7 = slot0.rtLevelUpWindow:Find(&quot;panel/info/content/itemContent&quot;)

	if not slot0.levelItemList then
		slot0.levelItemList = UIItemList.New(slot7, slot7:Find(&quot;tpl&quot;))
		slot8 = slot0.levelItemList

		slot8:make(function (slot0, slot1, slot2)
			slot3 = slot1 + 1

			if slot0 == UIItemList.EventUpdate then
				if slot1 &lt; #uv0.serverAward then
					updateDorm3dIcon(slot2, uv0.serverAward[slot3])
					onButton(uv0, slot2, function ()
						uv0:emit(BaseUI.ON_NEW_DROP, {
							drop = uv0.serverAward[uv1]
						})
					end, SFX_PANEL)
				else
					Dorm3dIconHelper.UpdateDorm3dIcon(slot2, uv0.clientAward[slot3 - #uv0.serverAward])
					onButton(uv0, slot2, function ()
						uv0:emit(Dorm3dRoomMediator.ON_DROP_CLIENT, {
							data = uv0.clientAward[uv1 - #uv0.serverAward]
						})
					end, SFX_PANEL)
				end
			end
		end)
	end

	slot8 = slot0.levelItemList

	slot8:align(#slot0.serverAward + #slot0.clientAward)
	setActive(slot0.rtLevelUpWindow, true)

	slot8 = pg.CriMgr.GetInstance()

	slot8:PlaySE_V3(&quot;ui-dorm_upgrade&quot;)

	slot8 = pg.UIMgr.GetInstance()

	slot8:OverlayPanel(slot0.rtLevelUpWindow, {
		weight = LayerWeightConst.SECOND_LAYER,
		groupName = LayerWeightConst.GROUP_DORM3D
	})

	slot0.levelUpCallback = function()
		uv0.levelUpCallback = nil

		if uv1 then
			uv0:PopNewStoryTip(uv1)
		end

		existCall(uv2)
	end
end

slot0.PopNewStoryTip = function(slot0, slot1, slot2)
	slot3 = slot0.uiContianer:Find(&quot;base/top/story_tip&quot;)

	setActive(slot3, true)
	LeanTween.delayedCall(1, System.Action(function ()
		setActive(uv0, false)
	end))
	setText(slot3:Find(&quot;Text&quot;), i18n(&quot;dorm3d_story_unlock_tip&quot;, pg.dorm3d_recall[slot1[2]].name))
	existCall(slot2)
end

slot0.UpdateZoneList = function(slot0)
	slot1 = nil
	slot1 = (not slot0.room:isPersonalRoom() or slot0.ladyDict[slot0.apartment:GetConfigID()].ladyBaseZone) and slot0:GetAttachedFurnitureName()

	for slot5, slot6 in ipairs(slot0.zoneDatas) do
		if slot6:GetWatchCameraName() == slot1 then
			setText(slot0.btnZone:Find(&quot;Text&quot;), slot6:GetName())
			setTextColor(slot0.rtZoneList:GetChild(slot5 - 1):Find(&quot;Name&quot;), Color.NewHex(&quot;5CCAFF&quot;))
		else
			setTextColor(slot0.rtZoneList:GetChild(slot5 - 1):Find(&quot;Name&quot;), Color.NewHex(&quot;FFFFFF99&quot;))
		end
	end
end

slot0.TalkingEventHandle = function(slot0, slot1)
	slot2 = {}
	slot3 = {}

	if slot1.data.op_list then
		for slot8, slot9 in ipairs(slot4.op_list) do
			table.insert(slot2, function (slot0)
				slot1 = function()
					uv0 = nil

					return existCall(uv0)
				end

				switch(uv0.type, {
					action = function ()
						uv0:PlaySingleAction(uv0.ladyDict[uv0.apartment:GetConfigID()], uv1.name, uv2)
					end,
					item_action = function ()
						uv0:PlaySceneItemAnim(uv1.id, uv1.name)
						uv2()
					end,
					extra_item_action = function ()
						slot1 = uv0.ladyDict[uv0.apartment:GetConfigID()].extraItems[uv1.name]

						warning(uv1.name)
						warning(slot1.trans)

						if slot1 then
							slot1.trans:GetComponent(typeof(Animator)):PlayInFixedTime(uv1.param)
						end

						uv2()
					end,
					timeline = function ()
						if uv0.inTouchGame then
							setActive(uv0.rtTouchGamePanel, false)
						end

						slot0 = uv0

						slot0:PlayTimeline(uv1, function (slot0, slot1)
							setActive(uv0.rtTouchGamePanel, uv0.inTouchGame)

							uv1.notifiCallback = slot1

							uv2()
						end)
					end,
					clickOption = function ()
						slot0 = uv0

						slot0:DoTalkTouchOption(uv1, uv2.flags, function (slot0)
							uv0.optionIndex = slot0

							uv1()
						end)
					end,
					wait = function ()
						uv0.LTs = uv0.LTs or {}

						table.insert(uv0.LTs, LeanTween.delayedCall(uv1.time, System.Action(uv2)).uniqueId)
					end,
					expression = function ()
						uv0:emit(uv0.PLAY_EXPRESSION, uv1)
						uv2()
					end
				}, function ()
					assert(false, &quot;op type error:&quot;, uv0.type)
				end)

				if uv0.skip then
					slot1()
				end
			end)
		end
	end

	seriesAsync(slot2, function ()
		if uv0.callbackData then
			uv1:emit(Dorm3dRoomMediator.TALKING_EVENT_FINISH, uv0.callbackData.name, uv2)
		end
	end)
end

slot0.CheckQueue = function(slot0)
	if slot0.inGuide or slot0.uiState ~= &quot;base&quot; then
		return
	end

	if slot0.room:GetConfigID() == 1 and slot0:CheckGuide() then
		-- Nothing
	elseif slot0.room:isPersonalRoom() and slot0:CheckLevelUp() then
		-- Nothing
	elseif slot0.apartment and slot0:CheckEnterDeal() then
		-- Nothing
	elseif slot0.apartment and slot0:CheckActiveTalk() then
		-- Nothing
	elseif slot0.apartment then
		slot0:CheckFavorTrigger()
	end

	slot0.contextData.hasEnterCheck = true
end

slot0.didEnterCheck = function(slot0)
	slot1 = nil

	if slot0.contextData.specialId then
		slot0.contextData.specialId = nil

		slot0:DoTalk(slot0.contextData.specialId, function ()
			uv0:closeView()
		end)

		if slot0.contextData.isVideoTalk then
			slot0.contextData.hasEnterCheck = true
		end
	elseif not slot0.contextData.hasEnterCheck and slot0.apartment then
		slot5 = slot0.room
		slot6 = slot5
		slot5 = slot5.GetConfigID

		for slot5, slot6 in ipairs(slot0.apartment:getForceEnterTalking(slot5(slot6))) do
			slot1 = slot6

			slot0:DoTalk(slot6)

			break
		end
	end

	if slot1 and pg.dorm3d_dialogue_group[slot1].extend_loading &gt; 0 then
		slot0.contextData.hasEnterCheck = true
		slot2 = pg.SceneAnimMgr.GetInstance()

		slot2:RegisterDormNextCall(function ()
			uv0:FinishEnterResume()
		end)
	else
		if slot0.apartment and slot0.contextData.pendingDic[slot0.apartment:GetConfigID()] then
			slot0.contextData.hasEnterCheck = true
		end

		for slot5, slot6 in pairs(slot0.contextData.pendingDic) do
			slot0:SetInPending(slot0.ladyDict[slot5], slot6)
		end

		slot0.contextData.pendingDic = {}

		slot0:FinishEnterResume()
		slot0:CheckQueue()
	end
end

slot0.CheckGuide = function(slot0)
	if slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inPending&quot;) then
		return
	end

	slot4 = function()
		return uv0:CheckSystemOpen(&quot;DayNight&quot;)
	end

	for slot4, slot5 in ipairs({
		{
			name = &quot;DORM3D_GUIDE_03&quot;,
			active = function ()
				return true
			end
		},
		{
			name = &quot;DORM3D_GUIDE_04&quot;,
			active = function ()
				return true
			end
		},
		{
			name = &quot;DORM3D_GUIDE_05&quot;,
			active = function ()
				return uv0:CheckSystemOpen(&quot;Furniture&quot;)
			end
		},
		{
			name = &quot;DORM3D_GUIDE_07&quot;,
			active = slot4
		}
	}) do
		if not pg.NewStoryMgr.GetInstance():IsPlayed(slot5.name) and slot5.active() then
			slot0:SetAllBlackbloardValue(&quot;inGuide&quot;, true)

			slot6 = function()
				pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataGuide(2, pg.NewStoryMgr.GetInstance():StoryName2StoryId(uv0.name)))
				uv1:SetAllBlackbloardValue(&quot;inGuide&quot;, false)
			end

			pg.m02:sendNotification(GAME.STORY_UPDATE, {
				storyId = slot5.name
			})
			pg.m02:sendNotification(GAME.APARTMENT_TRACK, Dorm3dTrackCommand.BuildDataGuide(1, pg.NewStoryMgr.GetInstance():StoryName2StoryId(slot5.name)))
			pg.NewGuideMgr.GetInstance():Play(slot5.name, nil, slot6, slot6)

			return true
		end
	end

	return false
end

slot0.CheckFavorTrigger = function(slot0)
	slot5 = &quot;drom3d_favir_trigger_propose&quot;

	slot4 = function()
		return getProxy(CollectionProxy):getShipGroup(uv0.apartment.configId) and slot0.married &gt; 0
	end

	for slot4, slot5 in ipairs({
		{
			triggerId = getDorm3dGameset(&quot;drom3d_favir_trigger_onwer&quot;)[1],
			active = function ()
				return tobool(getProxy(CollectionProxy):getShipGroup(uv0.apartment.configId))
			end
		},
		{
			triggerId = getDorm3dGameset(slot5)[1],
			active = slot4
		}
	}) do
		if slot0.apartment.triggerCountDic[slot5.triggerId] == 0 and slot5.active() then
			slot0:emit(Dorm3dRoomMediator.TRIGGER_FAVOR, slot0.apartment.configId, slot5.triggerId)
		end
	end
end

slot0.CheckEnterDeal = function(slot0)
	if slot0.contextData.hasEnterCheck then
		return false
	end

	slot2 = &quot;dorm3d_enter_count_&quot; .. slot0.apartment:GetConfigID()

	if PlayerPrefs.GetString(&quot;dorm3d_enter_count_day&quot;) ~= pg.TimeMgr.GetInstance():CurrentSTimeDesc(&quot;%Y/%m/%d&quot;) then
		PlayerPrefs.SetString(&quot;dorm3d_enter_count_day&quot;, slot3)
		PlayerPrefs.SetInt(slot2, 1)
	else
		PlayerPrefs.SetInt(slot2, PlayerPrefs.GetInt(slot2, 0) + 1)
	end

	PlayerPrefs.SetString(&quot;DORM3D_DAILY_ENTER&quot;, pg.TimeMgr.GetInstance():CurrentSTimeDesc(&quot;%Y/%m/%d&quot;))

	if #slot0.apartment:getEnterTalking(slot0.room:GetConfigID()) &gt; 0 then
		slot0:DoTalk(slot4[math.random(#slot4)])

		return true
	end
end

slot0.CheckActiveTalk = function(slot0)
	if slot0:GetBlackboardValue(slot0.ladyDict[slot0.apartment:GetConfigID()], &quot;inPending&quot;) then
		return false
	end

	if #slot0.apartment:getZoneTalking(slot0.room:GetConfigID(), slot1.ladyBaseZone) &gt; 0 then
		slot0:DoTalk(slot2[1])

		return true
	else
		return false
	end
end

slot0.CheckDistanceTalk = function(slot0, slot1, slot2)
	slot8 = slot0.room:GetConfigID()
	slot9 = slot0.ladyDict[slot1].ladyBaseZone

	for slot8, slot9 in ipairs(getProxy(ApartmentProxy):getApartment(slot1):getDistanceTalking(slot8, slot9)) do
		slot0:DoTalk(slot9)

		return
	end
end

slot0.CheckSystemOpen = function(slot0, slot1)
	if slot0.room:isPersonalRoom() then
		return switch(slot1, {
			Talk = function ()
				return 1 &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			Touch = function ()
				return getDorm3dGameset(&quot;drom3d_touch_dialogue&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			Gift = function ()
				return getDorm3dGameset(&quot;drom3d_gift_dialogue&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			PublicGame = function ()
				return false
			end,
			Photo = function ()
				return getDorm3dGameset(&quot;drom3d_photograph_unlock&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			Collection = function ()
				return getDorm3dGameset(&quot;drom3d_recall_unlock&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			Furniture = function ()
				return getDorm3dGameset(&quot;drom3d_furniture_unlock&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			DayNight = function ()
				return getDorm3dGameset(&quot;drom3d_time_unlock&quot;)[1] &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			Accompany = function ()
				return 1 &lt;= uv0.apartment.level, i18n(&quot;apartment_level_unenough&quot;, slot0)
			end,
			MiniGame = function ()
				if uv0.apartment.level &lt; 1 then
					return false, i18n(&quot;apartment_level_unenough&quot;, slot0)
				elseif #uv0.room:getMiniGames() &lt;= 0 then
					return false, &quot;without minigame config in room:&quot; .. uv0.room.configId
				else
					return true
				end
			end,
			Invite = function ()
				return false
			end,
			Performance = function ()
				return IsUnityEditor
			end
		}, function ()
			return true
		end)
	else
		return switch(slot1, {
			Gift = function ()
				return false
			end,
			PublicGame = function ()
				return true
			end,
			Furniture = function ()
				return #uv0.room:GetFurnitures() &gt; 0 or #_.filter(uv0.room:GetFurnitureIDList() or {}, function (slot0)
					return Dorm3dFurniture.New({
						configId = slot0
					}):InShopTime()
				end) &gt; 0
			end,
			DayNight = function ()
				return false
			end,
			Accompany = function ()
				return false
			end,
			MiniGame = function ()
				return false
			end,
			Performance = function ()
				return IsUnityEditor
			end
		}, function ()
			return true
		end)
	end
end

slot0.CheckLevelUp = function(slot0)
	if slot0.apartment:canLevelUp() then
		slot0:emit(Dorm3dRoomMediator.FAVOR_LEVEL_UP, slot0.apartment.configId)

		return true
	end

	return false
end

slot0.GetIKHandTF = function(slot0)
	return slot0.ikHand
end

slot0.CycleIKCameraGroup = function(slot0)
	slot2 = slot0.apartment

	assert(slot0:GetBlackboardValue(slot0.ladyDict[slot2:GetConfigID()], &quot;inIK&quot;))
	seriesAsync({
		function (slot0)
			pg.IKMgr.GetInstance():ResetActiveIKs()

			slot1 = uv0.ikConfig
			slot3 = pg.dorm3d_ik_status.get_id_list_by_camera_group[slot1.camera_group]

			uv1:SwitchIKConfig(uv0, slot3[table.indexof(slot3, slot1.id) % #slot3 + 1])
			uv1:SetIKState(true)
		end
	})
end

slot0.TempHideUI = function(slot0, slot1, slot2)
	slot3 = defaultValue(slot0.hideCount, 0)
	slot0.hideCount = slot3 + (slot1 and 1 or -1)

	assert(slot0.hideCount &gt;= 0)

	if slot0.hideCount * slot3 &gt; 0 then
		return existCall(slot2)
	elseif slot0.hideCount &gt; 0 then
		slot0:SetUI(slot2, &quot;blank&quot;)
	else
		slot0:SetUI(slot2, &quot;back&quot;)
	end
end

slot0.onBackPressed = function(slot0)
	if not slot0.exited then
		if slot0.retainCount &gt; 0 then
			-- Nothing
		elseif isActive(slot0.rtLevelUpWindow) then
			triggerButton(slot0.rtLevelUpWindow:Find(&quot;bg&quot;))
		elseif slot0.uiState == &quot;base&quot; then
			slot0:closeView()
		end
	end
end

slot0.willExit = function(slot0)
	if slot0.downTimer then
		slot0.downTimer:Stop()

		slot0.downTimer = nil
	end

	if slot0.LTs then
		underscore.map(slot0.LTs, function (slot0)
			LeanTween.cancel(slot0)
		end)

		slot0.LTs = nil
	end

	if slot0.sliderLT then
		LeanTween.cancel(slot0.sliderLT)

		slot0.sliderLT = nil
	end

	for slot4, slot5 in pairs(slot0.ladyDict) do
		slot5.wakeUpTalkId = nil
	end

	if slot0.accompanyFavorTimer then
		slot0.accompanyFavorTimer:Stop()

		slot0.accompanyFavorTimer = nil
	end

	if slot0.accompanyPerformanceTimer then
		slot0.accompanyPerformanceTimer:Stop()

		slot0.accompanyPerformanceTimer = nil
	end

	slot0.canTriggerAccompanyPerformance = nil

	slot0.videoPlayer:Destroy()
	uv0.super.willExit(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>