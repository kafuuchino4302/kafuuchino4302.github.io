<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>neweducateinfopanel.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>neweducateinfopanel.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewEducateInfoPanel&quot;, import(&quot;view.base.BaseSubView&quot;))

slot0.getUIName = function(slot0)
	return &quot;NewEducateInfoPanel&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.foldPanelTF = slot0._tf:Find(&quot;fold_panel&quot;)
	slot0.showBtn = slot0.foldPanelTF:Find(&quot;show_btn&quot;)
	slot0.showPanelTF = slot0._tf:Find(&quot;show_panel&quot;)
	slot0.showAnim = slot0.showPanelTF:GetComponent(typeof(Animation))
	slot0.showAnimEvent = slot0.showPanelTF:GetComponent(typeof(DftAniEvent))

	slot0.showAnimEvent:SetEndEvent(function ()
		setActive(uv0.showPanelTF, false)
	end)

	slot0.blurBg = slot0.showPanelTF:Find(&quot;content&quot;)
	slot0.foldBtn = slot0.showPanelTF:Find(&quot;fold_btn&quot;)
	slot0.contnetTF = slot0.showPanelTF:Find(&quot;content&quot;)

	setText(slot0.contnetTF:Find(&quot;personality_title/Text&quot;), i18n(&quot;child2_personality_title&quot;))

	slot0.personalityTF = slot0.contnetTF:Find(&quot;personality&quot;)
	slot0.personalityValueTF = slot0.personalityTF:Find(&quot;slider/handle/Image/bubble/Text&quot;)

	setText(slot0.contnetTF:Find(&quot;attr_title/Text&quot;), i18n(&quot;child2_attr_title&quot;))

	slot1 = slot0.contnetTF:Find(&quot;attrs/content&quot;)
	slot0.gradientBgTF = slot0.contnetTF:Find(&quot;attrs/bg_gradient&quot;)
	slot0.attrUIList = UIItemList.New(slot1, slot1:Find(&quot;tpl&quot;))

	setText(slot0.contnetTF:Find(&quot;talent_title/Text&quot;), i18n(&quot;child2_talent_title&quot;))

	slot2 = slot0.contnetTF:Find(&quot;talents/content&quot;)
	slot0.talentUIList = UIItemList.New(slot2, slot2:Find(&quot;tpl&quot;))

	setText(slot0.contnetTF:Find(&quot;status_title/Text&quot;), i18n(&quot;child2_status_title&quot;))

	slot3 = slot0.contnetTF:Find(&quot;status/content/content&quot;)
	slot0.statusUIList = UIItemList.New(slot3, slot3:Find(&quot;tpl&quot;))
	slot0.attrIds = slot0.contextData.char:GetAttrIds()
	slot0.talentRoundIds = slot0.contextData.char:GetRoundData():GetTalentRoundIds()
end

slot0.OnInit = function(slot0)
	LoadImageSpriteAsync(&quot;neweducateicon/&quot; .. slot0.contextData.char:getConfig(&quot;child2_data_personality_icon&quot;)[1], slot0.personalityTF:Find(&quot;slider/handle/Image&quot;), true)
	onButton(slot0, slot0.showBtn, function ()
		uv0:ShowPanel()
	end, SFX_PANEL)
	onButton(slot0, slot0.foldBtn, function ()
		uv0:HidePanel()
	end, SFX_PANEL)
	slot0.attrUIList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventInit then
			slot4 = pg.child2_attr[uv0.attrIds[slot1 + 1]]

			LoadImageSpriteAsync(&quot;neweducateicon/&quot; .. slot4.icon, slot2:Find(&quot;icon_bg/icon&quot;))
			setScrollText(slot2:Find(&quot;name_mask/name&quot;), slot4.name)
		elseif slot0 == UIItemList.EventUpdate then
			uv0:OnUpdateAttrItem(slot1, slot2)
		end
	end)
	slot0.talentUIList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:OnUpdateTalentItem(slot1, slot2)
		end
	end)
	slot0.statusUIList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:OnUpdateStatusItem(slot1, slot2)
		end
	end)
	pg.UIMgr.GetInstance():OverlayPanelPB(slot0._tf, {
		pbList = {
			slot0.blurBg
		},
		groupName = LayerWeightConst.GROUP_EDUCATE,
		weight = slot0.contextData.weight or LayerWeightConst.BASE_LAYER - 1
	})
	setActive(slot0.foldPanelTF, true)
	setActive(slot0.showPanelTF, false)

	if slot0.contextData.hide then
		slot0:HidePanel()
	elseif slot0.contextData.isMainEnter then
		onDelayTick(function ()
			uv0:ShowPanel()
		end, 0.396)
	else
		slot0:ShowPanel()
	end

	slot0:Flush()
end

slot0.IsShowPanel = function(slot0)
	return isActive(slot0.showPanelTF)
end

slot0.ShowPanel = function(slot0)
	setActive(slot0.foldPanelTF, false)
	setActive(slot0.showPanelTF, true)
end

slot0.HidePanel = function(slot0, slot1)
	setActive(slot0.foldPanelTF, true)

	if not slot1 then
		slot0.showAnim:Play(&quot;anim_educate_archive_show_out&quot;)
	else
		setActive(slot0.showPanelTF, false)
	end

	eachChild(slot0.talentUIList.container, function (slot0)
		triggerToggle(slot0:Find(&quot;unlock&quot;), false)
	end)
	eachChild(slot0.statusUIList.container, function (slot0)
		triggerToggle(slot0, false)
	end)
end

slot0.OnUpdateAttrItem = function(slot0, slot1, slot2)
	slot3 = slot0.attrIds[slot1 + 1]
	slot6, slot7 = uv0.GetArrtInfo(pg.child2_attr[slot3].rank, slot0.contextData.char:GetAttr(slot3))

	setText(slot2:Find(&quot;rank/Text&quot;), slot6)
	setText(slot2:Find(&quot;value&quot;), slot7)
	setImageColor(slot0.gradientBgTF:GetChild(slot1), Color.NewHex(EducateConst.GRADE_2_COLOR[slot6][1]))
	setImageColor(slot2:Find(&quot;rank&quot;), Color.NewHex(EducateConst.GRADE_2_COLOR[slot6][2]))
end

slot0.OnUpdateTalentItem = function(slot0, slot1, slot2)
	slot3 = slot0.talents[slot1 + 1]

	setActive(slot2:Find(&quot;unlock&quot;), slot3)
	setActive(slot2:Find(&quot;lock&quot;), not slot3)

	if slot3 then
		LoadImageSpriteAsync(&quot;neweducateicon/&quot; .. slot3:getConfig(&quot;item_icon_little&quot;), slot2:Find(&quot;unlock/icon&quot;))
		setText(slot2:Find(&quot;unlock/name&quot;), shortenString(slot3:getConfig(&quot;name&quot;), 5))
		setText(slot2:Find(&quot;unlock/info/content/name&quot;), slot3:getConfig(&quot;name&quot;))
		setText(slot2:Find(&quot;unlock/info/content/desc&quot;), slot3:getConfig(&quot;desc&quot;))
	end

	slot4 = slot0.talentRoundIds[slot1 + 1]

	onButton(slot0, slot2:Find(&quot;lock&quot;), function ()
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;child2_talent_unlock_tip&quot;, uv0))
	end, SFX_PANEL)

	slot7 = slot0.contnetTF

	onScroll(slot0, slot7:Find(&quot;status&quot;), function (slot0)
		eachChild(uv0.statusUIList.container, function (slot0)
			triggerToggle(slot0, false)
		end)
	end)
end

slot0.OnUpdateStatusItem = function(slot0, slot1, slot2)
	if slot2.name ~= tostring(slot0.status[slot1 + 1].id) then
		slot2.name = slot3.id

		LoadImageSpriteAsync(&quot;neweducateicon/&quot; .. slot3:getConfig(&quot;item_icon&quot;), slot2:Find(&quot;icon&quot;))
	end

	setText(slot2:Find(&quot;time/Text&quot;), slot3:getConfig(&quot;during_time&quot;) == -1 and i18n(&quot;child2_status_time2&quot;) or i18n(&quot;child2_status_time1&quot;, slot3:GetEndRound() - slot0.contextData.char:GetRoundData().round))
	setText(slot2:Find(&quot;info/content/name&quot;), slot3:getConfig(&quot;name&quot;))
	setText(slot2:Find(&quot;info/content/desc&quot;), slot3:getConfig(&quot;desc&quot;))
end

slot0.Flush = function(slot0)
	slot0:FlushAttrs()
	slot0:FlushTalents()
	slot0:FlushStatus()
end

slot0.FlushAttrs = function(slot0)
	slot1 = slot0.contextData.char:GetPersonalityMiddle()
	slot3 = slot0.contextData.char:GetPersonality()

	setSlider(slot0.personalityTF:Find(&quot;slider&quot;), -slot1, slot1, slot3 - slot1)
	setText(slot0.personalityValueTF, math.abs(slot3 - slot1))
	setTextColor(slot0.personalityValueTF, Color.NewHex(slot0.contextData.char:GetPersonalityTag() == &quot;tag1&quot; and &quot;26b1f3&quot; or &quot;ff6767&quot;))
	slot0.attrUIList:align(#slot0.attrIds)
end

slot0.FlushTalents = function(slot0)
	slot0.talents = slot0.contextData.char:GetTalentList()

	slot0.talentUIList:align(#slot0.talentRoundIds)
end

slot0.FlushStatus = function(slot0)
	slot0.status = slot0.contextData.char:GetStatusList()

	slot0.statusUIList:align(#slot0.status)
end

slot0.OnDestroy = function(slot0)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf)
end

slot0.GetArrtInfo = function(slot0, slot1)
	for slot5, slot6 in ipairs(slot0) do
		if slot6[1][1] &lt;= slot1 and slot1 &lt; slot6[1][2] then
			return slot6[2], slot1 .. &quot;/&quot; .. slot6[1][2]
		end
	end

	return slot0[#slot0][2], slot1 .. &quot;/&quot; .. slot0[#slot0][1][2]
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>