<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>neweducateselendinglayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>neweducateselendinglayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewEducateSelEndingLayer&quot;, import(&quot;view.newEducate.base.NewEducateBaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;NewEducateSelEndingUI&quot;
end

slot0.init = function(slot0)
	slot0.rootTF = slot0._tf:Find(&quot;root&quot;)
	slot0.blurPanel = slot0.rootTF:Find(&quot;bg&quot;)
	slot0.scrollrect = slot0.blurPanel:Find(&quot;window/view&quot;)
	slot1 = slot0.blurPanel:Find(&quot;window/view/content&quot;)
	slot0.uiList = UIItemList.New(slot1, slot1:Find(&quot;tpl&quot;))

	slot0.uiList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventInit then
			uv0:InitItem(slot1, slot2)
		elseif slot0 == UIItemList.EventUpdate then
			setActive(slot2:Find(&quot;selected&quot;), uv0.selectedIdx == slot1 + 1)
		end
	end)

	slot0.sureBtn = slot0.blurPanel:Find(&quot;window/sure_btn&quot;)

	setText(slot0.sureBtn:Find(&quot;Image&quot;), i18n(&quot;word_ok&quot;))
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():OverlayPanelPB(slot0.blurPanel, {
		pbList = {
			slot0.blurPanel
		},
		groupName = LayerWeightConst.GROUP_EDUCATE,
		weight = slot0:getWeightFromData() + 1
	})
	onButton(slot0, slot0.sureBtn, function ()
		uv0:emit(NewEducateSelEndingMediator.ON_SELECT_ENDING, uv0.endingList[uv0.selectedIdx])
	end, SFX_PANEL)

	slot0.selectedIdx = 1

	slot0:RefreshView()
end

slot0.InitItem = function(slot0, slot1, slot2)
	slot4 = slot0.endingList[slot1 + 1]
	slot5 = pg.child2_ending[slot4]

	setScrollText(slot2:Find(&quot;name_mask/name&quot;), slot5.name)
	LoadImageSpriteAsync(&quot;neweducateicon/&quot; .. slot5.pic_preview, slot2:Find(&quot;Image&quot;))
	setActive(slot2:Find(&quot;complete&quot;), table.contains(slot0.completeList, slot4))
	onButton(slot0, slot2, function ()
		uv0.selectedIdx = uv1

		uv0.uiList:align(#uv0.endingList)
	end, SFX_PANEL)
end

slot0.RefreshView = function(slot0)
	slot0.endingList = slot0.contextData.char:GetFSM():GetState(NewEducateFSM.STYSTEM.ENDING):GetEndings()
	slot0.completeList = slot0.contextData.char:GetPermanentData():GetFinishedEndings()

	table.sort(slot0.endingList, CompareFuncs({
		function (slot0)
			return table.contains(uv0.completeList, slot0) and 1 or 0
		end,
		function (slot0)
			return -slot0
		end
	}))
	slot0.uiList:align(#slot0.endingList)
	scrollTo(slot0.scrollrect, slot0.uiList.container.rect.width / 2, 0)
end

slot0.OnSelDone = function(slot0, slot1)
	NewEducateHelper.PlaySpecialStory(pg.child2_ending[slot1].performance, function ()
		uv0:closeView()
	end, true)
end

slot0.onBackPressed = function(slot0)
end

slot0.willExit = function(slot0)
	existCall(slot0.contextData.onExit)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0.blurPanel, slot0._tf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>