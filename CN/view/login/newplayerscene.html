<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>newplayerscene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>newplayerscene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewPlayerScene&quot;, import(&quot;..base.BaseUI&quot;))
slot1 = 0.5
slot2 = -300
slot3 = Vector3(-380, 265, 0)
slot4 = 19
slot5 = {
	101171,
	201211,
	401231
}
slot6 = {
	[201211.0] = &quot;biaoqiang&quot;,
	[301051.0] = &quot;lingbo&quot;,
	[401231.0] = &quot;z23&quot;,
	[101171.0] = &quot;lafei&quot;
}
slot7 = {
	[101171] = i18n(&quot;login_newPlayerScene_word_laFei&quot;),
	[201211] = i18n(&quot;login_newPlayerScene_word_biaoqiang&quot;),
	[401231] = i18n(&quot;login_newPlayerScene_word_z23&quot;)
}

slot0.getUIName = function(slot0)
	return &quot;NewPlayerUI&quot;
end

slot0.init = function(slot0)
	slot0.eventTriggers = {}
	slot0.characters = slot0:findTF(&quot;select_character/characters&quot;)
	slot0.propPanel = slot0:findTF(&quot;prop_panel&quot;)
	slot0.selectPanel = slot0:findTF(&quot;select_character&quot;)

	setActive(slot0.propPanel, false)
	setActive(slot0.selectPanel, true)

	slot0.confirmBtn = slot0:findTF(&quot;bg/qr_btn&quot;, slot0.propPanel)
	slot0.tip = slot0:findTF(&quot;select_character/tip&quot;)
	slot0.skillPanel = slot0:findTF(&quot;bg/skill_panel&quot;, slot0.propPanel)
	slot0.skillTpl = slot0:getTpl(&quot;bg/skill_panel/frame/skilltpl&quot;, slot0.propPanel)
	slot0.skillContainer = slot0:findTF(&quot;bg/skill_panel/frame&quot;, slot0.propPanel)
	slot0.namedPanel = slot0:findTF(&quot;named_panel&quot;)

	setActive(slot0.namedPanel, false)

	slot0.info = slot0.namedPanel:Find(&quot;info&quot;)
	slot0.nickname = slot0.info:Find(&quot;nickname&quot;)
	slot0.qChar = slot0.propPanel:Find(&quot;q_char&quot;)
	slot0.chat = slot0:findTF(&quot;info/tip/chatbgtop0/Text&quot;, slot0.namedPanel)
	slot0.propertyPanel = PropertyPanel.New(slot0.propPanel:Find(&quot;bg/property_panel/frame&quot;))
	slot0.paintTF = slot0:findTF(&quot;prop_panel/bg/paint&quot;)
	slot0.nameTF = slot0:findTF(&quot;prop_panel/bg/name&quot;)
	slot0.nameEnTF = slot0:findTF(&quot;prop_panel/bg/english_name_bg&quot;)
	slot0.titleShipinfoTF = slot0:findTF(&quot;lines/hori/shipinfo_text&quot;)
	slot0.titleShipchooseTF = slot0:findTF(&quot;lines/hori/shipchoose_text&quot;)

	setImageAlpha(slot0.titleShipinfoTF, 1)
	setImageAlpha(slot0.titleShipchooseTF, 0)

	slot0.randBtn = findTF(slot0.info, &quot;random_button&quot;)

	setActive(slot0.randBtn, PLATFORM_CODE == PLATFORM_CH)
end

slot0.onBackPressed = function(slot0)
	if LeanTween.isTweening(go(slot0.propPanel)) then
		return
	end

	pg.CriMgr.GetInstance():PlaySoundEffect_V3(SFX_CANCEL)

	if isActive(slot0.namedPanel) then
		slot0:closeNamedPanel()

		return
	end

	pg.SdkMgr.GetInstance():OnAndoridBackPress()
end

slot0.switchPanel = function(slot0)
	setActive(slot0.propPanel, true)

	slot1 = slot0.propPanel:GetComponent(typeof(CanvasGroup))
	slot2 = slot0.selectPanel:GetComponent(typeof(CanvasGroup))

	LeanTween.value(go(slot0.propPanel), 0, 1, 0.5):setOnUpdate(System.Action_float(function (slot0)
		uv0.alpha = slot0
		uv1.alpha = 1 - slot0
	end)):setOnComplete(System.Action(function ()
		setActive(uv0.selectPanel, false)
	end))

	slot0.skillPanel.localPosition = Vector3.New(-1000, slot0.skillPanel.localPosition.y, slot0.skillPanel.localPosition.z)

	LeanTween.moveX(slot0.skillPanel, 339, 0.2)
	LeanTween.moveY(slot0:findTF(&quot;lines/line&quot;), -328, 0.2)

	slot8 = 0.2

	LeanTween.moveX(slot0:findTF(&quot;lines/hori&quot;), -820, slot8)

	for slot8 = 1, 3 do
		slot9 = slot0:findTF(&quot;character_&quot; .. slot8, slot0.characters)

		setImageAlpha(slot9, 1)
		LeanTween.alpha(slot9, 0, 0.25)
		LeanTween.move(go(slot9), slot0:findTF(&quot;bg/characters/character_&quot; .. slot8, slot0.propPanel).position, 0.3)
		setImageAlpha(slot0.titleShipinfoTF, 0)
		setImageAlpha(slot0.titleShipchooseTF, 1)
		LeanTween.alpha(slot0.titleShipinfoTF, 1, 0.25)
		LeanTween.alpha(slot0.titleShipchooseTF, 0, 0.25)
	end
end

slot0.initCharacters = function(slot0)
	slot0.charInitPos = {}

	for slot4 = 1, 3 do
		onToggle(slot0, slot0:findTF(&quot;prop_panel/bg/characters/character_&quot; .. slot4), function (slot0)
			if slot0 then
				uv0:selectCharacterByIdx(uv1, uv2[uv3])
				setActive(uv0:findTF(&quot;selected&quot;, uv1), true)

				uv1:GetComponent(typeof(RectTransform)).sizeDelta = Vector2(196, 196)
			else
				setActive(uv0:findTF(&quot;selected&quot;, uv1), false)

				uv1:GetComponent(typeof(RectTransform)).sizeDelta = Vector2(140, 140)
			end
		end)
	end

	slot1 = {
		0.2,
		0.3,
		0.1
	}

	for slot5 = 1, 3 do
		slot6 = slot0:findTF(&quot;character_&quot; .. slot5, slot0.characters)

		onButton(slot0, slot6, function ()
			uv0:switchPanel()
			triggerToggle(uv0:findTF(&quot;prop_panel/bg/characters/character_&quot; .. uv1), true)
		end)

		slot6.localPosition = Vector3.New(slot6.localPosition.x, 912, slot6.localPosition.z)

		setImageAlpha(slot6, 0)
		LeanTween.alpha(slot6, 1, 0.3):setDelay(slot1[slot5])
		LeanTween.moveY(slot6, 0, 0.2):setDelay(slot1[slot5])
	end
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0.confirmBtn, function ()
		uv0:showNamedPanel()
	end, SFX_PANEL)
	onButton(slot0, findTF(slot0.info, &quot;random_button&quot;), function ()
		slot0 = require(&quot;GameCfg.names&quot;)

		setInputText(uv0.nickname, slot0[1][math.random(#slot0[1])] .. slot0[2][math.random(#slot0[2])] .. slot0[3][math.random(#slot0[3])] .. slot0[4][math.random(#slot0[4])])
	end, SFX_MAIN)
	onButton(slot0, findTF(slot0.info, &quot;btn_container/enter_button&quot;), function ()
		if not uv0.contextData.configId then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;login_newPlayerScene_error_notChoiseShip&quot;))

			return
		end

		if getInputText(uv0.nickname) == &quot;&quot; then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;login_newPlayerScene_inputName&quot;))

			return
		end

		if not nameValidityCheck(slot0, 4, 14, {
			&quot;spece_illegal_tip&quot;,
			&quot;login_newPlayerScene_name_tooShort&quot;,
			&quot;login_newPlayerScene_name_tooLong&quot;,
			&quot;login_newPlayerScene_invalideName&quot;
		}) then
			return
		end

		uv0.event:emit(NewPlayerMediator.ON_CREATE, slot0, uv0.contextData.configId)
	end, SFX_CONFIRM)
	onButton(slot0, findTF(slot0.info, &quot;btn_container/cancel_button&quot;), function ()
		uv0:closeNamedPanel()
	end)
	slot0:initCharacters()
end

slot8 = 0.3
slot9 = -47

slot0.selectCharacterByIdx = function(slot0, slot1, slot2)
	slot0.inProp = true
	slot0.contextData.configId = slot2

	slot0.propertyPanel:initProperty(slot2)
	slot0:initSkills()

	slot3 = pg.ship_data_statistics[slot2]

	setPaintingPrefab(slot0.paintTF, uv0[slot2], &quot;chuanwu&quot;)
	setText(slot0:findTF(&quot;name_mask/Text&quot;, slot0.nameTF), slot3.name)
	setText(slot0:findTF(&quot;english_name&quot;, slot0.nameTF), slot3.english_name)
	setText(slot0.nameEnTF, string.upper(slot3.english_name))

	if Ship.New({
		configId = slot0.contextData.configId
	}):getPrefab() == slot0.shipPrefab then
		return
	end

	slot0:recycleSpineChar()

	slot6 = pg.UIMgr.GetInstance()

	slot6:LoadingOn()

	slot6 = PoolMgr.GetInstance()

	slot6:GetSpineChar(slot5, true, function (slot0)
		pg.UIMgr.GetInstance():LoadingOff()

		uv0.shipPrefab = uv1
		uv0.shipModel = slot0

		slot0:GetComponent(&quot;SpineAnimUI&quot;):SetAction(&quot;stand&quot;, 0)

		tf(slot0).localScale = Vector3(0.5, 0.5, 1)
		tf(slot0).localPosition = Vector3(15, -95, 0)

		pg.ViewUtils.SetLayer(tf(slot0), Layer.UI)
		removeAllChildren(uv0.qChar)
		SetParent(slot0, uv0.qChar, false)
	end)
end

slot0.initSkills = function(slot0)
	removeAllChildren(slot0.skillContainer)

	for slot5, slot6 in ipairs(pg.ship_data_template[slot0.contextData.configId].buff_list_display) do
		slot9 = cloneTplTo(slot0.skillTpl, slot0.skillContainer)

		setActive(slot9:Find(&quot;mask&quot;), not table.contains(slot1.buff_list, slot6))
		onButton(slot0, slot9, function ()
			uv0:emit(NewPlayerMediator.ON_SKILLINFO, uv1.id)
		end, SFX_PANEL)
		LoadImageSpriteAsync(&quot;skillicon/&quot; .. getSkillConfig(slot6).icon, findTF(slot9, &quot;icon&quot;))
	end
end

slot0.showNamedPanel = function(slot0)
	slot0.qChar:SetParent(slot0.info)
	pg.UIMgr.GetInstance():BlurPanel(slot0.namedPanel)
	setActive(slot0.namedPanel, true)
	setInputText(slot0.nickname, &quot;&quot;)
	setText(slot0.chat, uv0[slot0.contextData.configId])
end

slot0.closeNamedPanel = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0.namedPanel, slot0._tf)
	setActive(slot0.namedPanel, false)
	slot0.qChar:SetParent(slot0.propPanel)
end

slot0.recycleSpineChar = function(slot0)
	if slot0.shipPrefab and slot0.shipModel then
		PoolMgr.GetInstance():ReturnSpineChar(slot0.shipPrefab, slot0.shipModel)

		slot0.shipPrefab = nil
		slot0.shipModel = nil
	end
end

slot0.willExit = function(slot0)
	if slot0.eventTriggers then
		for slot4, slot5 in pairs(slot0.eventTriggers) do
			ClearEventTrigger(slot4)
		end

		slot0.eventTriggers = nil
	end

	slot0:closeNamedPanel()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>