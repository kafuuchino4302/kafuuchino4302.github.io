<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>catterydescpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>catterydescpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CatteryDescPage&quot;, import(&quot;...base.BaseSubView&quot;))
slot0.CHANGE_STYLE = &quot;CatteryDescPage:CHANGE_STYLE&quot;
slot0.CHANGE_COMMANDER = &quot;CatteryDescPage:CHANGE_COMMANDER&quot;

slot0.getUIName = function(slot0)
	return &quot;CatteryDescPage&quot;
end

slot0.OnCatteryUpdate = function(slot0, slot1)
	slot0:Flush(slot1)

	if slot0.page and slot0.page:GetLoaded() and slot0.page:isShowing() then
		slot0.page:OnCatteryUpdate(slot1)
	end
end

slot0.OnCatteryStyleUpdate = function(slot0, slot1)
	slot0.cattery = slot1

	slot0:UpdateCatteryStyle()

	if slot0.page and slot0.page:GetLoaded() and slot0.page:isShowing() and isa(slot0.page, CommanderHomeSelCatteryStylePage) then
		slot0.page:OnCatteryStyleUpdate(slot1)
	end
end

slot0.OnLoaded = function(slot0)
	slot0.closeBtn = slot0:findTF(&quot;right/close_btn&quot;)
	slot0.styleIcon = slot0:findTF(&quot;left/bg/mask/icon&quot;):GetComponent(typeof(Image))
	slot0.char = slot0:findTF(&quot;left/bg/char&quot;)
	slot0.commanderEmpty = slot0:findTF(&quot;left/bg/info/empty&quot;)
	slot0.styleInfo = slot0.commanderEmpty
	slot0.commanderExp = slot0:findTF(&quot;left/bg/info/commander_exp&quot;)
	slot0.commanderLevelTxt = slot0.commanderExp:Find(&quot;level/Text&quot;):GetComponent(typeof(Text))
	slot0.commanderExpTxt = slot0.commanderExp:Find(&quot;value_bg/Text&quot;):GetComponent(typeof(Text))
	slot0.commanderExpImg = slot0.commanderExp:Find(&quot;exp/Image&quot;)
	slot0.pageContainer = slot0._tf:Find(&quot;&quot;)
	slot1 = slot0:findTF(&quot;left/tags&quot;)
	slot0.toggleGroup = slot1:GetComponent(typeof(ToggleGroup))
	slot0.pagesTF = slot0:findTF(&quot;right/pages&quot;)
	slot0.tags = {
		slot0:findTF(&quot;left/tags/commander&quot;),
		slot0:findTF(&quot;left/tags/home&quot;)
	}
	slot0.pages = {
		CommanderHomeSelCommanderPage.New(slot0.pagesTF, slot0.event),
		CommanderHomeSelCatteryStylePage.New(slot0.pagesTF, slot0.event)
	}
end

slot0.OnInit = function(slot0)
	slot0:bind(uv0.CHANGE_STYLE, function (slot0, slot1)
		uv0:PreviewCatteryStyle(slot1)
	end, SFX_PANEL)
	slot0:bind(uv0.CHANGE_COMMANDER, function (slot0, slot1)
		uv0:PreviewCatteryCommader(slot1)
	end)
	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)

	slot4 = function()
		uv0:Hide()
	end

	slot5 = SFX_PANEL

	onButton(slot0, slot0.closeBtn, slot4, slot5)

	for slot4, slot5 in ipairs(slot0.tags) do
		onToggle(slot0, slot5, function (slot0)
			if slot0 then
				uv0:SwitchPage(uv1)
			end
		end, SFX_PANEL)
	end
end

slot0.SwitchPage = function(slot0, slot1)
	if slot0.page == slot0.pages[slot1] then
		return
	end

	if slot0.page then
		slot0.page:Hide()
	end

	slot2:ExecuteAction(&quot;Update&quot;, slot0.home, slot0.cattery)

	slot0.page = slot2
	slot3 = isa(slot2, CommanderHomeSelCatteryStylePage)

	setActive(slot0.commanderEmpty, slot3)
	setActive(slot0.commanderExp, not slot3)
	slot0:FlushCatteryInfo()
end

slot0.Update = function(slot0, slot1, slot2)
	slot0:Show()

	slot0.home = slot1
	slot0.cattery = slot2
	slot0.page = nil

	triggerToggle(slot0.tags[1], true)

	if slot2 then
		slot0:Flush(slot2)
	end
end

slot0.Show = function(slot0)
	uv0.super.Show(slot0)
	slot0:emit(CommanderHomeLayer.DESC_PAGE_OPEN)
end

slot0.Flush = function(slot0, slot1)
	slot0.cattery = slot1

	slot0:FlushCatteryInfo()
	slot0:UpdateCatteryStyle()
end

slot0.FlushCatteryInfo = function(slot0)
	slot1 = false

	if isa(slot0.page, CommanderHomeSelCommanderPage) then
		slot1 = slot0.cattery:ExistCommander()
	end

	slot0:UpdateCommander(slot0.cattery:GetCommander())

	slot2 = slot0.home
end

slot0.UpdateCommander = function(slot0, slot1)
	slot0:ReturnChar()

	if slot1 ~= nil then
		slot0:LoadChar(slot1)

		slot0.commanderLevelTxt.text = &quot;LV.&quot; .. slot1:getLevel()

		if slot1:isMaxLevel() then
			slot0.commanderExpTxt.text = &quot;MAX&quot;

			setFillAmount(slot0.commanderExpImg, 1)
		else
			slot0.commanderExpTxt.text = &quot;&lt;color=#92FC63FF&gt;&quot; .. slot1.exp .. &quot;&lt;/color&gt;/&quot; .. slot1:getNextLevelExp()

			setFillAmount(slot0.commanderExpImg, slot1.exp / slot1:getNextLevelExp())
		end
	end

	setActive(slot0.commanderExp, slot2)
	setActive(slot0.commanderEmpty, not slot2)
end

slot0.PreviewCatteryCommader = function(slot0, slot1)
	slot0:UpdateCommander(slot1)
end

slot0.UpdateCatteryStyle = function(slot0)
	slot1 = slot0.cattery
	slot2 = slot1:_GetStyle_()

	if slot1:ExistCommander() then
		slot0.styleIcon.sprite = GetSpriteFromAtlas(&quot;CatteryStyle/&quot; .. slot2:GetName(slot1:IsDirty()), &quot;&quot;)
	else
		slot0.styleIcon.sprite = GetSpriteFromAtlas(&quot;CatteryStyle/&quot; .. slot2:GetName(false), &quot;&quot;)
	end
end

slot0.PreviewCatteryStyle = function(slot0, slot1)
	slot0.styleIcon.sprite = GetSpriteFromAtlas(&quot;CatteryStyle/&quot; .. pg.commander_home_style[slot1].name, &quot;&quot;)
end

slot0.LoadChar = function(slot0, slot1)
	slot0.painting = slot1:getPainting()

	setCommanderPaintingPrefab(slot0.char, slot0.painting, &quot;info&quot;)
end

slot0.ReturnChar = function(slot0)
	if slot0.painting then
		retCommanderPaintingPrefab(slot0.char, slot0.painting)

		slot0.painting = nil
	end
end

slot0.Hide = function(slot0)
	slot0:emit(CommanderHomeLayer.DESC_PAGE_CLOSE)
	slot0.toggleGroup:SetAllTogglesOff()
	uv0.super.Hide(slot0)

	for slot4, slot5 in pairs(slot0.pages) do
		if slot5:GetLoaded() and slot5:isShowing() then
			slot5:Hide()
		end
	end
end

slot0.OnDestroy = function(slot0)
	slot0:ReturnChar()

	for slot4, slot5 in ipairs(slot0.pages) do
		slot5:Destroy()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>