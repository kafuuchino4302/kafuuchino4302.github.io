<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>catterycard.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>catterycard.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CatteryCard&quot;)

slot0.Ctor = function(slot0, slot1)
	slot0._go = slot1
	slot0._tf = tf(slot1)
	slot0.lockTF = findTF(slot0._tf, &quot;lock&quot;)
	slot0.unlockTF = findTF(slot0._tf, &quot;unlock&quot;)
	slot0.style = slot0.unlockTF:Find(&quot;mask/bg&quot;):GetComponent(typeof(Image))
	slot0.char = findTF(slot0.unlockTF, &quot;char&quot;)
	slot0.empty = findTF(slot0.unlockTF, &quot;empty&quot;)
	slot0.commanderExp = findTF(slot0.unlockTF, &quot;commander_exp&quot;)
	slot0.bubble = findTF(slot0.unlockTF, &quot;bubble&quot;)
	slot0.levelTxt = findTF(slot0.commanderExp, &quot;level/Text&quot;):GetComponent(typeof(Text))
	slot0.expTxt = findTF(slot0.commanderExp, &quot;exp/Text&quot;):GetComponent(typeof(Text))
	slot0.clean = findTF(slot0.bubble, &quot;clean&quot;)
	slot0.feed = findTF(slot0.bubble, &quot;feed&quot;)
	slot0.play = findTF(slot0.bubble, &quot;play&quot;)
	slot0.expAddition = findTF(slot0.unlockTF, &quot;exp_addition&quot;)
	slot0.expAdditionTxt = slot0.expAddition:Find(&quot;Text&quot;):GetComponent(typeof(Text))
end

slot0.Update = function(slot0, slot1)
	slot0.cattery = slot1

	if slot1:GetState() == Cattery.STATE_LOCK then
		setActive(slot0.bubble, false)
	elseif slot2 == Cattery.STATE_EMPTY then
		slot0:FlushEmpty()
	elseif slot2 == Cattery.STATE_OCCUPATION then
		slot0:FlushCommander()
	end

	setActive(slot0.lockTF, slot3)
	setActive(slot0.unlockTF, not slot3)
	slot0:UpdateStyle()
end

slot0.UpdateStyle = function(slot0)
	if not (slot0.cattery:GetState() == Cattery.STATE_LOCK) then
		slot4 = slot1:_GetStyle_()

		if slot2 == Cattery.STATE_EMPTY then
			slot0.style.sprite = GetSpriteFromAtlas(&quot;CatteryStyle/&quot; .. slot4:GetName(false), &quot;&quot;)
		else
			slot0.style.sprite = GetSpriteFromAtlas(&quot;CatteryStyle/&quot; .. slot4:GetName(slot1:IsDirty()), &quot;&quot;)
		end
	end
end

slot0.FlushEmpty = function(slot0)
	setActive(slot0.empty, true)
	setActive(slot0.commanderExp, false)
	setActive(slot0.bubble, false)
	slot0:ReturnChar()
	slot0:InitBubble()
end

slot0.FlushCommander = function(slot0)
	setActive(slot0.empty, false)
	setActive(slot0.commanderExp, true)
	setActive(slot0.bubble, true)

	slot2 = slot0.cattery:GetCommander()
	slot0.levelTxt.text = &quot;LV.&quot; .. slot2:getLevel()
	slot0.expTxt.text = slot2.exp .. &quot;/&quot; .. slot2:getNextLevelExp()

	slot0:LoadChar(slot2)
	slot0:InitBubble()
end

slot0.LoadChar = function(slot0, slot1)
	slot0.painting = slot1:getPainting()

	setCommanderPaintingPrefab(slot0.char, slot0.painting, &quot;info&quot;)
end

slot0.ReturnChar = function(slot0)
	if slot0.painting then
		retCommanderPaintingPrefab(slot0.char, slot0.painting)

		slot0.painting = nil
	end
end

slot0.InitBubble = function(slot0)
	slot1 = slot0.cattery
	slot2 = slot1:ExistCleanOP()

	setActive(slot0.clean, slot2)
	setActive(slot0.feed, slot1:ExiseFeedOP())
	setActive(slot0.play, slot1:ExistPlayOP())
	setActive(slot0.bubble, slot2 or slot3 or slot4)
end

slot0.AddExpAnim = function(slot0, slot1, slot2)
	slot0:RemoveTimer()

	slot0.expAdditionTxt.text = slot1

	setActive(slot0.expAddition, true)

	slot0.timer = Timer.New(function ()
		uv0:RemoveTimer()
		setActive(uv0.expAddition, false)
		uv1()
	end, 1, 1)

	slot0.timer:Start()
end

slot0.RemoveTimer = function(slot0)
	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end
end

slot0.Dispose = function(slot0)
	slot0:ReturnChar()
	slot0:RemoveTimer()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>