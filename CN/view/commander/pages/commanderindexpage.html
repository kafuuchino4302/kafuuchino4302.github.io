<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>commanderindexpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>commanderindexpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">class(&quot;CommanderIndexPage&quot;, import(&quot;...base.BaseSubView&quot;)).NATION_OTHER = -1
slot4 = {
	sort = {
		{
			i18n(&quot;word_achieved_item&quot;),
			&quot;id&quot;
		},
		{
			i18n(&quot;word_level&quot;),
			&quot;Level&quot;
		},
		{
			i18n(&quot;word_rarity&quot;),
			&quot;Rarity&quot;
		}
	},
	nation = {},
	rarity = {
		{
			i18n(&quot;word_ssr&quot;),
			5
		},
		{
			i18n(&quot;word_sr&quot;),
			4
		},
		{
			i18n(&quot;word_r&quot;),
			3
		}
	},
	name = {
		{
			i18n(&quot;commandercat_label_raw_name&quot;),
			1
		},
		{
			i18n(slot8),
			2
		}
	}
}
slot8 = &quot;commandercat_label_custom_name&quot;

for slot8, slot9 in ipairs({
	Nation.US,
	Nation.EN,
	Nation.JP,
	Nation.DE,
	Nation.CN,
	Nation.SN,
	Nation.FF,
	Nation.MNF
}) do
	table.insert(slot4.nation, slot9)
end

table.insert(slot4.nation, slot0.NATION_OTHER)

slot0.IsOtherNation = function(slot0)
	if not uv0.displayNations then
		uv0.displayNations = {}

		for slot4, slot5 in ipairs(uv1) do
			uv0.displayNations[slot5] = true
		end
	end

	return uv0.displayNations[slot0] ~= true
end

slot0.getUIName = function(slot0)
	return &quot;CommanderIndexUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.sortPanel = slot0:findTF(&quot;frame/frame/frame/sort_panel/content&quot;)
	slot0.nationPanel = slot0:findTF(&quot;frame/frame/frame/nation_panel/content&quot;)
	slot0.rarityPanel = slot0:findTF(&quot;frame/frame/frame/rarity_panel/content&quot;)
	slot0.namePanel = slot0:findTF(&quot;frame/frame/frame/name_panel/content&quot;)
	slot0.sortTpl = slot0.sortPanel:Find(&quot;tpl&quot;)
	slot0.nationTpl = slot0.nationPanel:Find(&quot;tpl&quot;)
	slot0.rarityTpl = slot0.rarityPanel:Find(&quot;tpl&quot;)
	slot0.nameTpl = slot0.namePanel:Find(&quot;tpl&quot;)
	slot0.cancelBtn = slot0:findTF(&quot;frame/frame/cancel_btn&quot;)
	slot0.confirmBtn = slot0:findTF(&quot;frame/frame/confirm_btn&quot;)
	slot0.closeBtn = slot0:findTF(&quot;frame/close_btn&quot;)

	setText(slot0:findTF(&quot;frame/frame/frame/sort_panel/title/Text&quot;), i18n(&quot;indexsort_sort&quot;))
	setText(slot0:findTF(&quot;frame/frame/frame/nation_panel/title/Text&quot;), i18n(&quot;indexsort_camp&quot;))
	setText(slot0:findTF(&quot;frame/frame/frame/rarity_panel/title/Text&quot;), i18n(&quot;indexsort_rarity&quot;))
	setText(slot0:findTF(&quot;frame/frame/frame/name_panel/title/Text&quot;), i18n(&quot;commandercat_label_display_name&quot;))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.cancelBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.confirmBtn, function ()
		uv0.data.displayCustomName = uv0.displayName == uv1

		uv0:emit(CommanderCatDockPage.ON_SORT, uv0.data.displayCustomName)
		uv0:Hide()
	end, SFX_PANEL)

	slot0.nationAllBtn = cloneTplTo(slot0.nationTpl, slot0.nationPanel)

	setText(slot0.nationAllBtn:Find(&quot;Text&quot;), i18n(&quot;index_all&quot;))
	onToggle(slot0, slot0.nationAllBtn, function (slot0)
		if slot0 then
			for slot4, slot5 in pairs(uv0.nationToggles) do
				triggerToggle(slot5, false)
			end

			uv0.data.nationData = {}
		end

		setToggleEnabled(uv0.nationAllBtn, not slot0)
	end, SFX_PANEL)

	slot0.rarityAllBtn = cloneTplTo(slot0.rarityTpl, slot0.rarityPanel)

	setText(slot0.rarityAllBtn:Find(&quot;Text&quot;), i18n(&quot;index_all&quot;))
	onToggle(slot0, slot0.rarityAllBtn, function (slot0)
		if slot0 then
			for slot4, slot5 in pairs(uv0.rarityToggles) do
				triggerToggle(slot5, false)
			end

			uv0.data.rarityData = {}
		end

		setToggleEnabled(uv0.rarityAllBtn, not slot0)
	end, SFX_PANEL)
	slot0:Reset()
	slot0:InitSort()
	slot0:InitNation()
	slot0:InitRarity()
	slot0:InitDisplayName()
end

slot0.InitSort = function(slot0)
	slot0.sortToggles = {}

	for slot4, slot5 in ipairs(uv0.sort) do
		slot6 = cloneTplTo(slot0.sortTpl, slot0.sortPanel)

		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				uv0.data.sortData = uv1[2]
			end
		end, SFX_PANEL)
		setText(slot6:Find(&quot;Text&quot;), slot5[1])

		slot0.sortToggles[slot5[2]] = slot6
	end
end

slot0.InitNation = function(slot0)
	slot0.nationToggles = {}

	for slot4, slot5 in pairs(uv0.nation) do
		slot6 = cloneTplTo(slot0.nationTpl, slot0.nationPanel)

		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				if #uv0.data.nationData == 0 then
					triggerToggle(uv0.nationAllBtn, false)
				end

				table.insert(uv0.data.nationData, uv1)

				if #uv0.data.nationData == #uv2.nation then
					triggerToggle(uv0.nationAllBtn, true)
				end
			elseif #uv0.data.nationData &gt; 0 and table.indexof(uv0.data.nationData, uv1) then
				table.remove(uv0.data.nationData, slot1)

				if #uv0.data.nationData == 0 then
					triggerToggle(uv0.nationAllBtn, true)
				end
			end
		end, SFX_PANEL)
		setText(slot6:Find(&quot;Text&quot;), slot0:Nation2Name(slot5))

		slot0.nationToggles[slot5] = slot6
	end
end

slot0.Nation2Name = function(slot0, slot1)
	if slot1 == uv0.NATION_OTHER then
		return i18n(&quot;index_other&quot;)
	else
		return Nation.Nation2Name(slot1)
	end
end

slot0.InitRarity = function(slot0)
	slot0.rarityToggles = {}

	for slot4, slot5 in pairs(uv0.rarity) do
		slot6 = cloneTplTo(slot0.rarityTpl, slot0.rarityPanel)

		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				if #uv0.data.rarityData == 0 then
					triggerToggle(uv0.rarityAllBtn, false)
				end

				table.insert(uv0.data.rarityData, uv1[2])

				if #uv0.data.rarityData == #uv2.rarity then
					triggerToggle(uv0.rarityAllBtn, true)
				end
			elseif #uv0.data.rarityData &gt; 0 and table.indexof(uv0.data.rarityData, uv1[2]) then
				table.remove(uv0.data.rarityData, slot1)

				if #uv0.data.rarityData == 0 then
					triggerToggle(uv0.rarityAllBtn, true)
				end
			end
		end, SFX_PANEL)
		setText(slot6:Find(&quot;Text&quot;), slot5[1])

		slot0.rarityToggles[slot5[2]] = slot6
	end
end

slot0.InitDisplayName = function(slot0)
	slot0.nameToggles = {}

	for slot4, slot5 in ipairs(uv0.name) do
		slot6 = cloneTplTo(slot0.nameTpl, slot0.namePanel)

		setText(slot6:Find(&quot;Text&quot;), slot5[1])
		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				uv0.displayName = uv1[2]
			end
		end, SFX_PANEL)

		slot0.nameToggles[slot5[2]] = slot6
	end
end

slot0.Show = function(slot0, slot1)
	setActive(slot0._tf, true)
	slot0.UpdateSelected(slot0, slot1)
	setParent(slot0._tf, pg.UIMgr.GetInstance().OverlayMain)
end

slot0.UpdateSelected = function(slot0, slot1)
	triggerToggle(slot0.sortToggles[slot1.sortData or &quot;Level&quot;], true)

	if #(slot1.nationData or {}) &gt; 0 then
		for slot7, slot8 in pairs(slot3) do
			triggerToggle(slot0.nationToggles[slot8], true)
		end
	else
		triggerToggle(slot0.nationAllBtn, true)
	end

	if #(slot1.rarityData or {}) &gt; 0 then
		for slot8, slot9 in pairs(slot4) do
			triggerToggle(slot0.rarityToggles[slot9], true)
		end
	else
		triggerToggle(slot0.rarityAllBtn, true)
	end

	triggerToggle(slot0.nameToggles[defaultValue(slot1.displayCustomName, true) and uv0 or uv1], true)
end

slot0.Reset = function(slot0)
	slot0.data = {
		displayCustomName = true,
		sortData = &quot;Level&quot;,
		nationData = {},
		rarityData = {}
	}
end

slot0.Hide = function(slot0)
	setActive(slot0._tf, false)
	slot0.Reset(slot0)
	setParent(slot0._tf, slot0._parentTf)
end

slot0.OnDestroy = function(slot0)
	uv0.displayNations = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>