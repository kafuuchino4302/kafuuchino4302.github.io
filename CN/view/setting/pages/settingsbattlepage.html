<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>settingsbattlepage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>settingsbattlepage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;SettingsBattlePage&quot;, import(&quot;...base.BaseSubView&quot;))
slot1 = &quot;joystick_anchorX&quot;
slot2 = &quot;joystick_anchorY&quot;
slot3 = &quot;skill_1_anchorX&quot;
slot4 = &quot;skill_1_anchorY&quot;
slot5 = &quot;skill_2_anchorX&quot;
slot6 = &quot;skill_2_anchorY&quot;
slot7 = &quot;skill_3_anchorX&quot;
slot8 = &quot;skill_3_anchorY&quot;
slot9 = &quot;skill_4_anchorX&quot;
slot10 = &quot;skill_4_anchorY&quot;
slot0.CLD_RED = Color.New(0.6, 0.05, 0.05, 0.5)
slot0.DEFAULT_GREY = Color.New(0.5, 0.5, 0.5, 0.5)

slot0.getUIName = function(slot0)
	return &quot;SettingsBattlePage&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.editPanel = slot0._tf:Find(&quot;editor&quot;)
	slot1 = findTF(slot0._tf, &quot;editor/buttons&quot;)
	slot0.normalBtns = findTF(slot1, &quot;normal&quot;)
	slot0.editBtns = findTF(slot1, &quot;editing&quot;)
	slot0.saveBtn = findTF(slot0.editBtns, &quot;save&quot;)
	slot0.cancelBtn = findTF(slot0.editBtns, &quot;cancel&quot;)
	slot0.editBtn = findTF(slot0.normalBtns, &quot;edit&quot;)
	slot0.revertBtn = findTF(slot0.normalBtns, &quot;reset&quot;)
	slot0.interface = findTF(slot0._tf, &quot;editor/editing_region&quot;)
	slot0.stick = findTF(slot0.interface, &quot;Stick&quot;)
	slot0.skillBtn1 = findTF(slot0.interface, &quot;Skill_1&quot;)
	slot0.skillBtn2 = findTF(slot0.interface, &quot;Skill_2&quot;)
	slot0.skillBtn3 = findTF(slot0.interface, &quot;Skill_3&quot;)
	slot0.skillBtn4 = findTF(slot0.interface, &quot;Skill_4&quot;)
	slot0.eventStick = slot0.stick:GetComponent(&quot;EventTriggerListener&quot;)
	slot0.eventSkillBtn1 = slot0.skillBtn1:GetComponent(&quot;EventTriggerListener&quot;)
	slot0.eventSkillBtn2 = slot0.skillBtn2:GetComponent(&quot;EventTriggerListener&quot;)
	slot0.eventSkillBtn3 = slot0.skillBtn3:GetComponent(&quot;EventTriggerListener&quot;)
	slot0.eventSkillBtn4 = slot0.skillBtn4:GetComponent(&quot;EventTriggerListener&quot;)
	slot0.mask = findTF(slot0.interface, &quot;mask&quot;)
	slot0.topArea = findTF(slot0.interface, &quot;top&quot;)
	slot0.cg = slot0._tf:GetComponent(typeof(CanvasGroup))
	slot0.topLayerCg = slot0._parentTf.parent:Find(&quot;blur_panel&quot;):GetComponent(typeof(CanvasGroup))

	setActive(slot0._tf, true)
	setText(slot0._tf:Find(&quot;editor/editing_region/mask/middle/Text&quot;), i18n(&quot;settings_battle_tip&quot;))
	setText(slot0._tf:Find(&quot;editor/buttons/normal/edit/Image&quot;), i18n(&quot;settings_battle_Btn_edit&quot;))
	setText(slot0._tf:Find(&quot;editor/buttons/normal/reset/Image&quot;), i18n(&quot;settings_battle_Btn_reset&quot;))
	setText(slot0._tf:Find(&quot;editor/title&quot;), i18n(&quot;settings_battle_title&quot;))
	setText(slot0._tf:Find(&quot;editor/buttons/editing/save/Image&quot;), i18n(&quot;settings_battle_Btn_save&quot;))
	setText(slot0._tf:Find(&quot;editor/buttons/editing/cancel/Image&quot;), i18n(&quot;settings_battle_Btn_cancel&quot;))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.editBtn, function ()
		uv0:EditModeEnabled(true)
	end, SFX_PANEL)
	onButton(slot0, slot0.revertBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			hideNo = false,
			content = i18n(&quot;setting_interface_revert_check&quot;),
			onYes = function ()
				uv0:RevertInterfaceSetting(true)
			end
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.cancelBtn, function ()
		if uv0._currentDrag then
			LuaHelper.triggerEndDrag(uv0._currentDrag)
		end

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			hideNo = false,
			content = i18n(&quot;setting_interface_cancel_check&quot;),
			onYes = function ()
				uv0:EditModeEnabled(false)
				uv0:RevertInterfaceSetting(false)
			end
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.saveBtn, function ()
		if uv0._currentDrag then
			LuaHelper.triggerEndDrag(uv0._currentDrag)
		end

		uv0:EditModeEnabled(false)
		uv0:SaveInterfaceSetting()
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;setting_interface_save_success&quot;))
	end, SFX_PANEL)
	slot0:InitInterfaceComponents()
end

slot0.InitInterfaceComponents = function(slot0)
	slot0:InitInterfaceComponent(slot0.stick, slot0.eventStick, uv0, uv1, ys.Battle.BattleConfig.JOY_STICK_DEFAULT_PREFERENCE)

	slot2 = ys.Battle.BattleConfig.SKILL_BUTTON_DEFAULT_PREFERENCE

	slot0:InitInterfaceComponent(slot0.skillBtn1, slot0.eventSkillBtn1, uv2, uv3, slot2[1])
	slot0:InitInterfaceComponent(slot0.skillBtn2, slot0.eventSkillBtn2, uv4, uv5, slot2[2])
	slot0:InitInterfaceComponent(slot0.skillBtn3, slot0.eventSkillBtn3, uv6, uv7, slot2[3])

	slot7 = uv8

	slot0:InitInterfaceComponent(slot0.skillBtn4, slot0.eventSkillBtn4, slot7, uv9, slot2[4])

	slot3 = slot0:GetScale()
	slot0.components = {
		slot0.topArea,
		slot0.stick,
		slot0.skillBtn1,
		slot0.skillBtn2,
		slot0.skillBtn3,
		slot0.skillBtn4
	}

	for slot7 = 2, #slot0.components do
		setLocalScale(slot0.components[slot7], slot3)
	end

	slot0:EditModeEnabled(false)
end

slot0.GetScale = function(slot0)
	slot5 = nil
	slot5 = rtf(slot0.interface).rect.width / rtf(slot0.interface).rect.height &gt; rtf(slot0._parentTf).rect.width / rtf(slot0._parentTf).rect.height and slot2 / slot4 or slot1 / slot3

	return Vector3.New(slot5, slot5, 1)
end

slot0.InitInterfaceComponent = function(slot0, slot1, slot2, slot3, slot4, slot5)
	slot8 = rtf(slot0._parentTf).rect.width * 0.5 + slot0.interface.localPosition.x + slot0.interface.parent.localPosition.x + slot0.interface.parent.parent.localPosition.x
	slot9 = rtf(slot0._parentTf).rect.height * 0.5 + slot0.interface.localPosition.y + slot0.interface.parent.localPosition.y + slot0.interface.parent.parent.localPosition.y
	slot10, slot11, slot12, slot13 = nil

	slot2:AddBeginDragFunc(function (slot0, slot1)
		uv0._currentDrag = uv1
		uv2 = uv3 / UnityEngine.Screen.width
		uv4 = uv5 / UnityEngine.Screen.height
		uv6 = uv7.localPosition.x
		uv8 = uv7.localPosition.y
	end)
	slot2:AddDragFunc(function (slot0, slot1)
		uv0.localPosition = Vector3(slot1.position.x * uv1 - uv2, slot1.position.y * uv3 - uv4, 0)

		uv5:CheckInterfaceIntersect()
	end)
	slot2:AddDragEndFunc(function (slot0, slot1)
		uv0._currentDrag = nil

		if uv0:CheckInterfaceIntersect() then
			uv1.localPosition = Vector3(uv2, uv3, 0)
		end

		uv0:CheckInterfaceIntersect()
	end)
	slot0:SetInterfaceAnchor(slot1, slot3, slot4, slot5)
end

slot0.EditModeEnabled = function(slot0, slot1)
	setActive(slot0.normalBtns, not slot1)
	setActive(slot0.mask, not slot1)
	setActive(slot0.editBtns, slot1)

	for slot5, slot6 in ipairs(slot0.components) do
		setActive(findTF(slot6, &quot;rect&quot;), slot1)

		if slot5 &gt; 1 then
			GetOrAddComponent(slot6, &quot;EventTriggerListener&quot;).enabled = slot1
		end
	end

	Input.multiTouchEnabled = not slot1
	slot0.topLayerCg.blocksRaycasts = not slot1
end

slot0.SetInterfaceAnchor = function(slot0, slot1, slot2, slot3, slot4, slot5)
	slot6, slot7 = nil

	if slot5 then
		slot6 = slot4.x
		slot7 = slot4.y
	else
		slot6 = PlayerPrefs.GetFloat(slot2, slot4.x)
		slot7 = PlayerPrefs.GetFloat(slot3, slot4.y)
	end

	slot1.localPosition = Vector3((slot6 - 0.5) * rtf(slot0.interface).rect.width, (slot7 - 0.5) * rtf(slot0.interface).rect.height, 0)
end

slot11 = function(slot0)
	slot1 = rtf(slot0)
	slot2 = slot1.rect
	slot3 = slot2.width * slot1.lossyScale.x
	slot4 = slot2.height * slot1.lossyScale.y
	slot5 = slot1.position

	return UnityEngine.Rect.New(slot5.x - slot3 / 2, slot5.y - slot4 / 2, slot3, slot4)
end

slot0.CheckInterfaceIntersect = function(slot0)
	slot1 = {}
	slot2 = false
	slot3 = {}
	slot4 = uv0(slot0.interface)

	for slot8, slot9 in ipairs(slot0.components) do
		slot3[slot9] = uv0(slot9:Find(&quot;rect&quot;))
	end

	for slot8, slot9 in ipairs(slot0.components) do
		for slot13, slot14 in ipairs(slot0.components) do
			if slot9 ~= slot14 and slot3[slot9]:Overlaps(slot3[slot14]) then
				slot1[slot14] = true
			end
		end

		if slot8 &gt; 1 then
			slot11 = Vector2.New(slot3[slot9].xMax, slot3[slot9].yMax)

			if not slot4:Contains(Vector2.New(slot3[slot9].xMin, slot3[slot9].yMin)) or not slot4:Contains(slot11) then
				slot1[slot9] = true
			end
		end
	end

	for slot8, slot9 in ipairs(slot0.components) do
		slot10 = findTF(slot9, &quot;rect&quot;):GetComponent(typeof(Image))

		if slot1[slot9] then
			slot10.color = uv1.CLD_RED
			slot2 = true
		else
			slot10.color = uv1.DEFAULT_GREY
		end
	end

	return slot2
end

slot0.RevertInterfaceSetting = function(slot0, slot1)
	slot3 = ys.Battle.BattleConfig.SKILL_BUTTON_DEFAULT_PREFERENCE

	slot0:SetInterfaceAnchor(slot0.stick, uv0, uv1, ys.Battle.BattleConfig.JOY_STICK_DEFAULT_PREFERENCE, slot1)
	slot0:SetInterfaceAnchor(slot0.skillBtn1, uv2, uv3, slot3[1], slot1)
	slot0:SetInterfaceAnchor(slot0.skillBtn2, uv4, uv5, slot3[2], slot1)
	slot0:SetInterfaceAnchor(slot0.skillBtn3, uv6, uv7, slot3[3], slot1)
	slot0:SetInterfaceAnchor(slot0.skillBtn4, uv8, uv9, slot3[4], slot1)
	slot0:SaveInterfaceSetting()
end

slot0.SaveInterfaceSetting = function(slot0)
	slot0:OverrideInterfaceSetting(slot0.stick, uv0, uv1)
	slot0:OverrideInterfaceSetting(slot0.skillBtn1, uv2, uv3)
	slot0:OverrideInterfaceSetting(slot0.skillBtn2, uv4, uv5)
	slot0:OverrideInterfaceSetting(slot0.skillBtn3, uv6, uv7)
	slot0:OverrideInterfaceSetting(slot0.skillBtn4, uv8, uv9)
end

slot0.OverrideInterfaceSetting = function(slot0, slot1, slot2, slot3)
	slot4 = rtf(slot0.interface).rect.width
	slot5 = rtf(slot0.interface).rect.height

	PlayerPrefs.SetFloat(slot2, (slot1.localPosition.x + slot4 * 0.5) / slot4)
	PlayerPrefs.SetFloat(slot3, (slot1.localPosition.y + slot5 * 0.5) / slot5)
end

slot0.OnDestroy = function(slot0)
	ClearEventTrigger(slot0.eventStick)
	ClearEventTrigger(slot0.eventSkillBtn1)
	ClearEventTrigger(slot0.eventSkillBtn2)
	ClearEventTrigger(slot0.eventSkillBtn3)
	ClearEventTrigger(slot0.eventSkillBtn4)

	Input.multiTouchEnabled = true
end

slot0.Show = function(slot0)
	slot0.cg.blocksRaycasts = true
	slot0.cg.alpha = 1
end

slot0.Hide = function(slot0)
	slot0.cg.blocksRaycasts = false
	slot0.cg.alpha = 0
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>