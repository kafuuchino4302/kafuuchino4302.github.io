<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>settingsmaingroupbtn.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>settingsmaingroupbtn.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;SettingsMainGroupBtn&quot;)

slot0.Ctor = function(slot0, slot1)
	pg.DelegateInfo.New(slot0)
	slot0:initData()
	slot0:findUI(slot1)
	slot0:addListener()
	slot0:check()
end

slot0.Dispose = function(slot0)
	pg.DelegateInfo.Dispose(slot0)

	if slot0.timer then
		slot0.timer:Stop()

		slot0.timer = nil
	end
end

slot0.initData = function(slot0)
	slot1 = pg.SettingsGroupMgr
	slot0.mgr = slot1:GetInstance()
	slot0.infoName = &quot;MainGroup&quot;
	slot0.groupNameList = {
		PaintingGroupConst.PaintingGroupName
	}
end

slot0.findUI = function(slot0, slot1)
	slot0._tf = slot1
	slot2 = findTF(slot0._tf, &quot;Content&quot;)
	slot0.titleText = findTF(slot2, &quot;Title&quot;)
	slot0.progressBar = findTF(slot2, &quot;Progress&quot;)
	slot0.btn = findTF(slot2, &quot;Btn&quot;)
	slot0.btnText = findTF(slot0.btn, &quot;Text&quot;)
	slot0.loadingIcon = findTF(slot2, &quot;Status/Loading&quot;)
	slot0.newIcon = findTF(slot2, &quot;Status/New&quot;)
	slot0.finishIcon = findTF(slot2, &quot;Status/Finish&quot;)

	setText(slot0.titleText, i18n(&quot;setting_resdownload_title_main_group&quot;))
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0._tf, function ()
		if uv0.mgr:GetState(uv0.infoName) ~= pg.SettingsGroupMgr.State.Updating then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				type = MSGBOX_TYPE_NORMAL,
				content = string.format(i18n(&quot;main_group_msgbox_content&quot;, HashUtil.BytesToString(uv0.mgr:GetTotalSize(uv0.groupNameList)))),
				onYes = function ()
					GroupMainHelper.SavePrefs(DMFileChecker.Prefs.Max)
					uv0.mgr:StartDownload(uv0.infoName, uv0.groupNameList)
				end
			})
		end
	end, SFX_PANEL)
end

slot0.check = function(slot0)
	slot0.timer = Timer.New(function ()
		uv0:updateUI()
	end, 0.5, -1)

	slot0.timer:Start()
	slot0:updateUI()
end

slot0.updateUI = function(slot0)
	if slot0.mgr:GetState(slot0.infoName) == pg.SettingsGroupMgr.State.None then
		setText(slot0.btnText, i18n(&quot;word_maingroup_checktoupdate&quot;))
		setActive(slot0.loadingIcon, false)
		setActive(slot0.newIcon, true)
		setActive(slot0.finishIcon, false)
	elseif slot1 == pg.SettingsGroupMgr.State.Updating then
		setText(slot0.btnText, i18n(&quot;word_maingroup_updating&quot;))
		setActive(slot0.loadingIcon, true)
		setActive(slot0.newIcon, false)
		setActive(slot0.finishIcon, false)

		slot2, slot3 = slot0.mgr:GetCountProgress(slot0.infoName)

		setSlider(slot0.progressBar, 0, slot3, slot2)
		setText(slot0.btnText, slot2 .. &quot;/&quot; .. slot3)
	elseif slot1 == pg.SettingsGroupMgr.State.Success then
		setText(slot0.btnText, i18n(&quot;word_maingroup_updatesuccess&quot;))
		setActive(slot0.loadingIcon, false)
		setActive(slot0.newIcon, false)
		setActive(slot0.finishIcon, true)
	elseif slot1 == pg.SettingsGroupMgr.State.Fail then
		setText(slot0.btnText, i18n(&quot;word_maingroup_updatefailure&quot;))
		setActive(slot0.loadingIcon, false)
		setActive(slot0.newIcon, false)
		setActive(slot0.finishIcon, false)
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>