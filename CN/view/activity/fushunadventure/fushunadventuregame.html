<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fushunadventuregame.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>fushunadventuregame.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;FushunAdventureGame&quot;)
slot1 = false
slot2 = 0
slot3 = 1
slot4 = 2
slot5 = 3
slot6 = 4

slot0.Ctor = function(slot0, slot1, slot2, slot3)
	pg.DelegateInfo.New(slot0)

	slot0.state = uv0
	slot0._go = slot1
	slot0.gameData = slot2
	slot0.highestScore = (slot3:GetRuntimeData(&quot;elements&quot;) or {})[1] or 0

	slot0:Init()
end

slot0.SetOnShowResult = function(slot0, slot1)
	slot0.OnShowResult = slot1
end

slot0.SetOnLevelUpdate = function(slot0, slot1)
	slot0.OnLevelUpdate = slot1
end

slot0.setRoomTip = function(slot0, slot1)
	slot0.helpTip = slot1
end

slot0.setRoomId = function(slot0, slot1)
	slot0.roomId = slot1
end

slot0.Init = function(slot0)
	if slot0.state ~= uv0 then
		return
	end

	slot0.state = uv1

	slot0:InitMainUI()

	slot0.helpTip = pg.gametip.fushun_adventure_help.tip
end

slot0.loadPrefab = function(slot0, slot1, slot2)
	slot3 = ResourceMgr.Inst

	slot3:getAssetAsync(slot1, &quot;&quot;, function (slot0)
		uv0(instantiate(slot0))
	end, true, true)
end

slot0.InitMainUI = function(slot0)
	slot1 = slot0._go

	onButton(slot0, findTF(slot1, &quot;btn_help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = uv0.helpTip
		})
	end, SFX_PANEL)
	onButton(slot0, findTF(slot1, &quot;btn_start&quot;), function ()
		pg.BgmMgr.GetInstance():StopPlay()
		uv0:StartGame()
	end, SFX_PANEL)

	slot0.levelList = UIItemList.New(findTF(slot1, &quot;levels/scrollrect/content&quot;), findTF(slot1, &quot;levels/scrollrect/content/level&quot;))
	slot0.arrUp = findTF(slot1, &quot;levels/arr_up&quot;)
	slot0.arrDown = findTF(slot1, &quot;levels/arr_bottom&quot;)

	onScroll(slot0, findTF(slot1, &quot;levels/scrollrect&quot;), function (slot0)
		setActive(uv0.arrUp, slot0.y &lt; 1)
		setActive(uv0.arrDown, slot0.y &gt; 0)
	end)
	slot0:RefreshLevels()
end

slot0.RefreshLevels = function(slot0)
	slot0.levelList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot2:Find(&quot;Text&quot;):GetComponent(typeof(Image)).sprite = GetSpriteFromAtlas(&quot;ui/minigameui/FushunAdventureGame_atlas&quot;, &quot;level_&quot; .. slot1 + 1)
			slot4 = slot1 &gt;= uv0.gameData.usedtime + (uv0.gameData.count &gt; 0 and 1 or 0)

			setActive(slot2:Find(&quot;lock&quot;), slot4)

			slot5 = slot1 &lt; uv0.gameData.usedtime

			setActive(slot2:Find(&quot;cleared&quot;), slot5)
			setActive(slot2:Find(&quot;Text&quot;), not slot4)

			if not slot5 and not uv1 then
				uv1 = slot1
			end

			slot2:GetComponent(typeof(Image)).enabled = not slot4
		end
	end)
	slot0.levelList:align(FushunAdventureGameConst.LEVEL_CNT)
	setActive(findTF(slot0._go, &quot;tip/got&quot;), slot0.gameData.ultimate ~= 0)

	if nil then
		setAnchoredPosition(slot0.levelList.container, {
			y = slot0.levelList.container.anchoredPosition.y + slot1 * (slot0.levelList.item.rect.height + 50)
		})
	end

	if slot0.OnLevelUpdate then
		slot0.OnLevelUpdate()
	end
end

slot0.InitGameUI = function(slot0)
	slot1 = slot0.gameUI
	slot0.btnA = findTF(slot1, &quot;UI/A&quot;)
	slot0.btnB = findTF(slot1, &quot;UI/B&quot;)
	slot0.btnAEffect = slot0.btnA:Find(&quot;effect&quot;)
	slot0.btnBEffect = slot0.btnB:Find(&quot;effect&quot;)
	slot0.btnAExEffect = slot0.btnA:Find(&quot;effect_ex&quot;)
	slot2 = slot0.btnB
	slot0.btnBExEffect = slot2:Find(&quot;effect_ex&quot;)
	slot0.keys = {
		findTF(slot1, &quot;UI/keys/1&quot;):GetComponent(typeof(Image)),
		findTF(slot1, &quot;UI/keys/2&quot;):GetComponent(typeof(Image)),
		findTF(slot1, &quot;UI/keys/3&quot;):GetComponent(typeof(Image))
	}
	slot0.btnSprites = {
		slot0.keys[1].sprite,
		slot0.btnA:GetComponent(typeof(Image)).sprite,
		slot0.btnB:GetComponent(typeof(Image)).sprite
	}
	slot0.hearts = {
		findTF(slot1, &quot;UI/heart_score/hearts/1/mark&quot;),
		findTF(slot1, &quot;UI/heart_score/hearts/2/mark&quot;),
		findTF(slot1, &quot;UI/heart_score/hearts/3/mark&quot;)
	}
	slot0.numbers = {
		findTF(slot1, &quot;UI/countdown_panel/timer/3&quot;),
		findTF(slot1, &quot;UI/countdown_panel/timer/2&quot;),
		findTF(slot1, &quot;UI/countdown_panel/timer/1&quot;)
	}
	slot0.scoreTxt = findTF(slot1, &quot;UI/heart_score/score/Text&quot;):GetComponent(typeof(Text))
	slot0.energyBar = findTF(slot1, &quot;UI/ex/bar&quot;):GetComponent(typeof(Image))
	slot0.energyIcon = findTF(slot1, &quot;UI/ex/icon&quot;)
	slot0.energyLight = findTF(slot1, &quot;UI/ex/light&quot;)
	slot0.exTipPanel = findTF(slot1, &quot;UI/ex_tip_panel&quot;)
	slot0.comboTxt = findTF(slot1, &quot;UI/combo/Text&quot;):GetComponent(typeof(Text))
	slot0.countdownPanel = findTF(slot1, &quot;UI/countdown_panel&quot;)
	slot0.resultPanel = findTF(slot1, &quot;UI/result_panel&quot;)
	slot0.resultCloseBtn = findTF(slot0.resultPanel, &quot;frame/close&quot;)
	slot0.resultHighestScoreTxt = findTF(slot0.resultPanel, &quot;frame/highest/Text&quot;):GetComponent(typeof(Text))
	slot0.resultScoreTxt = findTF(slot0.resultPanel, &quot;frame/score/Text&quot;):GetComponent(typeof(Text))
	slot0.msgboxPanel = findTF(slot1, &quot;UI/msg_panel&quot;)
	slot0.exitMsgboxWindow = findTF(slot0.msgboxPanel, &quot;frame/exit_mode&quot;)
	slot0.pauseMsgboxWindow = findTF(slot0.msgboxPanel, &quot;frame/pause_mode&quot;)
	slot0.helpWindow = findTF(slot1, &quot;UI/help&quot;)
	slot0.lightTF = findTF(slot1, &quot;game/range&quot;)
	slot0.lightMark = slot0.lightTF:Find(&quot;Image&quot;)
	slot0.pauseBtn = findTF(slot1, &quot;UI/pause&quot;)
	slot0.exitBtn = findTF(slot1, &quot;UI/back&quot;)
	slot0.energyBar.fillAmount = 0
end

slot0.EnterAnimation = function(slot0, slot1)
	setActive(slot0.countdownPanel, true)

	slot0.countdownTimer = Timer.New(function ()
		uv0 = uv0 + 1

		if uv0 &gt; 3 then
			setActive(uv1.countdownPanel, false)
			uv2()
		else
			uv3(uv0)
		end
	end, 1, 3)

	(function (slot0)
		for slot4, slot5 in ipairs(uv0.numbers) do
			setActive(slot5, slot4 == slot0)
		end
	end)(1)
	pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.COUNT_DOWN_VOICE)
	slot0.countdownTimer:Start()
end

slot0.ShowHelpWindow = function(slot0, slot1)
	setActive(slot0.helpWindow, true)
	onButton(slot0, slot0.helpWindow, function ()
		setActive(uv0.helpWindow, false)
		PlayerPrefs.SetInt(&quot;FushunAdventureGame&quot; .. getProxy(PlayerProxy):getRawData().id, 1)
		uv1()
	end, SFX_PANEL)
end

slot0.DisplayKey = function(slot0)
	slot1 = function(slot0, slot1)
		slot2 = nil

		if not slot1 or slot1 == &quot;&quot; then
			slot2 = uv0.btnSprites[1]
		elseif slot1 == &quot;A&quot; then
			slot2 = uv0.btnSprites[2]
		elseif slot1 == &quot;B&quot; then
			slot2 = uv0.btnSprites[3]
		end

		if slot0.sprite ~= slot2 then
			slot0.sprite = slot2
		end
	end

	for slot5, slot6 in ipairs(slot0.keys) do
		slot1(slot6, string.sub(slot0.key, slot5, slot5) or &quot;&quot;)
	end
end

slot0.DisplayeHearts = function(slot0, slot1)
	for slot5, slot6 in ipairs(slot0.hearts) do
		setActive(slot6, slot5 &lt;= slot1)
	end
end

slot0.DisplayScore = function(slot0)
	slot0.scoreTxt.text = slot0.score
end

slot0.DisplayeEnergy = function(slot0, slot1, slot2)
	slot3 = math.min(1, slot1 / slot2)
	slot0.energyBar.fillAmount = slot3

	setAnchoredPosition(slot0.energyIcon, {
		x = math.max(0, slot0.energyIcon.parent.rect.width * slot3 - slot0.energyIcon.rect.width)
	})

	slot6 = 0

	if slot3 &gt;= 1 then
		slot6 = tf(slot0.energyBar.gameObject).rect.width
	elseif slot4 &gt; 0 then
		slot6 = slot4
	end

	setActive(slot0.energyLight, slot3 &gt;= 0.01)

	slot0.energyLight.sizeDelta = Vector2(slot6, slot0.energyLight.sizeDelta.y)
end

slot0.SetGameStateCallback = function(slot0, slot1, slot2)
	slot0._startCallback = slot1
	slot0._endCallback = slot2
end

slot0.StartGame = function(slot0)
	if slot0.state ~= uv0 then
		return
	end

	if slot0._startCallback then
		slot0._startCallback()
	end

	slot0.enemys = {}
	slot0.hitList = {}
	slot0.missFlags = {}
	slot0.score = 0
	slot0.combo = 0
	slot0.pause = false
	slot0.schedule = FushunSchedule.New()
	slot0.specailSchedule = FushunSchedule.New()

	slot0:LoadScene(function ()
		uv0:EnterGame()
		pg.BgmMgr.GetInstance():Push(uv0.__cname, FushunAdventureGameConst.GAME_BGM_NAME)
	end)

	slot0.state = uv1
end

slot0.LoadScene = function(slot0, slot1)
	seriesAsync({
		function (slot0)
			if uv0.gameUI then
				setActive(uv0.gameUI, true)
				slot0()
			else
				slot1 = uv0

				slot1:loadPrefab(&quot;ui/FushunAdventureGame&quot;, function (slot0)
					uv0.gameUI = slot0

					slot0.transform:SetParent(uv0._go.transform, false)
					uv0:InitGameUI()
					uv1()
				end)
			end
		end,
		function (slot0)
			uv0:DisplayeHearts(3)
			uv0:DisplayScore()
			uv0:DisplayeEnergy(0, 1)

			if not (PlayerPrefs.GetInt(&quot;FushunAdventureGame&quot; .. getProxy(PlayerProxy):getRawData().id, 0) &gt; 0) then
				uv0:ShowHelpWindow(slot0)
			else
				slot0()
			end
		end,
		function (slot0)
			parallelAsync({
				function (slot0)
					uv0:EnterAnimation(slot0)
				end,
				function (slot0)
					slot1 = uv0

					slot1:loadPrefab(&quot;ui/fa_fushun&quot;, function (slot0)
						uv0.fushun = FushunChar.New(slot0)

						uv0.fushun:SetPosition(FushunAdventureGameConst.FUSHUN_INIT_POSITION)
						slot0.transform:SetParent(uv0.gameUI.transform:Find(&quot;game&quot;), false)
						uv1()
					end)
				end
			}, slot0)
		end
	}, slot1)
end

slot0.EnterGame = function(slot0)
	if not slot0.handle then
		slot0.handle = UpdateBeat:CreateListener(slot0.UpdateGame, slot0)
	end

	slot1 = UpdateBeat

	slot1:AddListener(slot0.handle)

	slot0.lightTF.sizeDelta = Vector2(FushunAdventureGameConst.FUSHUN_ATTACK_RANGE, slot0.lightTF.sizeDelta.y)
	slot4 = slot0.fushun
	slot0.lightTF.localPosition = Vector2(FushunAdventureGameConst.FUSHUN_ATTACK_DISTANCE + slot4:GetPosition().x, slot0.lightTF.localPosition.y)

	slot0:SpawnEnemys()
	slot0:RegisterEventListener()

	slot0.key = &quot;&quot;
	slot1 = slot0.fushun

	slot1:SetOnAnimEnd(function ()
		uv0.key = &quot;&quot;

		uv0:DisplayKey()
	end)
end

slot0.UpdateGame = function(slot0)
	if slot0.state == uv0 then
		slot0:ExitGame(true)

		return
	end

	if not slot0.pause then
		slot0.spawner:Update()
		slot0:AddDebugInput()

		if slot0.fushun:IsDeath() then
			slot0.fushun:Die()

			slot0.state = uv0

			return
		elseif slot0.fushun:ShouldInvincible() then
			slot0:EnterInvincibleMode()
		elseif slot0.fushun:ShouldVincible() then
			slot0:ExitInvincibleMode()
		end

		slot1 = false

		for slot5 = #slot0.enemys, 1, -1 do
			if slot0.enemys[slot5]:IsFreeze() then
				-- Nothing
			elseif slot0:CheckEnemyDeath(slot5) then
				-- Nothing
			else
				slot6:Move()
				slot0:CheckCollision(slot0.fushun, slot6)

				if slot0:CheckAttackRange(slot6) then
					slot1 = true
				end
			end
		end

		slot0:RangeLightDisplay(slot1)
		slot0:DisplayeEnergy(slot0.fushun:GetEnergy(), slot0.fushun:GetEnergyTarget())
		slot0.specailSchedule:Update()
	else
		for slot4 = #slot0.enemys, 1, -1 do
			slot0:CheckEnemyDeath(slot4)
		end
	end

	slot0.schedule:Update()
end

slot0.RangeLightDisplay = function(slot0, slot1)
	setActive(slot0.lightMark, slot1)
end

slot0.CheckAttackRange = function(slot0, slot1)
	return slot1:GetPosition().x &lt;= slot0.fushun:GetAttackPosition().x
end

slot0.CheckEnemyDeath = function(slot0, slot1)
	slot2 = false

	if slot0.enemys[slot1]:IsDeath() then
		if slot0.hitList[slot3.index] and not slot3:IsEscape() then
			slot0:AddScore(slot3:GetScore())
			slot0:AddEnergy(slot3:GetEnergyScore())
		end

		slot3:Vanish()
		table.remove(slot0.enemys, slot1)

		slot2 = true
	end

	return slot2
end

slot0.EnterInvincibleMode = function(slot0)
	slot2 = FushunAdventureGameConst.EX_TIME

	slot0.fushun:Invincible()
	setActive(slot0.exTipPanel, true)

	slot0.pause = true

	blinkAni(slot0.energyBar.gameObject, 0.5, -1)
	slot0.schedule:AddSchedule(FushunAdventureGameConst.EX_TIP_TIME, 1, function ()
		setActive(uv0.exTipPanel, false)
		uv0.spawner:CarzyMode()

		uv0.pause = false

		uv0.fushun:StartAction(&quot;EX&quot;)
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.ENTER_EX_VOICE)

		slot1 = uv0.fushun:GetEnergyTarget() / uv1

		uv0.specailSchedule:AddSchedule(1, uv1, function ()
			uv0.fushun:ReduceEnergy(uv1)
		end)
	end)
	setActive(slot0.btnAExEffect, true)
	setActive(slot0.btnBExEffect, true)

	slot0.key = &quot;&quot;

	slot0:DisplayKey()
end

slot0.ExitInvincibleMode = function(slot0)
	slot0.fushun:Vincible()

	slot4 = 1
	slot5 = 1
	slot0.energyBar.color = Color.New(1, slot4, slot5, 1)

	LeanTween.cancel(slot0.energyBar.gameObject)

	for slot4, slot5 in ipairs(slot0.enemys) do
		slot0.hitList[slot5.index] = nil

		slot5:Die()
	end

	slot0.spawner:NormalMode()
	setActive(slot0.btnAExEffect, false)
	setActive(slot0.btnBExEffect, false)
end

slot0.CheckCollision = function(slot0, slot1, slot2)
	if uv0.IsCollision(slot2.effectCollider2D, slot1.collider2D) then
		slot1:Hurt()
		slot2:OnHit()
		slot0:DisplayeHearts(slot0.fushun:GetHp())
		slot0:AddCombo(-slot0.combo)
	elseif slot0.fushun:InvincibleState() and not slot2:IsDeath() and slot2:GetPosition().x &lt;= slot1:GetAttackPosition().x then
		slot2:Hurt(1)

		slot0.hitList[slot2.index] = true

		slot0:AddHitEffect(slot2)
	elseif uv0.IsNearby(slot1:GetPosition(), slot2:GetAttackPosition()) then
		slot2:Attack()
	end
end

slot0.AddHitEffect = function(slot0, slot1)
	slot6 = Vector3(slot0.gameUI.transform:InverseTransformPoint(slot1.collider2D.bounds:GetMin()).x, slot0.gameUI.transform:InverseTransformPoint(slot0.fushun.effectCollider2D.bounds.center).y, 0)

	slot0:loadPrefab(&quot;ui/fa_attack_effect&quot;, function (slot0)
		slot0.transform:SetParent(uv0.gameUI.transform, false)

		slot0.transform.localPosition = uv1

		slot0:GetComponent(typeof(DftAniEvent)):SetEndEvent(function ()
			uv0:SetEndEvent(nil)

			if uv1 then
				Destroy(uv1)
			end
		end)
	end)
	slot0:ShakeScreen(slot0.gameUI)
end

slot0.ShakeScreen = function(slot0, slot1)
	if LeanTween.isTweening(slot1) then
		LeanTween.cancel(slot1)
	end

	slot2 = LeanTween.rotateAroundLocal(slot1, Vector3(0, 0, 1), FushunAdventureGameConst.SHAKE_RANGE, FushunAdventureGameConst.SHAKE_TIME)
	slot2 = slot2:setLoopPingPong(FushunAdventureGameConst.SHAKE_LOOP_CNT)
	slot2 = slot2:setFrom(-1 * FushunAdventureGameConst.SHAKE_RANGE)

	slot2:setOnComplete(System.Action(function ()
		uv0.transform.localEulerAngles = Vector3(0, 0, 0)
	end))
end

slot0.SpawnEnemys = function(slot0)
	slot1 = {
		FushunBeastChar,
		FushunEliteBeastChar,
		FushunEliteBeastChar
	}

	slot2 = function(slot0)
		slot2 = nil

		for slot6, slot7 in ipairs(FushunAdventureGameConst.SPEED_ADDITION) do
			slot9 = slot7[1][2]

			if slot7[1][1] &lt;= slot0 and slot0 &lt;= slot9 then
				slot2 = slot7

				break
			end
		end

		return (slot2 or slot1[#slot1])[2]
	end

	slot0.spawner = FuShunEnemySpawner.New(slot0.gameUI.transform:Find(&quot;game&quot;).transform, function (slot0)
		slot1 = slot0.config
		slot3 = slot0.index
		slot4 = uv0[slot1.id].New(slot0.go, slot3, slot1)
		slot6 = slot0.speed + uv1(uv2.score)

		uv3.LOG(&quot;  顺序 :&quot;, slot3, &quot; id :&quot;, slot1.id, &quot; speed :&quot;, slot6)
		slot4:SetSpeed(slot6)
		slot4:SetPosition(FushunAdventureGameConst.ENEMY_SPAWN_POSITION)
		table.insert(uv2.enemys, slot4)
	end)

	slot0.spawner:NormalMode()
end

slot0.AddScore = function(slot0, slot1)
	slot0:AddCombo(1)

	slot0.score = slot0.score + slot1 + (FushunAdventureGameConst.COMBO_SCORE_TARGET &lt;= slot0.combo and FushunAdventureGameConst.COMBO_EXTRA_SCORE or 0)

	slot0:DisplayScore()
	slot0.spawner:UpdateScore(slot0.score)
end

slot0.AddEnergy = function(slot0, slot1)
	slot0.fushun:AddEnergy(slot1)
end

slot0.AddCombo = function(slot0, slot1)
	if slot1 &gt; 0 then
		slot0:loadPrefab(&quot;UI/fushun_combo&quot;, function (slot0)
			slot0.transform:SetParent(uv0.gameUI.transform:Find(&quot;UI&quot;), false)

			slot1 = nil

			Timer.New(function ()
				if uv0 then
					Destroy(uv0)
				end

				if uv1 then
					uv1:Stop()

					uv1 = nil
				end
			end, 1, 1):Start()
		end)
	end

	slot0.combo = slot0.combo + slot1
	slot0.comboTxt.text = slot0.combo

	setActive(slot0.comboTxt.gameObject.transform.parent, slot0.combo &gt; 0)
end

slot0.Action = function(slot0, slot1)
	if slot0.fushun:InvincibleState() then
		slot0:AddScore(FushunAdventureGameConst.EX_CLICK_SCORE)
	else
		slot0:OnFushunAttack(slot1)
	end
end

slot0.OnFushunAttack = function(slot0, slot1)
	if #slot0.key == 3 or slot0.fushun:IsMissState() or slot0.fushun:IsDamageState() then
		return
	end

	slot0.key = slot0.key .. slot1

	slot0:DisplayKey()

	slot2 = {}
	slot3 = slot0.fushun

	for slot7, slot8 in ipairs(slot0.enemys) do
		if not slot8:WillDeath() and slot8:GetPosition().x &lt;= slot3:GetAttackPosition().x then
			table.insert(slot2, slot7)
		end
	end

	slot4 = slot0.fushun

	slot4:TriggerAction(slot0.key, function ()
		if #uv0 == 0 then
			uv1.fushun:Miss()
		end

		uv1.key = &quot;&quot;

		uv1:DisplayKey()
	end)

	if #slot2 &gt; 0 then
		for slot7, slot8 in ipairs(slot2) do
			slot9 = slot0.enemys[slot8]

			slot9:Hurt(1)

			slot0.hitList[slot9.index] = true

			slot0:AddHitEffect(slot9)
		end
	end
end

slot0.PauseGame = function(slot0)
	slot0.pause = true
end

slot0.ResumeGame = function(slot0)
	slot0.pause = false
end

slot0.ExitGame = function(slot0, slot1)
	slot2 = function()
		uv0:ClearGameScene()
	end

	if slot0.btnA then
		ClearEventTrigger(slot0.btnA:GetComponent(&quot;EventTriggerListener&quot;))
	end

	if slot0.btnB then
		ClearEventTrigger(slot0.btnB:GetComponent(&quot;EventTriggerListener&quot;))
	end

	if slot0.handle then
		UpdateBeat:RemoveListener(slot0.handle)

		slot0.handle = nil
	end

	if slot0.schedule then
		slot0.schedule:Dispose()

		slot0.schedule = nil
	end

	if slot0.specailSchedule then
		slot0.specailSchedule:Dispose()

		slot0.specailSchedule = nil
	end

	if slot1 then
		if slot0.OnShowResult then
			slot0.OnShowResult(slot0.score)
		end

		slot0:ShowResultWindow(function ()
			uv0()
		end)
	else
		slot2()
	end
end

slot0.ClearGameScene = function(slot0)
	if slot0.fushun then
		slot0.fushun:Destory()

		slot0.fushun = nil
	end

	if slot0.spawner then
		slot0.spawner:Dispose()

		slot0.spawner = nil
	end

	if slot0.enemys then
		for slot4, slot5 in ipairs(slot0.enemys) do
			slot5:Dispose()
		end

		slot0.enemys = nil
	end

	slot0.state = uv0

	if slot0.gameUI then
		slot0:HideExitMsgbox()
		slot0:HideResultWindow()
		slot0:HidePauseMsgbox()
		setActive(slot0.gameUI, false)
		pg.BgmMgr.GetInstance():Push(slot0.__cname, FushunAdventureGameConst.BGM_NAME)
	end

	if slot0._endCallback then
		slot0._endCallback()
	end
end

slot0.IsStarting = function(slot0)
	return slot0.state == uv0
end

slot0.Dispose = function(slot0)
	if slot0.countdownTimer then
		slot0.countdownTimer:Stop()

		slot0.countdownTimer = nil
	end

	slot0._startCallback = nil
	slot0._endCallback = nil

	slot0:ExitGame()
	pg.DelegateInfo.Dispose(slot0)

	if slot0.gameUI then
		Destroy(slot0.gameUI)

		slot0.gameUI = nil
	end

	slot0._go = nil
	slot0.btnSprites = nil
	slot0.state = uv0
	slot0.OnShowResult = nil
	slot0.OnLevelUpdate = nil
end

slot0.AddDebugInput = function(slot0)
	if IsUnityEditor then
		if Input.GetKeyDown(KeyCode.A) then
			slot0:OnShowBtnEffect(&quot;A&quot;, true)
		end

		if Input.GetKeyUp(KeyCode.A) then
			slot0:Action(&quot;A&quot;)
			slot0:OnShowBtnEffect(&quot;A&quot;, false)
			pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.A_BTN_VOICE)
		end

		if Input.GetKeyDown(KeyCode.S) then
			slot0:OnShowBtnEffect(&quot;B&quot;, true)
		end

		if Input.GetKeyUp(KeyCode.S) then
			slot0:Action(&quot;B&quot;)
			slot0:OnShowBtnEffect(&quot;B&quot;, false)
			pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.B_BTN_VOICE)
		end
	end
end

slot0.RegisterEventListener = function(slot0)
	slot1 = slot0.btnA
	slot1 = slot1:GetComponent(&quot;EventTriggerListener&quot;)

	slot1:AddPointDownFunc(function ()
		uv0:OnShowBtnEffect(&quot;A&quot;, true)
	end)
	slot1:AddPointExitFunc(function ()
		uv0:OnShowBtnEffect(&quot;A&quot;, false)
	end)
	slot1:AddPointUpFunc(function ()
		if uv0.pause then
			return
		end

		uv0:Action(&quot;A&quot;)
		uv0:OnShowBtnEffect(&quot;A&quot;, false)
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.A_BTN_VOICE)
	end)

	slot2 = slot0.btnB
	slot2 = slot2:GetComponent(&quot;EventTriggerListener&quot;)

	slot2:AddPointDownFunc(function ()
		uv0:OnShowBtnEffect(&quot;B&quot;, true)
	end)
	slot2:AddPointExitFunc(function ()
		uv0:OnShowBtnEffect(&quot;B&quot;, false)
	end)
	slot2:AddPointUpFunc(function ()
		if uv0.pause then
			return
		end

		uv0:Action(&quot;B&quot;)
		uv0:OnShowBtnEffect(&quot;B&quot;, false)
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(FushunAdventureGameConst.B_BTN_VOICE)
	end)
	onButton(slot0, slot0.pauseBtn, function ()
		uv0:ShowPauseMsgbox()
	end, SFX_PANEL)
	onButton(slot0, slot0.exitBtn, function ()
		uv0:ShowExitMsgbox()
	end, SFX_PANEL)
end

slot0.OnShowBtnEffect = function(slot0, slot1, slot2)
	setActive(slot0[&quot;btn&quot; .. slot1 .. &quot;Effect&quot;], slot2)
end

slot0.ShowResultWindow = function(slot0, slot1)
	setActive(slot0.resultPanel, true)
	onButton(slot0, slot0.resultCloseBtn, function ()
		uv0:HideResultWindow()

		if uv1 then
			uv1()
		end
	end, SFX_PANEL)

	if slot0.roomId then
		slot0.highestScore = getProxy(GameRoomProxy):getRoomScore(slot0.roomId)
	end

	slot0.resultHighestScoreTxt.text = slot0.highestScore
	slot0.resultScoreTxt.text = slot0.score

	if slot0.highestScore &lt; slot0.score then
		slot0.highestScore = slot0.score
	end
end

slot0.HideResultWindow = function(slot0)
	setActive(slot0.resultPanel, false)
end

slot0.ShowPauseMsgbox = function(slot0)
	slot0:PauseGame()
	setActive(slot0.msgboxPanel, true)
	setActive(slot0.pauseMsgboxWindow, true)
	setActive(slot0.exitMsgboxWindow, false)

	slot3 = slot0.pauseMsgboxWindow

	onButton(slot0, slot3:Find(&quot;continue_btn&quot;), function ()
		uv0:ResumeGame()
		uv0:HidePauseMsgbox()
	end, SFX_PANEL)
end

slot0.HidePauseMsgbox = function(slot0)
	setActive(slot0.msgboxPanel, false)
	setActive(slot0.pauseMsgboxWindow, false)
end

slot0.ShowExitMsgbox = function(slot0)
	slot0:PauseGame()
	setActive(slot0.msgboxPanel, true)
	setActive(slot0.pauseMsgboxWindow, false)
	setActive(slot0.exitMsgboxWindow, true)

	slot3 = slot0.exitMsgboxWindow

	onButton(slot0, slot3:Find(&quot;cancel_btn&quot;), function ()
		uv0:ResumeGame()
		uv0:HideExitMsgbox()
	end, SFX_PANEL)

	slot3 = slot0.exitMsgboxWindow

	onButton(slot0, slot3:Find(&quot;confirm_btn&quot;), function ()
		uv0:HideExitMsgbox()

		if uv0.OnShowResult then
			uv0.OnShowResult(uv0.score)
		end

		uv0:ExitGame()
	end, SFX_PANEL)
end

slot0.HideExitMsgbox = function(slot0)
	setActive(slot0.msgboxPanel, false)
	setActive(slot0.exitMsgboxWindow, false)
end

slot0.IsCollision = function(slot0, slot1)
	return slot0.enabled and slot1.enabled and slot0.gameObject.activeSelf and slot0.bounds:Intersects(slot1.bounds)
end

slot0.IsNearby = function(slot0, slot1)
	return slot1.x - slot0.x &lt;= 0
end

slot0.LOG = function(...)
	if uv0 then
		print(...)
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>