<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>inviterpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>inviterpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;InviterPage&quot;)
slot0.REFRESH_TIME = 1800

slot0.Ctor = function(slot0, slot1, slot2)
	pg.DelegateInfo.New(slot0)

	slot0._event = slot2
	slot0._go = slot1
	slot0._tf = tf(slot1)
	slot0.ptTxt = slot0._tf:Find(&quot;pt_panel/slider/Text&quot;):GetComponent(typeof(Text))
	slot0.phaseTotalTxt = slot0._tf:Find(&quot;pt_panel/total_progress&quot;):GetComponent(typeof(Text))
	slot0.phaseTxt = slot0._tf:Find(&quot;pt_panel/progress&quot;):GetComponent(typeof(Text))
	slot0.progress = slot0._tf:Find(&quot;pt_panel/slider&quot;)
	slot0.getBtn = slot0._tf:Find(&quot;pt_panel/get&quot;)
	slot0.awardTF = slot0._tf:Find(&quot;pt_panel/item&quot;)
	slot0.awardOverView = slot0._tf:Find(&quot;pt_panel/award_overview&quot;)
	slot0.bg = slot0._tf:Find(&quot;bg&quot;):GetComponent(typeof(Image))
	slot0.returnerList = UIItemList.New(slot0._tf:Find(&quot;returners/content&quot;), slot0._tf:Find(&quot;returners/content/tpl&quot;))
	slot0.help = slot0._tf:Find(&quot;help&quot;)
	slot0.pushBtn = slot0._tf:Find(&quot;push_btn&quot;)
	slot0.pushedBtn = slot0._tf:Find(&quot;pushed_btn&quot;)
	slot0.pushDisBtn = slot0._tf:Find(&quot;push_btn_dis&quot;)
	slot0.codeTxt = slot0._tf:Find(&quot;code&quot;):GetComponent(typeof(Text))
	slot0.taskLockPanel = slot0._tf:Find(&quot;task_lock_panel&quot;)

	setText(slot0.taskLockPanel:Find(&quot;Text&quot;), i18n(&quot;word_sell_lock&quot;))

	slot0.taskPanel = slot0._tf:Find(&quot;task_panel&quot;)
	slot0.taskItemTF = slot0._tf:Find(&quot;task_panel/item&quot;)
	slot0.taskProgress = slot0._tf:Find(&quot;task_panel/progress&quot;)
	slot0.taskDesc = slot0._tf:Find(&quot;task_panel/desc&quot;)
	slot0.taskGoBtn = slot0._tf:Find(&quot;task_panel/go&quot;)
	slot0.taskGotBtn = slot0._tf:Find(&quot;task_panel/got&quot;)
	slot0.taskGetBtn = slot0._tf:Find(&quot;task_panel/get&quot;)
	slot0.taskProgressTxt = slot0._tf:Find(&quot;task_panel/p&quot;):GetComponent(typeof(Text))

	slot0:Init()
end

slot0.Init = function(slot0)
	onButton(slot0, slot0.getBtn, function ()
		uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
			activity_id = uv0.activity.id,
			cmd = ActivityConst.RETURN_AWARD_OP_GET_AWARD,
			arg1 = uv0.nextTarget
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.awardOverView, function ()
		uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
			cmd = ActivityConst.RETURN_AWARD_OP_SHOW_AWARD_OVERVIEW,
			arg1 = {
				dropList = uv0.config.drop_client,
				targets = uv0.config.target,
				fetchList = uv0.fetchList,
				count = uv0.pt,
				resId = uv0.config.pt
			}
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.pushBtn, function ()
		if uv0.isPush then
			return
		end

		if not uv0.returners or #uv0.returners &gt;= 3 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;returner_max_count&quot;))

			return
		end

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			content = i18n(&quot;returner_push_tip&quot;),
			onYes = function ()
				uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
					activity_id = uv0.activity.id,
					cmd = ActivityConst.RETURN_AWARD_OP_PUSH_UID,
					arg1 = uv0.code
				})
			end
		})
	end, SFX_PANEL)
end

slot0.Update = function(slot0, slot1)
	slot0.activity = slot1
	slot2 = pg.TimeMgr.GetInstance():GetServerTime()

	if not ActivityMainScene.FetchReturnersTime or ActivityMainScene.FetchReturnersTime &lt;= slot2 then
		ActivityMainScene.FetchReturnersTime = slot2 + uv0.REFRESH_TIME

		slot0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
			activity_id = slot0.activity.id,
			cmd = ActivityConst.RETURN_AWARD_OP_GET_RETRUNERS
		})

		return
	end

	slot0:UpdateData()
	slot0:UpdateUI()
	slot0:UpdateReturners()
end

slot0.getTotalPt = function(slot0, slot1)
	slot2 = 0

	for slot6, slot7 in ipairs(slot0.returners) do
		slot2 = slot2 + slot7:getPt()
	end

	return slot2 + slot1
end

slot0.UpdateData = function(slot0)
	slot0.isPush = slot0.activity.data2_list[1] == 1
	slot0.code = getProxy(PlayerProxy):getRawData().id
	slot0.fetchList = slot1.data1_list
	slot0.config = pg.activity_template_headhunting[slot1.id]
	slot0.targets = slot0.config.target
	slot0.nextIndex = -1

	for slot5 = 1, #slot0.targets do
		if not table.contains(slot0.fetchList, slot0.targets[slot5]) then
			slot0.nextIndex = slot5

			break
		end
	end

	if slot0.nextIndex == -1 then
		slot0.fetchIndex = #slot0.targets
		slot0.nextIndex = #slot0.targets
	else
		slot0.fetchIndex = math.max(slot0.nextIndex - 1, 0)
	end

	slot0.drops = slot0.config.drop_client
	slot0.nextDrops = slot0.config.drop_client[slot0.nextIndex]
	slot0.nextTarget = slot0.targets[slot0.nextIndex]
	slot0.returners = slot1:getClientList()
	slot0.pt = slot0:getTotalPt(slot1.data3)

	setActive(slot0.pushBtn, not slot0.isPush and #slot0.returners &lt; 3)
	setActive(slot0.pushedBtn, slot0.isPush)
	setActive(slot0.pushDisBtn, not slot0.isPush and #slot0.returners &gt;= 3)
end

slot0.UpdateUI = function(slot0)
	slot0.codeTxt.text = slot0.code
	slot0.ptTxt.text = slot0.pt .. &quot;/&quot; .. slot0.nextTarget

	setActive(slot0.getBtn, slot0.fetchIndex ~= #slot0.targets and slot0.nextTarget &lt;= slot0.pt)

	slot0.phaseTxt.text = slot0.fetchIndex
	slot0.phaseTotalTxt.text = #slot0.targets

	setFillAmount(slot0.progress, slot0.pt / slot0.nextTarget)

	slot1 = slot0.nextDrops

	updateDrop(slot0.awardTF, {
		type = slot1[1],
		id = slot1[2],
		count = slot1[3]
	})
	slot0:UpdateTasks(pg.activity_template_headhunting[slot0.activity.id].tasklist)
end

slot0.getTask = function(slot0, slot1)
	return getProxy(TaskProxy):getTaskById(slot1) or slot2:getFinishTaskById(slot1)
end

slot0.UpdateTasks = function(slot0, slot1)
	if slot0.isPush then
		slot3 = slot0.activity:getDayIndex()
		slot4 = getProxy(TaskProxy)
		slot5 = 0

		for slot9 = #slot1, 1, -1 do
			if slot0:getTask(slot1[slot9]) then
				slot5 = slot9

				break
			end
		end

		if (not slot0:getTask(slot1[slot5]) or slot6:isReceive()) and slot5 &lt; slot3 then
			if slot5 == #slot1 and slot6 and slot6:isReceive() then
				slot0:UpdateTaskTF(slot6)
			else
				slot0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
					activity_id = slot2.id,
					cmd = ActivityConst.RETURN_AWARD_OP_ACCEPT_TASK
				})
			end
		else
			assert(slot6)
			slot0:UpdateTaskTF(slot6)
		end
	else
		setActive(slot0.taskPanel, false)
		setActive(slot0.taskLockPanel, true)
	end
end

slot0.UpdateTaskTF = function(slot0, slot1)
	setActive(slot0.taskLockPanel, false)
	setActive(slot0.taskPanel, true)

	slot2 = slot1:isFinish()
	slot3 = slot1:isReceive()

	setActive(slot0.taskGoBtn, slot1 and not slot2)
	setActive(slot0.taskGotBtn, slot1 and slot3)
	setActive(slot0.taskGetBtn, slot1 and slot2 and not slot3)

	slot4 = slot1:getConfig(&quot;award_display&quot;)[1]

	updateDrop(slot0.taskItemTF, {
		type = slot4[1],
		id = slot4[2],
		count = slot4[3]
	})
	setFillAmount(slot0.taskProgress, slot1:getProgress() / slot1:getConfig(&quot;target_num&quot;))
	setText(slot0.taskDesc, slot1:getConfig(&quot;desc&quot;))

	slot0.taskProgressTxt.text = slot1:getProgress() .. &quot;/&quot; .. slot1:getConfig(&quot;target_num&quot;)

	onButton(slot0, slot0.taskGoBtn, function ()
		uv0._event:emit(ActivityMediator.ON_TASK_GO, uv1)
	end, SFX_PANEL)
	onButton(slot0, slot0.taskGetBtn, function ()
		uv0._event:emit(ActivityMediator.ON_TASK_SUBMIT, uv1)
	end, SFX_PANEL)
end

slot1 = function(slot0, slot1)
	LoadSpriteAsync(&quot;qicon/&quot; .. slot1:getPainting(), function (slot0)
		if not IsNil(uv0) then
			uv0:GetComponent(typeof(Image)).sprite = slot0
		end
	end)
	UIItemList.New(slot0:Find(&quot;starts&quot;), slot0:Find(&quot;starts/tpl&quot;)):align(slot1:getStar())
end

slot0.UpdateReturners = function(slot0)
	slot1 = slot0.returners

	slot0.returnerList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			if uv0[slot1 + 1] then
				uv1(slot2:Find(&quot;info/icon&quot;), Ship.New({
					configId = slot3:getIcon()
				}))
				setText(slot2:Find(&quot;info/name&quot;), slot3:getName())
				setText(slot2:Find(&quot;info/pt/Text&quot;), slot3:getPt())
			end

			setActive(slot2:Find(&quot;empty&quot;), not slot3)
			setActive(slot2:Find(&quot;info&quot;), slot3)
		end
	end)
	slot0.returnerList:align(2)
end

slot0.Dispose = function(slot0)
	pg.DelegateInfo.Dispose(slot0)

	slot0.bg.sprite = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>