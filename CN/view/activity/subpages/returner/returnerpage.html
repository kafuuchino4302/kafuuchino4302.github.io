<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>returnerpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>returnerpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ReturnerPage&quot;)

slot0.Ctor = function(slot0, slot1, slot2)
	pg.DelegateInfo.New(slot0)

	slot0._go = slot1
	slot0._tf = tf(slot1)
	slot0._event = slot2
	slot0.bg = slot0._tf:Find(&quot;bg&quot;):GetComponent(typeof(Image))
	slot0.input = slot0._tf:Find(&quot;InputField&quot;)
	slot0.inputPlaceholder = slot0._tf:Find(&quot;InputField/Placeholder&quot;):GetComponent(typeof(Text))
	slot0.confirmBtn = slot0._tf:Find(&quot;confim_btn&quot;)
	slot0.taskUIlist = UIItemList.New(slot0._tf:Find(&quot;task_list&quot;), slot0._tf:Find(&quot;task_list/tpl&quot;))
	slot0.totalProgress = slot0._tf:Find(&quot;total_progress&quot;):GetComponent(typeof(Text))
	slot0.progress = slot0._tf:Find(&quot;progress&quot;):GetComponent(typeof(Text))
	slot0.awrdOverviewBtn = slot0._tf:Find(&quot;award_overview&quot;)
	slot0.help = slot0._tf:Find(&quot;help&quot;)
	slot0.ptTxt = slot0._tf:Find(&quot;pt&quot;):GetComponent(typeof(Text))
	slot0.matchBtn = slot0._tf:Find(&quot;match_btn&quot;)
	slot0.matchedBtn = slot0._tf:Find(&quot;matched_btn&quot;)

	slot0:Init()
end

slot0.Init = function(slot0)
	onButton(slot0, slot0.confirmBtn, function ()
		if uv0.code ~= 0 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;return_have_participated_in_act&quot;))

			return
		end

		if not getInputText(uv0.input) or slot0 == &quot;&quot; then
			return
		end

		if tonumber(slot0) &gt; 2147483647 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_notExist&quot;))

			return
		end

		uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
			activity_id = uv0.activity.id,
			cmd = ActivityConst.RETURN_AWARD_OP_SET_RETRUNER,
			arg1 = tonumber(slot0)
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.awrdOverviewBtn, function ()
		uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
			cmd = ActivityConst.RETURN_AWARD_OP_SHOW_RETURNER_AWARD_OVERVIEW,
			arg1 = {
				tasklist = uv0.config.task_list,
				ptId = pg.activity_template_headhunting[uv0.activity.id].pt,
				totalPt = uv0.pt,
				index = uv0.taskIndex
			}
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.matchBtn, function ()
		if uv0.code ~= 0 then
			return
		end

		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			content = i18n(&quot;returner_match_tip&quot;),
			onYes = function ()
				uv0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
					activity_id = uv0.activity.id,
					cmd = ActivityConst.RETURN_AWARD_OP_MATCH
				})
			end
		})
	end, SFX_PANEL)
end

slot0.Update = function(slot0, slot1)
	slot0.activity = slot1

	slot0:UpdateData()

	if slot0:ShouldAcceptTasks() then
		slot0:AcceptTasks()
	else
		slot0:UpdateTasks()
	end

	if not (slot0.code ~= 0) then
		slot0.inputPlaceholder.text = i18n(&quot;input_returner_code&quot;)
	else
		slot0.inputPlaceholder.text = slot0.code

		setInputText(slot0.input, &quot;&quot;)
	end

	slot0.input:GetComponent(typeof(InputField)).interactable = not slot2

	setActive(slot0.matchBtn, not slot2)
	setActive(slot0.matchedBtn, slot2)
end

slot0.ShouldAcceptTasks = function(slot0)
	if slot0.code == 0 then
		return false
	end

	if slot0.taskIndex == 0 then
		return true
	end

	slot1 = slot0.config.task_list
	slot2 = getProxy(TaskProxy)

	return _.all(slot1[slot0.taskIndex], function (slot0)
		return uv0:getTaskById(slot0) == nil and uv0:getFinishTaskById(slot0) == nil
	end) or _.all(slot1[slot0.taskIndex], function (slot0)
		return uv0:getFinishTaskById(slot0) ~= nil
	end) and not (slot0.taskIndex == #slot1) and (function ()
		return uv0.taskIndex &lt; uv0.day
	end)()
end

slot0.AcceptTasks = function(slot0)
	slot0._event:emit(ActivityMediator.RETURN_AWARD_OP, {
		activity_id = slot0.activity.id,
		cmd = ActivityConst.RETURN_AWARD_OP_RETURNER_GET_AWARD
	})
end

slot0.UpdateData = function(slot0)
	slot1 = slot0.activity
	slot0.config = pg.activity_template_returnner[slot1.id]
	slot0.code = slot1.data2
	slot2 = pg.activity_template_headhunting[slot1.id]
	slot0.pt = slot1.data3
	slot0.taskIndex = slot1.data4
	slot0.ptTxt.text = slot0.pt
	slot0.day = pg.TimeMgr.GetInstance():DiffDay(slot1:getStartTime(), pg.TimeMgr.GetInstance():GetServerTime()) + 1
end

slot1 = function(slot0, slot1, slot2)
	slot3 = slot2:getConfig(&quot;award_display&quot;)[1]

	updateDrop(slot1:Find(&quot;item&quot;), {
		type = slot3[1],
		id = slot3[2],
		count = slot3[3]
	})
	setText(slot1:Find(&quot;desc&quot;), slot2:getConfig(&quot;desc&quot;))
	setFillAmount(slot1:Find(&quot;slider&quot;), slot2:getProgress() / slot2:getConfig(&quot;target_num&quot;))
	setActive(slot1:Find(&quot;go&quot;), not slot2:isFinish())
	setActive(slot1:Find(&quot;get&quot;), slot2:isFinish() and not slot2:isReceive())
	setActive(slot1:Find(&quot;got&quot;), slot2:isReceive())
	onButton(slot0, slot4, function ()
		uv0._event:emit(ActivityMediator.ON_TASK_GO, uv1)
	end, SFX_PANEL)
	onButton(slot0, slot5, function ()
		uv0._event:emit(ActivityMediator.ON_TASK_SUBMIT, uv1)
	end, SFX_PANEL)
end

slot0.UpdateTasks = function(slot0)
	slot0.taskUIlist:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot5 = getProxy(TaskProxy):getTaskById(uv0[slot1 + 1]) or slot4:getFinishTaskById(slot3)

			assert(slot5)
			uv1(uv2, slot2, slot5)
		end
	end)
	slot0.taskUIlist:align(#(slot0.config.task_list[slot0.taskIndex] or {}))

	slot0.totalProgress.text = #slot1
	slot0.progress.text = slot0.taskIndex
end

slot0.Dispose = function(slot0)
	pg.DelegateInfo.Dispose(slot0)

	slot0.bg.sprite = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>