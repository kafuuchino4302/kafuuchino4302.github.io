<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tianhouskinpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>tianhouskinpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;TianHouSkinPage&quot;, import(&quot;...base.BaseActivityPage&quot;))
slot1 = {
	[0] = {
		color = &quot;ffffff&quot;,
		name = &quot;none&quot;
	},
	{
		color = &quot;ffed95&quot;,
		name = &quot;na&quot;
	},
	{
		color = &quot;feb8ff&quot;,
		name = &quot;k&quot;
	},
	{
		color = &quot;ad92ff&quot;,
		name = &quot;rb&quot;
	},
	{
		color = &quot;affff4&quot;,
		name = &quot;zn&quot;
	},
	{
		color = &quot;ffa685&quot;,
		name = &quot;ca&quot;
	},
	{
		color = &quot;c1ffa7&quot;,
		name = &quot;cu&quot;
	}
}

slot0.GetCurrentDay = function()
	return pg.TimeMgr.GetInstance():STimeDescS(pg.TimeMgr.GetInstance():GetServerTime(), &quot;*t&quot;).yday
end

slot0.OnInit = function(slot0)
	slot0.bg = slot0:findTF(&quot;AD&quot;)
	slot0.helpBtn = slot0:findTF(&quot;help&quot;, slot0.bg)
	slot0.gotTag = slot0:findTF(&quot;got&quot;, slot0.bg)
	slot0.medalText = slot0:findTF(&quot;medal&quot;, slot0.bg)
	slot0.ticketText = slot0:findTF(&quot;ticket&quot;, slot0.bg)
	slot0.fireworkBtn = slot0:findTF(&quot;game_list/firework&quot;, slot0.bg)
	slot0.shootBtn = slot0:findTF(&quot;game_list/shoot&quot;, slot0.bg)
	slot0.foodBtn = slot0:findTF(&quot;game_list/food&quot;, slot0.bg)
	slot0.effectNode = slot0:findTF(&quot;effectNode&quot;, slot0.bg)
	slot0.playEffectBtn = slot0:findTF(&quot;fire&quot;, slot0.bg)
end

slot0.OnFirstFlush = function(slot0)
	slot0.hubID = slot0.activity:getConfig(&quot;config_id&quot;)

	onButton(slot0, slot0.helpBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = i18n(&quot;help_summer_feast&quot;)
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.fireworkBtn, function ()
		pg.m02:sendNotification(GAME.GO_MINI_GAME, 26)
	end, SFX_PANEL)
	onButton(slot0, slot0.shootBtn, function ()
		pg.m02:sendNotification(GAME.GO_MINI_GAME, 27)
	end, SFX_PANEL)
	onButton(slot0, slot0.foodBtn, function ()
		pg.m02:sendNotification(GAME.GO_MINI_GAME, 25)
	end, SFX_PANEL)

	slot0.ishow = getProxy(MiniGameProxy):GetMiniGameData(26):GetRuntimeData(&quot;elements&quot;) and #slot2 &gt;= 4 and slot2[4] == slot0.GetCurrentDay()

	onButton(slot0, slot0.playEffectBtn, function ()
		if not uv0.ishow then
			return
		end

		uv0:PlayFirework(uv1)
		setActive(uv0.playEffectBtn, false)
	end, SFX_PANEL)
	blinkAni(slot0:findTF(&quot;light&quot;, slot0.playEffectBtn), 0.5)
end

slot0.OnUpdateFlush = function(slot0)
	slot2 = getProxy(MiniGameProxy):GetHubByHubId(slot0.hubID)

	setText(slot0.ticketText, slot2.count)
	setText(slot0.medalText, slot2.usedtime .. &quot;/&quot; .. slot2:getConfig(&quot;reward_need&quot;))
	setActive(slot0.gotTag, slot2.ultimate ~= 0)

	if slot2.ultimate == 0 and slot3 &lt;= slot2.usedtime then
		pg.m02:sendNotification(GAME.SEND_MINI_GAME_OP, {
			hubid = slot0.hubID,
			cmd = MiniGameOPCommand.CMD_ULTIMATE,
			args1 = {}
		})
	end

	setActive(slot0.playEffectBtn, slot0.ishow)
	pg.NewStoryMgr.GetInstance():Play(&quot;TIANHOUYUYI1&quot;)
end

slot0.TransformColor = function(slot0)
	return Color.New(tonumber(string.sub(slot0, 1, 2), 16) / 255, tonumber(string.sub(slot0, 3, 4), 16) / 255, tonumber(string.sub(slot0, 5, 6), 16) / 255)
end

slot0.PlayFirework = function(slot0, slot1)
	slot1 = slot1 or {
		0,
		0,
		0
	}
	slot2 = UnityEngine.ParticleSystem.MinMaxGradient.New

	pg.PoolMgr.GetInstance():GetPrefab(&quot;ui/firework&quot;, &quot;&quot;, false, function (slot0)
		slot2 = tf(slot0):Find(&quot;Fire&quot;):GetComponent(&quot;ParticleSystem&quot;).main.startColor
		tf(slot0):Find(&quot;Fire&quot;):GetComponent(&quot;ParticleSystem&quot;).main.startColor = uv0(uv1.TransformColor(uv2[uv3[1]].color))
		tf(slot0):Find(&quot;Fire/par_small&quot;):GetComponent(&quot;ParticleSystem&quot;).main.startColor = uv0(uv1.TransformColor(uv2[uv3[2]].color))
		tf(slot0):Find(&quot;Fire/par_small/par_big&quot;):GetComponent(&quot;ParticleSystem&quot;).main.startColor = uv0(uv1.TransformColor(uv2[uv3[3]].color))

		setParent(slot0, uv1.effectNode)

		slot0.transform.localPosition = Vector2(0, 0)
		uv1.fireEffect = slot0
	end)
	slot0:PlaySE()
end

slot0.ClearEffectFirework = function(slot0)
	slot0:StopSE()

	if slot0.fireEffect then
		pg.PoolMgr.GetInstance():ReturnPrefab(&quot;ui/firework&quot;, &quot;&quot;, slot0.fireEffect)
	end
end

slot0.PlaySE = function(slot0)
	if slot0.SETimer then
		return
	end

	slot0.SECount = 10
	slot0.SETimer = Timer.New(function ()
		uv0.SECount = uv0.SECount - 1

		if uv0.SECount &lt;= 0 then
			uv0.SECount = math.random(5, 20)

			pg.CriMgr.GetInstance():PlaySE_V3(&quot;battle-firework&quot;)
		end
	end, 0.1, -1)

	slot0.SETimer:Start()
end

slot0.StopSE = function(slot0)
	if slot0.SETimer then
		pg.CriMgr.GetInstance():StopSEBattle_V3()
		slot0.SETimer:Stop()

		slot0.SETimer = nil
	end
end

slot0.OnHideFlush = function(slot0)
	slot0:ClearEffectFirework()
end

slot0.OnDestroy = function(slot0)
	slot0:ClearEffectFirework()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>