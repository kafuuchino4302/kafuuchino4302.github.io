<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>neworleansmappage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>neworleansmappage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewOrleansMapPage&quot;, import(&quot;...base.BaseActivityPage&quot;))

slot0.OnInit = function(slot0)
	slot0.bg = slot0:findTF(&quot;AD&quot;)
	slot0.item = slot0:findTF(&quot;item&quot;, slot0.bg)
	slot0.itemMask = slot0:findTF(&quot;icon_mask&quot;, slot0.item)
	slot0.gotaskBtn = slot0:findTF(&quot;gotask&quot;, slot0.bg)
	slot0.gobattleBtn = slot0:findTF(&quot;gobattle&quot;, slot0.bg)
end

slot0.OnDataSetting = function(slot0)
	slot0.taskIDList = _.flatten(slot0.activity:getConfig(&quot;config_data&quot;))
	slot0.taskProxy = getProxy(TaskProxy)
end

slot0.OnFirstFlush = function(slot0)
	onButton(slot0, slot0.gobattleBtn, function ()
		if not getProxy(ActivityProxy):getActivityById(pg.activity_const.NEW_ORLEANS_Map_BATTLE.act_id) or slot0:isEnd() then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;challenge_end_tip&quot;))

			return
		end

		uv0:emit(ActivityMediator.SPECIAL_BATTLE_OPERA)
	end, SFX_PANEL)
	onButton(slot0, slot0.gotaskBtn, function ()
		if not getProxy(ActivityProxy):getActivityById(pg.activity_const.NEW_ORLEANS_Map_BATTLE.act_id) or slot0:isEnd() then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;challenge_end_tip&quot;))

			return
		end

		uv0:emit(ActivityMediator.EVENT_GO_SCENE, SCENE.TASK, {
			page = &quot;activity&quot;
		})
	end)
end

slot0.OnUpdateFlush = function(slot0)
	slot3 = slot0.taskProxy:getTaskVO(slot0.taskIDList[slot0:findCurTaskIndex()])
	slot0.curTaskVO = slot3
	slot4 = slot3:getConfig(&quot;award_display&quot;)[1]

	updateDrop(slot0.item, {
		type = slot4[1],
		id = slot4[2],
		count = slot4[3]
	})
	onButton(slot0, slot0.item, function ()
		uv0:emit(BaseUI.ON_DROP, uv1)
	end, SFX_PANEL)
	setActive(slot0.itemMask, slot3:getTaskStatus() == 2)
end

slot0.OnDestroy = function(slot0)
end

slot0.findCurTaskIndex = function(slot0)
	slot1 = nil

	for slot5, slot6 in ipairs(slot0.taskIDList) do
		if slot0.taskProxy:getTaskVO(slot6):getTaskStatus() &lt;= 1 then
			slot1 = slot5

			break
		elseif slot5 == #slot0.taskIDList then
			slot1 = slot5
		end
	end

	return slot1
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>