<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>beatmonstermeidator.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>beatmonstermeidator.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BeatMonsterMeidator&quot;)
slot1 = 1
slot2 = 0.1
slot3 = 1

slot0.Ctor = function(slot0, slot1)
	pg.DelegateInfo.New(slot0)

	slot0.controller = slot1
end

slot0.SetUI = function(slot0, slot1)
	slot0._go = slot1
	slot0._tf = tf(slot1)
	slot0.monsterNian = slot0:findTF(&quot;AD/monster&quot;)
	slot0.fushun = slot0:findTF(&quot;AD/fushun&quot;)
	slot0.hpTF = slot0:findTF(&quot;AD/hp&quot;):GetComponent(typeof(Slider))
	slot2 = slot0:findTF(&quot;AD/attack_count/Text&quot;)
	slot0.attackCntTF = slot2:GetComponent(typeof(Text))
	slot0.actions = slot0:findTF(&quot;AD/actions&quot;)
	slot0.actionKeys = {
		slot0.actions:Find(&quot;content/1&quot;),
		slot0.actions:Find(&quot;content/2&quot;),
		slot0.actions:Find(&quot;content/3&quot;)
	}
	slot0.curtainTF = slot0:findTF(&quot;AD/curtain&quot;)
	slot0.startLabel = slot0.curtainTF:Find(&quot;start_label&quot;)
	slot0.ABtn = slot0:findTF(&quot;AD/A_btn&quot;)
	slot0.BBtn = slot0:findTF(&quot;AD/B_btn&quot;)
	slot0.joyStick = slot0:findTF(&quot;AD/joyStick&quot;)
end

slot0.DoCurtainUp = function(slot0, slot1)
	if getProxy(SettingsProxy):IsShowBeatMonseterNianCurtain() then
		slot2:SetBeatMonseterNianFlag()
		slot0:StartCurtainUp(slot1)
	else
		slot1()
	end
end

slot0.StartCurtainUp = function(slot0, slot1)
	setActive(slot0.curtainTF, true)

	slot2 = LeanTween.color(slot0.curtainTF, Color.white, uv0)
	slot2 = slot2:setFromColor(Color.black)

	slot2:setOnComplete(System.Action(function ()
		setActive(uv0.startLabel, true)

		slot0 = blinkAni(uv0.startLabel, uv1, 2)

		slot0:setOnComplete(System.Action(function ()
			LeanTween.alpha(uv0.curtainTF, 0, uv1):setFrom(1)
			LeanTween.alpha(uv0.startLabel, 0, uv1):setFrom(1):setOnComplete(System.Action(uv2))
		end))
	end))
end

slot0.OnInited = function(slot0)
	slot1 = function()
		if uv0.attackCnt &lt;= 0 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;activity_hit_monster_nocount&quot;))

			return false
		end

		if uv0.hp &lt;= 0 then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;activity_hit_monster_reset_tip&quot;),
				onYes = function ()
					uv0.controller:ReStartGame()
				end
			})

			return false
		end

		return true
	end

	slot0:OnTrigger(slot0.ABtn, slot1, function ()
		uv0.controller:Input(BeatMonsterNianConst.ACTION_NAME_A)
	end)
	slot0:OnTrigger(slot0.BBtn, slot1, function ()
		uv0.controller:Input(BeatMonsterNianConst.ACTION_NAME_B)
	end)
	slot0:OnJoyStickTrigger(slot0.joyStick, slot1, function (slot0)
		if slot0 &gt; 0 then
			uv0.controller:Input(BeatMonsterNianConst.ACTION_NAME_R)
		elseif slot0 &lt; 0 then
			uv0.controller:Input(BeatMonsterNianConst.ACTION_NAME_L)
		end
	end)
end

slot0.OnAttackCntUpdate = function(slot0, slot1, slot2)
	slot0.attackCnt = slot1
	slot0.attackCntTF.text = slot2 and &quot;-&quot; or slot1
end

slot0.OnMonsterHpUpdate = function(slot0, slot1)
	slot0.hp = slot1

	slot0.fuShun:SetInteger(&quot;hp&quot;, slot1)
	slot0.nian:SetInteger(&quot;hp&quot;, slot1)
end

slot0.OnUIHpUpdate = function(slot0, slot1, slot2, slot3)
	slot6 = LeanTween.value(slot0.hpTF.gameObject, slot0.hpTF.value, slot1 / slot2, 0.3)
	slot6 = slot6:setOnUpdate(System.Action_float(function (slot0)
		uv0.hpTF.value = slot0
	end))

	slot6:setOnComplete(System.Action(function ()
		if uv0 then
			uv0()
		end
	end))
end

slot0.OnAddFuShun = function(slot0, slot1)
	slot0.fuShun = slot0.fushun:GetComponent(typeof(Animator))

	slot0.fuShun:SetInteger(&quot;hp&quot;, slot1)
end

slot0.OnAddMonsterNian = function(slot0, slot1, slot2)
	slot0.hp = slot1
	slot0.nian = slot0.monsterNian:GetComponent(typeof(Animator))
	slot0.hpTF.value = slot1 / slot2

	slot0.nian:SetInteger(&quot;hp&quot;, slot1)
end

slot0.OnChangeFuShunAction = function(slot0, slot1)
	slot0.fuShun:SetTrigger(slot1)
end

slot0.OnChangeNianAction = function(slot0, slot1)
	slot0.nian:SetTrigger(slot1)
end

slot0.BanJoyStick = function(slot0, slot1)
	setActive(slot0.joyStick:Find(&quot;ban&quot;), slot1)

	GetOrAddComponent(slot0.joyStick, typeof(EventTriggerListener)).enabled = not slot1
end

slot0.OnInputChange = function(slot0, slot1)
	if slot1 and slot1 ~= &quot;&quot; then
		for slot6, slot7 in ipairs(slot0.actionKeys) do
			slot8 = string.sub(slot1, slot6, slot6) or &quot;&quot;

			setActive(slot7:Find(&quot;A&quot;), slot8 == BeatMonsterNianConst.ACTION_NAME_A)
			setActive(slot7:Find(&quot;L&quot;), slot8 == BeatMonsterNianConst.ACTION_NAME_L)
			setActive(slot7:Find(&quot;R&quot;), slot8 == BeatMonsterNianConst.ACTION_NAME_R)
			setActive(slot7:Find(&quot;B&quot;), slot8 == BeatMonsterNianConst.ACTION_NAME_B)
		end
	end

	setActive(slot0.actions, slot2)
	slot0:BanJoyStick(#slot1 == 2)
end

slot0.PlayStory = function(slot0, slot1, slot2)
	pg.NewStoryMgr.GetInstance():Play(slot1, slot2)
end

slot0.DisplayAwards = function(slot0, slot1, slot2)
	pg.m02:sendNotification(ActivityProxy.ACTIVITY_SHOW_AWARDS, {
		awards = slot1,
		callback = slot2
	})
end

slot0.Dispose = function(slot0)
	pg.DelegateInfo.Dispose(slot0)
end

slot0.OnTrigger = function(slot0, slot1, slot2, slot3)
	slot4 = slot1:Find(&quot;off&quot;)
	slot5 = true
	slot6 = GetOrAddComponent(slot1, typeof(EventTriggerListener))

	slot6:AddPointDownFunc(function (slot0, slot1)
		uv0 = uv1()

		if uv0 then
			setActive(uv2, false)
		end
	end)
	slot6:AddPointUpFunc(function (slot0, slot1)
		if uv0 then
			setActive(uv1, true)

			if uv2 then
				uv2()
			end
		end
	end)
end

slot0.OnJoyStickTrigger = function(slot0, slot1, slot2, slot3)
	slot4 = slot1:Find(&quot;m&quot;)
	slot5 = slot1:Find(&quot;l&quot;)
	slot6 = slot1:Find(&quot;r&quot;)
	slot7 = GetOrAddComponent(slot1, typeof(EventTriggerListener))
	slot8 = nil
	slot9 = false

	slot7:AddBeginDragFunc(function (slot0, slot1)
		uv0 = uv1()
		uv2 = slot1.position
	end)
	slot7:AddDragFunc(function (slot0, slot1)
		if not uv0 then
			return
		end

		setActive(uv2, slot1.position.x - uv1.x == 0)
		setActive(uv3, slot2 &lt; 0)
		setActive(uv4, slot2 &gt; 0)
	end)
	slot7:AddDragEndFunc(function (slot0, slot1)
		if not uv0 then
			return
		end

		uv2(slot1.position.x - uv1.x)
		setActive(uv3, true)
		setActive(uv4, false)
		setActive(uv5, false)
	end)
end

slot0.findTF = function(slot0, slot1, slot2)
	assert(slot0._tf, &quot;transform should exist&quot;)

	return findTF(slot2 or slot0._tf, slot1)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>