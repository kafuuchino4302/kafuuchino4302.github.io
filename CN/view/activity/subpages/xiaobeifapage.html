<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xiaobeifapage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>xiaobeifapage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;XiaobeiFaPage&quot;, import(&quot;...base.BaseActivityPage&quot;))

slot0.OnInit = function(slot0)
	slot0.bg = slot0:findTF(&quot;AD&quot;)
	slot0.layer = slot0:findTF(&quot;layer&quot;)
	slot0.btn = slot0:findTF(&quot;btn&quot;, slot0.layer)
	slot0.bonusList = slot0:findTF(&quot;bonus_list&quot;, slot0.layer)
	slot0.progress = slot0:findTF(&quot;progress&quot;, slot0.layer)
	slot0.progressTxt = slot0:findTF(&quot;progressText&quot;, slot0.layer)
	slot0.phaseTxt = slot0:findTF(&quot;phase/Text&quot;, slot0.layer)
	slot0.award = slot0:findTF(&quot;award&quot;, slot0.layer)
end

slot0.OnFirstFlush = function(slot0)
	slot1 = slot0.activity

	onButton(slot0, slot0.bonusList, function ()
		uv1:emit(ActivityMediator.SHOW_AWARD_WINDOW, PtTaskAwardWindow, {
			tasklist = uv0:getConfig(&quot;config_data&quot;),
			ptId = uv0:getConfig(&quot;config_client&quot;).pt_id,
			totalPt = getProxy(ActivityProxy):getActivityById(uv0:getConfig(&quot;config_client&quot;).rank_act_id).data1
		})
	end)
end

slot0.OnUpdateFlush = function(slot0)
	slot0:flush_task_list_pt_xiaobeifa()
end

slot0.flush_task_list_pt_xiaobeifa = function(slot0)
	slot0:flush_task_list_pt()

	slot1 = slot0.activity
	slot2, slot3, slot4 = slot0:getDoingTask(slot1)

	if slot1:getConfig(&quot;config_client&quot;).main_task then
		slot0:setImportantProgress(slot1, slot0:findTF(&quot;progress_important&quot;), slot4 and slot2 or slot2 - 1, slot1:getConfig(&quot;config_client&quot;).main_task, slot1:getConfig(&quot;config_data&quot;))
	end
end

slot0.getDoingTask = function(slot0, slot1, slot2)
	slot3 = getProxy(TaskProxy)
	slot4 = _.flatten(slot1:getConfig(&quot;config_data&quot;))
	slot5, slot6 = nil

	if slot1:getConfig(&quot;type&quot;) == ActivityConst.ACTIVITY_TYPE_TASKS then
		for slot10 = #slot4, 1, -1 do
			if slot3:getFinishTaskById(slot4[slot10]) then
				if not slot6 then
					slot5 = slot4[slot10]
					slot6 = slot11
				end

				break
			end

			slot5 = slot4[slot10]
			slot6 = slot3:getTaskById(slot4[slot10])
		end
	else
		slot5, slot6 = getActivityTask(slot1)
	end

	if not slot2 then
		assert(slot6, &quot;without taskVO &quot; .. slot5 .. &quot; from server&quot;)
	end

	return table.indexof(slot4, slot5), slot5, slot6
end

slot0.flush_task_list_pt = function(slot0)
	slot1 = slot0.activity
	slot3, slot4, slot5 = slot0:getDoingTask(slot1)
	slot7 = getProxy(ActivityProxy):getActivityById(slot1:getConfig(&quot;config_client&quot;).rank_act_id).data1

	setText(slot0.phaseTxt, slot3 .. &quot;/&quot; .. #_.flatten(slot1:getConfig(&quot;config_data&quot;)))

	if slot5 then
		slot8 = slot5:getConfig(&quot;target_num&quot;)

		setText(slot0.progressTxt, setColorStr(math.min(slot7, slot8), slot7 &lt; slot8 and COLOR_RED or COLOR_GREEN) .. &quot;/&quot; .. slot8)
		setSlider(slot0.progress, 0, slot8, math.min(slot7, slot8))

		slot10 = slot5:getConfig(&quot;award_display&quot;)[1]

		updateDrop(slot0.award, {
			type = slot10[1],
			id = slot10[2],
			count = slot10[3]
		})
		onButton(slot0, slot0.award, function ()
			uv0:emit(BaseUI.ON_DROP, uv1)
		end, SFX_PANEL)

		slot0.btn:GetComponent(typeof(Image)).enabled = not slot5:isFinish()

		setActive(slot0.btn:Find(&quot;get&quot;), slot5:isFinish() and not slot5:isReceive())
		setActive(slot0.btn:Find(&quot;achieved&quot;), slot5:isReceive())
		onButton(slot0, slot0.btn, function ()
			if not uv0:isFinish() then
				uv1:emit(ActivityMediator.ON_TASK_GO, uv0)
			else
				if not uv1:TaskSubmitCheck(uv0) then
					return
				end

				uv1:emit(ActivityMediator.ON_TASK_SUBMIT, uv0)
			end
		end, SFX_PANEL)
		setButtonEnabled(slot0.btn, not slot5:isReceive())
	end
end

slot0.TaskSubmitCheck = function(slot0, slot1)
	if uv0.checkList[slot1.id] then
		for slot6, slot7 in ipairs(getProxy(BayProxy):getShips()) do
			if slot7:getGroupId() == uv0.checkList[slot1.id] and slot7:isActivityNpc() then
				return true
			end
		end

		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;task_submitTask_error_client&quot;))

		return false
	end

	return true
end

slot0.setImportantProgress = function(slot0, slot1, slot2, slot3, slot4, slot5)
	slot6 = slot2:Find(&quot;award_display&quot;)
	slot8 = getProxy(TaskProxy)

	setSlider(slot2, 0, pg.task_data_template[slot5[#slot5]].target_num, getProxy(ActivityProxy):getActivityById(slot1:getConfig(&quot;config_client&quot;).rank_act_id).data1)

	slot12 = nil
	slot13 = slot6:GetComponent(typeof(RectTransform)).rect.width
	slot14 = nil

	removeAllChildren(slot6)
	setActive(slot2:Find(&quot;important_task_tpl&quot;), false)

	for slot18, slot19 in ipairs(slot4) do
		for slot23, slot24 in ipairs(slot5) do
			if slot19 == slot24 then
				slot14 = Instantiate(slot7)

				SetParent(slot14, slot6)
				setActive(slot14, true)
				setAnchoredPosition(slot14, {
					x = pg.task_data_template[slot5[slot23]].target_num / slot9 * slot13
				})

				slot25 = pg.task_data_template[slot19]
				slot26 = slot25.award_display[1]
				slot27 = slot0:findTF(&quot;award&quot;, slot14)

				updateDrop(slot27, {
					type = slot26[1],
					id = slot26[2],
					count = slot26[3]
				})
				onButton(slot0, slot27, function ()
					uv0:emit(BaseUI.ON_DROP, uv1)
				end, SFX_PANEL)
				setText(slot0:findTF(&quot;Text&quot;, slot14), slot25.target_num)
				setActive(slot0:findTF(&quot;mask&quot;, slot27), slot23 &lt;= slot3)

				break
			end
		end
	end
end

slot0.OnDestroy = function(slot0)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>