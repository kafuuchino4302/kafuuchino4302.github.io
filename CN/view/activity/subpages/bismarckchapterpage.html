<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bismarckchapterpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>bismarckchapterpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BismarckChapterPage&quot;, import(&quot;...base.BaseActivityPage&quot;))
slot0.tabPos = {
	[1.0] = 10,
	[2.0] = 182.3
}
slot0.IconShowFunc = {
	[DROP_TYPE_SHIP] = function (slot0, slot1)
		GetImageSpriteFromAtlasAsync(&quot;SquareIcon/&quot; .. pg.ship_skin_template[pg.ship_data_statistics[slot1].skin_id].painting, &quot;&quot;, slot0)
	end,
	[DROP_TYPE_FURNITURE] = function (slot0, slot1)
		GetImageSpriteFromAtlasAsync(&quot;furnitureicon/&quot; .. pg.furniture_data_template[slot1].icon, &quot;&quot;, slot0)
	end
}
slot0.TransformType = {
	[TASK_SUB_TYPE_COLLECT_SHIP] = DROP_TYPE_SHIP,
	[TASK_SUB_TYPE_COLLECT_FURNITURE] = DROP_TYPE_FURNITURE
}

slot0.OnInit = function(slot0)
	slot0.bg = slot0:findTF(&quot;AD&quot;)
	slot0.items = {
		slot0:findTF(&quot;AD/Item1&quot;),
		slot0:findTF(&quot;AD/Item2&quot;)
	}
	slot0.awardTF = slot0:findTF(&quot;AD/award&quot;)
	slot0.battleBtn = slot0:findTF(&quot;AD/battle_btn&quot;)
	slot0.shopBtn = slot0:findTF(&quot;AD/exchange_btn&quot;)
	slot0.buildBtn = slot0:findTF(&quot;AD/build_btn&quot;)
	slot0.tab = slot0:findTF(&quot;tab&quot;)
	slot0.bar = slot0:findTF(&quot;bar&quot;)
	slot0.scrollList = slot0:findTF(&quot;Scroll View&quot;, slot0.tab)
	slot0.content = slot0:findTF(&quot;Content&quot;, slot0.scrollList)
	slot0.listTmpl = slot0:findTF(&quot;listitem&quot;, slot0.tab)
	slot0.taskList = UIItemList.New(slot0.content, slot0.listTmpl)
	slot0.finalTasks = {}
	slot0.subtasks = {}
	slot0.tabType = 0
end

slot0.OnFirstFlush = function(slot0)
	slot0.finalTasks = Clone(slot0.activity:getConfig(&quot;config_client&quot;))

	_.each(slot0.finalTasks, function (slot0)
		if pg.task_data_template[slot0] and slot1.target_id then
			table.insert(uv0.subtasks, Clone(slot2))
		end
	end)
	setText(slot0:findTF(&quot;desc&quot;, slot0.bg), i18n(&quot;bismarck_chapter_desc&quot;))
	slot0:SubimtCompletedMission()
	slot0:InitInteractable()
end

slot0.InitInteractable = function(slot0)
	slot1 = getProxy(TaskProxy)

	for slot5, slot6 in ipairs(slot0.finalTasks) do
		slot7 = pg.task_data_template[slot6]

		onButton(slot0, slot0.items[slot5], function ()
			if uv0:getTaskVO(uv1):getTaskStatus() == 1 then
				uv2:emit(ActivityMediator.ON_TASK_SUBMIT, slot0)

				return
			end

			if uv2.tabType == uv3 then
				return
			end

			uv2.tabType = uv3

			uv2:UpdateTab()
		end, SFX_PANEL)
	end

	onButton(slot0, slot0.battleBtn, function ()
		uv0:emit(ActivityMediator.BATTLE_OPERA)
	end, SFX_PANEL)
	onButton(slot0, slot0.shopBtn, function ()
		if not configClinet.shopLinkActID or not getProxy(ActivityProxy):getActivitiesById(configClinet.shopLinkActID) then
			slot1 = getProxy(ActivityProxy)
			slot0 = underscore.detect(slot1:getActivitiesByType(ActivityConst.ACTIVITY_TYPE_SHOP), function (slot0)
				return not slot0:isEnd()
			end)
		end

		if not slot0 or slot0:isEnd() then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_activity_end&quot;))

			return
		end

		uv0:emit(ActivityMediator.GO_SHOPS_LAYER, {
			warp = NewShopsScene.TYPE_ACTIVITY,
			actId = slot0.id
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.buildBtn, function ()
		uv0:emit(ActivityMediator.EVENT_GO_SCENE, SCENE.GETBOAT, {
			projectName = BuildShipScene.PROJECTS.ACTIVITY
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.bg, function ()
		if uv0.tabType &gt; 0 then
			uv0.tabType = 0

			uv0:UpdateTab()
		end
	end)
end

slot0.OnUpdateFlush = function(slot0)
	slot0:UpdateView()
	slot0:UpdateTab()
end

slot0.UpdateView = function(slot0)
	slot1 = getProxy(TaskProxy)

	for slot5 = 1, #slot0.finalTasks do
		slot6 = slot0.finalTasks[slot5]
		slot8 = slot0.items[slot5]

		setActive(slot8, true)

		slot9 = pg.task_data_template[slot6].award_display[1]

		slot0:UpdateIcon(slot0:findTF(&quot;icon&quot;, slot8), slot9[1], slot9[2])
		setActive(slot8:Find(&quot;active&quot;), slot1:getTaskVO(slot6):getTaskStatus() == 0)
		setActive(slot8:Find(&quot;finished&quot;), slot11 == 1)
		setActive(slot8:Find(&quot;achieved&quot;), slot11 == 2)
		setButtonEnabled(slot8, slot11 &lt; 2)

		slot0.tabType = slot0.tabType == slot5 and slot11 == 2 and 0 or slot0.tabType
	end

	for slot5 = #slot0.finalTasks + 1, #slot0.items do
		setActive(slot0.items[slot5], false)

		slot0.tabType = slot0.tabType == slot5 and 0 or slot0.tabType
	end
end

slot0.UpdateTab = function(slot0)
	if slot0.tabType == 0 then
		setActive(slot0.tab, false)

		return
	end

	slot2 = #slot0.subtasks[slot0.tabType]

	slot0.taskList:align(slot2)

	slot3 = getProxy(TaskProxy)
	slot4 = 0

	for slot8 = 1, slot2 do
		slot9 = slot0.content:GetChild(slot8 - 1)

		setText(slot0:findTF(&quot;title/Text&quot;, slot9), string.format(&quot;Task-%02d&quot;, slot8))

		slot11 = pg.task_data_template[slot1[slot8]]

		setActive(slot9:Find(&quot;tip2&quot;), uv0.TransformType[slot11.sub_type] == DROP_TYPE_FURNITURE)
		setActive(slot9:Find(&quot;tip&quot;), slot13 == DROP_TYPE_SHIP)

		slot14 = false
		slot15 = slot3:getTaskById(slot10) or slot3:getFinishTaskById(slot10)

		setActive(slot9:Find(&quot;completed&quot;), defaultValue(slot15 and slot15:isFinish(), false))
		setText(slot0:findTF(&quot;text&quot;, slot9), slot11.desc)
		slot0:UpdateIcon(slot0:findTF(&quot;icon&quot;, slot9), slot13, tonumber(slot11.target_id))

		slot4 = slot4 + (slot15 and slot15:isFinish() and 1 or 0)
	end

	setText(slot0:findTF(&quot;slider/progress&quot;, slot0.tab), string.format(&quot;[%d/%d]&quot;, slot4, slot2))

	slot0.scrollList:GetComponent(typeof(ScrollRect)).verticalNormalizedPosition = 1
	slot5 = slot0.tab.transform.anchoredPosition
	slot5.x = uv0.tabPos[slot0.tabType]

	setAnchoredPosition(slot0.tab, slot5)

	slot8 = slot0.bar.sizeDelta
	slot8.x = slot0._tf.sizeDelta.x - slot0.bar.anchoredPosition.x - slot5.x - slot0.tab.sizeDelta.x
	slot0.bar.sizeDelta = slot8

	setActive(slot0.tab, true)
end

slot0.UpdateIcon = function(slot0, slot1, slot2, slot3)
	if uv0.IconShowFunc[slot2] then
		uv0.IconShowFunc[slot2](slot1, slot3)
	end
end

slot0.OnDestroy = function(slot0)
end

slot0.SubimtCompletedMission = function(slot0)
	slot1 = getProxy(TaskProxy)

	for slot5, slot6 in pairs(slot0.subtasks) do
		for slot10, slot11 in pairs(slot6) do
			if slot1:getTaskById(slot11) and slot12:isFinish() then
				slot0:emit(ActivityMediator.ON_TASK_SUBMIT, slot12)
			end
		end
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>