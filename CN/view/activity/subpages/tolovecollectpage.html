<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tolovecollectpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>tolovecollectpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ToloveCollectPage&quot;, import(&quot;.TemplatePage.LinkCollectTemplatePage&quot;))
slot0.SKIP_TYPE_MINIGAME = 7

slot0.OnInit = function(slot0)
	uv0.super.OnInit(slot0)
	slot0:findUI()
end

slot0.OnFirstFlush = function(slot0)
	uv0.super.OnFirstFlush(slot0)
	slot0:rewriteEquipSkinBtn()
end

slot0.findUI = function(slot0)
	setImageRaycastTarget(slot0:findTF(&quot;tpl/Frame&quot;, slot0.content), false)

	slot0.boxTF = slot0:findTF(&quot;Box&quot;)
	slot0.boxBG = slot0:findTF(&quot;BG&quot;, slot0.boxTF)
	slot0.panel = slot0:findTF(&quot;Panel&quot;, slot0.boxTF)
	slot0.infoTF = slot0:findTF(&quot;Info&quot;, slot0.panel)
	slot0.boxCloseBtn = slot0:findTF(&quot;CloseBtn&quot;, slot0.infoTF)
	slot0.boxIconTF = slot0:findTF(&quot;Icon/Mask/IconTpl&quot;, slot0.infoTF)
	slot0.boxNameText = slot0:findTF(&quot;NameText&quot;, slot0.infoTF)
	slot0.boxNumTF = slot0:findTF(&quot;Num&quot;, slot0.infoTF)
	slot0.boxNumTip = slot0:findTF(&quot;Text&quot;, slot0.boxNumTF)
	slot0.boxNumText = slot0:findTF(&quot;NumText&quot;, slot0.boxNumTF)
	slot0.boxDescText = slot0:findTF(&quot;DescText&quot;, slot0.infoTF)
	slot0.boxSrcText = slot0:findTF(&quot;SrcText&quot;, slot0.infoTF)

	onButton(slot0, slot0.boxBG, function ()
		uv0:showBoxPanel(false)
	end, SFX_PANEL)
	onButton(slot0, slot0.boxCloseBtn, function ()
		uv0:showBoxPanel(false)
	end, SFX_PANEL)

	slot0.boxSrcContent = slot0:findTF(&quot;Content&quot;, slot0.panel)
	slot0.boxSrcTpl = slot0:findTF(&quot;SrcTpl&quot;, slot0.boxSrcContent)

	GetComponent(slot0:findTF(&quot;furniture_theme/Title&quot;, slot0.btnList), &quot;Image&quot;):SetNativeSize()
	GetComponent(slot0:findTF(&quot;equip_skin_box/Title&quot;, slot0.btnList), &quot;Image&quot;):SetNativeSize()
	GetComponent(slot0:findTF(&quot;medal/Title&quot;, slot0.btnList), &quot;Image&quot;):SetNativeSize()
end

slot0.rewriteEquipSkinBtn = function(slot0)
	onButton(slot0, slot0.equipSkinBoxBtn, function ()
		slot0 = uv0.activity:getConfig(&quot;config_client&quot;)

		uv0:updateBoxPanel({
			type = MSGBOX_TYPE_LIKN_COLLECT_GUIDE,
			show_type = Msgbox4LinkCollectGuide.SHOW_TYPE_NORMAL,
			drop_type = slot0.equipskin_box_link.drop_type,
			drop_id = slot0.equipskin_box_link.drop_id,
			count = Drop.New({
				type = slot0.equipskin_box_link.drop_type,
				id = slot0.equipskin_box_link.drop_id
			}):getOwnedCount(),
			skipable_list = slot0.equipskin_box_link.list
		})
		uv0:showBoxPanel(true)
	end, SFX_PANEL)
end

slot0.updateBoxPanel = function(slot0, slot1)
	slot2 = Drop.New({
		type = slot1.drop_type,
		id = slot1.drop_id
	})

	updateDrop(slot0.boxIconTF, slot2)
	changeToScrollText(slot0.boxNameText, slot2.cfg.name)
	setText(slot0.boxDescText, SwitchSpecialChar(slot2.desc))
	setText(slot0.boxNumTip, i18n(&quot;word_own1&quot;))

	if slot1.show_type == Msgbox4LinkCollectGuide.SHOW_TYPE_NORMAL then
		setText(slot0.boxNumText, slot1.count)
	elseif slot1.show_type == Msgbox4LinkCollectGuide.SHOW_TYPE_LIMIT then
		setText(slot0.boxNumText, slot1.count .. &quot;/&quot; .. (slot1.count_limit or 0))
	end

	UIItemList.StaticAlign(slot0.boxSrcContent, slot0.boxSrcTpl, #slot1.skipable_list, function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0.skipable_list[slot1 + 1]
			slot4 = slot3[1]
			slot5 = slot3[2]
			slot8 = uv1

			changeToScrollText(slot8:findTF(&quot;SrcText&quot;, slot2), slot3[3])

			slot7 = uv1

			onButton(uv1, slot7:findTF(&quot;GoBtn&quot;, slot2), function ()
				if uv0 == Msgbox4LinkCollectGuide.SKIP_TYPE_SCENE then
					pg.m02:sendNotification(GAME.GO_SCENE, uv1[1], uv1[2] or {})
				elseif uv0 == Msgbox4LinkCollectGuide.SKIP_TYPE_ACTIVITY then
					pg.m02:sendNotification(GAME.GO_SCENE, SCENE.ACTIVITY, {
						id = uv1
					})
				elseif uv0 == uv2.SKIP_TYPE_MINIGAME then
					pg.m02:sendNotification(GAME.GO_MINI_GAME, uv1[1])
				end

				uv3:showBoxPanel(false)
			end, SFX_PANEL)
			Canvas.ForceUpdateCanvases()
		end
	end)
end

slot0.showBoxPanel = function(slot0, slot1)
	setActive(slot0.boxTF, slot1)
end

slot0.OnUpdateItem = function(slot0, slot1, slot2)
	slot3 = slot0.showDataList[slot1 + 1]
	slot4 = slot0:findTF(&quot;icon_mask/icon&quot;, slot2)

	updateDrop(slot4, {
		type = slot3.config.type,
		id = slot3.config.drop_id
	})
	onButton(slot0, slot4, function ()
		uv1:updateBoxPanel({
			type = MSGBOX_TYPE_LIKN_COLLECT_GUIDE,
			show_type = Msgbox4LinkCollectGuide.SHOW_TYPE_LIMIT,
			drop_type = uv0.config.type,
			drop_id = uv0.config.drop_id,
			count = uv0.count,
			count_limit = uv0.config.count,
			skipable_list = uv0.config.link_params
		})
		uv1:showBoxPanel(true)
	end, SFX_PANEL)
	changeToScrollText(slot0:findTF(&quot;name_mask/name&quot;, slot2), Drop.New({
		type = slot3.config.type,
		id = slot3.config.drop_id
	}):getName())
	setText(slot0:findTF(&quot;owner/number&quot;, slot2), slot3.count .. &quot;/&quot; .. slot3.config.count)

	GetOrAddComponent(slot0:findTF(&quot;owner&quot;, slot2), typeof(CanvasGroup)).alpha = slot3.count == slot3.config.count and 0.5 or 1

	setActive(slot0:findTF(&quot;got&quot;, slot2), slot3.count == slot3.config.count)
	setActive(slot0:findTF(&quot;new&quot;, slot2), slot3.config.is_new == &quot;1&quot;)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>