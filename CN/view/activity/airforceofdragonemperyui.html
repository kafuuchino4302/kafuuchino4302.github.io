<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>airforceofdragonemperyui.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>airforceofdragonemperyui.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;AirForceOfDragonEmperyUI&quot;, import(&quot;view.base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;AirForceOfDragonEmperyUI&quot;
end

slot1 = {
	&quot;J-20&quot;,
	&quot;J-10&quot;,
	&quot;J-15&quot;,
	&quot;FC-1&quot;,
	&quot;FC-31&quot;
}
slot2 = {
	&quot;fighterplane_J20_tip&quot;,
	&quot;fighterplane_J10_tip&quot;,
	&quot;fighterplane_J15_tip&quot;,
	&quot;fighterplane_FC1_tip&quot;,
	&quot;fighterplane_FC31_tip&quot;
}

slot0.init = function(slot0)
	slot0.itemList = {}
	slot4 = &quot;List&quot;

	for slot4 = 0, slot0._tf:Find(slot4).childCount - 1 do
		slot5 = slot0._tf:Find(&quot;List&quot;):GetChild(slot4)

		setImageAlpha(slot5:Find(&quot;Button&quot;), 0.5)
		table.insert(slot0.itemList, slot5)
	end

	slot0.currentNameImage = slot0._tf:Find(&quot;FighterName&quot;)
	slot0.currentFighterImage = slot0._tf:Find(&quot;FighterImage&quot;)
	slot0.currentFighterDesc = slot0._tf:Find(&quot;FighterProgress&quot;)

	setImageAlpha(slot0.currentNameImage, 0)
	setImageAlpha(slot0.currentFighterImage, 0)

	slot0.BattleTimes = slot0._tf:Find(&quot;BattleTimes&quot;)
	slot0.loader = AutoLoader.New()
end

slot0.SetActivityData = function(slot0, slot1)
	slot0.activity = slot1
end

slot0.GetFighterData = function(slot0, slot1)
	return slot0.activity:getKVPList(1, slot1) or 0, slot0.activity:getKVPList(2, slot1) == 1
end

slot0.GetActivityProgress = function(slot0)
	slot1 = slot0.activity:GetMaxProgress()
	slot2 = slot0.activity:GetPerDayCount()
	slot3 = 0

	for slot8 = 1, slot0.activity:GetLevelCount() do
		slot3 = slot3 + (slot0.activity:getKVPList(1, slot8) or 0)
	end

	slot5 = pg.TimeMgr.GetInstance()

	return slot3, math.min((slot5:DiffDay(slot0.activity.data1, slot5:GetServerTime()) + 1) * slot2, slot1)
end

slot0.didEnter = function(slot0)
	slot3 = slot0._tf

	onButton(slot0, slot3:Find(&quot;Back&quot;), function ()
		uv0:closeView()
	end, SOUND_BACK)

	slot3 = slot0._tf

	onButton(slot0, slot3:Find(&quot;Help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.fighterplane_help.tip,
			weight = LayerWeightConst.SECOND_LAYER
		})
	end, SFX_PANEL)

	slot3 = slot0._tf

	slot4 = function()
		slot2 = function()
			slot1 = uv0.activity:getConfig(&quot;config_client&quot;).stages
			slot2 = math.floor(#slot1 / uv0.activity:GetLevelCount())
			slot3 = slot2 * (uv1 - 1) + 1

			uv0:emit(AirForceOfDragonEmperyMediator.ON_BATTLE, slot1[math.random(slot3, math.min(slot3 + slot2 - 1, #slot1))])
		end

		if uv0.activity:GetPerLevelProgress() &lt;= uv0:GetFighterData(uv0.contextData.index) then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;fighterplane_complete_tip&quot;),
				onYes = slot2,
				weight = LayerWeightConst.SECOND_LAYER
			})
		else
			slot2()
		end
	end

	slot5 = SFX_FIGHTER_BATTLE

	onButton(slot0, slot3:Find(&quot;Battle&quot;), slot4, slot5)

	for slot4, slot5 in ipairs(slot0.itemList) do
		onButton(slot0, slot5, function ()
			uv0:SwitchIndex(uv1)
		end, SFX_FIGHTER_SWITCH)
	end

	slot0.contextData.index = nil

	slot0:SwitchIndex(slot0.contextData.index or PlayerPrefs.GetInt(&quot;AirFightIndex_&quot; .. getProxy(PlayerProxy):getRawData().id, 1))
	slot0:UpdateView()
end

slot0.willExit = function(slot0)
	PlayerPrefs.SetInt(&quot;AirFightIndex_&quot; .. getProxy(PlayerProxy):getRawData().id, slot0.contextData.index)
	PlayerPrefs.Save()
	LeanTween.cancel(go(slot0.currentNameImage))
	LeanTween.cancel(go(slot0.currentFighterImage))
	LeanTween.cancel(go(slot0.currentFighterDesc:Find(&quot;Desc/Text&quot;)))
	LeanTween.cancel(go(slot0.currentFighterDesc:Find(&quot;Progress&quot;)))
	slot0.loader:Clear()
end

slot0.UpdateView = function(slot0)
	for slot4, slot5 in ipairs(slot0.itemList) do
		slot6, slot7 = slot0:GetFighterData(slot4)
		slot8 = slot0.itemList[slot4]

		UIItemList.StaticAlign(slot8:Find(&quot;Progress&quot;), slot8:Find(&quot;Progress&quot;):GetChild(0), slot6)
	end

	slot0:UpdateFighter(slot0.contextData.index)

	slot1, slot2 = slot0:GetActivityProgress()

	setText(slot0.BattleTimes, slot2 - slot1)
	slot0:CheckActivityUpdate()
end

slot0.SwitchIndex = function(slot0, slot1)
	if slot1 == nil or slot1 == slot0.contextData.index then
		return
	end

	if slot0.contextData.index then
		slot2 = slot0.itemList[slot0.contextData.index]

		setActive(slot2:Find(&quot;Selected&quot;), false)
		setImageAlpha(slot2:Find(&quot;Button&quot;), 0.5)
	end

	slot0.contextData.index = slot1
	slot2 = slot0.itemList[slot0.contextData.index]

	setActive(slot2:Find(&quot;Selected&quot;), true)
	setImageAlpha(slot2:Find(&quot;Button&quot;), 1)
	slot0:UpdateFighter(slot1)
	(function ()
		slot0 = nil
		slot1 = uv0.currentFighterImage:GetComponent(typeof(Image))
		slot2 = tf(uv0.currentFighterImage)

		LeanTween.cancel(go(uv0.currentFighterImage))

		slot3 = nil
		slot4 = uv0.currentNameImage:GetComponent(typeof(Image))
		slot5 = tf(uv0.currentNameImage)

		LeanTween.cancel(go(uv0.currentNameImage))
		parallelAsync({
			function (slot0)
				if uv0.color.a &lt; 0.05 then
					slot0()

					return
				end

				LeanTween.alpha(uv1, 0, slot1 * 0.2):setOnComplete(System.Action(slot0))
			end,
			function (slot0)
				if uv0.color.a &lt; 0.05 then
					slot0()

					return
				end

				LeanTween.alpha(uv1, 0, slot1 * 0.2):setOnComplete(System.Action(slot0))
			end,
			function (slot0)
				uv0.loader:GetSpriteDirect(&quot;ui/AirForceOfDragonEmperyUI_atlas&quot;, uv1[uv2], function (slot0)
					uv0 = slot0

					uv1()
				end, uv0.currentFighterImage)
			end,
			function (slot0)
				uv0.loader:GetSpriteDirect(&quot;ui/AirForceOfDragonEmperyUI_atlas&quot;, uv1[uv2] .. &quot;_BG&quot;, function (slot0)
					uv0 = slot0

					uv1()
				end, uv0.currentNameImage)
			end
		}, function ()
			uv0.enabled = true
			uv0.sprite = uv1

			LeanTween.alpha(uv2, 1, 0.2)

			uv3.enabled = true
			uv3.sprite = uv4

			LeanTween.alpha(uv5, 1, 0.2)
		end)
	end)()
	(function ()
		slot0 = uv0.currentFighterDesc:Find(&quot;Desc/Text&quot;)

		LeanTween.cancel(slot0)
		slot0:GetComponent(&quot;ScrollText&quot;):SetText(i18n(uv1[uv2]))
		LeanTween.textAlpha(slot0, 1, 0.5):setFrom(0)
	end)()

	slot5, slot6 = slot0:GetFighterData(slot1)
	slot7 = slot0.currentFighterDesc:Find(&quot;Progress&quot;)
	slot8 = slot0.activity:GetPerLevelProgress()

	UIItemList.StaticAlign(slot7, slot7:GetChild(0), slot8, function (slot0, slot1, slot2)
		if not slot0 == UIItemList.EventUpdate then
			return
		end

		setActive(slot2:GetChild(0), slot1 + 1 &lt;= uv0)

		slot2:GetChild(0).localScale = Vector3(0, 1, 1)
	end)
	LeanTween.cancel(go(slot7))
	LeanTween.value(go(slot7), 0, 1, slot8 * 0.2):setOnUpdate(System.Action_float(function (slot0)
		for slot4 = 0, 2 do
			uv0:GetChild(slot4):GetChild(0).localScale = Vector3(math.clamp(uv1 * slot0 - slot4, 0, 1), 1, 1)
		end
	end))
	slot0.loader:GetSprite(&quot;ui/AirForceOfDragonEmperyUI_atlas&quot;, uv0[slot1] .. &quot;_Text&quot;, slot0.currentFighterDesc:Find(&quot;Name&quot;), true)
end

slot0.UpdateFighter = function(slot0, slot1)
	slot2, slot3 = slot0:GetFighterData(slot1)
	slot4 = slot0.itemList[slot1]
	slot7 = slot4:Find(&quot;Progress&quot;)

	UIItemList.StaticAlign(slot4:Find(&quot;Progress&quot;), slot7:GetChild(0), slot2)

	slot5 = slot0.currentFighterDesc
	slot6 = slot0.activity
	slot6 = slot6:getConfig(&quot;config_client&quot;).awards[slot1]

	updateDrop(slot5:Find(&quot;Item&quot;), {
		type = slot6[1],
		id = slot6[2],
		count = slot6[3]
	})
	setActive(slot5:Find(&quot;ItemMask&quot;), slot3)
	onButton(slot0, slot5:Find(&quot;Item&quot;), function ()
		uv0:emit(BaseUI.ON_DROP, uv1)
	end, SFX_PANEL)
end

slot0.CheckActivityUpdate = function(slot0)
	slot1 = slot0.activity:GetPerLevelProgress()

	for slot6 = 1, slot0.activity:GetLevelCount() do
		slot7, slot8 = slot0:GetFighterData(slot6)

		if slot1 &lt;= slot7 and not slot8 then
			slot0:emit(AirForceOfDragonEmperyMediator.ON_ACTIVITY_OPREATION, {
				cmd = 2,
				activity_id = slot0.activity.id,
				arg1 = slot6
			})

			return
		end
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>