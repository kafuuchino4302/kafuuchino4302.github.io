<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cluegroupsingleview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>cluegroupsingleview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ClueGroupSingleView&quot;, import(&quot;view.base.BaseUI&quot;))
slot1 = pg.activity_clue
slot2 = pg.activity_clue_group
slot3 = 0.6
slot4 = 1

slot0.getUIName = function(slot0)
	return &quot;ClueGroupSingleUI&quot;
end

slot0.init = function(slot0)
	slot0.clueGroupTf = slot0:findTF(&quot;clueGroup&quot;)

	setText(slot0:findTF(&quot;goBtn/Text&quot;, slot0.clueGroupTf), i18n(&quot;clue_task_goto&quot;))
	setText(slot0:findTF(&quot;closeTip&quot;), i18n(&quot;clue_close_tip&quot;))

	slot0.timerList = {}
end

slot0.didEnter = function(slot0)
	slot0.activityId = ActivityConst.Valleyhospital_ACT_ID
	slot0.playerId = getProxy(PlayerProxy):getRawData().id
	slot0.investigatingGroupId = PlayerPrefs.GetInt(&quot;investigatingGroupId_&quot; .. slot0.activityId .. &quot;_&quot; .. slot0.playerId)
	slot0.taskProxy = getProxy(TaskProxy)

	onButton(slot0, slot0:findTF(&quot;mask&quot;), function ()
		uv0:closeView()
	end, SFX_PANEL)
	slot0:SetClueGroup()
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false)
end

slot0.SetClueGroup = function(slot0)
	slot1 = slot0.contextData.clueGroupId
	slot2 = slot0.contextData.submitClueIds
	slot3 = slot0.clueGroupTf
	slot4 = uv0[slot1]
	slot5 = uv1.get_id_list_by_group[slot1]
	slot7 = slot0.taskProxy:getTaskVO(tonumber(({
		uv1[slot5[1]],
		uv1[slot5[2]],
		uv1[slot5[3]]
	})[3].task_id)):getProgress()
	slot8 = {}

	for slot12 = 1, 3 do
		slot8[slot12] = slot0.taskProxy:getFinishTaskById(tonumber(slot6[slot12].task_id))
	end

	setText(slot0:findTF(&quot;title/Text&quot;, slot3), slot4.title)
	setActive(slot0:findTF(&quot;title/Text&quot;, slot3), slot8[1] or slot8[2] or slot8[3])
	setActive(slot0:findTF(&quot;title/lock&quot;, slot3), not slot8[1] and not slot8[2] and not slot8[3])
	LoadImageSpriteAsync(&quot;cluepictures/&quot; .. slot4.pic, slot0:findTF(&quot;picture&quot;, slot3), true)

	if slot4.type == 1 then
		slot0:findTF(&quot;picture&quot;, slot3).localScale = Vector3(1, 1, 1)
	else
		slot0:findTF(&quot;picture&quot;, slot3).localScale = Vector3(0.6, 0.6, 1)
	end

	setActive(slot0:findTF(&quot;picture/lockSite&quot;, slot3), slot4.type == 1 and not slot8[1] and not slot8[2] and not slot8[3])
	setActive(slot0:findTF(&quot;picture/lockChara&quot;, slot3), slot4.type == 2 and not slot8[1] and not slot8[2] and not slot8[3])

	slot9 = false

	for slot13 = 1, 3 do
		if slot8[slot13] then
			setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), slot6[slot13].desc)
		elseif slot0.investigatingGroupId == slot1 then
			setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), &quot;&lt;color=#858593&gt;&quot; .. slot6[slot13].unlock_desc .. slot6[slot13].unlock_num .. i18n(&quot;clue_task_tip&quot;, slot7) .. &quot;&lt;/color&gt;&quot;)
		elseif not slot9 then
			slot9 = true

			setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), &quot;&lt;color=#858593&gt;&quot; .. slot6[slot13].unlock_desc .. slot6[slot13].unlock_num .. i18n(&quot;clue_task_tip&quot;, slot7) .. &quot;&lt;/color&gt;&quot;)
		else
			setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), &quot;&lt;color=#858593&gt;？？？&lt;/color&gt;&quot;)
		end
	end

	setActive(slot0:findTF(&quot;goBtn/selected&quot;, slot3), slot0.investigatingGroupId == slot1)
	onButton(slot0, slot0:findTF(&quot;goBtn&quot;, slot3), function ()
		uv0.investigatingGroupId = uv1

		PlayerPrefs.SetInt(&quot;investigatingGroupId_&quot; .. uv0.activityId .. &quot;_&quot; .. uv0.playerId, uv1)
		setActive(uv0:findTF(&quot;goBtn/selected&quot;, uv2), true)

		if uv0.pageIndex == 1 then
			uv0:ShowSitePage()
		elseif uv0.pageIndex == 2 then
			uv0:ShowCharaPage()
		end

		uv0:OpenChapter(uv1)
		uv0:closeView()
	end, SFX_PANEL)

	if not slot8[1] and not slot8[2] and not slot8[3] then
		setActive(slot0:findTF(&quot;triangle&quot;, slot0.clueGroupTf), false)
	else
		setActive(slot0:findTF(&quot;triangle&quot;, slot0.clueGroupTf), true)
		setActive(slot0:findTF(&quot;triangle&quot;, slot0.clueGroupTf), slot0:findTF(&quot;clueScroll&quot;, slot0.clueGroupTf):GetComponent(typeof(ScrollRect)).normalizedPosition.y &gt; 0.01)
		onScroll(slot0, slot0:findTF(&quot;clueScroll&quot;, slot0.clueGroupTf), function (slot0)
			setActive(uv0:findTF(&quot;triangle&quot;, uv0.clueGroupTf), slot0.y &gt; 0.01)
		end)
	end

	setActive(slot0:findTF(&quot;top&quot;), slot2 and #slot2 &gt; 0)

	if slot2 and #slot2 &gt; 0 then
		if table.contains(slot2, slot5[1]) then
			setActive(slot0:findTF(&quot;title/Text&quot;, slot3), false)
			setActive(slot0:findTF(&quot;title/lock&quot;, slot3), true)
			setActive(slot0:findTF(&quot;picture/lockSite&quot;, slot3), slot4.type == 1)
			setActive(slot0:findTF(&quot;picture/lockChara&quot;, slot3), slot4.type == 2)

			for slot13 = 1, #slot2 do
				if slot0.investigatingGroupId == slot1 then
					setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), &quot;&lt;color=#858593&gt;&quot; .. slot6[slot13].unlock_desc .. slot6[slot13].unlock_num .. &quot;&lt;/color&gt;&quot;)
				else
					setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot13, slot3), &quot;&lt;color=#858593&gt;？？？&lt;/color&gt;&quot;)
				end
			end

			slot0:StartTimer(function ()
				slot1 = uv0

				setActive(slot1:findTF(&quot;title/Text&quot;, uv1), true)

				slot0 = uv0
				slot0 = slot0:findTF(&quot;title&quot;, uv1)
				slot0 = slot0:GetComponent(typeof(Animation))
				slot0 = slot0:Play(&quot;anim_clue_single_unlock1&quot;)
				slot1 = uv0
				slot3 = uv0

				slot1:SetEndAniEvent(slot3:findTF(&quot;title&quot;, uv1), function ()
					setActive(uv0:findTF(&quot;title/lock&quot;, uv1), false)
				end)
			end, uv2)

			slot13 = uv2

			slot0:StartTimer(function ()
				slot0 = uv0
				slot0 = slot0:findTF(&quot;picture&quot;, uv1)
				slot0 = slot0:GetComponent(typeof(Animation))
				slot0 = slot0:Play(&quot;anim_clue_single_unlock&quot;)
				slot1 = uv0
				slot3 = uv0

				slot1:SetEndAniEvent(slot3:findTF(&quot;picture&quot;, uv1), function ()
					setActive(uv0:findTF(&quot;picture/lockSite&quot;, uv1), false)
					setActive(uv0:findTF(&quot;picture/lockChara&quot;, uv1), false)
				end)
			end, slot13)

			for slot13 = 1, #slot2 do
				slot0:StartTimer(function ()
					setText(uv0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. uv1, uv2), uv3[uv1].desc)
				end, uv3 * slot13 + uv2)
			end
		else
			for slot14 = table.indexof(slot5, slot2[1]), 3 do
				if slot0.investigatingGroupId == slot1 then
					setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot14, slot3), &quot;&lt;color=#858593&gt;&quot; .. slot6[slot14].unlock_desc .. slot6[slot14].unlock_num .. &quot;&lt;/color&gt;&quot;)
				else
					setText(slot0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. slot14, slot3), &quot;&lt;color=#858593&gt;？？？&lt;/color&gt;&quot;)
				end
			end

			slot11 = 1

			for slot15 = slot10, slot10 + #slot2 - 1 do
				slot0:StartTimer(function ()
					setText(uv0:findTF(&quot;clueScroll/Viewport/Content/clue&quot; .. uv1, uv2), uv3[uv1].desc)
				end, uv3 * slot11)

				slot11 = slot11 + 1
			end
		end

		setActive(slot0:findTF(&quot;goBtn&quot;, slot3), false)
	else
		slot10 = setActive
		slot11 = slot0:findTF(&quot;goBtn&quot;, slot3)
		slot12 = not slot8[1] or not slot8[2] or not slot8[3]

		slot10(slot11, slot12)
	end
end

slot0.OpenChapter = function(slot0, slot1)
	slot0:emit(ClueGroupSingleMediator.OPEN_CLUE_JUMP, slot1)
end

slot0.StartTimer = function(slot0, slot1, slot2)
	slot3 = Timer.New(slot1, slot2, 1)

	slot3:Start()
	table.insert(slot0.timerList, slot3)
end

slot0.RemoveAllTimer = function(slot0)
	for slot4, slot5 in ipairs(slot0.timerList) do
		slot5:Stop()
	end

	slot0.timerList = {}
end

slot0.SetEndAniEvent = function(slot0, slot1, slot2)
	if slot1:GetComponent(typeof(DftAniEvent)) then
		slot3:SetEndEvent(function ()
			uv0()
			uv1:SetEndEvent(nil)
		end)
	end
end

slot0.willExit = function(slot0)
	slot0:RemoveAllTimer()
end

slot0.onBackPressed = function(slot0)
	slot0:closeView()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>