<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secretshipyardscene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>secretshipyardscene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;SecretShipyardScene&quot;, import(&quot;..base.BaseUI&quot;))
slot0.optionsPath = {
	&quot;main/top/btn_home&quot;
}
slot0.ACT_ID = 5625
slot0.GAME_ID = 59
slot0.ANIMATIONS = {
	&quot;Phase_00&quot;,
	&quot;Phase_01&quot;,
	&quot;Phase_02&quot;,
	&quot;Phase_03&quot;,
	&quot;Phase_04&quot;,
	&quot;Phase_05&quot;,
	&quot;Phase_06&quot;,
	&quot;Phase_07&quot;
}
slot0.EFFECT_DELAY = 2
slot0.ANIMATION_DELAY = 1
slot0.STORY_DELAY = 3

slot0.getUIName = function(slot0)
	return &quot;SecretShipyardUI&quot;
end

slot0.init = function(slot0)
	slot0.activity = getProxy(ActivityProxy):getActivityById(uv0.ACT_ID)
	slot0.count = 0
	slot0.bgId = 1
	slot0.taskProxy = getProxy(TaskProxy)
	slot0.taskGroup = slot0.activity:getConfig(&quot;config_data&quot;)
	slot0.main = slot0:findTF(&quot;main&quot;)
	slot0.bottom = slot0:findTF(&quot;bottom&quot;, slot0.main)
	slot0.gameButton = slot0:findTF(&quot;btn_go_game&quot;, slot0.bottom)
	slot0.gameButtonLock = slot0:findTF(&quot;btn_go_game_lock&quot;, slot0.gameButton)
	slot0.items = slot0:findTF(&quot;items&quot;, slot0.bottom)
	slot0.item = slot0:findTF(&quot;item&quot;, slot0.bottom)
	slot0.dayText = slot0:findTF(&quot;day/nday&quot;, slot0.bottom)
	slot0.description = slot0:findTF(&quot;description/Text&quot;, slot0.bottom)
	slot0.top = slot0:findTF(&quot;top&quot;, slot0.main)
	slot0.buttonBack = slot0:findTF(&quot;btn_back&quot;, slot0.top)
	slot0.buttonHelp = slot0:findTF(&quot;btn_help&quot;, slot0.top)
	slot0.uilist = UIItemList.New(slot0.items, slot0.item)
	slot0.bg = slot0:findTF(&quot;bg&quot;)
	slot0.animator = slot0:findTF(&quot;anim&quot;, slot0.bg):GetComponent(typeof(Animator))
	slot0.effect = slot0:findTF(&quot;effect&quot;, slot0.bg)
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0.buttonBack, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0.buttonHelp, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = i18n(&quot;shipyard_phase_1&quot; or &quot;shipyard_phase_2&quot;)
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.gameButton, function ()
		if not uv0:checkTaskFinish() or not uv0:checkMinigame() then
			return
		end

		uv0:emit(SecretShipyardMediator.GO_MINI_GAME, uv1.GAME_ID)
	end, SFX_PANEL)
	onButton(slot0, slot0.gameButtonLock, function ()
		pg.TipsMgr.GetInstance():ShowTips(i18n(uv0:checkTaskFinish() and &quot;shipyard_button_1&quot; or &quot;shipyard_button_2&quot;))
	end, SFX_PANEL)
	slot0.uilist:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:UpdateTask(slot1, slot2)
		end
	end)
	setText(slot0.description, i18n(&quot;shipyard_introduce&quot;))
	setActive(slot0.effect, false)
	setActive(slot0.buttonHelp, slot0:checkMinigame())

	slot0.count = slot0.activity.data3
	slot0.bgId = slot0:CheckBgId()

	slot0.animator:Play(uv0.ANIMATIONS[slot0.bgId])
	slot0:OnUpdateFlush()

	if slot0.activity:getConfig(&quot;config_client&quot;).firstStory then
		playStory(slot1)
	end

	slot0:PlayStory()
end

slot0.UpdateTask = function(slot0, slot1, slot2)
	slot4 = slot0:findTF(&quot;item&quot;, slot2)
	slot6 = slot0.taskProxy:getTaskById(slot0.taskGroup[slot0.count][slot1 + 1]) or slot0.taskProxy:getFinishTaskById(slot5)

	assert(slot6, &quot;without this task by id: &quot; .. slot5)

	slot7 = slot6:getConfig(&quot;award_display&quot;)[1]

	updateDrop(slot4, {
		type = slot7[1],
		id = slot7[2],
		count = slot7[3]
	})
	onButton(slot0, slot4, function ()
		warning(&quot;click&quot;)
		uv0:emit(BaseUI.ON_DROP, uv1)
	end, SFX_PANEL)

	slot9 = slot6:getProgress()
	slot10 = slot6:getConfig(&quot;target_num&quot;)

	setText(slot0:findTF(&quot;description&quot;, slot2), slot6:getConfig(&quot;desc&quot;))
	setText(slot0:findTF(&quot;progress_text&quot;, slot2), slot9 .. (&quot;/&quot; .. slot10))
	setSlider(slot0:findTF(&quot;progress&quot;, slot2), 0, slot10, slot9)

	slot14 = slot0:findTF(&quot;get_btn&quot;, slot2)

	setActive(slot0:findTF(&quot;go_btn&quot;, slot2), slot6:getTaskStatus() == 0)
	setActive(slot14, slot16 == 1)
	setActive(slot0:findTF(&quot;got_btn&quot;, slot2), slot16 == 2)
	onButton(slot0, slot13, function ()
		uv0:emit(SecretShipyardMediator.TASK_GO, uv1)
	end, SFX_PANEL)
	onButton(slot0, slot14, function ()
		uv0:emit(SecretShipyardMediator.SUBMIT_TASK, uv1.id)
	end, SFX_PANEL)
	setActive(slot0:findTF(&quot;mask&quot;, slot2), slot0.taskProxy:getFinishTaskById(slot5) ~= nil)
end

slot0.updateTaskLayers = function(slot0)
	updateActivityTaskStatus(slot0.activity)

	slot0.activity = getProxy(ActivityProxy):getActivityById(uv0.ACT_ID)

	slot0:OnUpdateFlush()
end

slot0.CheckBgId = function(slot0)
	slot1 = slot0.activity.data3

	if slot0.taskProxy:getFinishTaskById(slot0.taskGroup[slot0.count][1]) ~= nil and slot0.taskProxy:getFinishTaskById(slot0.taskGroup[slot0.count][2]) ~= nil then
		slot1 = slot1 + 1
	end

	return slot1
end

slot0.OnUpdateFlush = function(slot0)
	slot0.count = slot0.activity.data3

	if slot0.bgId ~= slot0:CheckBgId() then
		slot0.bgId = slot0:CheckBgId()

		slot0:ChangeBackground()
	end

	if slot0.dayText then
		setText(slot0.dayText, tostring(slot0.count))
	end

	setActive(slot0.gameButtonLock, not slot0:checkTaskFinish() or not slot0:checkMinigame())
	setActive(slot0.gameButton, slot0:checkTaskFinish() or slot0:checkMinigame())
	slot0.uilist:align(#slot0.taskGroup[slot0.count])
end

slot0.ChangeBackground = function(slot0)
	LeanTween.cancel(go(slot0._tf))
	setActive(slot0.effect, true)
	LeanTween.delayedCall(go(slot0._tf), uv0.ANIMATION_DELAY, System.Action(function ()
		uv0.animator:Play(uv1.ANIMATIONS[uv0.bgId])
	end))
	LeanTween.delayedCall(go(slot0._tf), uv0.EFFECT_DELAY, System.Action(function ()
		setActive(uv0.effect, false)
	end))
	LeanTween.delayedCall(go(slot0._tf), uv0.STORY_DELAY, System.Action(function ()
		uv0:PlayStory()
	end))
end

slot0.PlayStory = function(slot0)
	if checkExist(slot0.activity:getConfig(&quot;config_client&quot;).story, {
		slot0.bgId - 1
	}, {
		1
	}) then
		playStory(slot1[slot0.bgId - 1][1])
	end
end

slot0.checkTaskFinish = function(slot0)
	if slot0.count &lt; #slot0.taskGroup then
		return false
	end

	for slot4, slot5 in ipairs(slot0.taskGroup[slot0.count]) do
		if not slot0.taskProxy:getFinishTaskById(slot5) then
			return false
		end
	end

	return true
end

slot0.checkMinigame = function(slot0)
	return pg.mini_game[uv0.GAME_ID] ~= nil and pg.TimeMgr.GetInstance():inTime(pg.mini_game[uv0.GAME_ID].simple_config_data.show_time)
end

slot0.willExit = function(slot0)
	LeanTween.cancel(go(slot0._tf))
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>