<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>doamedalcollectionview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>doamedalcollectionview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;DoaMedalCollectionView&quot;, import(&quot;view.base.BaseUI&quot;))
slot0.FADE_OUT_TIME = 1
slot0.PAGE_NUM = 7
slot0.MEDAL_NUM_PER_PAGE = 2

slot0.getUIName = function(slot0)
	return &quot;DoaMedalCollectionUI&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
end

slot0.didEnter = function(slot0)
	slot0:checkAward()
	setText(slot0.progressText, setColorStr(tostring(#slot0.activeIDList), COLOR_WHITE) .. &quot;/&quot; .. #slot0.allIDList)
	triggerToggle(slot0.switchBtnList[1], true)
end

slot0.willExit = function(slot0)
	if LeanTween.isTweening(go(slot0.picture)) then
		LeanTween.cancel(go(slot0.picture), false)
	end
end

slot0.getBGM = function(slot0)
	return math.random() &gt; 0.5 and &quot;doa_main_day&quot; or &quot;doa_main_night&quot;
end

slot0.initData = function(slot0)
	slot0.activityProxy = getProxy(ActivityProxy)
	slot0.activityData = slot0.activityProxy:getActivityById(ActivityConst.DOA_MEDAL_ACT_ID)
	slot0.allIDList = slot0.activityData:GetPicturePuzzleIds()

	print(#slot0.allIDList)

	slot0.pageIDList = {}

	for slot4 = 1, uv0.PAGE_NUM do
		slot0.pageIDList[slot4] = {}

		for slot8 = 1, uv0.MEDAL_NUM_PER_PAGE do
			slot0.pageIDList[slot4][slot8] = slot0.allIDList[(slot4 - 1) * uv0.MEDAL_NUM_PER_PAGE + slot8]
		end
	end

	slot0.activatableIDList = slot0.activityData.data1_list
	slot0.activeIDList = slot0.activityData.data2_list
	slot0.curPage = nil
	slot0.newMedalID = nil
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot1 = slot0:findTF(&quot;NotchAdapt&quot;)
	slot0.backBtn = slot0:findTF(&quot;BackBtn&quot;, slot1)
	slot0.progressText = slot0:findTF(&quot;ProgressImg/ProgressText&quot;, slot1)
	slot0.helpBtn = slot0:findTF(&quot;HelpBtn&quot;, slot1)
	slot0.tplButtom = findTF(slot0:findTF(&quot;SwitchBtnList&quot;, slot0._tf), &quot;tplButtom&quot;)
	slot6 = slot1
	slot0.imgGot = slot0:findTF(&quot;ProgressImg/got&quot;, slot6)
	slot0.switchBtnList = {}
	slot0.medalTfList = {}

	for slot6 = 1, uv0.PAGE_NUM do
		slot7 = tf(instantiate(go(slot0.tplButtom)))

		LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;ship&quot; .. slot6 .. &quot;Icon&quot;, function (slot0)
			if uv0 then
				setImageSprite(findTF(uv0, &quot;icon&quot;), slot0, true)
			end
		end)
		LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;ship&quot; .. slot6 .. &quot;Name&quot;, function (slot0)
			if uv0 then
				setImageSprite(findTF(uv0, &quot;name&quot;), slot0, true)
			end
		end)

		slot11 = function(slot0)
			if uv0 then
				setImageSprite(findTF(uv0, &quot;nameSelect&quot;), slot0, true)
			end
		end

		LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;ship&quot; .. slot6 .. &quot;NameSelect&quot;, slot11)
		setParent(slot7, slot2)
		setActive(slot7, true)
		table.insert(slot0.switchBtnList, slot7)

		for slot11 = 1, uv0.MEDAL_NUM_PER_PAGE do
			slot13 = findTF(slot0._tf, &quot;MedalContainer/medal&quot; .. (slot6 - 1) * uv0.MEDAL_NUM_PER_PAGE + slot11)

			setActive(slot13, false)
			GetComponent(findTF(slot13, &quot;disAcive/lock&quot;), typeof(Image)):SetNativeSize()
			GetComponent(findTF(slot13, &quot;disAcive/unlock&quot;), typeof(Image)):SetNativeSize()
			table.insert(slot0.medalTfList, slot13)
		end
	end

	slot0.picture = findTF(slot0._tf, &quot;picture&quot;)
	slot0.pictureName = findTF(slot0._tf, &quot;picture/name&quot;)
	slot0.leftPage = findTF(slot0._tf, &quot;book/leftPage&quot;)
	slot0.rightPage = findTF(slot0._tf, &quot;book/rightPage&quot;)
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:closeView()
	end, SFX_CANCEL)

	slot4 = function()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.doa_collection.tip
		})
	end

	slot5 = SFX_PANEL

	onButton(slot0, slot0.helpBtn, slot4, slot5)

	for slot4, slot5 in ipairs(slot0.switchBtnList) do
		onToggle(slot0, slot5, function (slot0)
			if slot0 == true then
				uv0.curPage = uv1

				uv0:updateSwitchBtnTF()
				uv0:updateMedalContainerView(uv1, uv0.curPage ~= uv1)
			end
		end, SFX_PANEL)
	end
end

slot0.UpdateActivity = function(slot0, slot1)
	slot0:checkAward()
end

slot0.updateMedalContainerView = function(slot0, slot1, slot2)
	slot3 = slot0.pageIDList[slot1]

	if slot2 then
		setActive(slot0.picture, false)
		LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;pictureImage&quot; .. slot1, function (slot0)
			setImageSprite(uv0.picture, slot0, true)

			if LeanTween.isTweening(go(uv0.picture)) then
				LeanTween.cancel(go(uv0.picture), false)
			end

			slot1 = LeanTween.value(go(uv0.picture), 0, 1, 0.3)

			slot1:setOnUpdate(System.Action_float(function (slot0)
				GetComponent(uv0.picture, typeof(CanvasGroup)).alpha = slot0
			end))
			setActive(uv0.picture, true)
		end)
	else
		setActive(slot0.picture, true)
		LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;pictureImage&quot; .. slot1, function (slot0)
			setImageSprite(uv0.picture, slot0, true)
		end)
	end

	slot7 = function(slot0)
		setImageSprite(uv0.pictureName, slot0, true)
	end

	LoadSpriteAtlasAsync(&quot;ui/doamedalcollectionui_atlas&quot;, &quot;pictureName&quot; .. slot1, slot7)

	for slot7 = 1, #slot0.medalTfList do
		slot9 = (slot1 - 1) * uv0.MEDAL_NUM_PER_PAGE + uv0.MEDAL_NUM_PER_PAGE

		if (slot1 - 1) * uv0.MEDAL_NUM_PER_PAGE &lt; slot7 and slot7 &lt;= slot9 then
			setActive(slot0.medalTfList[slot7], true)
		else
			setActive(slot0.medalTfList[slot7], false)
		end
	end

	for slot7, slot8 in ipairs(slot3) do
		slot0:updateMedalView(slot3, slot8)
	end
end

slot0.updateMedalView = function(slot0, slot1, slot2)
	slot3 = table.contains(slot0.activeIDList, slot2)
	slot5 = not slot3 and not (table.contains(slot0.activatableIDList, slot2) and not slot3)
	slot8 = slot0.medalTfList[(slot0.curPage - 1) * uv0.MEDAL_NUM_PER_PAGE + table.indexof(slot1, slot2, 1)]

	if slot3 then
		setActive(findTF(slot8, &quot;isActive&quot;), true)
		setActive(findTF(slot8, &quot;disAcive&quot;), false)
	else
		setActive(findTF(slot8, &quot;isActive&quot;), false)
		setActive(findTF(slot8, &quot;disAcive&quot;), true)

		if slot4 then
			onButton(slot0, findTF(slot8, &quot;disAcive&quot;), function ()
				pg.m02:sendNotification(GAME.MEMORYBOOK_UNLOCK, {
					id = uv0,
					actId = uv1.activityData.id
				})
			end, SFX_PANEL)
			setActive(findTF(slot8, &quot;disAcive/lock&quot;), false)
			setActive(findTF(slot8, &quot;disAcive/unlock&quot;), true)
		else
			setActive(findTF(slot8, &quot;disAcive/lock&quot;), true)
			setActive(findTF(slot8, &quot;disAcive/unlock&quot;), false)
		end
	end
end

slot0.updateSwitchBtnTF = function(slot0)
	setText(slot0.leftPage, (slot0.curPage - 1) * uv0.MEDAL_NUM_PER_PAGE + 1)

	slot4 = uv0.MEDAL_NUM_PER_PAGE

	setText(slot0.rightPage, (slot0.curPage - 1) * slot4 + 2)

	for slot4, slot5 in ipairs(slot0.switchBtnList) do
		slot6 = slot0:findTF(&quot;Tip&quot;, slot5)

		if slot0:caculateActivatable(slot4) == 0 or slot4 == slot0.curPage then
			setActive(slot6, false)
		end

		if slot7 &gt; 0 and slot4 ~= slot0.curPage then
			setActive(slot6, true)
		end
	end
end

slot0.updateAfterSubmit = function(slot0, slot1)
	slot0.activityProxy = getProxy(ActivityProxy)
	slot0.activityData = slot0.activityProxy:getActivityById(ActivityConst.DOA_MEDAL_ACT_ID)
	slot0.activatableIDList = slot0.activityData.data1_list
	slot0.activeIDList = slot0.activityData.data2_list
	slot0.newMedalID = slot1

	triggerToggle(slot0.switchBtnList[slot0.curPage], true)
	setText(slot0.progressText, setColorStr(tostring(#slot0.activeIDList), COLOR_WHITE) .. &quot;/&quot; .. #slot0.allIDList)
	slot0:checkAward()
end

slot0.caculateActivatable = function(slot0, slot1)
	slot3 = 0

	for slot7, slot8 in ipairs(slot0.pageIDList[slot1]) do
		slot10 = table.contains(slot0.activatableIDList, slot8)

		if not table.contains(slot0.activeIDList, slot8) and slot10 then
			slot3 = slot3 + 1
		end
	end

	return slot3
end

slot0.checkAward = function(slot0)
	setActive(slot0.imgGot, #slot0.activeIDList == #slot0.allIDList and slot0.activityData.data1 == 1)

	if #slot0.activeIDList == #slot0.allIDList and slot0.activityData.data1 ~= 1 then
		pg.m02:sendNotification(GAME.ACTIVITY_OPERATION, {
			cmd = 1,
			activity_id = ActivityConst.DOA_MEDAL_ACT_ID
		})
		setActive(slot0.imgGot, true)
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>