<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>newyearhotspringshipselectlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>newyearhotspringshipselectlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewYearHotSpringShipSelectLayer&quot;, import(&quot;view.base.BaseUI&quot;))
slot1 = import(&quot;.NewYearHotSpringFormationCard&quot;)

slot0.getUIName = function(slot0)
	return &quot;NewYearHotSpringShipSelectUI&quot;
end

slot0.init = function(slot0)
	slot0.counterTxt = slot0:findTF(&quot;frame/top/value/Text&quot;):GetComponent(typeof(Text))
	slot0.cardContainer = slot0:findTF(&quot;frame/panel&quot;)
	slot0.mainPanel = slot0:findTF(&quot;frame&quot;)
	slot0.addShipTpl = slot0.cardContainer:Find(&quot;AddShipTpl&quot;)
	slot0.extendShipTpl = slot0.cardContainer:Find(&quot;ExtendShipTpl&quot;)
	slot0.shipCardTpl = slot0.cardContainer:Find(&quot;ShipCardTpl&quot;)

	setActive(slot0.addShipTpl, false)
	setActive(slot0.extendShipTpl, false)
	setActive(slot0.shipCardTpl, false)

	slot0.cardContainer = slot0.cardContainer:Find(&quot;Scroll View/Content&quot;)
	slot0.shipCards = {}

	setText(slot0:findTF(&quot;frame/desc&quot;), i18n(&quot;hotspring_tip1&quot;))
end

slot0.SetActivity = function(slot0, slot1)
	slot0.activity = slot1
end

slot0.didEnter = function(slot0)
	slot0._tf:Find(&quot;BG&quot;):SetSiblingIndex(0)
	onButton(slot0, slot0._tf:Find(&quot;BG&quot;), function ()
		uv0:emit(uv1.ON_CLOSE)
	end, SFX_PANEL)

	slot1 = function(slot0)
		setActive(uv0:findTF(&quot;frame/panel/ArrowRight&quot;), slot0.x &lt; 0.01)
		setActive(uv0:findTF(&quot;frame/panel/ArrowLeft&quot;), slot0.x &gt; 0.99)
	end

	onScroll(slot0, slot0.cardContainer.parent, slot1)
	slot1({
		x = 0
	})
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false, {
		weight = LayerWeightConst.BASE_LAYER
	})
	slot0:UpdateSlots()
end

slot0.UpdateSlots = function(slot0)
	slot1 = slot0.activity

	slot0:CleanCards()
	_.each(_.range(1, slot1:GetTotalSlotCount()), function (slot0)
		slot1 = uv0:GetShipIds()[slot0] or 0
		slot2 = math.clamp(slot0 - uv0:GetSlotCount(), 0, 2)
		slot3 = slot1 &gt; 0 and getProxy(BayProxy):RawGetShipById(slot1)

		uv1:AddCard(slot0, slot2, slot3)

		uv2 = uv2 + (slot2 == 0 and 1 or 0)
		uv3 = uv3 + (slot3 and 1 or 0)
	end)

	slot0.counterTxt.text = 0 .. &quot;/&quot; .. 0
end

slot0.AddCard = function(slot0, slot1, slot2, slot3)
	slot4 = nil

	if slot2 == 0 and slot3 then
		slot4 = cloneTplTo(slot0.shipCardTpl, slot0.cardContainer)
		slot5 = slot4:Find(&quot;content&quot;)

		onButton(slot0, slot5, function ()
			uv0:emit(NewYearHotSpringShipSelectMediator.OPEN_CHUANWU, uv1, uv2)
		end, SFX_PANEL)

		slot7 = GetOrAddComponent(slot5, typeof(UILongPressTrigger))

		slot7.onLongPressed:RemoveAllListeners()
		slot7.onLongPressed:AddListener(function ()
			if not uv0 then
				return
			end

			uv1:emit(NewYearHotSpringShipSelectMediator.LOOG_PRESS_SHIP, uv2, uv0)
		end)
		uv0.New(go(slot4)):update(slot3)

		slot8 = slot3:getRecoverEnergyPoint() + slot0.activity:GetEnergyRecoverAddition()
		slot9 = 0

		if slot3.state == Ship.STATE_REST or slot3.state == Ship.STATE_TRAIN then
			if slot3.state == Ship.STATE_TRAIN then
				slot8 = slot8 + Ship.BACKYARD_1F_ENERGY_ADDITION
			elseif slot3.state == Ship.STATE_REST then
				slot8 = slot8 + Ship.BACKYARD_2F_ENERGY_ADDITION
			end

			for slot13, slot14 in ipairs(BuffHelper.GetBackYardEnergyBuffs()) do
				slot9 = slot9 + tonumber(slot14:getConfig(&quot;benefit_effect&quot;))
			end
		end

		slot6:updateProps1({
			{
				i18n(&quot;word_lv&quot;),
				slot3.level
			},
			{
				i18n(&quot;word_nowenergy&quot;),
				slot3.energy
			},
			{
				i18n(&quot;word_energy_recov_speed&quot;),
				setColorStr(10 * slot8, COLOR_GREEN) .. (slot9 &gt; 0 and setColorStr(&quot;+&quot; .. 10 * slot9, COLOR_GREEN) or &quot;&quot;) .. &quot;/h&quot;
			}
		})
		setActive(slot6.propsTr, false)
		setActive(slot6.propsTr1, true)
		table.insert(slot0.shipCards, {
			info = slot6,
			longpressedTigger = slot7
		})
	else
		setActive(cloneTplTo(slot0.extendShipTpl, slot0.cardContainer):Find(&quot;content&quot;):Find(&quot;label/add&quot;), slot2 == 0)
		setActive(slot5:Find(&quot;label/unlock&quot;), slot2 == 1)
		setActive(slot5:Find(&quot;label/lock&quot;), slot2 == 2)
		setActive(slot5:Find(&quot;mask&quot;), slot2 == 2)

		if slot2 == 0 then
			onButton(slot0, slot5, function ()
				uv0:emit(NewYearHotSpringShipSelectMediator.OPEN_CHUANWU, uv1)
			end, SFX_PANEL)
		elseif slot2 == 1 then
			onButton(slot0, slot5, function ()
				uv0:emit(NewYearHotSpringShipSelectMediator.EXTEND, uv1)
			end, SFX_PANEL)
		elseif slot2 == 2 then
			-- Nothing
		end
	end

	setActive(slot4, true)
end

slot0.CleanCards = function(slot0)
	_.each(slot0.shipCards, function (slot0)
		slot0.longpressedTigger.onLongPressed:RemoveAllListeners()
		slot0.info:clear()
	end)

	slot0.shipCards = {}

	removeAllChildren(slot0.cardContainer)
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
	slot0:CleanCards()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>