<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>newyearhotspringshoplayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>newyearhotspringshoplayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewYearHotSpringShopLayer&quot;, import(&quot;view.base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;NewYearHotSpringShopUI&quot;
end

slot0.init = function(slot0)
	slot0.goodsContainer = slot0._tf:Find(&quot;Box/Container/Goods&quot;)
	slot0.chat = slot0._tf:Find(&quot;Box/Bubble&quot;)
	slot0.chatAnimator = GetComponent(slot0.chat, typeof(Animator))
	slot0.chatAnimEvent = GetComponent(slot0.chat, typeof(DftAniEvent))
	slot0.chatText = slot0.chat:Find(&quot;BubbleText&quot;)
	slot0.chatClick = slot0.chat:Find(&quot;BubbleClick&quot;)

	setActive(slot0.chat, false)
	setLocalScale(slot0.chat, {
		x = 0,
		y = 0
	})
	setActive(slot0.chat, true)

	slot0.msgbox = slot0._tf:Find(&quot;Msgbox&quot;)

	setActive(slot0.msgbox, false)

	slot0.contentText = slot0.msgbox:Find(&quot;window/msg_panel/content&quot;):GetComponent(&quot;RichText&quot;)
end

slot0.SetShop = function(slot0, slot1)
	slot0.shop = slot1
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0._tf:Find(&quot;Top/Back&quot;), function ()
		uv0:closeView()
	end, SOUND_BACK)
	onButton(slot0, slot0._tf:Find(&quot;Top/Help&quot;), function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.hotspring_shop_help.tip
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.msgbox:Find(&quot;BG&quot;), function ()
		setActive(uv0.msgbox, false)
	end)
	onButton(slot0, slot0.msgbox:Find(&quot;window/button_container/Button1&quot;), function ()
		setActive(uv0.msgbox, false)
	end, SFX_CANCEL)
	onButton(slot0, slot0.chatClick, function ()
		uv0:HideChat()
	end)
	onButton(slot0, slot0._tf:Find(&quot;Box/Spine&quot;), function ()
		uv0:DisplayChat({
			&quot;hotspring_shop_touch1&quot;,
			&quot;hotspring_shop_touch2&quot;,
			&quot;hotspring_shop_touch3&quot;
		})
		uv0.role:SetActionOnce(&quot;touch&quot;)
	end)
	slot0:ShowEnterMsg()

	slot0.role = SpineRole.New()

	slot0.role:SetData(&quot;mingshi_2&quot;)
	slot0:LoadingOn()
	slot0.role:Load(function ()
		uv0.role:SetParent(uv0._tf:Find(&quot;Box/Spine&quot;))
		uv0.role:SetAction(&quot;stand&quot;)
		uv0.role:SetActionCallBack(function (slot0)
			if slot0 == &quot;finish&quot; then
				uv0.role:SetAction(&quot;stand&quot;)
			end
		end)
		uv0:LoadingOff()
	end, true)
	slot0:UpdateView()
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
end

slot0.ShowEnterMsg = function(slot0)
	if not getProxy(ActivityProxy):getActivityByType(ActivityConst.ACTIVITY_TYPE_HOTSPRING) or slot1:isEnd() then
		slot0:DisplayChat({
			&quot;hotspring_shop_end&quot;
		})

		return
	end

	if _.all(_.values(slot0.shop.goods), function (slot0)
		return not slot0:canPurchase()
	end) then
		slot0:DisplayChat({
			&quot;hotspring_shop_finish&quot;
		})

		return
	end

	slot0:DisplayChat({
		&quot;hotspring_shop_enter1&quot;,
		&quot;hotspring_shop_enter2&quot;
	})
end

slot0.UpdateView = function(slot0)
	setText(slot0._tf:Find(&quot;Top/Ticket/TicketText&quot;), getProxy(PlayerProxy):getRawData()[id2res(slot0.shop:getResId())] or 0)
	slot0:UpdateGoods()
end

slot0.UpdateGoods = function(slot0)
	slot1 = _.values(slot0.shop.goods)

	table.sort(slot1, function (slot0, slot1)
		return slot0.id &lt; slot1.id
	end)

	slot4 = slot0.goodsContainer

	UIItemList.StaticAlign(slot0.goodsContainer, slot4:GetChild(0), #slot1, function (slot0, slot1, slot2)
		if slot0 ~= UIItemList.EventUpdate then
			return
		end

		slot3 = uv0[slot1 + 1]

		setActive(slot2:Find(&quot;mask&quot;), not slot3:canPurchase())
		updateDrop(slot2:Find(&quot;Icon&quot;), {
			type = slot3:getConfig(&quot;commodity_type&quot;),
			id = slot3:getConfig(&quot;commodity_id&quot;),
			count = slot3:getConfig(&quot;num&quot;)
		})
		onButton(uv1, slot2, function ()
			slot0 = uv0

			slot0:OnClickCommodity(uv1, function (slot0, slot1)
				uv0:OnPurchase(uv1, slot1)
			end)
		end, SFX_PANEL)
	end)
end

slot0.CheckRes = function(slot0, slot1, slot2)
	if not slot1:canPurchase() then
		slot0:DisplayChat({
			&quot;hotspring_shop_exchanged&quot;
		})

		return false
	end

	if Drop.New({
		type = slot1:getConfig(&quot;resource_category&quot;),
		id = slot1:getConfig(&quot;resource_type&quot;)
	}):getOwnedCount() &lt; slot1:getConfig(&quot;resource_num&quot;) * slot2 then
		slot0:DisplayChat({
			&quot;hotspring_shop_insufficient&quot;
		})

		return false
	end

	return true
end

slot0.Purchase = function(slot0, slot1, slot2, slot3, slot4)
	slot0:ShowMsgbox({
		content = i18n(&quot;hotspring_shop_exchange&quot;, slot1:getConfig(&quot;resource_num&quot;) * slot2, slot1:getConfig(&quot;num&quot;) * slot2, slot3),
		onYes = function ()
			if uv0:CheckRes(uv1, uv2) then
				uv3(uv1, uv2)
			end
		end
	})
end

slot0.OnClickCommodity = function(slot0, slot1, slot2)
	if not slot0:CheckRes(slot1, 1) then
		return
	end

	slot0:Purchase(slot1, 1, Drop.New({
		id = slot1:getConfig(&quot;commodity_id&quot;),
		type = slot1:getConfig(&quot;commodity_type&quot;)
	}):getConfig(&quot;name&quot;), slot2)
end

slot0.OnPurchase = function(slot0, slot1, slot2)
	slot0:emit(NewYearHotSpringShopMediator.ON_ACT_SHOPPING, slot0.shop.activityId, 1, slot1.id, slot2)
end

slot0.OnShoppingDone = function(slot0)
	slot0:DisplayChat({
		&quot;hotspring_shop_success1&quot;,
		&quot;hotspring_shop_success2&quot;
	})
end

slot0.ShowMsgbox = function(slot0, slot1)
	setActive(slot0.msgbox, true)

	slot0.contentText.text = slot1.content
	slot2 = slot0.msgbox

	onButton(slot0, slot2:Find(&quot;window/button_container/Button2&quot;), function ()
		setActive(uv0.msgbox, false)
		existCall(uv1.onYes)
	end, SFX_CONFIRM)
end

slot0.DisplayChat = function(slot0, slot1)
	slot0:HideChat()
	onNextTick(function ()
		uv0.chatTween = LeanTween.delayedCall(go(uv0.chat), 10, System.Action(function ()
			uv0:HideChat()
		end)).uniqueId
		slot2 = i18n(uv1[math.random(#uv1)])
		slot3 = uv0.chatAnimator

		slot3:ResetTrigger(&quot;Shrink&quot;)

		slot3 = uv0.chatAnimator

		slot3:SetTrigger(&quot;Pop&quot;)

		slot3 = uv0.chatAnimEvent

		slot3:SetTriggerEvent(function ()
			setText(uv0.chatText, uv1)
		end)
	end)
end

slot0.HideChat = function(slot0)
	if slot0.chatTween then
		slot0.chatAnimator:ResetTrigger(&quot;Pop&quot;)
		slot0.chatAnimator:SetTrigger(&quot;Shrink&quot;)
		slot0.chatAnimEvent:SetTriggerEvent(nil)
		LeanTween.cancel(slot0.chatTween)

		slot0.chatTween = nil
	end
end

slot0.LoadingOn = function(slot0)
	if slot0.animating then
		return
	end

	slot0.animating = true

	pg.UIMgr.GetInstance():LoadingOn(false)
end

slot0.LoadingOff = function(slot0)
	if not slot0.animating then
		return
	end

	pg.UIMgr.GetInstance():LoadingOff()

	slot0.animating = false
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf)
	slot0:HideChat()
	slot0.role:Dispose()
	slot0:LoadingOff()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>