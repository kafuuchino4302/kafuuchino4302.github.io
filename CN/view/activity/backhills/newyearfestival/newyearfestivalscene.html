<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>newyearfestivalscene.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>newyearfestivalscene.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;NewyearFestivalScene&quot;, import(&quot;..TemplateMV.BackHillTemplate&quot;))

slot0.getUIName = function(slot0)
	return &quot;NewyearFestivalUI&quot;
end

slot0.HUB_ID = 4

slot0.init = function(slot0)
	slot0.top = slot0:findTF(&quot;top&quot;)
	slot0._closeBtn = slot0:findTF(&quot;top/back&quot;)
	slot0._homeBtn = slot0:findTF(&quot;top/home&quot;)
	slot0._helpBtn = slot0:findTF(&quot;top/help&quot;)
	slot0.ticketTimes = slot0.top:Find(&quot;ticket/text&quot;)
	slot0.yinhuace = slot0.top:Find(&quot;sign&quot;)
	slot0.yinhuaceTimes = slot0.yinhuace:Find(&quot;get&quot;)
	slot0.yinhuaceTips = slot0.yinhuace:Find(&quot;tip&quot;)
	slot0.shouce = slot0.top:Find(&quot;yinhuashouceye&quot;)
	slot0.shouce_bg = slot0.shouce:Find(&quot;bg&quot;)
	slot0.layout_shouce = slot0.shouce:Find(&quot;yinhuace/layout&quot;)
	slot0.group_get = CustomIndexLayer.Clone2Full(slot0.layout_shouce, 7)
	slot0.btn_receive = slot0.shouce:Find(&quot;yinhuace/receive&quot;)
	slot0.btn_shouce_help = slot0.shouce:Find(&quot;yinhuace/help&quot;)
	slot0.img_get = slot0.shouce:Find(&quot;yinhuace/get&quot;)

	setActive(slot0.shouce, false)

	slot0._map = slot0:findTF(&quot;map&quot;)
	slot0.shrine = slot0._map:Find(&quot;shrine&quot;)
	slot0.snack_street = slot0._map:Find(&quot;snack&quot;)
	slot0.divination = slot0._map:Find(&quot;divination&quot;)
	slot0.shop = slot0._map:Find(&quot;shop&quot;)
	slot0.cube = slot0._map:Find(&quot;magiccube&quot;)
	slot0.bottom2 = slot0._map:Find(&quot;bottom2&quot;)
	slot0.bottom = slot0._map:Find(&quot;bottom&quot;)
	slot0.middle = slot0._map:Find(&quot;middle&quot;)
	slot1 = slot0._map
	slot0.front = slot1:Find(&quot;top&quot;)
	slot0.containers = {
		slot0.front,
		slot0.middle,
		slot0.bottom,
		slot0.bottom2
	}
	slot0._shipTpl = slot0._map:Find(&quot;ship&quot;)
	slot0.graphPath = GraphPath.New(import(&quot;GameCfg.BackHillGraphs.NewyearFestivalGraph&quot;))
	slot0.effectReq = LoadPrefabRequestPackage.New(&quot;ui/xuedichangjing&quot;, &quot;xuedichangjing&quot;, function (slot0)
		setParent(slot0, uv0._map, false)

		slot2 = GameObject.Find(&quot;UICamera/Canvas&quot;):GetComponent(typeof(Canvas)).sortingOrder

		for slot7, slot8 in ipairs(slot0:GetComponentsInChildren(typeof(Renderer)):ToTable()) do
			slot8.sortingOrder = slot2 + 1
		end
	end):Start()
end

slot0.didEnter = function(slot0)
	slot1 = getProxy(MiniGameProxy)

	onButton(slot0, slot0._closeBtn, function ()
		uv0:emit(uv1.ON_BACK)
	end)
	onButton(slot0, slot0._homeBtn, function ()
		uv0:emit(uv1.ON_HOME)
	end)
	onButton(slot0, slot0._helpBtn, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.help_newyear_feast.tip
		})
	end)
	onButton(slot0, slot0.yinhuace, function ()
		setActive(uv0.shouce, true)
	end)
	onButton(slot0, slot0.shouce_bg, function ()
		setActive(uv0.shouce, false)
	end)
	onButton(slot0, slot0.btn_shouce_help, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.help_newyear_stamp.tip
		})
	end)
	onButton(slot0, slot0.btn_receive, function ()
		if uv0:GetHubByHubId(uv1.HUB_ID).ultimate ~= 0 or slot0.usedtime &lt; slot0:getConfig(&quot;reward_need&quot;) then
			return
		end

		uv1:emit(NewYearFestivalMediator.MINI_GAME_OPERATOR, {
			hubid = slot0.id,
			cmd = MiniGameOPCommand.CMD_ULTIMATE,
			args1 = {}
		})
	end)
	slot0:InitFacility(slot0.shrine, function ()
		pg.m02:sendNotification(GAME.GO_MINI_GAME, 3)
	end)
	slot0:InitFacility(slot0.snack_street, function ()
		pg.m02:sendNotification(GAME.GO_MINI_GAME, 8)
	end)
	slot0:InitFacility(slot0.divination, function ()
		uv0:emit(NewYearFestivalMediator.GO_SCENE, SCENE.ACTIVITY, {
			id = ActivityConst.CYGNET_BATHROBE_PAGE_ID
		})
	end)
	slot0:InitFacility(slot0.shop, function ()
		uv0:emit(NewYearFestivalMediator.GO_SCENE, SCENE.SKINSHOP)
	end)
	slot0:InitFacility(slot0.cube, function ()
		uv0:emit(NewYearFestivalMediator.GO_SCENE, SCENE.GETBOAT, {
			projectName = &quot;new&quot;,
			page = 1
		})
	end)
	pg.UIMgr.GetInstance():OverlayPanel(slot0.top)

	slot0.academyStudents = {}

	slot0:InitStudents(ActivityConst.NEWYEAR_ACTIVITY, 3, 5)
	slot0:UpdateView()

	if slot0.contextData.isOpenShrine then
		slot0.contextData.isOpenShrine = nil

		pg.m02:sendNotification(GAME.GO_MINI_GAME, 3)
	end

	if slot1:GetMiniGameData(3) and not slot2:GetRuntimeData(&quot;isInited&quot;) then
		slot0:emit(NewYearFestivalMediator.MINIGAME_OPERATION, slot0.HUB_ID, MiniGameOPCommand.CMD_SPECIAL_GAME, {
			3,
			1
		})
	end
end

slot0.UpdateView = function(slot0)
	slot2 = getProxy(MiniGameProxy):GetHubByHubId(slot0.HUB_ID)

	setText(slot0.ticketTimes, &quot;X &quot; .. slot2.count)

	slot7 = &quot;%02d&quot;
	slot8 = slot2.usedtime

	setText(slot0.yinhuaceTimes, string.format(slot7, slot8))

	for slot7, slot8 in ipairs(slot0.group_get) do
		setActive(slot8, slot7 &lt;= slot3)
	end

	slot4 = slot3 &gt;= #slot0.group_get and slot2.ultimate == 0

	setActive(slot0.btn_receive, slot4)
	setActive(slot0.yinhuaceTips, slot4)
	setActive(slot0.img_get, slot2.ultimate ~= 0)

	if slot2.ultimate == 1 then
		slot0:TryPlayStory()
	end

	setActive(slot0.snack_street:Find(&quot;tip&quot;), slot2.count &gt; 0)

	slot6 = slot0.shrine:Find(&quot;tip&quot;)
	slot8 = false

	if slot1:GetMiniGameData(3) then
		slot8 = (slot7:GetRuntimeData(&quot;count&quot;) or 0) &gt; 0 and NewYearShrinePage.IsTip()
	end

	setActive(slot6, slot8)
	setActive(slot0.divination:Find(&quot;tip&quot;), CygnetBathrobePage.IsTip())
end

slot0.edge2area = {
	[&quot;3_8&quot;] = &quot;bottom&quot;,
	[&quot;7_8&quot;] = &quot;bottom2&quot;,
	[&quot;5_6&quot;] = &quot;front&quot;
}

slot0.TryPlayStory = function(slot0)
end

slot0.willExit = function(slot0)
	slot0.effectReq:Stop()
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0.top, slot0._tf)
	slot0:clearStudents()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>