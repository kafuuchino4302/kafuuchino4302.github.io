<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>terminaladventurepage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>terminaladventurepage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;TerminalAdventurePage&quot;, import(&quot;view.base.BaseSubView&quot;))
slot0.BIND_PT_ACT_ID = ActivityConst.OTHER_WORLD_TERMINAL_PT_ID
slot0.BIND_TASK_ACT_ID = ActivityConst.OTHER_WORLD_TERMINAL_TASK_ID

slot0.getUIName = function(slot0)
	return &quot;TerminalAdventurePage&quot;
end

slot0.OnLoaded = function(slot0)
	slot0._tf.name = tostring(OtherworldTerminalLayer.PAGE_ADVENTURE)
	slot0.levelTF = slot0:findTF(&quot;frame/level&quot;)

	setText(slot0:findTF(&quot;title/content/Text&quot;, slot0.levelTF), i18n(&quot;adventure_award_title&quot;))
	setText(slot0:findTF(&quot;progress/title&quot;, slot0.levelTF), i18n(&quot;adventure_progress_title&quot;))
	setText(slot0:findTF(&quot;lv&quot;, slot0.levelTF), i18n(&quot;adventure_lv_title&quot;))

	slot0.ptIconTF = slot0:findTF(&quot;progress/Image&quot;, slot0.levelTF)
	slot0.ptValueTF = slot0:findTF(&quot;progress/value&quot;, slot0.levelTF)
	slot0.ptLvTF = slot0:findTF(&quot;lv/Text&quot;, slot0.levelTF)
	slot0.awardView = slot0:findTF(&quot;awards/view&quot;, slot0.levelTF)
	slot0.awardUIList = UIItemList.New(slot0:findTF(&quot;content&quot;, slot0.awardView), slot0:findTF(&quot;content/tpl&quot;, slot0.awardView))
	slot0.recordTF = slot0:findTF(&quot;frame/record&quot;)

	setText(slot0:findTF(&quot;title/content/Text&quot;, slot0.recordTF), i18n(&quot;adventure_record_title&quot;))
	setText(slot0:findTF(&quot;grade&quot;, slot0.recordTF), i18n(&quot;adventure_record_grade_title&quot;))

	slot0.recordGradeTF = slot0:findTF(&quot;grade/Text&quot;, slot0.recordTF)
	slot0.taskUIList = UIItemList.New(slot0:findTF(&quot;form&quot;, slot0.recordTF), slot0:findTF(&quot;form/tpl&quot;, slot0.recordTF))

	setText(slot0:findTF(&quot;frame/tip&quot;), i18n(&quot;adventure_award_end_tip&quot;))

	slot0.getBtn = slot0:findTF(&quot;frame/get_all_btn&quot;)

	setText(slot0:findTF(&quot;Text&quot;, slot0.getBtn), i18n(&quot;adventure_get_all&quot;))

	slot0.getGreyBtn = slot0:findTF(&quot;frame/get_all_btn_grey&quot;)

	setText(slot0:findTF(&quot;Text&quot;, slot0.getGreyBtn), i18n(&quot;adventure_get_all&quot;))
end

slot0.OnInit = function(slot0)
	slot1 = getProxy(ActivityProxy):getActivityById(uv0.BIND_PT_ACT_ID)

	assert(slot1, &quot;not exist bind pt act, id&quot; .. uv0.BIND_PT_ACT_ID)

	slot0.ptData = ActivityPtData.New(slot1)
	slot0.taskActivity = getProxy(ActivityProxy):getActivityById(uv0.BIND_TASK_ACT_ID)

	assert(slot0.taskActivity, &quot;not exist bind task act, id&quot; .. uv0.BIND_TASK_ACT_ID)
	onButton(slot0, slot0.getBtn, function ()
		uv0:emit(OtherworldTerminalMediator.ON_GET_PT_ALL_AWARD, {
			actId = uv1.BIND_PT_ACT_ID,
			arg1 = uv0.ptData:GetCurrTarget()
		})
	end, SFX_PANEL)
	slot0:InitPtUI()
	slot0:UpdatePtView()
	slot0:InitTaskUI()
	slot0:UpdateTaskView()
end

slot0.InitPtUI = function(slot0)
	slot3 = slot0.ptData
	slot2 = Drop.New(slot3:GetRes())

	LoadImageSpriteAsync(slot2:getIcon(), slot0.ptIconTF, false)

	slot1 = slot0.awardUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = slot1 + 1
			slot4 = uv0.ptData.dropList[slot3]
			slot5 = uv0.ptData.targets[slot3]

			updateDrop(slot2:Find(&quot;IconTpl&quot;), Drop.New({
				type = slot4[1],
				id = slot4[2],
				count = slot4[3]
			}), {
				hideName = true
			})
			onButton(uv0.binder, slot2:Find(&quot;IconTpl&quot;), function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)
			setActive(slot2:Find(&quot;IconTpl/got&quot;), slot3 &lt;= uv0.ptData:GetLevel())
			setText(slot2:Find(&quot;lv&quot;), &quot;Lv:&quot; .. slot3)
			setActive(slot2:Find(&quot;lv0&quot;), slot3 == 1)
			setActive(slot2:Find(&quot;progress&quot;):Find(&quot;left&quot;), slot3 ~= 1)
			setActive(slot8:Find(&quot;right&quot;), slot3 == #uv0.ptData.targets)

			if slot3 &lt;= slot7 then
				setSlider(slot8, 0, 1, 1)
			else
				slot10 = slot3 == 1 and 0 or uv0.ptData.targets[slot3 - 1]

				setSlider(slot8, 0, 1, (uv0.ptData.count - slot10) / (uv0.ptData.targets[slot3] - slot10))
			end
		end
	end)
end

slot0.UpdatePt = function(slot0, slot1)
	slot0.ptData = ActivityPtData.New(slot1)

	slot0:UpdatePtView()
end

slot0.UpdatePtView = function(slot0)
	slot1 = slot0.ptData:CanGetAward()

	setActive(slot0.getBtn, slot1)
	setActive(slot0.getGreyBtn, not slot1)

	slot2 = slot0.ptData:GetLevel()
	slot3, slot4 = slot0.ptData:GetResProgress()

	setText(slot0.ptValueTF, math.max(slot4 - slot3, 0))
	setText(slot0.ptLvTF, slot2)
	slot0.awardUIList:align(#slot0.ptData.targets)
	scrollTo(slot0.awardView, slot2 / #slot0.ptData.targets, 0)
end

slot0.InitTaskUI = function(slot0)
	slot1 = slot0.taskActivity
	slot0.taskIds = slot1:getConfig(&quot;config_data&quot;)
	slot1 = slot0.taskUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot4 = getProxy(TaskProxy):getTaskById(uv0.taskIds[slot1 + 1])

			setText(uv0:findTF(&quot;name&quot;, slot2), slot4:getConfig(&quot;desc&quot;))
			setText(uv0:findTF(&quot;value&quot;, slot2), slot4:getProgress())
		end
	end)
end

slot0.UpdateTask = function(slot0, slot1)
	slot0.taskActivity = slot1

	slot0:UpdateTaskView()
end

slot0.UpdateTaskView = function(slot0)
	slot0.taskUIList:align(#slot0.taskIds)
	setText(slot0.recordGradeTF, slot0:GetAdventureGrade())
end

slot0.GetAdventureGrade = function(slot0)
	for slot5, slot6 in ipairs(slot0.taskActivity:getConfig(&quot;config_client&quot;)) do
		if #slot6[2] &gt; 0 then
			for slot10, slot11 in ipairs(slot6[2]) do
				slot13 = slot11[2]

				if getProxy(TaskProxy):getTaskById(slot11[1]) and slot13 &lt;= slot14:getProgress() then
					return slot6[1]
				end
			end
		else
			return slot6[1]
		end
	end

	return &quot;&quot;
end

slot0.OnDestroy = function(slot0)
end

slot0.IsTip = function()
	if not getProxy(ActivityProxy):getActivityById(uv0.BIND_PT_ACT_ID) or slot0:isEnd() then
		return false
	end

	return ActivityPtData.New(slot0):CanGetAward()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>