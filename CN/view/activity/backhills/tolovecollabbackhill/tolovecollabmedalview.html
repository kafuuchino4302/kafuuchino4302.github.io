<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tolovecollabmedalview.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>tolovecollabmedalview.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ToLoveCollabMedalView&quot;, import(&quot;..TemplateMV.MedalCollectionTemplateView&quot;))

slot0.getUIName = function(slot0)
	return &quot;ToLoveCollabMedalPage&quot;
end

slot0.init = function(slot0)
	slot0:FindUI()

	slot0.loader = AutoLoader.New()
end

slot0.FindUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;mask&quot;)
	slot5 = slot0:findTF(&quot;Top&quot;)
	slot0.backBtn = slot0:findTF(&quot;BackBtn&quot;, slot5)
	slot0.slots = {}

	for slot5 = 1, 6 do
		slot0.slots[slot5] = {
			char = slot0._tf:Find(&quot;Desk/Slot&quot; .. slot5 .. &quot;/Char&quot;),
			selected = slot0._tf:Find(&quot;Desk/Slot&quot; .. slot5 .. &quot;/Selected&quot;),
			tips = slot0._tf:Find(&quot;Desk/Slot&quot; .. slot5 .. &quot;/reddot&quot;)
		}
	end

	slot0.medalTF = slot0._tf:Find(&quot;Desk/trophy&quot;)
	slot0.syncBtn = slot0._tf:Find(&quot;Desk/syncBtn&quot;)
	slot0.task = slot0._tf:Find(&quot;Desk/task&quot;)
	slot0.taskBGGo = slot0.task:Find(&quot;bg_go&quot;)
	slot0.taskBGGot = slot0.task:Find(&quot;bg_got&quot;)
	slot0.taskBtnGo = slot0.task:Find(&quot;go_btn&quot;)
	slot0.taskBtnGot = slot0.task:Find(&quot;got_btn&quot;)
	slot0.taskBtnGet = slot0.task:Find(&quot;get_btn&quot;)
	slot0.taskDesc = slot0.task:Find(&quot;desc&quot;)
	slot0.taskReward = slot0.task:Find(&quot;award/mask&quot;)
	slot0.taskRewardName = slot0.task:Find(&quot;name&quot;)
end

slot0.didEnter = function(slot0)
	slot0.dropInfoList = {}
	slot0.taskList = {}
	slot1 = slot0.activityData:getConfig(&quot;config_client&quot;).item_task

	for slot5 = 1, 6 do
		slot0.taskList[slot5] = Task.New({
			id = slot1[slot5][2]
		})
		slot0.dropInfoList[slot5] = {
			type = DROP_TYPE_VITEM,
			id = slot1[slot5][1]
		}
	end

	slot0:AddListener()

	slot0.contextData.ChipIndex = slot0.contextData.ChipIndex or 1

	slot0:UpdateView()
	pg.UIMgr.GetInstance():OverlayPanel(slot0._tf, {
		weight = LayerWeightConst.SECOND_LAYER
	})
end

slot0.AddListener = function(slot0)
	onButton(slot0, slot0.backBtn, function ()
		uv0:closeView()
	end, SFX_CANCEL)
	onButton(slot0, slot0.taskBtnGet, function ()
		if not table.contains(uv0.activeIDList, uv0.allIDList[uv0.contextData.ChipIndex]) and table.contains(uv0.activatableIDList, slot0) then
			uv0:emit(MedalCollectionTemplateMediator.MEMORYBOOK_UNLOCK, {
				id = slot0,
				actId = uv0.activityData.id
			})
		end
	end, SFX_PANEL)

	slot4 = function()
		if getProxy(ActivityProxy):getActivityById(ActivityConst.TOLOVE_TASK_ID) and not slot0:isEnd() then
			uv0:emit(MedalCollectionTemplateMediator.MEMORYBOOK_GO, uv0.taskList[uv0.contextData.ChipIndex])
		else
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_activity_end&quot;))
		end
	end

	onButton(slot0, slot0.taskBtnGo, slot4, SFX_PANEL)

	for slot4 = 1, 6 do
		slot7 = slot0._tf

		onButton(slot0, slot7:Find(&quot;Desk/Slot&quot; .. slot4 .. &quot;/Click&quot;), function ()
			uv0.contextData.ChipIndex = uv1

			uv0:UpdateView()
		end, SFX_PANEL)
	end

	onButton(slot0, slot0.syncBtn, function ()
		uv0:CheckAward()
	end, SFX_PANEL)
	onButton(slot0, slot0.bg, function ()
		uv0:closeView()
	end, SFX_PANEL)
end

slot0.UpdateAfterSubmit = function(slot0, slot1)
	slot0:UpdateView()
end

slot0.UpdateAfterFinalMedal = function(slot0)
	uv0.super.UpdateAfterFinalMedal(slot0)
	slot0:UpdateView()
end

slot0.UpdateView = function(slot0)
	for slot4 = 1, 6 do
		slot5 = 0
		slot6 = false

		for slot10 = 1, #slot0.slots do
			setActive(slot0.slots[slot10].char, table.contains(slot0.activeIDList, slot0.allIDList[slot10]))
			setActive(slot0.slots[slot10].tips, table.contains(slot0.activatableIDList, slot0.allIDList[slot10]) and not slot11)
		end

		setActive(slot0.slots[slot4].selected, slot4 == slot0.contextData.ChipIndex)
	end

	slot1 = #slot0.activeIDList == #slot0.allIDList
	slot2 = slot1 and slot0.activityData.data1 == 1

	setActive(slot0.medalTF:Find(&quot;Lock&quot;), not slot2)
	setActive(slot0.medalTF:Find(&quot;Unlock&quot;), slot2)
	setActive(slot0.syncBtn:Find(&quot;notSync&quot;), not slot1)
	setActive(slot0.syncBtn:Find(&quot;synced&quot;), slot2)

	slot0.syncBtn:GetComponent(typeof(Image)).enabled = slot1 and not slot2

	setActive(slot0.syncBtn:Find(&quot;reddot&quot;), slot1 and not slot2)
	slot0:UpdateInfo()
end

slot0.UpdateInfo = function(slot0)
	slot3 = not table.contains(slot0.activeIDList, slot0.allIDList[slot0.contextData.ChipIndex]) and table.contains(slot0.activatableIDList, slot1)

	setActive(slot0.taskBGGo, not slot2)
	setActive(slot0.taskBGGot, slot2)
	setActive(slot0.taskBtnGot, slot2)
	setActive(slot0.taskBtnGet, slot3)
	setActive(slot0.taskBtnGo, not slot3)
	setText(slot0.taskDesc, slot0.taskList[slot0.contextData.ChipIndex]:getConfig(&quot;desc&quot;))
	updateDrop(slot0.taskReward, slot0.dropInfoList[slot0.contextData.ChipIndex])
	setText(slot0.taskRewardName, pg.item_virtual_data_statistics[slot0.dropInfoList[slot0.contextData.ChipIndex].id].name)
end

slot0.willExit = function(slot0)
	slot0.loader:Clear()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>