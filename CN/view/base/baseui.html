<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>baseui.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>baseui.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BaseUI&quot;, import(&quot;view.base.BaseEventLogic&quot;))
slot0.LOADED = &quot;BaseUI:LOADED&quot;
slot0.DID_ENTER = &quot;BaseUI:DID_ENTER&quot;
slot0.AVALIBLE = &quot;BaseUI:AVALIBLE&quot;
slot0.DID_EXIT = &quot;BaseUI:DID_EXIT&quot;
slot0.ON_BACK = &quot;BaseUI:ON_BACK&quot;
slot0.ON_RETURN = &quot;BaseUI:ON_RETURN&quot;
slot0.ON_HOME = &quot;BaseUI:ON_HOME&quot;
slot0.ON_CLOSE = &quot;BaseUI:ON_CLOSE&quot;
slot0.ON_DROP = &quot;BaseUI.ON_DROP&quot;
slot0.ON_DROP_LIST = &quot;BaseUI.ON_DROP_LIST&quot;
slot0.ON_DROP_LIST_OWN = &quot;BaseUI.ON_DROP_LIST_OWN&quot;
slot0.ON_NEW_DROP = &quot;BaseUI.ON_NEW_DROP&quot;
slot0.ON_NEW_STYLE_DROP = &quot;BaseUI.ON_NEW_STYLE_DROP&quot;
slot0.ON_NEW_STYLE_ITEMS = &quot;BaseUI.ON_NEW_STYLE_ITEMS&quot;
slot0.ON_ITEM = &quot;BaseUI:ON_ITEM&quot;
slot0.ON_ITEM_EXTRA = &quot;BaseUI.ON_ITEM_EXTRA&quot;
slot0.ON_SHIP = &quot;BaseUI:ON_SHIP&quot;
slot0.ON_AWARD = &quot;BaseUI:ON_AWARD&quot;
slot0.ON_ACHIEVE = &quot;BaseUI:ON_ACHIEVE&quot;
slot0.ON_ACHIEVE_AUTO = &quot;BaseUI:ON_ACHIEVE_AUTO&quot;
slot0.ON_WORLD_ACHIEVE = &quot;BaseUI:ON_WORLD_ACHIEVE&quot;
slot0.ON_EQUIPMENT = &quot;BaseUI:ON_EQUIPMENT&quot;
slot0.ON_SPWEAPON = &quot;BaseUI:ON_SPWEAPON&quot;
slot0.ON_SHIP_EXP = &quot;BaseUI.ON_SHIP_EXP&quot;
slot0.ON_BACK_PRESSED = &quot;BaseUI:ON_BACK_PRESS&quot;

slot0.Ctor = function(slot0)
	uv0.super.Ctor(slot0)

	slot0._isLoaded = false
	slot0._go = nil
	slot0._tf = nil
	slot0._isCachedView = false
end

slot0.setContextData = function(slot0, slot1)
	slot0.contextData = slot1
end

slot0.getUIName = function(slot0)
	return nil
end

slot0.preloadUIList = function(slot0)
	return {
		slot0:getUIName()
	}
end

slot0.needCache = function(slot0)
	return false
end

slot0.forceGC = function(slot0)
	return false
end

slot0.forceRatio = function(slot0)
	return nil
end

slot0.loadingQueue = function(slot0)
	return false
end

slot0.tempCache = function(slot0)
	return false
end

slot0.getGroupName = function(slot0)
	return nil
end

slot0.getLayerWeight = function(slot0)
	return LayerWeightConst.BASE_LAYER
end

slot0.preload = function(slot0, slot1)
	slot1()
end

slot0.loadUISync = function(slot0, slot1)
	slot2 = LoadAndInstantiateSync(&quot;UI&quot;, slot1, true, false)

	slot2.transform:SetParent(pg.UIMgr.GetInstance().UIMain.transform, false)

	return slot2
end

slot0.load = function(slot0)
	slot1 = nil
	slot2 = Time.realtimeSinceStartup
	slot3 = slot0:getUIName()

	seriesAsync({
		function (slot0)
			if tobool(uv0:loadingQueue()) then
				gcAll(true)
			end

			uv0:preload(slot0)
		end,
		function (slot0)
			slot1 = uv0

			slot1:LoadUIFromPool(uv1, function (slot0)
				print(&quot;Loaded &quot; .. uv0)

				uv1 = slot0

				uv2()
			end)
		end
	}, function ()
		originalPrint(&quot;load &quot; .. uv0.name .. &quot; time cost: &quot; .. Time.realtimeSinceStartup - uv1)
		uv2:SetUIParent(uv0)

		if uv2:tempCache() then
			PoolMgr.GetInstance():AddTempCache(uv3)
		end

		uv2:onUILoaded(uv0)
	end)
end

slot0.SetUIParent = function(slot0, slot1)
	slot1.transform:SetParent(pg.UIMgr.GetInstance().UIMain.transform, false)
end

slot0.LoadUIFromPool = function(slot0, slot1, slot2)
	PoolMgr.GetInstance():GetUI(slot1, true, slot2)
end

slot0.getBGM = function(slot0, slot1)
	return getBgm(slot1 or slot0.__cname)
end

slot0.PlayBGM = function(slot0)
	if slot0:getBGM() then
		pg.BgmMgr.GetInstance():Push(slot0.__cname, slot1)
	end
end

slot0.StopBgm = function(slot0)
	if not slot0.contextData then
		return
	end

	if slot0.contextData.isLayer then
		pg.BgmMgr.GetInstance():Pop(slot0.__cname)
	else
		pg.BgmMgr.GetInstance():Clear()
	end
end

slot0.isLoaded = function(slot0)
	return slot0._isLoaded
end

slot0.getGroupNameFromData = function(slot0)
	slot1 = nil

	return (slot0.contextData == nil or not slot0.contextData.LayerWeightMgr_groupName or slot0.contextData.LayerWeightMgr_groupName) and slot0:getGroupName()
end

slot0.getWeightFromData = function(slot0)
	slot1 = nil

	return (slot0.contextData == nil or not slot0.contextData.LayerWeightMgr_weight or slot0.contextData.LayerWeightMgr_weight) and slot0:getLayerWeight()
end

slot0.isLayer = function(slot0)
	return slot0.contextData ~= nil and slot0.contextData.isLayer
end

slot0.addToLayerMgr = function(slot0)
	pg.LayerWeightMgr.GetInstance():Add2Overlay(LayerWeightConst.UI_TYPE_SYSTEM, slot0._tf, {
		globalBlur = false,
		groupName = slot0:getGroupNameFromData(),
		weight = slot0:getWeightFromData()
	})
end

slot0.optionsPath = {
	&quot;option&quot;,
	&quot;top/option&quot;,
	&quot;top/left_top/option&quot;,
	&quot;blur_container/top/title/option&quot;,
	&quot;blur_container/top/option&quot;,
	&quot;top/top/option&quot;,
	&quot;common/top/option&quot;,
	&quot;blur_panel/top/option&quot;,
	&quot;blurPanel/top/option&quot;,
	&quot;blur_container/top/option&quot;,
	&quot;top/title/option&quot;,
	&quot;blur_panel/adapt/top/option&quot;,
	&quot;mainPanel/top/option&quot;,
	&quot;bg/top/option&quot;,
	&quot;blur_container/adapt/top/title/option&quot;,
	&quot;blur_container/adapt/top/option&quot;,
	&quot;ForNorth/top/option&quot;,
	&quot;top/top_chapter/option&quot;,
	&quot;Main/blur_panel/adapt/top/option&quot;,
	&quot;adapt/blur_panel/adapt/top/option&quot;
}

slot0.onUILoaded = function(slot0, slot1)
	slot0._go = slot1
	slot0._tf = slot1 and slot1.transform

	if slot0:isLayer() then
		slot0:addToLayerMgr()
	end

	pg.SeriesGuideMgr.GetInstance():dispatch({
		view = slot0.__cname
	})

	slot5 = slot0.__cname

	pg.NewStoryMgr.GetInstance():OnSceneEnter({
		view = slot5
	})

	slot0._isLoaded = true

	pg.DelegateInfo.New(slot0)

	slot0.optionBtns = {}

	for slot5, slot6 in ipairs(slot0.optionsPath) do
		table.insert(slot0.optionBtns, slot0:findTF(slot6))
	end

	setActiveViaLayer(slot0._tf, true)
	slot0:init()
	slot0:emit(uv0.LOADED)
end

slot0.ResUISettings = function(slot0)
	return nil
end

slot0.ShowOrHideResUI = function(slot0, slot1)
	if not slot0:ResUISettings() then
		return
	end

	if slot2 == true then
		slot2 = {
			anim = true,
			showType = PlayerResUI.TYPE_ALL
		}
	end

	pg.playerResUI:SetActive(setmetatable({
		active = slot1,
		clear = not slot1 and not slot0:isLayer(),
		weight = slot2.weight or slot0:getWeightFromData(),
		groupName = slot2.groupName or slot0:getGroupNameFromData(),
		canvasOrder = slot2.order or false
	}, {
		__index = slot2
	}))
end

slot0.onUIAnimEnd = function(slot0, slot1)
	slot1()
end

slot0.init = function(slot0)
end

slot0.quickExitFunc = function(slot0)
	slot0:emit(uv0.ON_HOME)
end

slot0.quickExit = function(slot0)
	for slot4, slot5 in ipairs(slot0.optionBtns) do
		onButton(slot0, slot5, function ()
			uv0:quickExitFunc()
		end, SFX_PANEL)
	end
end

slot0.enter = function(slot0)
	slot0:quickExit()
	slot0:PlayBGM()
	slot0:emit(uv0.DID_ENTER)

	if slot0:forceRatio() then
		pg.CameraFixMgr.GetInstance():SetForceRatio(slot0:forceRatio())
	end

	if not slot0._isCachedView then
		slot0:didEnter()
		slot0:ShowOrHideResUI(true)
	end

	if tobool(slot0:loadingQueue()) and slot0.contextData.resumeCallback then
		slot0.contextData.resumeCallback = nil

		slot0.contextData.resumeCallback()
	end

	slot0:emit(uv0.AVALIBLE)
	slot0:onUIAnimEnd(function ()
		pg.SeriesGuideMgr.GetInstance():start({
			view = uv0.__cname,
			code = {
				pg.SeriesGuideMgr.CODES.MAINUI
			}
		})
		pg.NewGuideMgr.GetInstance():OnSceneEnter({
			view = uv0.__cname
		})
	end)
end

slot0.closeView = function(slot0)
	if slot0.contextData.isLayer then
		slot0:emit(uv0.ON_CLOSE)
	else
		slot0:emit(uv0.ON_BACK)
	end
end

slot0.didEnter = function(slot0)
end

slot0.willExit = function(slot0)
end

slot0.exit = function(slot0)
	slot0.exited = true

	slot0:StopBgm()
	pg.DelegateInfo.Dispose(slot0)
	slot0:willExit()
	slot0:ShowOrHideResUI(false)
	slot0:detach()

	if slot0:forceRatio() then
		pg.CameraFixMgr.GetInstance():SetForceRatio(nil)
	end

	pg.NewGuideMgr.GetInstance():OnSceneExit({
		view = slot0.__cname
	})
	pg.NewStoryMgr.GetInstance():OnSceneExit({
		view = slot0.__cname
	})
	slot0:emit(uv0.DID_EXIT)
end

slot0.PlayUIAnimation = function(slot0, slot1, slot2, slot3)
	slot5 = slot1:GetComponent(typeof(UIEventTrigger))

	slot5.didExit:RemoveAllListeners()
	slot5.didExit:AddListener(function ()
		uv0.didExit:RemoveAllListeners()
		uv1()
	end)
	slot1:GetComponent(typeof(Animation)):Play(slot2)
end

slot0.attach = function(slot0, slot1)
end

slot0.ClearTweens = function(slot0, slot1)
	slot0:cleanManagedTween(slot1)
end

slot0.RemoveTempCache = function(slot0)
	PoolMgr.GetInstance():DelTempCache(slot0:getUIName())
end

slot0.detach = function(slot0, slot1)
	slot0._isLoaded = false

	pg.LayerWeightMgr.GetInstance():DelFromOverlay(slot0._tf)
	pg.DynamicBgMgr.GetInstance():ClearBg(slot0:getUIName())
	slot0:disposeEvent()
	slot0:ClearTweens(false)

	slot0._tf = nil
	slot2 = PoolMgr.GetInstance()
	slot3 = slot0:getUIName()

	if slot0._go ~= nil and slot3 then
		slot2:ReturnUI(slot3, slot0._go)

		slot0._go = nil
	end
end

slot0.findGO = function(slot0, slot1, slot2)
	assert(slot0._go, &quot;game object should exist&quot;)

	return findGO(slot2 or slot0._go, slot1)
end

slot0.findTF = function(slot0, slot1, slot2)
	assert(slot0._tf, &quot;transform should exist&quot;)

	return findTF(slot2 or slot0._tf, slot1)
end

slot0.getTpl = function(slot0, slot1, slot2)
	slot3 = slot0:findTF(slot1, slot2)

	slot3:SetParent(slot0._tf, false)
	SetActive(slot3, false)

	return slot3
end

slot0.setSpriteTo = function(slot0, slot1, slot2, slot3)
	slot2:GetComponent(typeof(Image)).sprite = slot0:findTF(slot1):GetComponent(typeof(Image)).sprite

	if slot3 then
		slot4:SetNativeSize()
	end
end

slot0.setImageAmount = function(slot0, slot1, slot2)
	slot1:GetComponent(typeof(Image)).fillAmount = slot2
end

slot0.setVisible = function(slot0, slot1)
	slot0:ShowOrHideResUI(slot1)

	if slot1 then
		slot0:OnVisible()
	else
		slot0:OnDisVisible()
	end

	setActiveViaLayer(slot0._tf, slot1)
end

slot0.OnVisible = function(slot0)
end

slot0.OnDisVisible = function(slot0)
end

slot0.onBackPressed = function(slot0)
	slot0:emit(uv0.ON_BACK_PRESSED)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>