<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educateawardinfolayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educateawardinfolayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateAwardInfoLayer&quot;, import(&quot;..base.EducateBaseUI&quot;))
slot1 = {
	Vector2(0, 115),
	Vector2(0, 162)
}
slot2 = {
	Vector2(0, -280),
	Vector2(0, -315)
}
slot3 = 0.4

slot0.getUIName = function(slot0)
	return &quot;EducateAwardInfoUI&quot;
end

slot0.init = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, false, {
		weight = LayerWeightConst.THIRD_LAYER
	})

	slot0.drops = slot0.contextData.items or {}
	slot0.awardWindow = slot0:findTF(&quot;award_window&quot;)
	slot0.anim = slot0.awardWindow:GetComponent(typeof(Animation))
	slot0.animEvent = slot0.awardWindow:GetComponent(typeof(DftAniEvent))

	slot0.animEvent:SetEndEvent(function ()
		if #uv0.showPolaroidDrops &gt; 0 then
			setActive(uv0.awardWindow, false)
			setActive(uv0.polaroidWindow, true)

			uv0.polaroidIndex = 1

			uv0:showPolaroidAnim()
		else
			uv0:emit(uv1.ON_CLOSE)
		end
	end)

	slot0.tipTF = slot0:findTF(&quot;tip&quot;, slot0.awardWindow)

	setText(slot0.tipTF, i18n(&quot;child_close_tip&quot;))

	slot0.itemContent = slot0:findTF(&quot;content/items&quot;, slot0.awardWindow)
	slot0.itemContainer = slot0:findTF(&quot;items_scroll/content&quot;, slot0.itemContent)
	slot0.itemTpl = slot0:findTF(&quot;item_tpl&quot;, slot0.awardWindow)

	setActive(slot0.itemTpl, false)

	slot0.attrContent = slot0:findTF(&quot;content/attrs&quot;, slot0.awardWindow)
	slot0.attrContainer = slot0:findTF(&quot;attrs_scroll/content&quot;, slot0.attrContent)
	slot0.attrTpl = slot0:findTF(&quot;attr_tpl&quot;, slot0.awardWindow)

	setActive(slot0.attrTpl, false)

	slot0.polaroidWindow = slot0:findTF(&quot;polaroid_window&quot;)
	slot0.polaroidIconTF = slot0:findTF(&quot;content/mask/icon&quot;, slot0.polaroidWindow)
	slot0.polaroidDescTF = slot0:findTF(&quot;content/desc&quot;, slot0.polaroidWindow)

	setActive(slot0.awardWindow, false)
	setActive(slot0.polaroidWindow, false)
	slot0._tf:SetAsLastSibling()
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0:findTF(&quot;close&quot;, slot0.awardWindow), function ()
		uv0:_close()
	end, SFX_CANCEL)
	onButton(slot0, slot0.polaroidWindow, function ()
		if uv0.playing then
			return
		end

		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;child_polaroid_get_tip&quot;))

		if uv0.polaroidIndex &lt;= #uv0.showPolaroidDrops then
			uv0:showPolaroidAnim()
		else
			uv0:emit(uv1.ON_CLOSE)
		end
	end, SFX_CANCEL)

	slot0.showAwardDrops = slot0:getAwardDrops()
	slot0.showAttrDrops = slot0:getAttrDrops()
	slot0.showPolaroidDrops = slot0:getPolaroidDrops()

	setActive(slot0.attrContent, #slot0.showAttrDrops &gt; 0)
	slot0:showWindow()
end

slot0.showWindow = function(slot0)
	if #slot0.showAwardDrops &gt; 0 then
		slot0.inAnimPlaying = true

		setActive(slot0.awardWindow, true)
		slot0.anim:Play(#slot0.showAttrDrops &gt; 0 and &quot;anim_educate_awardinfo_awardattr_in&quot; or &quot;anim_educate_awardinfo_award_in&quot;)
		table.insert({}, function (slot0)
			uv0:managedTween(LeanTween.delayedCall, function ()
				uv0()
			end, 0.33, nil)
		end)

		for slot7 = 1, math.max(#slot0.showAttrDrops, #slot0.showAwardDrops) do
			table.insert(slot2, function (slot0)
				if uv0.showAwardDrops[uv1] then
					slot2 = cloneTplTo(uv0.itemTpl, uv0.itemContainer)

					EducateHelper.UpdateDropShow(slot2, slot1)
					onButton(uv0, slot2, function ()
						uv0:emit(uv1.EDUCATE_ON_ITEM, {
							drop = uv2
						})
					end)
				end

				if uv0.showAttrDrops[uv1] then
					EducateHelper.UpdateDropShowForAttr(cloneTplTo(uv0.attrTpl, uv0.attrContainer), slot2)
				end

				slot3 = uv0

				slot3:managedTween(LeanTween.delayedCall, function ()
					uv0()
				end, 0.066, nil)
			end)
		end

		seriesAsync(slot2, function ()
			slot0 = uv0

			slot0:managedTween(LeanTween.delayedCall, function ()
				uv0.inAnimPlaying = false
			end, 0.066, nil)
		end)
	elseif #slot0.showPolaroidDrops &gt; 0 then
		setActive(slot0.polaroidWindow, true)

		slot0.polaroidIndex = 1

		slot0:showPolaroidAnim()
	else
		assert(nil, &quot;不合法掉落, award/polaroid都为空, 请检查对应配置~&quot;)
	end
end

slot0.getAwardDrops = function(slot0)
	return EducateHelper.FilterDropByTypes(slot0.drops, {
		EducateConst.DROP_TYPE_ATTR,
		EducateConst.DROP_TYPE_RES,
		EducateConst.DROP_TYPE_ITEM,
		EducateConst.DROP_TYPE_BUFF
	})
end

slot0.getAttrDrops = function(slot0)
	underscore.each(EducateHelper.FilterDropByTypes(slot0.drops, {
		EducateConst.DROP_TYPE_ITEM
	}), function (slot0)
		uv0 = table.mergeArray(uv0, EducateHelper.GetItemAddDrops(slot0))
	end)

	return {}
end

slot0.getPolaroidDrops = function(slot0)
	return EducateHelper.FilterDropByTypes(slot0.drops, {
		EducateConst.DROP_TYPE_POLAROID
	})
end

slot0.showPolaroidAnim = function(slot0)
	slot0.playing = true

	setActive(slot0.polaroidDescTF, false)

	slot2 = pg.child_polaroid[slot0.showPolaroidDrops[slot0.polaroidIndex].id]

	LoadImageSpriteAsync(&quot;educatepolaroid/&quot; .. slot2.pic, slot0.polaroidIconTF)
	setText(slot0.polaroidDescTF, slot2.title)
	table.insert({}, function (slot0)
		uv0:managedTween(LeanTween.delayedCall, function ()
			setActive(uv0.polaroidDescTF, true)
			uv1()
		end, uv1, nil)
	end)

	if getProxy(EducateProxy):CheckNewSecretaryTip() then
		table.insert(slot3, function (slot0)
			uv0:emit(uv1.EDUCATE_ON_UNLOCK_TIP, {
				type = EducateUnlockTipLayer.UNLOCK_NEW_SECRETARY,
				onExit = slot0
			})
		end)
	end

	seriesAsync(slot3, function ()
		uv0.playing = false
		uv0.polaroidIndex = uv0.polaroidIndex + 1
	end)
end

slot0._close = function(slot0)
	if pg.NewGuideMgr.GetInstance():IsBusy() then
		slot0:emit(uv0.ON_CLOSE)

		return
	end

	if slot0.inAnimPlaying or slot0.isCloseAnim then
		return
	end

	slot0.anim:Play(&quot;anim_educate_awardinfo_award_out&quot;)

	slot0.isCloseAnim = true
end

slot0.onBackPressed = function(slot0)
	slot0:_close()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)

	if slot0.contextData.removeFunc then
		slot0.contextData.removeFunc()

		slot0.contextData.removeFunc = nil
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>