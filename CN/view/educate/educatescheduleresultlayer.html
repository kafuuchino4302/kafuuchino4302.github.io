<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educatescheduleresultlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educatescheduleresultlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateScheduleResultLayer&quot;, import(&quot;.base.EducateBaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;EducateScheduleResultUI&quot;
end

slot0.init = function(slot0)
	slot0.anim = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(Animation))
	slot0.animEvent = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(DftAniEvent))
	slot0.inAnimPlaying = true

	slot0.animEvent:SetEndEvent(function ()
		uv0.inAnimPlaying = false

		uv0.animEvent:SetEndEvent(function ()
			uv0:emit(uv1.ON_CLOSE)
		end)
	end)

	slot0.windowTF = slot0:findTF(&quot;anim_root/window&quot;)
	slot0.personalTF = slot0:findTF(&quot;personal&quot;, slot0.windowTF)
	slot0.majorArrTF = slot0:findTF(&quot;major&quot;, slot0.windowTF)
	slot0.minorArrTF = slot0:findTF(&quot;minor&quot;, slot0.windowTF)
	slot0.resTF = slot0:findTF(&quot;res/content&quot;, slot0.windowTF)

	setText(slot0:findTF(&quot;tip&quot;, slot0.windowTF), i18n(&quot;child_close_tip&quot;))
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf, nil, {
		groupName = slot0:getGroupNameFromData(),
		weight = slot0:getWeightFromData() + 1
	})
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0._tf, function ()
		uv0:_close()
	end, SFX_CANCEL)

	slot1 = slot0.contextData.plan_results or {}
	slot0.result = {}
	slot0.resResult = {}
	slot0.drops = {}

	slot2 = function(slot0)
		for slot4, slot5 in ipairs(slot0) do
			table.insert(uv0.drops, slot5)

			if slot5.type == EducateConst.DROP_TYPE_ATTR then
				if not uv0.result[slot5.id] then
					uv0.result[slot5.id] = 0
				end

				uv0.result[slot5.id] = uv0.result[slot5.id] + slot5.number
			end

			if slot5.type == EducateConst.DROP_TYPE_RES then
				if not uv0.resResult[slot5.id] then
					uv0.resResult[slot5.id] = 0
				end

				uv0.resResult[slot5.id] = uv0.resResult[slot5.id] + slot5.number
			end
		end
	end

	for slot6, slot7 in ipairs(slot1) do
		slot2(slot7.plan_drops)
		slot2(slot7.event_drops)
		slot2(slot7.spec_event_drops)
	end

	slot0.char = getProxy(EducateProxy):GetCharData()
	slot0.natureIds = slot0.char:GetAttrIdsByType(EducateChar.ATTR_TYPE_PERSONALITY)
	slot0.majorIds = slot0.char:GetAttrIdsByType(EducateChar.ATTR_TYPE_MAJOR)
	slot3 = slot0.char
	slot0.minorIds = slot3:GetAttrIdsByType(EducateChar.ATTR_TYPE_MINOR)
	slot0.resIds = {
		EducateChar.RES_MOOD_ID,
		EducateChar.RES_MONEY_ID
	}

	slot0:updatePersonalPanel()
	slot0:updateMajorPanel()
	slot0:updateMinorPanel()
	slot0:updateResPanel()
end

slot0.updatePersonalPanel = function(slot0)
	slot1 = EducateHelper.IsShowNature()

	setActive(slot0.personalTF, slot1)

	if slot1 then
		slot2 = slot0:findTF(&quot;content&quot;, slot0.natureTF)

		for slot6, slot7 in ipairs(slot0.natureIds) do
			setText(slot0:findTF(&quot;old&quot;, slot0:findTF(tostring(slot7), slot0.personalTF)), pg.child_attr[slot7].name .. &quot; &quot; .. slot0.char:GetAttrById(slot7))

			slot10 = slot0.result[slot7] or 0

			setActive(slot0:findTF(&quot;new&quot;, slot8), slot10 ~= 0)

			if slot10 ~= 0 then
				setText(slot0:findTF(&quot;new&quot;, slot8), (slot10 &gt; 0 and &quot;+&quot; or &quot;&quot;) .. &quot; &quot; .. slot10)
				setTextColor(slot0:findTF(&quot;new&quot;, slot8), Color.NewHex(slot10 &gt; 0 and &quot;39BFFF&quot; or &quot;FF6767&quot;))
			end
		end
	end
end

slot0.updateMajorPanel = function(slot0)
	for slot4 = 1, slot0.majorArrTF.childCount do
		slot5 = slot0.majorArrTF:GetChild(slot4 - 1)
		slot6 = slot0.majorIds[slot4]

		GetImageSpriteFromAtlasAsync(&quot;ui/educatecommonui_atlas&quot;, &quot;attr_&quot; .. slot6, slot0:findTF(&quot;icon_bg/icon&quot;, slot5), true)
		setScrollText(slot0:findTF(&quot;name_mask/name&quot;, slot5), pg.child_attr[slot6].name)

		slot7 = slot0.char:GetAttrInfo(slot6)

		setText(slot0:findTF(&quot;grade/Text&quot;, slot5), slot7)
		setText(slot0:findTF(&quot;value_old&quot;, slot5), slot0.char:GetAttrById(slot6))
		setImageColor(slot0:findTF(&quot;gradient&quot;, slot5), Color.NewHex(EducateConst.GRADE_2_COLOR[slot7][1]))
		setImageColor(slot0:findTF(&quot;grade&quot;, slot5), Color.NewHex(EducateConst.GRADE_2_COLOR[slot7][2]))

		slot11 = slot0.result[slot6] or 0
		slot12 = slot11 == 0 and &quot;39393C&quot; or &quot;39BFFF&quot;

		setActive(slot0:findTF(&quot;VX&quot;, slot5), slot11 ~= 0)
		setImageColor(slot0:findTF(&quot;arrow&quot;, slot5), Color.NewHex(slot12))
		setText(slot0:findTF(&quot;value_new&quot;, slot5), slot8 + slot11)
		setTextColor(slot0:findTF(&quot;value_new&quot;, slot5), Color.NewHex(slot12))
	end
end

slot0.updateMinorPanel = function(slot0)
	for slot4 = 1, slot0.minorArrTF.childCount do
		slot5 = slot0.minorArrTF:GetChild(slot4 - 1)
		slot6 = slot0.minorIds[slot4]

		GetImageSpriteFromAtlasAsync(&quot;ui/educatecommonui_atlas&quot;, &quot;attr_&quot; .. slot6, slot0:findTF(&quot;icon&quot;, slot5), true)
		setText(slot0:findTF(&quot;name&quot;, slot5), pg.child_attr[slot6].name)
		setText(slot0:findTF(&quot;value_add/value_old&quot;, slot5), slot0.char:GetAttrById(slot6))

		slot8 = slot0.result[slot6] or 0

		setActive(slot0:findTF(&quot;VX&quot;, slot5), slot8 ~= 0)
		setText(slot0:findTF(&quot;value_add&quot;, slot5), &quot;&quot;)

		if slot8 ~= 0 then
			onDelayTick(function ()
				setText(uv0:findTF(&quot;value_add&quot;, uv1), &quot;+&quot; .. uv2)
			end, 0.891)
		end
	end
end

slot0.updateResPanel = function(slot0)
	for slot4 = 1, #slot0.resIds do
		slot5 = slot0.resTF:GetChild(slot4 - 1)
		slot6 = slot0.resIds[slot4]

		GetImageSpriteFromAtlasAsync(&quot;ui/educatecommonui_atlas&quot;, &quot;res_&quot; .. slot6, slot0:findTF(&quot;icon&quot;, slot5), true)
		setText(slot0:findTF(&quot;name&quot;, slot5), pg.child_resource[slot6].name)

		if slot0.char:GetResById(slot6) &lt; 0 then
			slot7 = 0
		end

		setText(slot0:findTF(&quot;value_add/value_old&quot;, slot5), slot7)

		slot8 = slot0.resResult[slot6] or 0

		setText(slot0:findTF(&quot;value_add&quot;, slot5), slot8 == 0 and &quot;&quot; or &quot;+&quot; .. slot8)
	end
end

slot0._close = function(slot0)
	if slot0.inAnimPlaying then
		return
	end

	slot0.anim:Play(&quot;anim_educate_result_out&quot;)
end

slot0.onBackPressed = function(slot0)
	slot0:_close()
end

slot0.willExit = function(slot0)
	getProxy(EducateProxy):OnNextWeek()
	slot0.animEvent:SetEndEvent(nil)

	if slot0.drops then
		EducateHelper.UpdateDropsData(slot0.drops)
	end

	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)

	if slot0.contextData.onExit then
		slot0.contextData.onExit()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>