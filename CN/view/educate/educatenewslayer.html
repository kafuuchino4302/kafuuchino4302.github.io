<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educatenewslayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educatenewslayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateNewsLayer&quot;, import(&quot;.base.EducateBaseUI&quot;))
slot1 = {
	[EducateSpecialEvent.TAG_ING] = &quot;5ACEFE&quot;,
	[EducateSpecialEvent.TAG_COMING] = &quot;CB99FF&quot;,
	[EducateSpecialEvent.TAG_END] = &quot;7C7E81&quot;
}
slot2 = {
	[EducateSpecialEvent.TAG_ING] = &quot;393A3C&quot;,
	[EducateSpecialEvent.TAG_COMING] = &quot;393A3C&quot;,
	[EducateSpecialEvent.TAG_END] = &quot;7C7E81&quot;
}

slot0.getUIName = function(slot0)
	return &quot;EducateNewsUI&quot;
end

slot0.init = function(slot0)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
end

slot0.initData = function(slot0)
	slot0.curTime = getProxy(EducateProxy):GetCurTime()
	slot0.finishEvents = getProxy(EducateProxy):GetEventProxy():GetFinishSpecEventIds()
	slot0.importEvents = {}
	slot0.otherEvents = {}
	slot1 = getProxy(EducateProxy):GetPersonalityId()

	for slot5, slot6 in ipairs(pg.child_event_special.all) do
		if EducateSpecialEvent.New(slot6):IsShow() and slot7:InMonth(slot0.curTime.month) and slot7:IsUnlockSite() and slot7:IsMatch(slot1) then
			if slot7:IsImport() then
				table.insert(slot0.importEvents, slot7)
			elseif slot7:IsOther() then
				table.insert(slot0.otherEvents, slot7)
			end
		end
	end
end

slot0.findUI = function(slot0)
	slot0.anim = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(Animation))
	slot0.animEvent = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(DftAniEvent))

	slot0.animEvent:SetEndEvent(function ()
		uv0:emit(uv1.ON_CLOSE)
	end)

	slot0.windowTF = slot0:findTF(&quot;anim_root/window&quot;)
	slot0.tplTF = slot0:findTF(&quot;tpl&quot;, slot0.windowTF)

	setActive(slot0.tplTF, false)

	slot0.importTF = slot0:findTF(&quot;scrollview/view/content/import_news&quot;, slot0.windowTF)
	slot0.importUIList = UIItemList.New(slot0:findTF(&quot;list&quot;, slot0.importTF), slot0.tplTF)

	setText(slot0:findTF(&quot;title/Text&quot;, slot0.importTF), i18n(&quot;child_news_import_title&quot;))
	setText(slot0:findTF(&quot;empty/Text&quot;, slot0.importTF), i18n(&quot;child_news_import_empty&quot;))

	slot0.otherTF = slot0:findTF(&quot;scrollview/view/content/other_news&quot;, slot0.windowTF)
	slot0.otherUIList = UIItemList.New(slot0:findTF(&quot;list&quot;, slot0.otherTF), slot0.tplTF)

	setText(slot0:findTF(&quot;title/Text&quot;, slot0.otherTF), i18n(&quot;child_news_other_title&quot;))
	setText(slot0:findTF(&quot;empty/Text&quot;, slot0.otherTF), i18n(&quot;child_news_other_empty&quot;))
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0:findTF(&quot;anim_root/bg&quot;), function ()
		uv0:_close()
	end, SFX_PANEL)
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():OverlayPanel(slot0._tf, {
		groupName = slot0:getGroupNameFromData(),
		weight = slot0:getWeightFromData() + 1
	})
	slot0:initNewsList()
	slot0:updateNewsList()
end

slot0.initNewsList = function(slot0)
	slot1 = slot0.importUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateEventItem(slot1, slot2, true)
		end
	end)

	slot1 = slot0.otherUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			uv0:updateEventItem(slot1, slot2, false)
		end
	end)
end

slot0.updateEventItem = function(slot0, slot1, slot2, slot3)
	slot4 = slot3 and slot0.importEvents[slot1 + 1] or slot0.otherEvents[slot1 + 1]
	slot5 = slot4:GetTag(slot0.finishEvents, slot0.curTime.week)
	slot6 = EducateSpecialEvent.TAG2NAME[slot5]

	setImageColor(slot0:findTF(&quot;block&quot;, slot2), Color.NewHex(uv0[slot5]))
	setText(slot0:findTF(&quot;name&quot;, slot2), slot4:getConfig(&quot;main_desc&quot;))
	setTextColor(slot0:findTF(&quot;name&quot;, slot2), Color.NewHex(uv1[slot5]))
	eachChild(slot0:findTF(&quot;name/tags&quot;, slot2), function (slot0)
		setActive(slot0, slot0.name == uv0)
	end)
	setText(slot0:findTF(&quot;time/Text&quot;, slot2), slot4:GetTimeDesc())
end

slot0.updateNewsList = function(slot0)
	slot1 = CompareFuncs({
		function (slot0)
			return slot0:GetTag(uv0.finishEvents, uv0.curTime.week)
		end,
		function (slot0)
			return slot0.id
		end
	})

	table.sort(slot0.importEvents, slot1)
	table.sort(slot0.otherEvents, slot1)
	setActive(slot0:findTF(&quot;empty&quot;, slot0.importTF), #slot0.importEvents &lt;= 0)
	setActive(slot0:findTF(&quot;empty&quot;, slot0.otherTF), #slot0.otherEvents &lt;= 0)
	slot0.importUIList:align(#slot0.importEvents)
	slot0.otherUIList:align(#slot0.otherEvents)
end

slot0._close = function(slot0)
	slot0.anim:Play(&quot;anim_educate_newsUI_out&quot;)
end

slot0.onBackPressed = function(slot0)
	slot0:_close()
end

slot0.willExit = function(slot0)
	slot0.animEvent:SetEndEvent(nil)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>