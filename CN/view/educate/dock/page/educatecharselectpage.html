<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educatecharselectpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educatecharselectpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateCharSelectPage&quot;, import(&quot;view.base.BaseSubView&quot;))

slot0.getUIName = function(slot0)
	return &quot;EducateCharDockSelectUI&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.titleTxt = slot0:findTF(&quot;title/Text&quot;):GetComponent(typeof(Text))
	slot0.labelTxt = slot0:findTF(&quot;left/label/icon&quot;):GetComponent(typeof(Image))
	slot0.paintingTr = slot0:findTF(&quot;left/print/mask/painting&quot;)
	slot0.scrollrect = slot0:findTF(&quot;list&quot;)
	slot0.uiItemList = UIItemList.New(slot0:findTF(&quot;list/content&quot;), slot0:findTF(&quot;list/content/tpl&quot;))
	slot0.dotUIItemList = UIItemList.New(slot0:findTF(&quot;list/dots&quot;), slot0:findTF(&quot;list/dots/tpl&quot;))
	slot0.confirmBtn = slot0:findTF(&quot;confirm_btn&quot;)
	slot0.nextArr = slot0:findTF(&quot;prints/next&quot;)
	slot0.prevArr = slot0:findTF(&quot;prints/prev&quot;)
	slot0.nextPrint = slot0:findTF(&quot;prints/print1&quot;)
	slot0.prevPrint = slot0:findTF(&quot;prints/print2&quot;)
	slot0.animation = slot0._tf:GetComponent(typeof(Animation))
	slot0.dftAniEvent = slot0._tf:GetComponent(typeof(DftAniEvent))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.confirmBtn, function ()
		if uv0.doAnim then
			return
		end

		if not uv0.selectedId then
			return
		end

		slot0 = uv0

		slot0:emit(EducateCharDockScene.ON_SELECTED, uv0.selectedId)

		uv0.doAnim = true
		slot0 = uv0

		slot0:Back(function ()
			uv0.doAnim = nil

			uv0:emit(EducateCharDockScene.ON_CONFIRM, uv0.selectedId)
		end)
	end, SFX_PANEL)
	slot0:bind(EducateCharDockScene.MSG_CLEAR_TIP, function (slot0, slot1)
	end)
end

slot0.Back = function(slot0, slot1)
	slot0.dftAniEvent:SetEndEvent(function (slot0)
		uv0.dftAniEvent:SetEndEvent(nil)
		uv1()
	end)
	slot0.animation:Play(&quot;anim_educate_chardockselect_out&quot;)
end

slot0.Update = function(slot0, slot1, slot2)
	slot0.group = slot1

	if slot1:IsSelected(slot2) then
		slot0.selectedId = slot2
	end

	slot0.timers = {}

	slot0:FlushPainting(slot1:GetShowPainting())
	slot0:InitLabel()
	slot0:UpdateTitle()
	slot0:InitList()
	slot0:UpdateDots()
	slot0:Show()
end

slot0.UpdateTitle = function(slot0)
	slot0.titleTxt.text = slot0.group:GetTitle()
end

slot0.InitLabel = function(slot0)
	slot0.labelTxt.sprite = GetSpriteFromAtlas(&quot;ui/EducateDockUI_atlas&quot;, slot0.group:GetSpriteName())

	slot0.labelTxt:SetNativeSize()
end

slot0.FlushPainting = function(slot0, slot1)
	slot0:ReturnPainting()
	setPaintingPrefabAsync(slot0.paintingTr, slot1, &quot;tb1&quot;)

	slot0.paintingName = slot1
end

slot0.InitList = function(slot0)
	slot2 = slot0.group:GetCharIdList()

	slot0:ReturnCardList()

	slot0.cards = {}

	slot0:RemoveAllTimer()
	slot0.uiItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0[slot1 + 1]

			uv1:UpdateCard(slot2, slot3, slot1)

			uv1.cards[slot3] = slot2
		end
	end)
	slot0.uiItemList:align(#slot2)

	slot3 = #slot2 &gt; 2

	setActive(slot0.nextArr, slot3)
	setActive(slot0.prevArr, slot3)
	setActive(slot0.nextPrint, not slot3)
	setActive(slot0.prevPrint, not slot3)
	scrollTo(slot0.scrollrect, 0, 0)
end

slot0.UpdateDots = function(slot0)
	slot0.dotUIItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			setActive(slot2:Find(&quot;Image&quot;), uv0[slot1 + 1] == uv1.selectedId)
		end
	end)
	slot0.dotUIItemList:align(#slot0.group:GetCharIdList())
end

slot0.IsLockCard = function(slot0, slot1)
	return not table.contains(NewEducateHelper.GetAllUnlockSecretaryIds(), slot1)
end

slot0.UpdateCard = function(slot0, slot1, slot2, slot3)
	slot4 = slot1:Find(&quot;anim_root&quot;)
	slot5 = pg.secretary_special_ship[slot2]

	setPaintingPrefab(slot4:Find(&quot;mask/painting&quot;), slot5.prefab, &quot;tb&quot;)
	setActive(slot4:Find(&quot;lock&quot;), slot0:IsLockCard(slot5.id))
	setScrollText(slot4:Find(&quot;lock/desc/Text&quot;), slot5.unlock_desc)
	(function ()
		setActive(uv0:Find(&quot;tip&quot;), getProxy(SettingsProxy):_ShouldEducateCharTip(uv1))
	end)()

	slot7 = function()
		setActive(uv0:Find(&quot;mark&quot;), true)

		uv1.selectedId = uv2

		uv1:UpdateDots()
		uv1:FlushPainting(uv3.painting)

		uv1.prevSelected = uv0

		uv1.animation:Stop()
		uv1.animation:Play(&quot;anim_educate_chardockselect_change&quot;)
	end

	onButton(slot0, slot4, function ()
		if uv0:IsLockCard(uv1) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;secretary_special_lock_tip&quot;))

			return
		end

		if getProxy(SettingsProxy):ClearEducateCharTip(uv1) then
			uv2()
		end

		uv0:ClearPrevSelected()

		if uv0.selectedId == uv1 then
			uv0.selectedId = 0

			uv0:UpdateDots()

			return
		end

		uv3()
	end, SFX_PANEL)

	if slot0.selectedId == slot2 then
		slot7()
	end

	setActive(slot4, false)

	slot0.timers[slot3] = Timer.New(function ()
		setActive(uv0, true)
		uv0:GetComponent(typeof(Animation)):Play(&quot;anim_educate_chardockselect_tpl&quot;)
	end, math.max(1e-05, slot3 * 0.066), 1)

	slot0.timers[slot3]:Start()
end

slot0.RemoveAllTimer = function(slot0)
	for slot4, slot5 in pairs(slot0.timers) do
		slot5:Stop()

		slot5 = nil
	end

	slot0.timers = {}
end

slot0.ClearPrevSelected = function(slot0)
	if slot0.prevSelected then
		setActive(slot0.prevSelected:Find(&quot;mark&quot;), false)

		slot0.prevSelected = nil
	end
end

slot0.ReturnPainting = function(slot0)
	if slot0.paintingName then
		retPaintingPrefab(slot0.paintingTr, slot0.paintingName)

		slot0.paintingName = nil
	end
end

slot0.ReturnCardList = function(slot0)
	slot1 = pairs
	slot2 = slot0.cards or {}

	for slot4, slot5 in slot1(slot2) do
		retPaintingPrefab(slot5:Find(&quot;mask/painting&quot;), pg.secretary_special_ship[slot4].prefab)
	end

	slot0.cards = {}
end

slot0.Hide = function(slot0)
	uv0.super.Hide(slot0)
	slot0:ClearPrevSelected()

	slot0.selectedId = nil

	slot0:ReturnCardList()
	slot0:RemoveAllTimer()
end

slot0.OnDestroy = function(slot0)
	slot0:RemoveAllTimer()
	slot0:ReturnPainting()
	slot0:ReturnCardList()
	slot0.dftAniEvent:SetEndEvent(nil)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>