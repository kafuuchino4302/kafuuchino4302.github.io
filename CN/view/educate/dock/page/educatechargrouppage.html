<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educatechargrouppage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educatechargrouppage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateCharGroupPage&quot;, import(&quot;view.base.BaseEventLogic&quot;))

slot0.Ctor = function(slot0, slot1, slot2, slot3)
	pg.DelegateInfo.New(slot0)
	uv0.super.Ctor(slot0, slot2)

	slot0.contextData = slot3
	slot0.tf = slot1
	slot0.go = slot1.gameObject
	slot0.confirmBtn = findTF(slot1, &quot;confirm_btn&quot;)
	slot0.cancelBtn = findTF(slot1, &quot;cancel_btn&quot;)
	slot0.uiItemList = UIItemList.New(findTF(slot1, &quot;main/list&quot;), findTF(slot1, &quot;main/list/tpl&quot;))
	slot0.tabItemList = UIItemList.New(findTF(slot1, &quot;tab/list&quot;), findTF(slot1, &quot;tab/list/tpl&quot;))
	slot0.profileBtn = findTF(slot1, &quot;right/icon&quot;)
	slot0.animation = slot1:GetComponent(typeof(Animation))
	slot0.dftAniEvent = slot1:GetComponent(typeof(DftAniEvent))
	slot0.timers = {}

	slot0:RegisterEvent()
end

slot0.RegisterEvent = function(slot0)
	onButton(slot0, slot0.profileBtn, function ()
		uv0:emit(EducateCharDockMediator.GO_PROFILE, uv0.selectedCharacterId)
	end, SFX_PANEL)
	slot0:bind(EducateCharDockScene.MSG_CLEAR_TIP, function (slot0, slot1)
		uv0:FlushList(uv0.selectedId)
	end)
end

slot0.Update = function(slot0)
	slot0:InitData()
	slot0:InitTabs()
	slot0:InitList()
	slot0:CheckChangeFormShop()
end

slot0.Show = function(slot0)
	setActive(slot0.tf, true)
end

slot0.Hide = function(slot0)
	setActive(slot0.tf, false)
	slot0:RemoveAllTimer()
end

slot0.GetSelectedId = function(slot0)
	return getProxy(PlayerProxy):getRawData():GetEducateCharacter()
end

slot0.GetSelectedCharacterId = function(slot0)
	slot1 = slot0:GetSelectedId()

	if slot0.contextData.tbSkinId then
		slot1 = NewEducateHelper.GetSecIdBySkinId(slot0.contextData.tbSkinId)
	end

	for slot5, slot6 in ipairs(slot0.characterList) do
		if slot6:IsSelected(slot1) then
			return slot5
		end
	end

	for slot5, slot6 in ipairs(slot0.characterList) do
		if not slot6:IsLock() then
			return slot5
		end
	end
end

slot0.InitData = function(slot0)
	slot0.characterList = NewEducateHelper.GetEducateCharacterList()
	slot0.selectedCharacterId = slot0:GetSelectedCharacterId()
	slot0.selectedId = slot0:GetSelectedId()
end

slot0.CheckChangeFormShop = function(slot0)
	if not slot0.contextData.tbSkinId then
		return
	end

	slot2 = slot0.characterList[slot0.selectedCharacterId].id
	slot3 = pg.secretary_special_ship[NewEducateHelper.GetSecIdBySkinId(slot0.contextData.tbSkinId)].group

	for slot7, slot8 in ipairs(slot0.characterList) do
		if slot8.id == slot2 then
			slot0:emit(EducateCharDockScene.ON_SELECT, slot8:GetGroupById(slot3), slot0.selectedId)

			return
		end
	end
end

slot0.InitTabs = function(slot0)
	slot0.tabItemList:make(function (slot0, slot1, slot2)
		slot4 = uv0.characterList[slot1 + 1]

		if slot0 == UIItemList.EventUpdate then
			setActive(slot2:Find(&quot;lock&quot;), slot4:IsLock())
			setActive(slot2:Find(&quot;border/selected&quot;), slot3 == uv0.selectedCharacterId)
			setActive(slot2:Find(&quot;border/normal&quot;), slot3 ~= uv0.selectedCharacterId)
			setActive(slot2:Find(&quot;tip&quot;), slot4:ShouldTip())
		elseif slot0 == UIItemList.EventInit then
			GetImageSpriteFromAtlasAsync(&quot;qicon/&quot; .. slot4:GetDefaultFrame(), &quot;&quot;, slot2:Find(&quot;frame&quot;))
			onButton(uv0, slot2, function ()
				if uv0:IsLock() then
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;secretary_special_character_unlock&quot;))

					return
				end

				if uv1 ~= uv2.selectedCharacterId then
					uv2.selectedCharacterId = uv1

					uv2.tabItemList:align(#uv2.characterList)
					uv2:InitList()
				end
			end)
		end
	end)
	slot0.tabItemList:align(#slot0.characterList)
end

slot0.InitList = function(slot0)
	slot0.cards = {}
	slot1 = slot0.characterList[slot0.selectedCharacterId]:GetGroupList()

	table.sort(slot1, function (slot0, slot1)
		return slot0:GetSortWeight() &lt; slot1:GetSortWeight()
	end)
	slot0:RemoveAllTimer()
	slot0.uiItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0[slot1 + 1]

			uv1:InitCard(slot2, slot3, slot1)
			uv1:UpdateCard(slot2, slot3)

			uv1.cards[slot2] = slot3
		end
	end)
	slot0.uiItemList:align(#slot1)
end

slot0.FlushList = function(slot0, slot1)
	slot0.selectedId = slot1

	slot0:InitList()
	slot0.tabItemList:align(#slot0.characterList)
end

slot0.InitCard = function(slot0, slot1, slot2, slot3)
	slot4 = slot1:Find(&quot;anim_root&quot;)
	slot5 = slot2:IsSp()

	setActive(slot4:Find(&quot;bg&quot;), not slot5)
	setActive(slot4:Find(&quot;sp_bg&quot;), slot5)
	setActive(slot4:Find(&quot;mask&quot;), not slot5)
	setActive(slot4:Find(&quot;sp_mask&quot;), slot5)
	setActive(slot4:Find(&quot;sp&quot;), slot5)
	setActive(slot4:Find(&quot;label&quot;), not slot5)
	setActive(slot4:Find(&quot;sp_label&quot;), slot5)

	slot6 = slot2:GetShowPainting()

	if slot5 then
		setPaintingPrefabAsync(slot4:Find(&quot;sp_mask/painting&quot;), slot6, &quot;tb2&quot;)
	else
		slot7 = slot4:Find(&quot;label/Text&quot;):GetComponent(typeof(Image))
		slot7.sprite = GetSpriteFromAtlas(&quot;ui/EducateDockUI_atlas&quot;, slot2:GetSpriteName())

		slot7:SetNativeSize()
		setPaintingPrefabAsync(slot4:Find(&quot;mask/painting&quot;), slot6, &quot;tb2&quot;)
	end

	onButton(slot0, slot4, function ()
		if uv0.doAnim then
			return
		end

		if uv1:IsLock() then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;secretary_special_lock_tip&quot;))

			return
		end

		uv0.doAnim = true

		uv0.dftAniEvent:SetEndEvent(function (slot0)
			uv0.doAnim = nil

			uv0.dftAniEvent:SetEndEvent(nil)
			uv0:emit(EducateCharDockScene.ON_SELECT, uv1, uv0.selectedId)
		end)
		uv0.animation:Play(&quot;anim_educate_chardock_grouppage_out&quot;)
	end, SFX_PANEL)
	setActive(slot4, false)

	slot0.timers[slot3] = Timer.New(function ()
		setActive(uv0, true)
		uv0:GetComponent(typeof(Animation)):Play(&quot;anim_educate_chardock_tpl&quot;)
	end, math.max(1e-05, slot3 * 0.066), 1)

	slot0.timers[slot3]:Start()
end

slot0.UpdateCard = function(slot0, slot1, slot2)
	slot3 = slot1:Find(&quot;anim_root&quot;)

	setActive(slot3:Find(&quot;lock&quot;), slot2:IsLock())
	setActive(slot3:Find(&quot;mark&quot;), slot2:IsSelected(slot0.selectedId))
	setScrollText(slot3:Find(&quot;lock/desc/Text&quot;), slot2:GetUnlockDesc())
	setActive(slot3:Find(&quot;tip&quot;), slot2:ShouldTip())
end

slot0.RemoveAllTimer = function(slot0)
	for slot4, slot5 in pairs(slot0.timers) do
		slot5:Stop()

		slot5 = nil
	end

	slot0.timers = {}
end

slot0.Destroy = function(slot0)
	slot1 = pairs
	slot2 = slot0.cards or {}

	for slot4, slot5 in slot1(slot2) do
		retPaintingPrefab(slot5:IsSp() and slot4:Find(&quot;sp_mask/painting&quot;) or slot4:Find(&quot;mask/painting&quot;), slot5:GetShowPainting())
	end

	pg.DelegateInfo.Dispose(slot0)
	slot0.dftAniEvent:SetEndEvent(nil)
	slot0:RemoveAllTimer()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>