<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>educateschedulefilterlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>educateschedulefilterlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;EducateScheduleFilterLayer&quot;, import(&quot;.base.EducateBaseUI&quot;))

slot1 = function(slot0)
	slot1 = Clone(slot0)

	table.remove(slot1, 1)

	return slot1
end

slot0.FILTER_CONFIG = {
	{
		tag = &quot;typeIndex&quot;,
		dropdown = false,
		title = i18n(&quot;child_filter_type1&quot;),
		options = slot1(EducatePlanIndexConst.TypeIndexs),
		names = slot1(EducatePlanIndexConst.TypeNames),
		default = EducatePlanIndexConst.TypeAll
	},
	{
		dropdown = true,
		title = i18n(&quot;child_filter_type2&quot;),
		options = {
			EducatePlanIndexConst.AwardResIndexs,
			EducatePlanIndexConst.AwardNatureIndexs,
			EducatePlanIndexConst.AwardAttr1Indexs,
			EducatePlanIndexConst.AwardAttr2Indexs
		},
		names = {
			EducatePlanIndexConst.AwardResNames,
			EducatePlanIndexConst.AwardNatureNames,
			EducatePlanIndexConst.AwardAttr1Names,
			EducatePlanIndexConst.AwardAttr2Names
		},
		tags = {
			&quot;awardResIndex&quot;,
			&quot;awardNatureIndex&quot;,
			&quot;awardAttr1Index&quot;,
			&quot;awardAttr2Index&quot;
		},
		defaults = {
			EducatePlanIndexConst.AwardResAll,
			EducatePlanIndexConst.AwardNatureAll,
			EducatePlanIndexConst.AwardAttr1All,
			EducatePlanIndexConst.AwardAttr2All
		}
	},
	{
		tag = &quot;costIndex&quot;,
		dropdown = false,
		title = i18n(&quot;child_filter_type3&quot;),
		options = slot1(EducatePlanIndexConst.CostIndexs),
		names = slot1(EducatePlanIndexConst.CostNames),
		default = EducatePlanIndexConst.CostAll
	}
}

slot0.getUIName = function(slot0)
	return &quot;EducateScheduleIndexUI&quot;
end

slot0.init = function(slot0)
	slot0.anim = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(Animation))
	slot0.animEvent = slot0:findTF(&quot;anim_root&quot;):GetComponent(typeof(DftAniEvent))

	slot0.animEvent:SetEndEvent(function ()
		uv0:emit(uv1.ON_CLOSE)
	end)

	slot0.windowTF = slot0:findTF(&quot;anim_root/window&quot;)

	setText(slot0:findTF(&quot;top/title&quot;, slot0.windowTF), i18n(&quot;child_filter_title&quot;))

	slot0.filterContainer = slot0:findTF(&quot;frame/filter_content&quot;, slot0.windowTF)
	slot0.filterTpl = slot0:findTF(&quot;anim_root/filter_tpl&quot;)
	slot0.itemTpl = slot0:findTF(&quot;anim_root/item_tpl&quot;)

	setActive(slot0.filterTpl, false)
	setActive(slot0.itemTpl, false)

	slot0.dropdownPanel = slot0:findTF(&quot;anim_root/dropdown_panel&quot;)
	slot0.dropdownUIList = UIItemList.New(slot0:findTF(&quot;dropdown/list&quot;, slot0.dropdownPanel), slot0:findTF(&quot;dropdown/list/tpl&quot;, slot0.dropdownPanel))

	setActive(slot0.dropdownPanel, false)
	setText(slot0:findTF(&quot;sure_btn/Text&quot;, slot0.windowTF), i18n(&quot;word_ok&quot;))
	setText(slot0:findTF(&quot;reset_btn/Text&quot;, slot0.windowTF), i18n(&quot;word_reset&quot;))
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0:findTF(&quot;sure_btn&quot;, slot0.windowTF), function ()
		if uv0.contextData.callback then
			uv0.contextData.callback(uv0.contextData.indexDatas)

			uv0.contextData.callback = nil
		end

		uv0:_close()
	end, SFX_PANEL)
	onButton(slot0, slot0:findTF(&quot;reset_btn&quot;, slot0.windowTF), function ()
		uv0.contextData.indexDatas = nil

		removeAllChildren(uv0.filterContainer)
		uv0:initFilters()
	end, SFX_PANEL)
	onButton(slot0, slot0.dropdownPanel, function ()
		uv0:closeDropdownPanel()
	end, SFX_PANEL)
	onButton(slot0, slot0:findTF(&quot;anim_root/bg&quot;), function ()
		uv0:_close()
	end, SFX_PANEL)
	onButton(slot0, slot0:findTF(&quot;top/close_btn&quot;, slot0.windowTF), function ()
		uv0:_close()
	end, SFX_PANEL)
	slot0:initDropdownPanel()
	slot0:initFilters()
	pg.UIMgr.GetInstance():OverlayPanel(slot0._tf, {
		groupName = LayerWeightConst.GROUP_EDUCATE,
		weight = LayerWeightConst.BASE_LAYER + 1
	})
end

slot0.initDropdownPanel = function(slot0)
	slot1 = slot0.dropdownUIList

	slot1:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = slot1 + 1 + 1
			slot5 = uv0.dropdownCfg.options[uv0.dropdownCfgIndex][slot3]
			slot6 = uv0.dropdownCfg.tags[uv0.dropdownCfgIndex]
			slot7 = uv0.dropdownCfg.defaults[uv0.dropdownCfgIndex]

			setActive(uv0:findTF(&quot;line&quot;, slot2), slot3 ~= #uv0.dropdownCfg.options[uv0.dropdownCfgIndex])
			setText(uv0:findTF(&quot;Text&quot;, slot2), uv0.dropdownCfg.names[uv0.dropdownCfgIndex][slot3])
			onButton(uv0, slot2, function ()
				if uv0.contextData.indexDatas[uv1] == uv2 then
					uv0.contextData.indexDatas[uv1] = uv3
				else
					uv0.contextData.indexDatas[uv1] = uv2
				end

				uv0:closeDropdownPanel()
				uv0.uiList[uv0.updateListIndex]:align(#uv0.dropdownCfg.options)
			end, SFX_PANEL)
		end
	end)
end

slot0.initFilters = function(slot0)
	slot0.contextData.indexDatas = slot0.contextData.indexDatas or {}
	slot0.uiList = {}

	for slot4, slot5 in ipairs(uv0.FILTER_CONFIG) do
		setText(slot0:findTF(&quot;title/title&quot;, cloneTplTo(slot0.filterTpl, slot0.filterContainer)), slot5.title)

		if not slot5.dropdown then
			slot0:initNormal(slot4, slot5, slot6)
		else
			slot0:initDropdown(slot4, slot5, slot6)
		end
	end
end

slot0.initNormal = function(slot0, slot1, slot2, slot3)
	slot5 = UIItemList.New(slot0:findTF(&quot;content/container&quot;, slot3), slot0.itemTpl)

	slot5:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventInit then
			slot3 = slot1 + 1
			slot5 = uv0.options[slot3]

			setText(uv1:findTF(&quot;Text&quot;, slot2), uv0.names[slot3])
			setActive(uv1:findTF(&quot;line&quot;, slot2), slot3 ~= #uv0.names)
			setActive(uv1:findTF(&quot;arrow&quot;, slot2), false)

			if not uv1.contextData.indexDatas[uv0.tag] then
				uv1.contextData.indexDatas[uv0.tag] = uv0.default
			end

			onButton(uv1, slot2, function ()
				if uv0.contextData.indexDatas[uv1.tag] == uv1.default then
					uv0.contextData.indexDatas[uv1.tag] = uv2
				else
					uv0.contextData.indexDatas[uv1.tag] = bit.bxor(uv0.contextData.indexDatas[uv1.tag], uv2)
				end

				if uv0.contextData.indexDatas[uv1.tag] == 0 then
					uv0.contextData.indexDatas[uv1.tag] = uv1.default
				end

				uv3:align(#uv1.options)
			end, SFX_PANEL)

			return
		end

		if slot0 == UIItemList.EventUpdate then
			slot5 = nil
			slot5 = (uv1.contextData.indexDatas[uv0.tag] ~= uv0.default or false) and bit.band(uv1.contextData.indexDatas[uv0.tag], uv0.options[slot1 + 1]) &gt; 0

			setActive(uv1:findTF(&quot;selected&quot;, slot2), slot5)
			setTextColor(uv1:findTF(&quot;Text&quot;, slot2), slot5 and Color.white or Color.NewHex(&quot;393a3c&quot;))
		end
	end)
	slot5:align(#slot2.options)

	slot0.uiList[slot1] = slot5
end

slot0.initDropdown = function(slot0, slot1, slot2, slot3)
	slot5 = UIItemList.New(slot0:findTF(&quot;content/container&quot;, slot3), slot0.itemTpl)

	slot5:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventInit then
			slot3 = slot1 + 1
			slot5 = uv0.defaults[slot3]

			setActive(uv1:findTF(&quot;line&quot;, slot2), slot3 ~= #uv0.tags)
			setActive(uv1:findTF(&quot;arrow&quot;, slot2), true)

			if not uv1.contextData.indexDatas[uv0.tags[slot3]] then
				uv1.contextData.indexDatas[slot4] = slot5
			end

			onButton(uv1, slot2, function ()
				uv0.dropdownCfg = uv1
				uv0.dropdownCfgIndex = uv2
				uv0.updateListIndex = uv3

				uv0:showDropdownPanel(uv0._tf:InverseTransformPoint(uv4.position))
			end, SFX_PANEL)

			return
		end

		if slot0 == UIItemList.EventUpdate then
			slot3 = slot1 + 1
			slot6 = &quot;&quot;
			slot7 = true

			if uv1.contextData.indexDatas[uv0.tags[slot3]] == uv0.defaults[slot3] then
				slot7 = false
				slot6 = uv0.names[slot3][1]
			else
				for slot12, slot13 in ipairs(uv0.options[slot3]) do
					if uv1.contextData.indexDatas[slot4] == slot13 then
						slot6 = uv0.names[slot3][slot12]

						break
					end
				end
			end

			setText(uv1:findTF(&quot;Text&quot;, slot2), slot6)
			setActive(uv1:findTF(&quot;selected&quot;, slot2), slot7)
			setTextColor(uv1:findTF(&quot;Text&quot;, slot2), slot7 and Color.white or Color.NewHex(&quot;393a3c&quot;))
			setImageColor(uv1:findTF(&quot;arrow&quot;, slot2), slot7 and Color.white or Color.NewHex(&quot;393a3c&quot;))
		end
	end)
	slot5:align(#slot2.options)

	slot0.uiList[slot1] = slot5
end

slot0.showDropdownPanel = function(slot0, slot1)
	setAnchoredPosition(slot0:findTF(&quot;dropdown&quot;, slot0.dropdownPanel), slot1)
	setActive(slot0.dropdownPanel, true)
	slot0.dropdownUIList:align(#slot0.dropdownCfg.options[slot0.dropdownCfgIndex] - 1)
end

slot0.closeDropdownPanel = function(slot0)
	setActive(slot0.dropdownPanel, false)
end

slot0._close = function(slot0)
	slot0.anim:Play(&quot;anim_educate_scheduleindex_out&quot;)
end

slot0.onBackPressed = function(slot0)
	slot0:_close()
end

slot0.willExit = function(slot0)
	slot0.animEvent:SetEndEvent(nil)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0._tf)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>