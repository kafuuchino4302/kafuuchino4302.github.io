<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>baseshoppage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>baseshoppage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;BaseShopPage&quot;, import(&quot;...base.BasePanel&quot;))

slot0.Ctor = function(slot0, slot1, slot2)
	uv0.super.Ctor(slot0, slot2)
	slot0:attach(slot1)

	slot0.event = slot1.event

	slot0:CustomInit()
end

slot0.init = function(slot0)
	slot0.canvasGroup = slot0._go:GetComponent(typeof(CanvasGroup))
	slot0.lScrollrect = GetComponent(slot0:findTF(&quot;scroll&quot;), &quot;LScrollRect&quot;)
	slot0.scrollbar = slot0:findTF(&quot;scroll/Scrollbar&quot;)
	slot0.tipTextGo = slot0:findTF(&quot;bg/tipBg&quot;)
	slot0.tipText = slot0:findTF(&quot;bg/tipBg/tipText&quot;):GetComponent(typeof(Text))
	slot0.helpBtn = slot0:findTF(&quot;bg/resList/helpBtn&quot;)
	slot0.refreshBtn = slot0:findTF(&quot;timeBtn&quot;)
	slot0.timerText = slot0:findTF(&quot;timeBtn/Text&quot;):GetComponent(typeof(Text))
	slot0.resolveBtn = slot0:findTF(&quot;resolveBtn&quot;)

	setText(slot0:findTF(&quot;resolveBtn/Text&quot;), i18n(&quot;shop_fragment_resolve&quot;))
end

slot0.CustomInit = function(slot0)
end

slot0.SetShop = function(slot0, slot1)
	slot0.shop = slot1
end

slot0.SetPlayer = function(slot0, slot1)
	slot0.player = slot1

	slot0:OnUpdatePlayer()
end

slot0.SetItems = function(slot0, slot1)
	slot0.items = slot1

	slot0:OnUpdateItems()
end

slot0.SetUp = function(slot0, slot1, slot2, slot3)
	slot0:SetShop(slot1)
	slot0:Show()
	slot0:SetPlayer(slot2)
	slot0:SetItems(slot3)
	slot0:InitCommodities()
	slot0:OnSetUp()
	slot0:SetPainting()
	slot0:RefreshUI()
end

slot0.InitCommodities = function(slot0)
	slot0.cards = {}
	slot0.displays = slot0.shop:GetCommodities()

	slot0.lScrollrect:SetTotalCount(#slot0.displays, 0)
end

slot0.RefreshUI = function(slot0)
	setActive(slot0.tipTextGo, false)
	setActive(slot0.helpBtn, false)
	setActive(slot0.resolveBtn, false)
	setActive(slot0.refreshBtn, false)
end

slot0.Show = function(slot0)
	slot0.lScrollrect.onInitItem = function(slot0)
		uv0:OnInitItem(slot0)
	end

	slot0.lScrollrect.onUpdateItem = function(slot0, slot1)
		uv0:OnUpdateItem(slot0, slot1)
	end

	slot0.canvasGroup.alpha = 1
	slot0.canvasGroup.blocksRaycasts = true

	slot0:PlayBGM()
end

slot0.Hide = function(slot0)
	slot0:StopBGM()

	for slot4, slot5 in pairs(slot0.cards) do
		slot5:Dispose()
	end

	slot0.displays = {}
	slot0.cards = {}

	ClearLScrollrect(slot0.lScrollrect)

	slot0.canvasGroup.alpha = 0
	slot0.canvasGroup.blocksRaycasts = false
end

slot0.GetResDataList = function(slot0)
	return {}
end

slot0.RefreshResItemList = function(slot0)
	slot0.parent:RefreshResItemList(slot0:GetResDataList() or {})
end

slot0.OnDestroy = function(slot0)
	slot0:detach()
end

slot0.SetPainting = function(slot0)
	slot1, slot2, slot3 = slot0:GetPaintingName()

	if slot0.contextData.paintingView.name ~= slot1 then
		slot4 = slot0.contextData.paintingView

		slot4:Init(slot1, slot2, slot3, function ()
			slot0, slot1, slot2 = uv0:GetPaintingEnterVoice()

			uv0.contextData.paintingView:Chat(slot0, slot1, slot2, true)
		end, function ()
			slot0, slot1, slot2 = uv0:GetPaintingTouchVoice()

			uv0.contextData.paintingView:Chat(slot0, slot1, slot2, false)
		end)
	end
end

slot0.UpdateShop = function(slot0, slot1)
	slot0:SetShop(slot1)
	pg.MsgboxMgr.GetInstance():hide()

	if slot0.contextData.singleWindow:GetLoaded() and slot0.contextData.singleWindow:isShowing() then
		slot0.contextData.singleWindow:ExecuteAction(&quot;Close&quot;)
	end

	if slot0.contextData.multiWindow:GetLoaded() and slot0.contextData.multiWindow:isShowing() then
		slot0.contextData.multiWindow:ExecuteAction(&quot;Close&quot;)
	end

	slot0:OnUpdateAll()
end

slot0.UpdateCommodity = function(slot0, slot1, slot2)
	slot0:SetShop(slot1)

	if DROP_TYPE_SHIP == slot1:GetCommodityById(slot2):getConfig(&quot;commodity_type&quot;) then
		slot0:OnUpdateAll()
	else
		slot0:OnUpdateCommodity(slot3)
	end

	slot4, slot5, slot6 = nil

	if slot1:IsPurchaseAll() then
		slot4, slot5, slot6 = slot0:GetPaintingAllPurchaseVoice()
	else
		slot4, slot5, slot6 = slot0:GetPaintingCommodityUpdateVoice()
	end

	slot0.contextData.paintingView:Chat(slot4, slot5, slot6, true)
end

slot0.OnClickCommodity = function(slot0, slot1, slot2)
	if Drop.New({
		type = slot1:getConfig(&quot;commodity_type&quot;),
		id = slot1:getConfig(&quot;commodity_id&quot;),
		count = slot1:getConfig(&quot;num&quot;)
	}).type == DROP_TYPE_VITEM and slot3:getConfig(&quot;virtual_type&quot;) == 22 and (not getProxy(ActivityProxy):getActivityById(slot3:getConfig(&quot;link_id&quot;)) or slot5:isEnd()) then
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;tip_build_ticket_exchange_expired&quot;, slot3:getName()))

		return
	end

	slot4 = nil

	((slot3.type ~= DROP_TYPE_EQUIPMENT_SKIN or slot0.contextData.singleWindowForESkin) and (slot1:getConfig(&quot;num_limit&quot;) ~= 1 and slot1:getConfig(&quot;commodity_type&quot;) ~= 4 and (not isa(slot1, QuotaCommodity) or slot1:GetLimitGoodCount() ~= 1) or slot0.contextData.singleWindow) and slot0.contextData.multiWindow):ExecuteAction(&quot;Open&quot;, slot1, function (slot0, slot1, slot2)
		slot3 = {}

		if slot0:getConfig(&quot;commodity_type&quot;) == 4 or uv0.shop.type == ShopArgs.ShopActivity then
			table.insert(slot3, function (slot0)
				uv0:TipPurchase(uv1, uv2, uv3, slot0)
			end)
		else
			table.insert(slot3, function (slot0)
				if uv0:getSpecialRule(uv1) then
					slot0()
				end
			end)
		end

		table.insert(slot3, function (slot0)
			if not uv0:canPurchase() then
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;buy_countLimit&quot;))

				return
			end

			if Drop.New({
				type = uv0:getConfig(&quot;resource_category&quot;),
				id = uv0:getConfig(&quot;resource_type&quot;)
			}):getOwnedCount() &lt; uv0:getConfig(&quot;resource_num&quot;) * uv1 then
				if not ItemTipPanel.ShowItemTip(uv0:getConfig(&quot;resource_category&quot;), uv0:getConfig(&quot;resource_type&quot;)) then
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_no_x&quot;, slot1:getName()))
				end

				return
			end

			slot0()
		end)
		seriesAsync(slot3, function ()
			uv0(uv1, uv2)
		end)
	end)
end

slot0.TipPurchase = function(slot0, slot1, slot2, slot3, slot4)
	pg.MsgboxMgr.GetInstance():ShowMsgBox({
		content = i18n(&quot;pt_reconfirm&quot;, slot3 or &quot;??&quot;),
		onYes = slot4
	})
end

slot0.getSpecialRule = function(slot0, slot1)
	if slot1:getConfig(&quot;commodity_type&quot;) == DROP_TYPE_ITEM and slot0.shop.type == ShopArgs.ShopFragment and Item.getConfigData(slot1:getConfig(&quot;commodity_id&quot;)) and slot3.type == 7 and #slot3.shiptrans_id &gt; 0 then
		slot4 = getProxy(BayProxy)

		if getProxy(BagProxy):getItemCountById(slot2) &gt; 0 or underscore.any(slot3.shiptrans_id, function (slot0)
			return uv0:getConfigShipCount(slot0) &gt; 0
		end) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;special_transform_limit_reach&quot;))

			return false
		end
	end

	return true
end

slot0.CanOpen = function(slot0, slot1, slot2)
	return true
end

slot0.GetPaintingName = function(slot0)
	return &quot;buzhihuo_shop&quot;
end

slot0.GetPaintingEnterVoice = function(slot0)
	slot2 = string.split(pg.navalacademy_shoppingstreet_template[1].words_enter, &quot;|&quot;)
	slot3 = math.random(#slot2)

	return slot2[slot3], &quot;enter_&quot; .. slot3, false
end

slot0.GetPaintingCommodityUpdateVoice = function(slot0)
	slot2 = string.split(pg.navalacademy_shoppingstreet_template[1].words_buy, &quot;|&quot;)
	slot3 = math.random(#slot2)

	return slot2[slot3], &quot;buy_&quot; .. slot3, false
end

slot0.GetPaintingAllPurchaseVoice = function(slot0)
	return nil, , 
end

slot0.GetPaintingTouchVoice = function(slot0)
	slot2 = string.split(pg.navalacademy_shoppingstreet_template[1].words_touch, &quot;|&quot;)
	slot3 = math.random(#slot2)

	return slot2[slot3], &quot;touch_&quot; .. slot3, false
end

slot0.GetBg = function(slot0, slot1)
end

slot0.OnSetUp = function(slot0)
end

slot0.getBGM = function(slot0)
	return nil
end

slot0.PlayBGM = function(slot0)
	slot1 = slot0:getBGM()
	slot2 = pg.voice_bgm[slot1]

	if slot1 and slot2 then
		pg.BgmMgr.GetInstance():Push(slot1, slot2.bgm)
	end
end

slot0.StopBGM = function(slot0)
	slot1 = slot0:getBGM()
	slot2 = pg.voice_bgm[slot1]

	if slot1 and slot2 then
		pg.BgmMgr.GetInstance():Pop(slot1)
	end
end

slot0.OnUpdateAll = function(slot0)
end

slot0.OnUpdateCommodity = function(slot0, slot1)
end

slot0.OnUpdatePlayer = function(slot0)
end

slot0.OnUpdateItems = function(slot0)
end

slot0.OnInitItem = function(slot0, slot1)
end

slot0.OnUpdateItem = function(slot0, slot1, slot2)
end

slot0.CanOpenPurchaseWindow = function(slot0, slot1)
	return slot1:canPurchase()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>