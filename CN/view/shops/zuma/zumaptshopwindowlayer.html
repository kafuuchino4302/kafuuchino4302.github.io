<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zumaptshopwindowlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>zumaptshopwindowlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ZumaPTShopWindowLayer&quot;, import(&quot;...base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;ZumaPTShopWindowUI&quot;
end

slot0.init = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0:initData()
	slot0:findUI()
	slot0:addListener()
end

slot0.didEnter = function(slot0)
	slot0:updateGoodInfoPanel()
	slot0:updateBuyPanelWithNum(1)
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
	slot0.pageUtil:Dispose()
end

slot0.onBackPressed = function(slot0)
	slot0:closeView()
end

slot0.initData = function(slot0)
	slot0.actShopVO = slot0.contextData.actShopVO
	slot0.goodVO = slot0.contextData.goodVO
	slot0.perCost = slot0.goodVO:getConfig(&quot;resource_num&quot;)
	slot0.maxBuyCount = math.floor(Drop.New({
		type = slot0.goodVO:getConfig(&quot;resource_category&quot;),
		id = slot0.goodVO:getConfig(&quot;resource_type&quot;)
	}):getOwnedCount() / slot0.perCost)

	if slot0.goodVO:getConfig(&quot;num_limit&quot;) ~= 0 then
		slot0.maxBuyCount = math.min(slot0.maxBuyCount, math.max(slot0.goodVO:GetPurchasableCnt(), 0))
	end

	slot0.curBuyCount = 1
	slot0.costItemInfo = Drop.New({
		type = slot0.goodVO:getConfig(&quot;resource_category&quot;),
		id = slot0.goodVO:getConfig(&quot;resource_type&quot;)
	})
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot1 = slot0:findTF(&quot;Panel&quot;)
	slot2 = slot0:findTF(&quot;Info&quot;, slot1)
	slot0.nameText = slot0:findTF(&quot;Name/Text&quot;, slot2)
	slot0.descText = slot0:findTF(&quot;Desc&quot;, slot2)
	slot0.itemTF = slot0:findTF(&quot;CommonItemTemplate&quot;, slot2)
	slot0.countTF = slot0:findTF(&quot;Count&quot;, slot2)
	slot0.countText = slot0:findTF(&quot;Count/Num&quot;, slot2)

	setText(slot0:findTF(&quot;Count/Tip&quot;, slot2), i18n(&quot;word_own1&quot;))

	slot0.titleTF = slot0:findTF(&quot;Title&quot;, slot1)
	slot4 = slot0:findTF(&quot;Buy&quot;, slot1)
	slot0.minusBtn = slot0:findTF(&quot;Minus&quot;, slot4)
	slot0.addBtn = slot0:findTF(&quot;Add&quot;, slot4)
	slot0.maxBtn = slot0:findTF(&quot;Max&quot;, slot4)
	slot0.buyNumText = slot0:findTF(&quot;Num&quot;, slot4)
	slot0.butCountText = slot0:findTF(&quot;BuyCount/Num&quot;, slot1)
	slot0.costNumText = slot0:findTF(&quot;Cost/Num&quot;, slot1)
	slot0.confirmBtn = slot0:findTF(&quot;ConfirmBtn&quot;, slot1)
	slot0.cancelBtn = slot0:findTF(&quot;CancelBtn&quot;, slot1)
end

slot0.addListener = function(slot0)
	slot1 = function()
		uv0:closeView()
	end

	onButton(slot0, slot0.bg, slot1, SFX_CANCEL)
	onButton(slot0, slot0.cancelBtn, slot1, SFX_CANCEL)
	onButton(slot0, slot0.confirmBtn, function ()
		if uv0.maxBuyCount &lt; uv0.curBuyCount then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;islandshop_tips4&quot;, uv0.costItemInfo:getName()))

			return
		end

		pg.m02:sendNotification(GAME.ISLAND_SHOPPING, {
			shop = uv0.actShopVO,
			arg1 = uv0.goodVO.id,
			arg2 = uv0.curBuyCount
		})
	end, SFX_CANCEL)

	slot0.pageUtil = PageUtil.New(slot0.minusBtn, slot0.addBtn, slot0.maxBtn, slot0.butCountText)

	slot0.pageUtil:setNumUpdate(function (slot0)
		uv0:updateBuyPanelWithNum(slot0)
	end)
	slot0.pageUtil:setAddNum(1)
	slot0.pageUtil:setMaxNum(math.max(slot0.maxBuyCount, 1))
	slot0.pageUtil:setDefaultNum(1)
end

slot0.updateGoodInfoPanel = function(slot0)
	slot1 = slot0.goodVO
	slot2 = Drop.New({
		type = slot1:getConfig(&quot;commodity_type&quot;),
		id = slot1:getConfig(&quot;commodity_id&quot;),
		count = slot1:getConfig(&quot;num&quot;)
	})

	updateDrop(slot0.itemTF, slot2)

	slot3, slot4 = slot2:getOwnedCount()

	setActive(slot0.countTF, slot4)

	if slot4 then
		setText(slot0.countText, slot3)
	end

	setText(slot0.nameText, slot2:getConfig(&quot;name&quot;))
	setText(slot0.descText, string.gsub(slot2.desc or slot2:getConfig(&quot;desc&quot;), &quot;&lt;[^&gt;]+&gt;&quot;, &quot;&quot;))
end

slot0.updateBuyPanelWithNum = function(slot0, slot1)
	slot0.curBuyCount = slot1 or 0

	setText(slot0.buyNumText, slot0.curBuyCount)
	setText(slot0.butCountText, slot0.curBuyCount)
	setText(slot0.costNumText, slot0.curBuyCount * slot0.perCost)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>