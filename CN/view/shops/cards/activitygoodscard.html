<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>activitygoodscard.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>activitygoodscard.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;ActivityGoodsCard&quot;, import(&quot;.BaseGoodsCard&quot;))
slot0.Color = {}
slot0.DefaultColor = {
	0.8745098039215686,
	0.9294117647058824,
	1
}

slot0.Ctor = function(slot0, slot1)
	uv0.super.Ctor(slot0, slot1)

	slot0.limitPassTag = slot0.tf:Find(&quot;mask/tag/pass_tag&quot;)
end

slot0.update = function(slot0, slot1, slot2, slot3, slot4)
	if slot1:Selectable() then
		slot0:updateSelectable(slot1, slot2, slot3, slot4)
	else
		slot0:updateSingle(slot1, slot2, slot3, slot4)
	end
end

slot0.updateSingle = function(slot0, slot1, slot2, slot3, slot4)
	slot0.goodsVO = slot1
	slot7 = false

	setActive(slot0.mask, not slot5 or slot0.goodsVO:CheckCntLimit() and not slot0.goodsVO:CheckArgLimit())
	setActive(slot0.selloutTag, false)

	if slot0.limitPassTag then
		setActive(slot0.limitPassTag, false)
	end

	setActive(slot0.unexchangeTag, false)
	removeOnButton(slot0.mask)

	if slot6 then
		slot8, slot9, slot10 = slot0.goodsVO:CheckArgLimit()

		if slot9 == &quot;pass&quot; then
			setActive(slot0.limitPassTag, true)
			setScrollText(findTF(slot0.limitPassTag, &quot;TextGo/Text&quot;), i18n(&quot;eventshop_unlock_info&quot;, slot10))
			onButton(slot0, slot0.mask, function ()
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;eventshop_unlock_hint&quot;, uv0))
			end, SFX_PANEL)
		else
			setScrollText(slot0.unexchangeTag:Find(&quot;TextGo/Text&quot;), slot10)

			slot7 = true
		end
	end

	if not slot5 then
		setActive(slot0.selloutTag, true)
	elseif slot7 then
		setActive(slot0.unexchangeTag, true)
	end

	updateDrop(slot0.itemTF, Drop.New({
		type = slot1:getConfig(&quot;commodity_type&quot;),
		id = slot1:getConfig(&quot;commodity_id&quot;),
		count = slot1:getConfig(&quot;num&quot;)
	}))

	if slot5 then
		slot9, slot10, slot11 = slot0.goodsVO:CheckTimeLimit()

		if slot9 and not slot10 then
			setActive(slot0.mask, true)
			setActive(slot0.sellEndTag, true)
			removeOnButton(slot0.mask)
			onButton(slot0, slot0.mask, function ()
				if uv0 then
					pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;tip_build_ticket_exchange_expired&quot;, uv1:getName()))
				end
			end, SFX_PANEL)
		end
	end

	GetSpriteFromAtlasAsync(Drop.New({
		type = slot1:getConfig(&quot;resource_category&quot;),
		id = slot1:getConfig(&quot;resource_type&quot;)
	}):getIcon(), &quot;&quot;, function (slot0)
		uv0.resIconTF.sprite = slot0
	end)
	setText(slot0.countTF, slot1:getConfig(&quot;resource_num&quot;))
	setScrollText(slot0.nameTxt, slot8:getName() or &quot;??&quot;)

	if slot1:getConfig(&quot;num_limit&quot;) == 0 then
		setText(slot0.limitCountLabelTF, i18n(&quot;common_no_limit&quot;))
	else
		setText(slot0.limitCountLabelTF, i18n(&quot;activity_shop_exchange_count&quot;) .. math.max(slot1:GetPurchasableCnt(), 0) .. &quot;/&quot; .. slot10)
	end

	setActive(slot0.limitCountLabelTF, true)
end

slot0.updateSelectable = function(slot0, slot1, slot2, slot3, slot4)
	slot0.goodsVO = slot1

	updateDrop(slot0.itemTF, Drop.New({
		count = 1,
		type = DROP_TYPE_ITEM,
		id = slot1:getConfig(&quot;commodity_id_list_show&quot;)
	}))
	setActive(slot0.mask, false)
	setActive(slot0.selloutTag, false)

	if slot0.limitPassTag then
		setActive(slot0.limitPassTag, false)
	end

	removeOnButton(slot0.mask)
	GetSpriteFromAtlasAsync(Drop.New({
		type = slot1:getConfig(&quot;resource_category&quot;),
		id = slot1:getConfig(&quot;resource_type&quot;)
	}):getIcon(), &quot;&quot;, function (slot0)
		uv0.resIconTF.sprite = slot0
	end)
	setText(slot0.countTF, slot1:getConfig(&quot;resource_num&quot;))
	setScrollText(slot0.nameTxt, slot5:getName() or &quot;??&quot;)

	if slot1:getConfig(&quot;num_limit&quot;) == 0 then
		setText(slot0.limitCountLabelTF, i18n(&quot;common_no_limit&quot;))
	else
		setText(slot0.limitCountLabelTF, i18n(&quot;activity_shop_exchange_count&quot;) .. math.max(slot1:GetPurchasableCnt(), 0) .. &quot;/&quot; .. slot7)
	end
end

slot0.setAsLastSibling = function(slot0)
	slot0.tf:SetAsLastSibling()
end

slot0.StaticUpdate = function(slot0, slot1, slot2, slot3)
	slot4 = tf(slot0)

	setActive(findTF(slot4, &quot;discount&quot;), false)

	slot12 = findTF(slot4, &quot;count_contain/label&quot;):GetComponent(typeof(Text))
	slot13, slot14 = slot1:canPurchase()

	setActive(slot4:Find(&quot;mask&quot;), not slot13)
	setActive(slot4:Find(&quot;mask/tag/sellout_tag&quot;), not slot13)

	slot15 = Drop.New({
		type = slot1:getConfig(&quot;commodity_type&quot;),
		id = slot1:getConfig(&quot;commodity_id&quot;),
		count = slot1:getConfig(&quot;num&quot;)
	})

	updateDrop(findTF(slot4, &quot;itemBg/item&quot;), slot15)

	findTF(slot4, &quot;consume/contain/Text&quot;):GetComponent(typeof(Text)).text = slot1:getConfig(&quot;resource_num&quot;)

	setScrollText(findTF(slot4, &quot;name_mask/name&quot;), slot15:getConfig(&quot;name&quot;) or &quot;??&quot;)
	GetImageSpriteFromAtlasAsync(Drop.New({
		type = slot1:getConfig(&quot;resource_category&quot;),
		id = slot1:getConfig(&quot;resource_type&quot;)
	}):getIcon(), &quot;&quot;, findTF(slot4, &quot;consume/contain/icon&quot;):GetComponent(typeof(Image)))

	if slot1:getConfig(&quot;num_limit&quot;) == 0 then
		setText(slot12, i18n(&quot;common_no_limit&quot;))
	else
		slot18 = slot1:getConfig(&quot;num_limit&quot;)

		if slot15.type == DROP_TYPE_SKIN and not slot13 then
			setText(slot12, i18n(&quot;activity_shop_exchange_count&quot;) .. &quot;0/&quot; .. slot18)
		else
			setText(slot12, i18n(&quot;activity_shop_exchange_count&quot;) .. slot18 - slot1.buyCount .. &quot;/&quot; .. slot18)
		end
	end

	if slot1:getConfig(&quot;num_limit&quot;) &gt;= 99 then
		setText(slot12, i18n(&quot;shop_label_unlimt_cnt&quot;))
	end
end

slot0.OnDispose = function(slot0)
	slot0.goodsVO = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>