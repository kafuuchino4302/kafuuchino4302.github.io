<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>worldgoodscard.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>worldgoodscard.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;WorldGoodsCard&quot;, import(&quot;.BaseOldGoodsCard&quot;))

slot0.Ctor = function(slot0, slot1)
	uv0.super.Ctor(slot0, slot1)

	slot0.go = slot1
	slot0.tr = tf(slot1)
	slot2 = slot0.tr
	slot0.mask = slot2:Find(&quot;mask&quot;)
	slot2 = slot0.tr
	slot0.selloutTag = slot2:Find(&quot;mask/tag/sellout_tag&quot;)

	setText(slot0.selloutTag, i18n(&quot;common_sale_out&quot;))

	slot2 = slot0.tr
	slot0.levelTag = slot2:Find(&quot;mask/tag/level_tag&quot;)

	setText(slot0.levelTag, i18n(&quot;shop_charge_level_limit&quot;))

	slot2 = slot0.tr
	slot0.levelTagText = slot2:Find(&quot;mask/tag/level_tag/Text&quot;)
	slot2 = slot0.tr
	slot0.stars = slot2:Find(&quot;item/icon_bg/stars&quot;)
	slot0.itemTF = findTF(slot0.tr, &quot;item&quot;)
	slot0.nameTxt = findTF(slot0.tr, &quot;item/name_mask/name&quot;)
	slot0.discountTF = findTF(slot0.tr, &quot;item/discount&quot;)
	slot2 = findTF(slot0.discountTF, &quot;Text&quot;)
	slot0.discountTextTF = slot2:GetComponent(typeof(Text))
	slot2 = findTF(slot0.tr, &quot;item/consume/contain/Text&quot;)
	slot0.countTF = slot2:GetComponent(typeof(Text))
	slot2 = findTF(slot0.tr, &quot;item/consume/contain/icon&quot;)
	slot0.resIconTF = slot2:GetComponent(typeof(Image))
	slot2 = slot0.itemTF
	slot2 = slot2:Find(&quot;icon_bg/icon&quot;)
	slot0.itemIconTF = slot2:GetComponent(typeof(Image))
	slot2 = slot0.itemTF
	slot2 = slot2:Find(&quot;icon_bg/count&quot;)
	slot0.itemCountTF = slot2:GetComponent(typeof(Text))
	slot0.maskTip = i18n(&quot;buy_countLimit&quot;)

	onButton(slot0, slot0.mask, function ()
		pg.TipsMgr.GetInstance():ShowTips(uv0.maskTip)
	end, SFX_PANEL)
end

slot0.setGroupMask = function(slot0, slot1)
	slot3 = slot0.goodsVO:getConfig(&quot;group_limit&quot;) &gt; 0 and slot2 &lt;= slot1

	if isActive(slot0.mask) then
		return
	end

	setActive(slot0.mask, slot3)

	if slot2 &gt; 0 and slot2 &lt;= slot1 then
		setActive(slot0.selloutTag, true)
		setActive(slot0.levelTag, false)
	end
end

slot0.setLevelMask = function(slot0, slot1)
	slot2 = slot0.goodsVO:getLevelLimit(slot1)
	slot3 = slot0.goodsVO:isLevelLimit(slot1)

	if isActive(slot0.mask) then
		return
	end

	setActive(slot0.mask, slot3)

	if slot3 then
		setText(slot0.levelTagText, tostring(slot2))
		setActive(slot0.levelTag, true)
		setActive(slot0.selloutTag, false)

		slot0.maskTip = i18n(&quot;charge_level_limit&quot;)
	end
end

slot0.update = function(slot0, slot1)
	slot0.goodsVO = slot1
	slot2 = slot0.goodsVO:canPurchase()

	setActive(slot0.mask, not slot2)
	setActive(slot0.selloutTag, not slot2)
	setActive(slot0.stars, false)

	slot3 = slot1:getDropInfo()

	updateDrop(slot0.itemTF, slot3)
	setText(slot0.nameTxt, shortenString(slot3:getConfig(&quot;name&quot;) or &quot;&quot;, 6))

	slot5 = &quot;&quot;
	slot6 = slot1:getConfig(&quot;resource_num&quot;)

	if slot1:getConfig(&quot;genre&quot;) == ShopArgs.ShoppingStreetLimit then
		slot5 = 100 - slot1.discount .. &quot;%OFF&quot;
		slot6 = slot6 * slot1.discount / 100
	end

	setActive(slot0.discountTF, false)

	slot0.discountTF = slot1.activityDiscount and findTF(slot0.tr, &quot;item/discount_activity&quot;) or findTF(slot0.tr, &quot;item/discount&quot;)
	slot0.discountTextTF = findTF(slot0.discountTF, &quot;Text&quot;):GetComponent(typeof(Text))

	setActive(slot0.discountTF, slot1:hasDiscount())

	slot0.discountTextTF.text = slot5
	slot0.countTF.text = math.ceil(slot6)

	GetImageSpriteFromAtlasAsync(Drop.New({
		type = DROP_TYPE_RESOURCE,
		id = slot1:getConfig(&quot;resource_type&quot;)
	}):getIcon(), &quot;&quot;, tf(slot0.resIconTF))
end

slot0.OnDispose = function(slot0)
	slot0.goodsVO = nil
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>