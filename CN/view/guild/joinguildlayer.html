<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>joinguildlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>joinguildlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;JoinGuildLayer&quot;, import(&quot;..base.BaseUI&quot;))
slot2 = i18n(&quot;guild_search_list_max_count&quot;, 30)

slot0.getUIName = function(slot0)
	return &quot;JoinGuildUI&quot;
end

slot0.setGuildVOs = function(slot0, slot1)
	slot0.guildVOs = slot1
end

slot0.setPlayerVO = function(slot0, slot1)
	slot0.playerVO = slot1
end

slot0.init = function(slot0)
	slot0.guildViewRect = slot0:findTF(&quot;add_panel/view&quot;)
	slot0.refreshBtn = slot0:findTF(&quot;add_panel/center/refresh&quot;)
	slot0.searchBtn = slot0:findTF(&quot;add_panel/center/search&quot;)
	slot1 = slot0:findTF(&quot;add_panel/center/search_bar&quot;)
	slot0.searchBar = slot1:GetComponent(typeof(InputField))
	slot0.backBtn = slot0:findTF(&quot;blur_panel/adapt/top/back&quot;)
	slot0.sortBtn = slot0:findTF(&quot;add_panel/center/sort_button&quot;)
	slot0.sortBtnContainer = slot0:findTF(&quot;add_panel/sort_panel/mask/content&quot;)
	slot0.sortBtnTpl = slot0:getTpl(&quot;add_panel/sort_panel/mask/content/tpl&quot;)
	slot0.sortPanel = slot0:findTF(&quot;add_panel/sort_panel&quot;)
	slot0.applyRedPage = GuildApplyRedPage.New(slot0._tf, slot0.event)
	slot0.applyBluePage = GuildApplyBluePage.New(slot0._tf, slot0.event)
	slot0.listEmptyTF = slot0:findTF(&quot;empty&quot;)

	setActive(slot0.listEmptyTF, false)

	slot0.listEmptyTxt = slot0:findTF(&quot;Text&quot;, slot0.listEmptyTF)

	setText(slot0.listEmptyTxt, i18n(&quot;list_empty_tip_joinguildui&quot;))
	setText(slot0:findTF(&quot;tip&quot;), uv0)

	slot1 = slot0.guildViewRect
	slot0.viewRect = slot1:GetComponent(&quot;LScrollRect&quot;)

	slot0.viewRect.onInitItem = function(slot0)
		uv0:onInitItem(slot0)
	end

	slot0.viewRect.onUpdateItem = function(slot0, slot1)
		uv0:onUpdateItem(slot0, slot1)
	end

	slot0.items = {}
end

slot0.didEnter = function(slot0)
	onButton(slot0, slot0.refreshBtn, function ()
		uv0:emit(JoinGuildMediator.REFRESH)
	end, SFX_PANEL)
	onButton(slot0, slot0.backBtn, function ()
		uv0:emit(uv1.ON_CLOSE)
	end, SOUND_BACK)
	onButton(slot0, slot0.searchBtn, function ()
		uv0:emit(JoinGuildMediator.SEARCH, uv0.searchBar.text)
	end, SFX_PANEL)
	onButton(slot0, slot0.sortBtn, function ()
		if go(uv0.sortPanel).activeSelf then
			uv0:closeSortPanel()
		else
			uv0:openSortPanel()
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.sortPanel, function ()
		uv0:closeSortPanel()
	end, SFX_PANEL)
end

slot0.openSortPanel = function(slot0)
	slot0.isOpenSortPanel = true

	setActive(slot0.sortPanel, true)

	if not slot0.isInitSort then
		slot0.isInitSort = true

		slot0:initSort()
	end
end

slot3 = {
	{
		&quot;index_all&quot;
	},
	{
		&quot;index_blhx&quot;,
		{
			&quot;faction&quot;,
			GuildConst.FACTION_TYPE_BLHX
		}
	},
	{
		&quot;index_cszz&quot;,
		{
			&quot;faction&quot;,
			GuildConst.FACTION_TYPE_CSZZ
		}
	},
	{
		&quot;index_power&quot;,
		{
			&quot;policy&quot;,
			GuildConst.POLICY_TYPE_POWER
		}
	},
	{
		&quot;index_relax&quot;,
		{
			&quot;policy&quot;,
			GuildConst.POLICY_TYPE_RELAXATION
		}
	}
}
slot4 = {}

slot0.initSort = function(slot0)
	for slot4, slot5 in ipairs(uv0) do
		slot6 = cloneTplTo(slot0.sortBtnTpl, slot0.sortBtnContainer)

		setImageSprite(slot6:Find(&quot;Image&quot;), GetSpriteFromAtlas(&quot;ui/joinguildui_atlas&quot;, slot5[1]), true)
		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				uv0:filter(uv1)
				setActive(uv0.sortPanel, false)
			end
		end)
	end

	for slot4, slot5 in ipairs(uv1) do
		slot6 = cloneTplTo(slot0.sortBtnTpl, slot0.sortBtnContainer)

		setText(slot6:Find(&quot;Text&quot;), slot5[2])
		onToggle(slot0, slot6, function (slot0)
			if slot0 then
				uv0:sortGuilds(uv1[1])
			end
		end)
	end
end

slot0.closeSortPanel = function(slot0)
	slot0.isOpenSortPanel = nil

	setActive(slot0.sortPanel, false)
end

slot0.onInitItem = function(slot0, slot1)
	slot0.items[slot1] = GuildApplyCard.New(slot1)

	onButton(slot0, slot0.items[slot1].applyBtn, function ()
		if uv0.playerVO:inGuildCDTime() then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;guild_leave_cd_time&quot;))

			return
		end

		uv0:showApply(uv0.items[uv1].guildVO)
	end, SFX_PANEL)
end

slot0.onUpdateItem = function(slot0, slot1, slot2)
	if not slot0.items[slot2] then
		slot0:onInitItem(slot2)

		slot3 = slot0.items[slot2]
	end

	slot3:Update(slot0.sortVOs[slot1 + 1])
end

slot0.sortGuilds = function(slot0, slot1)
	slot0.sortVOs = slot0.guildVOs or {}

	table.sort(slot0.sortVOs, function (slot0, slot1)
		if not uv0 then
			return slot0.id &lt; slot1.id
		elseif slot0[uv0] == slot1[uv0] then
			return slot0.id &lt; slot1.id
		else
			return slot1[uv0] &lt; slot0[uv0]
		end
	end)
	slot0.viewRect:SetTotalCount(#slot0.sortVOs, 0)
	setActive(slot0.listEmptyTF, #slot0.sortVOs &lt;= 0)
end

slot0.filter = function(slot0, slot1)
	slot0.sortVOs = {}

	if not slot1 and not slot0.contextData.filterData or #slot2 &lt; 2 then
		slot0.sortVOs = slot0.guildVOs or {}

		setImageSprite(slot0:findTF(&quot;Image&quot;, slot0.sortBtn), GetSpriteFromAtlas(&quot;ui/joinguildui_atlas&quot;, &quot;index_all&quot;), true)
	else
		for slot6, slot7 in ipairs(slot0.guildVOs) do
			if slot7[slot2[2][1]] == slot2[2][2] then
				table.insert(slot0.sortVOs, slot7)
			end
		end

		setImageSprite(slot0:findTF(&quot;Image&quot;, slot0.sortBtn), GetSpriteFromAtlas(&quot;ui/joinguildui_atlas&quot;, slot2[1]), true)
	end

	slot3 = _.all(slot0.sortVOs, function (slot0)
		return slot0:getFaction() == GuildConst.FACTION_TYPE_CSZZ
	end)
	slot4 = _.all(slot0.sortVOs, function (slot0)
		return slot0:getFaction() == GuildConst.FACTION_TYPE_BLHX
	end)
	slot0.contextData.filterData = slot2

	slot0.viewRect:SetTotalCount(#slot0.sortVOs, 0)
	setActive(slot0.listEmptyTF, #slot0.sortVOs &lt;= 0)
end

slot0.showApply = function(slot0, slot1)
	if slot1:getFaction() == GuildConst.FACTION_TYPE_BLHX then
		slot0.page = slot0.applyBluePage
	elseif slot2 == GuildConst.FACTION_TYPE_CSZZ then
		slot0.page = slot0.applyRedPage
	end

	slot0.page:ExecuteAction(&quot;Show&quot;, slot1)
end

slot0.CloseApply = function(slot0)
	if slot0.page and slot0.page:GetLoaded() and slot0.page:isShowing() then
		slot0.page:Hide()
	end
end

slot0.onBackPressed = function(slot0)
	if slot0.isOpenSortPanel then
		slot0:closeSortPanel()
	elseif slot0.page and slot0.page:GetLoaded() and slot0.page:isShowing() then
		slot0.page:Hide()
	else
		pg.CriMgr.GetInstance():PlaySoundEffect_V3(SFX_CANCEL)
		slot0:emit(uv0.ON_CLOSE)
	end
end

slot0.willExit = function(slot0)
	slot0.applyBluePage:Destroy()
	slot0.applyRedPage:Destroy()
	PoolMgr.GetInstance():DestroySprite(&quot;ui/JoinGuildUI_atlas&quot;)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>