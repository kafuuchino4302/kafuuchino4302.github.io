<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guildrankpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>guildrankpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;GuildRankPage&quot;, import(&quot;...base.GuildBasePage&quot;))

slot0.getTargetUI = function(slot0)
	return &quot;GuildRankBluePage&quot;, &quot;GuildRankRedPage&quot;
end

slot1 = {
	&quot;commit&quot;,
	&quot;task&quot;,
	&quot;battle&quot;
}
slot2 = {
	i18n(&quot;guild_member_rank_title_donate&quot;),
	i18n(&quot;guild_member_rank_title_finish_cnt&quot;),
	i18n(&quot;guild_member_rank_title_join_cnt&quot;)
}

slot0.PageId2RankLabel = function(slot0)
	return uv0[slot0]
end

slot0.GetRank = function(slot0, slot1)
	return slot0.ranks[slot1]
end

slot0.OnUpdateRankList = function(slot0, slot1, slot2)
	if slot2 and table.getCount(slot2) &gt; 0 then
		slot0.ranks[slot1] = slot2

		if slot0.pageId == slot1 then
			slot0:SwitchPage(slot1)
		end
	end
end

slot0.OnLoaded = function(slot0)
	slot0.tabContainer = slot0:findTF(&quot;frame/bg/tab&quot;)
	slot0.ranTypeTF = slot0:findTF(&quot;frame/bg/week&quot;)
	slot0.closeBtn = slot0:findTF(&quot;frame/close&quot;)
	slot0.rankLabel = slot0:findTF(&quot;frame/bg/title/Text&quot;):GetComponent(typeof(Text))
	slot0.scrollrect = slot0:findTF(&quot;frame/bg/scrollrect&quot;):GetComponent(&quot;LScrollRect&quot;)

	slot0.scrollrect.onUpdateItem = function(slot0, slot1)
		uv0:OnUpdateItem(slot0, slot1)
	end

	setActive(slot0.ranTypeTF:Find(&quot;month&quot;), true)
	setActive(slot0.ranTypeTF:Find(&quot;total&quot;), true)
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)

	slot0.ranType = 0

	onButton(slot0, slot0.ranTypeTF, function ()
		uv0.ranType = (uv0.ranType + 1) % 3

		uv1()
	end, SFX_PANEL)
	slot0:InitTags()
	(function ()
		if uv0.pageId then
			uv0:SwitchPage(uv0.pageId)
		end

		uv0.ranTypeTF:Find(&quot;month&quot;):GetComponent(typeof(Image)).enabled = uv0.ranType == 0
		uv0.ranTypeTF:Find(&quot;total&quot;):GetComponent(typeof(Image)).enabled = uv0.ranType == 2
		uv0.ranTypeTF:GetComponent(typeof(Image)).enabled = uv0.ranType == 1
	end)()
end

slot0.InitTags = function(slot0)
	for slot4, slot5 in ipairs(uv0) do
		slot6 = slot0.tabContainer

		onToggle(slot0, slot6:Find(slot5), function (slot0)
			if slot0 then
				uv0:SwitchPage(uv1)
			end
		end, SFX_PANEL)
	end
end

slot0.Flush = function(slot0, slot1)
	slot0.ranks = slot1

	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0:Show()
	slot0._tf:SetAsLastSibling()
	triggerToggle(slot0.tabContainer:Find(&quot;commit&quot;), true)
end

slot0.SwitchPage = function(slot0, slot1)
	slot0.pageId = slot1

	slot0.scrollrect:SetTotalCount(0)

	if not slot0:GetRank(slot1) or getProxy(GuildProxy):ShouldRefreshRank(slot1) then
		slot0:emit(GuildMemberMediator.GET_RANK, slot1)
	else
		assert(slot2)
		slot0:InitRank(slot2)
	end

	slot0.rankLabel.text = uv0.PageId2RankLabel(slot1)
end

slot0.InitRank = function(slot0, slot1)
	slot0.displays = {}

	for slot5, slot6 in pairs(slot1) do
		table.insert(slot0.displays, slot6)
	end

	table.sort(slot0.displays, function (slot0, slot1)
		return slot1:GetScore(uv0.ranType) &lt; slot0:GetScore(uv0.ranType)
	end)
	slot0.scrollrect:SetTotalCount(#slot0.displays)
end

slot0.OnUpdateItem = function(slot0, slot1, slot2)
	slot3 = slot0.displays[slot1 + 1]

	setText(tf(slot2):Find(&quot;number&quot;), slot1 + 1)
	setText(tf(slot2):Find(&quot;name&quot;), slot3:GetName())
	setText(tf(slot2):Find(&quot;score&quot;), slot3:GetScore(slot0.ranType))
end

slot0.Hide = function(slot0)
	if slot0:isShowing() then
		pg.UIMgr.GetInstance():UnblurPanel(slot0._tf, slot0._parentTf)
	end

	uv0.super.Hide(slot0)
end

slot0.OnDestroy = function(slot0)
	slot0:Hide()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>