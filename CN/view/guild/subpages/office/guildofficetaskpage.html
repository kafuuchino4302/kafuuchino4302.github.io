<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guildofficetaskpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>guildofficetaskpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;GuildOfficeTaskPage&quot;, import(&quot;...base.GuildBasePage&quot;))

slot0.getTargetUI = function(slot0)
	return &quot;GuildOfficeTaskBluePage&quot;, &quot;GuildOfficeTaskRedPage&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.selectTaskPage = GuildOfficeSelectTaskPage.New(slot0._tf.parent, slot0.event)
	slot0.taskTF = slot0:findTF(&quot;TaskPanel&quot;)
	slot0.taskUnOpenTF = slot0:findTF(&quot;TaskPanel/unopen&quot;)
	slot0.unOpenAdmin = slot0.taskUnOpenTF:Find(&quot;select&quot;)
	slot0.unOpenUnAdmin = slot0.taskUnOpenTF:Find(&quot;lock&quot;)
	slot0.taskOpenTF = slot0:findTF(&quot;TaskPanel/open&quot;)
	slot0.taskDescTxt = slot0:findTF(&quot;top/desc/Text&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.taskAwardTxt = slot0:findTF(&quot;top/desc1/Text&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.taskProgressTxt = slot0:findTF(&quot;top/progress&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.taskProgressBar = slot0:findTF(&quot;top/progress_bar&quot;, slot0.taskOpenTF)
	slot0.privateTaskDesc = slot0:findTF(&quot;bottom/desc&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.privateTaskGetBtn = slot0:findTF(&quot;bottom/get&quot;, slot0.taskOpenTF)
	slot0.privateTaskAcceptBtn = slot0:findTF(&quot;bottom/accept&quot;, slot0.taskOpenTF)
	slot0.privateTaskProgressTxt = slot0:findTF(&quot;bottom/progress/Text&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.privateTaskReapeatFlag = slot0:findTF(&quot;bottom/reapeat&quot;, slot0.taskOpenTF)
	slot0.privateTaskResTxt = slot0:findTF(&quot;bottom/res/Text&quot;, slot0.taskOpenTF):GetComponent(typeof(Text))
	slot0.taskMaskAll = slot0:findTF(&quot;TaskPanel/open/mask_all&quot;)
	slot0.taskMaskTop = slot0:findTF(&quot;TaskPanel/open/mask_top&quot;)
	slot0.contributionList = UIItemList.New(slot0:findTF(&quot;TaskPanel/SubmitPanel/list&quot;), slot0:findTF(&quot;TaskPanel/SubmitPanel/list/tpl&quot;))
	slot0.contributionCntTxt = slot0:findTF(&quot;TaskPanel/SubmitPanel/cnt/Text&quot;):GetComponent(typeof(Text))
	slot0.supplyFrame = slot0:findTF(&quot;TaskPanel/SupplyPanel/frame&quot;)
	slot0.supplyOpenTF = slot0:findTF(&quot;TaskPanel/SupplyPanel/frame/open&quot;)
	slot0.supplyOpenTimeTxt = slot0:findTF(&quot;time&quot;, slot0.supplyOpenTF):GetComponent(typeof(Text))
	slot0.supplyOpenLetfCntTxt = slot0:findTF(&quot;Text&quot;, slot0.supplyOpenTF):GetComponent(typeof(Text))
	slot0.supplyOpenGetBtn = slot0:findTF(&quot;get&quot;, slot0.supplyOpenTF)
	slot0.supplyOpenGotBtn = slot0:findTF(&quot;got&quot;, slot0.supplyOpenTF)
	slot0.supplyUnOpenTF = slot0:findTF(&quot;TaskPanel/SupplyPanel/frame/unopen&quot;)
	slot0.supplyUnOpenAdminTF = slot0:findTF(&quot;purchase&quot;, slot0.supplyUnOpenTF)
	slot0.supplyUnOpenResTF = slot0.supplyUnOpenAdminTF:Find(&quot;Text&quot;):GetComponent(typeof(Text))
	slot0.supplyUnOpenLockTF = slot0:findTF(&quot;lock&quot;, slot0.supplyUnOpenTF)
end

slot0.OnInit = function(slot0)
	slot1 = pg.UIMgr.GetInstance()

	slot1:OverlayPanelPB(slot0.taskTF, {
		pbList = {
			slot0.taskTF
		},
		overlayType = LayerWeightConst.OVERLAY_UI_ADAPT
	})
	onButton(slot0, slot0.supplyUnOpenAdminTF, function ()
		pg.MsgboxMgr:GetInstance():ShowMsgBox({
			content = i18n(&quot;guild_start_supply_consume_tip&quot;, uv0.guild:getSupplyConsume()),
			onYes = function ()
				uv0:emit(GuildOfficeMediator.ON_PURCHASE_SUPPLY)
			end
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.supplyOpenGetBtn, function ()
		uv0:emit(GuildOfficeMediator.GET_SUPPLY_AWARD)
	end, SFX_PANEL)
	onButton(slot0, slot0.supplyFrame, function ()
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			type = MSGBOX_TYPE_HELP,
			helps = pg.gametip.guild_supply_help_tip.tip
		})
	end, SFX_PANEL)
end

slot0.Update = function(slot0, slot1, slot2)
	slot0:OnUpdateGuild(slot1, slot2)
	slot0:UpdateTaskPanel(false)
	slot0:UpdateContributionPanel()
	slot0:UpdateSupplyPanel()
	slot0:Show()
end

slot0.OnUpdateGuild = function(slot0, slot1, slot2)
	slot0.guild = slot1
	slot0.isAdmin = slot2
end

slot0.OnUpdateContribution = function(slot0)
	slot0:UpdateContributionPanel()
end

slot0.OnUpdateTask = function(slot0, slot1)
	slot0:UpdateTaskPanel(slot1)
end

slot0.OnUpdateSupplyPanel = function(slot0)
	slot0:UpdateSupplyPanel()
end

slot0.UpdateTaskPanel = function(slot0, slot1)
	if slot0.guild:getWeeklyTask():getState() == GuildTask.STATE_EMPTY then
		slot0:UpdateLockTask()
	elseif slot4 == GuildTask.STATE_ONGOING or slot4 == GuildTask.STATE_FINISHED then
		slot0:UpdatePubliceTask(slot3)
		slot0:UpdatePrivateTask(slot3)
	end

	setActive(slot0.taskOpenTF, slot4 ~= GuildTask.STATE_EMPTY)
	setActive(slot0.taskUnOpenTF, slot4 == GuildTask.STATE_EMPTY)

	if slot1 or slot2:shouldRefreshWeeklyTaskProgress() then
		slot0:emit(GuildOfficeMediator.UPDATE_WEEKLY_TASK)
	end
end

slot0.UpdateLockTask = function(slot0)
	setActive(slot0.unOpenAdmin, slot0.isAdmin)
	setActive(slot0.unOpenUnAdmin, not slot0.isAdmin)

	if slot0.isAdmin then
		onButton(slot0, slot0.unOpenAdmin, function ()
			uv0.selectTaskPage:ExecuteAction(&quot;Show&quot;, uv0.guild, uv0.isAdmin)
		end, SFX_PANEL)
	end
end

slot0.UpdatePrivateTask = function(slot0, slot1)
	slot2 = not slot0.guild:hasWeeklyTaskFlag()

	if not ((getProxy(TaskProxy):getTaskById(slot1:GetPresonTaskId()) or slot4:getFinishTaskById(slot3)) ~= nil) then
		slot5 = Task.New({
			id = slot3
		})
	end

	slot0.privateTaskDesc.text = slot5:getConfig(&quot;desc&quot;)
	slot0.privateTaskProgressTxt.text = slot5.progress .. &quot;/&quot; .. slot5:getConfig(&quot;target_num&quot;)
	slot0.privateTaskResTxt.text = slot1:GetPrivateAward()

	onButton(slot0, slot0.privateTaskAcceptBtn, function ()
		pg.MsgboxMgr:GetInstance():ShowMsgBox({
			content = i18n(&quot;guild_task_accept&quot;, uv0:getConfig(&quot;name&quot;), uv1:getConfig(&quot;name&quot;), uv1:getConfig(&quot;name&quot;)),
			onYes = function ()
				uv0:emit(GuildOfficeMediator.ON_ACCEPT_TASK, uv1)
			end
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.privateTaskGetBtn, function ()
		uv0:emit(GuildOfficeMediator.ON_SUBMIT_TASK, uv1)
	end, SFX_PANEL)

	if slot5:isFinish() and not slot5:isReceive() and not slot2 then
		slot0:emit(GuildOfficeMediator.ON_SUBMIT_TASK, slot3)
	elseif not slot6 and slot2 then
		slot0:emit(GuildOfficeMediator.ON_ACCEPT_TASK, slot3)
	end

	slot7 = not slot2
	slot8 = slot1:isFinished() and (not slot6 or not slot2)

	setActive(slot0.taskMaskAll, slot8)
	setActive(slot0.taskMaskTop, not slot8 and slot1:isFinished())
	setActive(slot0.privateTaskReapeatFlag, slot7)
	setActive(slot0.privateTaskResTxt.gameObject.transform.parent, not slot7)
	setActive(slot0.privateTaskAcceptBtn, not slot6 or slot5:isReceive())
	setActive(slot0.privateTaskGetBtn, slot6 and slot5:isFinish() and not slot5:isReceive())
	setActive(slot0.privateTaskProgressTxt.gameObject.transform.parent, slot6 and not slot5:isFinish())
end

slot0.UpdatePubliceTask = function(slot0, slot1)
	slot2 = slot1:getProgress()
	slot3 = slot1:getMaxProgress()
	slot0.taskProgressTxt.text = slot2 .. &quot;/&lt;size=40&gt;&quot; .. slot3 .. &quot;&lt;/size&gt;&quot;

	setFillAmount(slot0.taskProgressBar, slot2 / slot3)

	slot0.taskDescTxt.text = slot2
	slot0.taskAwardTxt.text = slot1:GetCurrCaptailAward()
end

slot0.UpdateContributionPanel = function(slot0)
	slot1 = slot0.guild

	slot0.contributionList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot4 = GuildDonateCard.New(slot2)

			slot4:update(uv0[slot1 + 1])
			onButton(uv1, slot4.commitBtn, function ()
				slot0 = uv0:getCommitItem()

				pg.MsgboxMgr:GetInstance():ShowMsgBox({
					content = i18n(&quot;guild_donate_tip&quot;, Drop.New({
						type = slot0[1],
						id = slot0[2],
						count = slot0[3]
					}):getConfig(&quot;name&quot;), slot0[3], slot2, uv1:GetResCntByAward(slot0) &lt; slot0[3] and &quot;#FF5C5CFF&quot; or &quot;#92FC63FF&quot;),
					onYes = function ()
						uv0:emit(GuildOfficeMediator.ON_COMMIT, uv1.id)
					end
				})
			end, SFX_PANEL)
			setButtonEnabled(slot4.commitBtn, uv2 &gt; 0)
		end
	end)
	slot0.contributionList:align(#slot1:getDonateTasks())

	slot0.contributionCntTxt.text = i18n(&quot;guild_left_donate_cnt&quot;, slot1:getRemainDonateCnt() + slot1:GetExtraDonateCnt())
end

slot0.UpdateSupplyPanel = function(slot0)
	slot2 = slot0.guild:isOpenedSupply()

	setActive(slot0.supplyOpenTF, slot2)
	setActive(slot0.supplyUnOpenTF, not slot2)

	if not slot2 then
		setActive(slot0.supplyUnOpenAdminTF, slot0.isAdmin)
		setActive(slot0.supplyUnOpenLockTF, not slot0.isAdmin)

		if slot0.isAdmin then
			slot0.supplyUnOpenResTF.text = slot1:getSupplyConsume()
		end
	else
		setActive(slot0.supplyOpenGetBtn, slot1:getSupplyCnt() &gt; 0)
		setActive(slot0.supplyOpenGotBtn, slot3 &lt;= 0)

		if slot1:getSupplyLeftCnt() &lt; 0 then
			slot0.supplyOpenTimeTxt.text = i18n(&quot;guild_exist_unreceived_supply_award&quot;)
		else
			slot0.supplyOpenTimeTxt.text = i18n(&quot;guild_left_supply_day&quot;, slot4)
		end

		slot0.supplyOpenLetfCntTxt.text = i18n1(slot3 .. &quot;/&quot; .. GuildConst.MAX_SUPPLY_CNT)
	end
end

slot0.OnDestroy = function(slot0)
	pg.UIMgr.GetInstance():UnOverlayPanel(slot0.taskTF, slot0._tf)
	slot0.selectTaskPage:Destroy()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>