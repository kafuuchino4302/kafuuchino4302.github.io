<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guildmodifitonpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>guildmodifitonpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;GuildModiftionPage&quot;, import(&quot;...base.GuildBasePage&quot;))

slot0.getTargetUI = function(slot0)
	return &quot;GuildModiftionBluePage&quot;, &quot;GuildModiftionRedPage&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.nameInput = findTF(slot0._tf, &quot;frame/name_bg/input&quot;):GetComponent(typeof(InputField))
	slot0.factionBLHXToggle = findTF(slot0._tf, &quot;frame/policy_container/faction/blhx&quot;)
	slot0.factionCSZZToggle = findTF(slot0._tf, &quot;frame/policy_container/faction/cszz&quot;)
	slot0.policyRELAXToggle = findTF(slot0._tf, &quot;frame/policy_container/policy/relax&quot;)
	slot0.policyPOWERToggle = findTF(slot0._tf, &quot;frame/policy_container/policy/power&quot;)
	slot0.manifestoInput = findTF(slot0._tf, &quot;frame/policy_container/input_frame/input&quot;):GetComponent(typeof(InputField))
	slot0.confirmBtn = findTF(slot0._tf, &quot;frame/confirm_btn&quot;)
	slot0.cancelBtn = findTF(slot0._tf, &quot;frame/cancel_btn&quot;)
	slot0.quitBtn = findTF(slot0._tf, &quot;frame/quit_btn&quot;)
	slot0.dissolveBtn = findTF(slot0._tf, &quot;frame/dissolve_btn&quot;)
	slot0.factionMask = findTF(slot0._tf, &quot;frame/policy_container/faction/mask&quot;)
	slot0.costTF = findTF(slot0._tf, &quot;frame/confirm_btn/print_container/Text&quot;):GetComponent(typeof(Text))
end

slot0.OnInit = function(slot0)
	slot0.costTF.text = 0
	slot0.modifyBackBG = slot0:findTF(&quot;bg_decorations&quot;, slot0._tf)

	setActive(slot0._tf, false)
	onButton(slot0, slot0.cancelBtn, function ()
		uv0:Hide()
	end, SFX_CANCEL)
	onButton(slot0, slot0.dissolveBtn, function ()
		if uv0.guildVO then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;guild_tip_dissolve&quot;),
				onYes = function ()
					uv0:emit(GuildMainMediator.DISSOLVE, uv0.guildVO.id)
				end
			})
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.quitBtn, function ()
		seriesAsync({
			function (slot0)
				uv0:DealQuit(slot0)
			end
		}, function ()
			uv0:emit(GuildMainMediator.QUIT, uv0.guildVO.id)
		end)
	end, SFX_PANEL)
	onButton(slot0, slot0.modifyBackBG, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.confirmBtn, function ()
		slot0 = Clone(uv0.guildVO)
		slot2 = uv0.manifestoInput.text

		if not uv0.nameInput.text or slot1 == &quot;&quot; then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;guild_create_error_noname&quot;))

			return
		end

		if not nameValidityCheck(slot1, 0, 20, {
			&quot;spece_illegal_tip&quot;,
			&quot;login_newPlayerScene_name_tooShort&quot;,
			&quot;login_newPlayerScene_name_tooLong&quot;,
			&quot;err_name_existOtherChar&quot;
		}) then
			return
		end

		if slot1 ~= uv0.guildVO:getName() and getProxy(PlayerProxy):getData():getTotalGem() &lt; pg.gameset.modify_guild_cost.key_value then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_no_rmb&quot;))

			return
		end

		if not slot2 or slot2 == &quot;&quot; then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;guild_create_error_nomanifesto&quot;))

			return
		end

		slot0:setName(slot1)
		slot0:setPolicy(uv0.policy)
		slot0:setFaction(uv0.faction)
		slot0:setManifesto(slot2)

		slot3 = function()
			if uv0:getPolicy() ~= uv1.guildVO:getPolicy() then
				uv1:emit(GuildMainMediator.MODIFY, 3, uv0:getPolicy(), &quot;&quot;)
			end

			if uv0:getManifesto() ~= uv1.guildVO:getManifesto() then
				uv1:emit(GuildMainMediator.MODIFY, 4, 0, uv0:getManifesto())
			end

			if uv0:getName() ~= uv1.guildVO:getName() then
				uv1:emit(GuildMainMediator.MODIFY, 1, 0, uv0:getName())
			end

			uv1:Hide()
		end

		if slot0:getFaction() ~= uv0.guildVO:getFaction() then
			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				content = i18n(&quot;guild_faction_change_tip&quot;),
				onYes = function ()
					uv0()
					uv1:emit(GuildMainMediator.MODIFY, 2, uv2:getFaction(), &quot;&quot;)
				end
			})
		else
			slot3()
		end
	end, SFX_CONFIRM)

	slot1 = function(slot0)
		onInputChanged(uv0, slot0, function ()
			slot1, slot2 = wordVer(getInputText(uv0), {
				isReplace = true
			})

			if slot1 &gt; 0 then
				setInputText(uv0, slot2)
			end

			if getInputText(uv1.nameInput) ~= uv1.guildVO:getName() then
				setText(uv1.costTF, pg.gameset.modify_guild_cost.key_value)
			else
				setText(uv1.costTF, 0)
			end
		end)
	end

	slot1(slot0.nameInput)
	slot1(slot0.manifestoInput)
end

slot0.DealQuit = function(slot0, slot1)
	if not slot0.guildVO:GetActiveEvent() or slot2 and not slot2:IsParticipant() then
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			content = i18n(&quot;guild_tip_quit&quot;),
			onYes = slot1
		})
	else
		pg.MsgboxMgr.GetInstance():ShowMsgBox({
			content = i18n(&quot;guild_tip_quit_operation&quot;, string.format(&quot;&lt;color=%s&gt;%d&lt;/color&gt;/%d&quot;, slot2:GetMaxJoinCnt() - slot2:GetJoinCnt() + slot2:GetExtraJoinCnt() &lt;= 0 and COLOR_RED or COLOR_WHITE, slot5, slot4)),
			onYes = slot1
		})
	end
end

slot0.DealBattleReportAward = function(slot0, slot1)
	if #getProxy(GuildProxy):GetCanGetReports() == 0 then
		slot1()

		return
	end

	pg.MsgboxMgr.GetInstance():ShowMsgBox({
		content = i18n(&quot;guild_exist_report_award_when_exit&quot;),
		onYes = function ()
			pg.m02:sendNotification(GAME.SUBMIT_GUILD_REPORT, {
				ids = uv0,
				callback = uv1
			})
		end,
		onNo = function ()
			uv0:emit(GuildMainMediator.QUIT, uv0.guildVO.id)
		end
	})
end

slot0.Show = function(slot0, slot1, slot2)
	slot0.guildVO = slot1
	slot0.playerVO = slot2

	setActive(slot0._tf, true)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0._tf:SetAsLastSibling()

	slot0.isShowModify = true
	slot0.nameInput.text = slot0.guildVO:getName()
	slot0.manifestoInput.text = slot0.guildVO.manifesto
	slot3 = slot0.guildVO:getDutyByMemberId(slot0.playerVO.id) == GuildConst.DUTY_COMMANDER
	slot0.nameInput.interactable = slot3
	slot0.manifestoInput.interactable = slot3

	setActive(slot0.confirmBtn, slot3)
	setActive(slot0.cancelBtn, slot3)
	setActive(slot0.factionMask, slot0.guildVO:inChangefactionTime())

	if slot0.guildVO:inChangefactionTime() then
		setText(slot0:findTF(&quot;timer_container/Text&quot;, slot0.factionMask), slot0.guildVO:changeFactionLeftTime())
	end

	slot5 = slot0.guildVO
	slot0.faction = slot5:getFaction()

	onToggle(slot0, slot0.factionBLHXToggle, function (slot0)
		if slot0 then
			uv0.faction = GuildConst.FACTION_TYPE_BLHX
		end
	end, SFX_PANEL)
	onToggle(slot0, slot0.factionCSZZToggle, function (slot0)
		if slot0 then
			uv0.faction = GuildConst.FACTION_TYPE_CSZZ
		end
	end, SFX_PANEL)

	slot5 = slot0.guildVO
	slot0.policy = slot5:getPolicy()

	onToggle(slot0, slot0.policyRELAXToggle, function (slot0)
		if slot0 then
			uv0.policy = GuildConst.POLICY_TYPE_RELAXATION
		end
	end, SFX_PANEL)
	onToggle(slot0, slot0.policyPOWERToggle, function (slot0)
		if slot0 then
			uv0.policy = GuildConst.POLICY_TYPE_POWER
		end
	end, SFX_PANEL)

	if slot0.faction == GuildConst.FACTION_TYPE_BLHX then
		triggerToggle(slot0.factionBLHXToggle, true)
	elseif slot0.faction == GuildConst.FACTION_TYPE_CSZZ then
		triggerToggle(slot0.factionCSZZToggle, true)
	end

	if slot0.policy == GuildConst.POLICY_TYPE_RELAXATION then
		triggerToggle(slot0.policyRELAXToggle, true)
	elseif slot0.policy == GuildConst.POLICY_TYPE_POWER then
		triggerToggle(slot0.policyPOWERToggle, true)
	end

	slot0.policyPOWERToggle:GetComponent(typeof(Toggle)).interactable = slot3
	slot0.policyRELAXToggle:GetComponent(typeof(Toggle)).interactable = slot3
	slot0.factionCSZZToggle:GetComponent(typeof(Toggle)).interactable = slot3
	slot0.factionBLHXToggle:GetComponent(typeof(Toggle)).interactable = slot3

	setActive(slot0.quitBtn, slot0.guildVO:getDutyByMemberId(slot0.playerVO.id) ~= GuildConst.DUTY_COMMANDER)
	setActive(slot0.dissolveBtn, slot5 == GuildConst.DUTY_COMMANDER)
end

slot0.Hide = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf, slot0._parentTf)
	setActive(slot0._tf, false)
end

slot0.OnDestroy = function(slot0)
	slot0:Hide()
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>