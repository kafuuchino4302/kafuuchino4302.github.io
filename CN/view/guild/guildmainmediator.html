<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guildmainmediator.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>guildmainmediator.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;GuildMainMediator&quot;, import(&quot;..base.ContextMediator&quot;))
slot0.OPEN_MEMBER = &quot;GuildMainMediator:OPEN_MEMBER&quot;
slot0.CLOSE_MEMBER = &quot;GuildMainMediator:CLOSE_MEMBER&quot;
slot0.OPEN_APPLY = &quot;GuildMainMediator:OPEN_APPLY&quot;
slot0.CLOSE_APPLY = &quot;GuildMainMediator:CLOSE_APPLY&quot;
slot0.MODIFY = &quot;GuildMainMediator:MODIFY&quot;
slot0.DISSOLVE = &quot;GuildMainMediator:DISSOLVE&quot;
slot0.QUIT = &quot;GuildMainMediator:QUIT&quot;
slot0.ON_BACK = &quot;GuildMainMediator:ON_BACK&quot;
slot0.REBUILD_ALL = &quot;GuildMainMediator:REBUILD_ALL&quot;
slot0.ON_REBUILD_LOG_ALL = &quot;GuildMainMediator:ON_REBUILD_LOG_ALL&quot;
slot0.SEND_MSG = &quot;GuildMainMediator:SEND_MSG&quot;
slot0.OPEN_EMOJI = &quot;GuildMainMediator:OPEN_EMOJI&quot;
slot0.OPEN_OFFICE = &quot;GuildMainMediator:OPEN_OFFICE&quot;
slot0.OPEN_TECH = &quot;GuildMainMediator:OPEN_TECH&quot;
slot0.OPEN_BATTLE = &quot;GuildMainMediator:OPEN_BATTLE&quot;
slot0.CLOSE_OFFICE = &quot;GuildMainMediator:CLOSE_OFFICE&quot;
slot0.CLOSE_TECH = &quot;GuildMainMediator:CLOSE_TECH&quot;
slot0.CLOSE_BATTLE = &quot;GuildMainMediator:CLOSE_BATTLE&quot;
slot0.ON_FETCH_CAPITAL = &quot;GuildOfficeMediator:ON_FETCH_CAPITAL&quot;
slot0.ON_FETCH_CAPITAL_LOG = &quot;GuildOfficeMediator:ON_FETCH_CAPITAL_LOG&quot;
slot0.OPEN_EVENT_REPORT = &quot;GuildOfficeMediator:OPEN_EVENT_REPORT&quot;
slot0.OPEN_EVENT = &quot;GuildOfficeMediator:OPEN_EVENT&quot;
slot0.OPEN_MAIN = &quot;GuildOfficeMediator:OPEN_MAIN&quot;
slot0.SWITCH_TO_OFFICE = &quot;GuildOfficeMediator:SWITCH_TO_OFFICE&quot;
slot0.OPEN_SHOP = &quot;GuildMainMediator:OPEN_SHOP&quot;

slot0.register = function(slot0)
	if getProxy(ContextProxy):GetPrevContext(1).mediator == NewGuildMediator then
		slot1:RemoveContext(slot2)
	end

	slot3 = getProxy(GuildProxy)

	slot0.viewComponent:setGuildVO(slot3:getData())
	slot0.viewComponent:setChatMsgs(slot3:getChatMsgs())
	slot0:bind(uv0.OPEN_SHOP, function ()
		uv0:sendNotification(GAME.GO_SCENE, SCENE.SHOP, {
			warp = NewShopsScene.TYPE_GUILD
		})
	end)
	slot0:bind(uv0.OPEN_MAIN, function ()
		uv0:closePage(GuildEventReportMediator)
	end)
	slot0:bind(uv0.OPEN_EVENT, function (slot0)
		uv0.viewComponent:openPage(GuildMainScene.TOGGLE_TAG[6])
	end)
	slot0:bind(uv0.OPEN_EVENT_REPORT, function (slot0)
		uv0:sendNotification(GAME.GUILD_OPEN_EVENT_REPORT)
	end)
	slot0:bind(uv0.ON_FETCH_CAPITAL, function (slot0)
		uv0:sendNotification(GAME.GUILD_REFRESH_CAPITAL)
	end)
	slot0.viewComponent:setPlayerVO(getProxy(PlayerProxy):getData())
	slot0:bind(uv0.ON_BACK, function (slot0)
		uv0:sendNotification(GAME.GO_BACK)
	end)
	slot0:bind(uv0.REBUILD_ALL, function (slot0)
		uv0.viewComponent:UpdateAllChat(getProxy(GuildProxy):getChatMsgs())
	end)
	slot0:bind(uv0.OPEN_MEMBER, function ()
		uv0:closePage(GuildEventReportMediator)
		uv0:addSubLayers(Context.New({
			viewComponent = GuildMemberLayer,
			mediator = GuildMemberMediator
		}))
	end)
	slot0:bind(uv0.CLOSE_MEMBER, function ()
		uv0:closePage(GuildMemberMediator)
	end)
	slot0:bind(uv0.OPEN_APPLY, function ()
		uv0:closePage(GuildEventReportMediator)
		uv0:addSubLayers(Context.New({
			viewComponent = GuildRequestLayer,
			mediator = GuildRequestMediator
		}))
	end)
	slot0:bind(uv0.CLOSE_APPLY, function ()
		uv0:closePage(GuildRequestMediator)
	end)
	slot0:bind(uv0.MODIFY, function (slot0, slot1, slot2, slot3)
		uv0:sendNotification(GAME.MODIFY_GUILD_INFO, {
			type = slot1,
			int = slot2,
			string = slot3
		})
	end)
	slot0:bind(uv0.DISSOLVE, function (slot0, slot1)
		uv0:sendNotification(GAME.GUILD_DISSOLVE, slot1)
	end)
	slot0:bind(uv0.QUIT, function (slot0, slot1)
		uv0:sendNotification(GAME.GUILD_QUIT, slot1)
	end)
	slot0:bind(uv0.ON_REBUILD_LOG_ALL, function (slot0)
		uv0.viewComponent:UpdateAllLog(getProxy(GuildProxy):getData():getLogs())
	end)
	slot0:bind(uv0.SEND_MSG, function (slot0, slot1)
		uv0:sendNotification(GAME.GUILD_SEND_MSG, slot1)
	end)
	slot0:bind(uv0.OPEN_EMOJI, function (slot0, slot1, slot2)
		uv0:addSubLayers(Context.New({
			viewComponent = EmojiLayer,
			mediator = EmojiMediator,
			data = {
				pos = slot1,
				callback = slot2,
				emojiIconCallback = function (slot0)
					uv0.viewComponent:insertEmojiToInputText(slot0)
				end
			}
		}))
	end)
	slot0:bind(uv0.OPEN_OFFICE, function ()
		uv0:closePage(GuildEventReportMediator)
		uv0:addSubLayers(Context.New({
			viewComponent = GuildOfficeLayer,
			mediator = GuildOfficeMediator
		}))
	end)
	slot0:bind(uv0.CLOSE_OFFICE, function ()
		uv0:closePage(GuildOfficeMediator)
	end)
	slot0:bind(uv0.OPEN_TECH, function ()
		uv0:closePage(GuildEventReportMediator)
		uv0:addSubLayers(Context.New({
			viewComponent = GuildTechnologyLayer,
			mediator = GuildTechnologyMediator
		}))
	end)
	slot0:bind(uv0.CLOSE_TECH, function ()
		uv0:closePage(GuildTechnologyMediator)
	end)
	slot0:bind(uv0.ON_FETCH_CAPITAL_LOG, function (slot0)
		if uv0:getData():shouldRequestCapitalLog() then
			uv1:sendNotification(GAME.GUILD_FETCH_CAPITAL_LOG)
		else
			uv1.viewComponent:openResourceLog()
		end
	end)
	slot0:bind(uv0.OPEN_BATTLE, function ()
		uv0:closePage(GuildEventReportMediator)
		uv0:addSubLayers(Context.New({
			viewComponent = GuildEventLayer,
			mediator = GuildEventMediator
		}))
	end)
	slot0:bind(uv0.CLOSE_BATTLE, function ()
		uv0:closePage(GuildEventMediator)
	end)
	slot0.viewComponent:setPlayerVO(getProxy(PlayerProxy):getData())
end

slot0.closePage = function(slot0, slot1)
	if getProxy(ContextProxy):getContextByMediator(slot1) then
		slot0:sendNotification(GAME.REMOVE_LAYERS, {
			context = slot3
		})
	end
end

slot0.listNotificationInterests = function(slot0)
	return {
		GuildProxy.GUILD_UPDATED,
		GuildProxy.EXIT_GUILD,
		GAME.MODIFY_GUILD_INFO_DONE,
		GuildProxy.NEW_MSG_ADDED,
		GuildProxy.LOG_ADDED,
		GuildProxy.REQUEST_COUNT_UPDATED,
		GuildProxy.REQUEST_DELETED,
		GAME.GUILD_GET_REQUEST_LIST_DONE,
		GAME.REMOVE_LAYERS,
		PlayerProxy.UPDATED,
		GAME.GUILD_FETCH_CAPITAL_LOG_DONE,
		GAME.GUILD_COMMIT_DONATE_DONE,
		GuildProxy.ON_DELETED_MEMBER,
		GuildProxy.ON_ADDED_MEMBER,
		GAME.GUILD_OPEN_EVENT_REPORT,
		GuildProxy.BATTLE_BTN_FLAG_CHANGE,
		GAME.BEGIN_STAGE_DONE,
		GAME.SUBMIT_GUILD_REPORT_DONE,
		GuildTechnologyMediator.ON_OPEN_OFFICE,
		GAME.OPEN_MSGBOX_DONE,
		GuildProxy.TECHNOLOGY_START,
		GAME.GO_WORLD_BOSS_SCENE,
		GAME.GUILD_START_TECH_DONE,
		GuildMainMediator.SWITCH_TO_OFFICE,
		GAME.ON_GUILD_JOIN_EVENT_DONE,
		GAME.GUILD_JOIN_MISSION_DONE,
		GAME.GUILD_GET_SUPPLY_AWARD_DONE,
		GAME.LOAD_LAYERS,
		GAME.REMOVE_LAYERS
	}
end

slot0.handleNotification = function(slot0, slot1)
	slot3 = slot1:getBody()

	if slot1:getName() == GuildProxy.GUILD_UPDATED then
		slot0.viewComponent:setGuildVO(slot3)
	elseif slot2 == GuildProxy.EXIT_GUILD then
		slot0.viewComponent:emit(uv0.ON_BACK)
	elseif slot2 == GAME.MODIFY_GUILD_INFO_DONE then
		slot0.viewComponent:initTheme()
	elseif slot2 == GuildProxy.NEW_MSG_ADDED then
		slot0.viewComponent:Append(slot3, -1)
	elseif slot2 == GuildProxy.LOG_ADDED then
		slot0.viewComponent:AppendLog(slot3, true)
	elseif slot2 == GuildProxy.REQUEST_COUNT_UPDATED or slot2 == GuildProxy.REQUEST_DELETED or slot2 == GAME.GUILD_GET_REQUEST_LIST_DONE then
		slot4 = getProxy(GuildProxy)

		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_APPLY)
	elseif slot2 == GAME.GUILD_FETCH_CAPITAL_LOG_DONE then
		slot0.viewComponent:openResourceLog()
	elseif slot2 == PlayerProxy.UPDATED then
		slot0.viewComponent:setPlayerVO(slot3)
		slot0.viewComponent:UpdateRes()
	elseif slot2 == GAME.GUILD_COMMIT_DONATE_DONE or slot2 == GAME.GUILD_GET_SUPPLY_AWARD_DONE then
		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_OFFICE)
	elseif GuildProxy.ON_DELETED_MEMBER == slot2 then
		slot0.viewComponent:OnDeleteMember(slot3.member)
	elseif GuildProxy.ON_ADDED_MEMBER == slot2 then
		slot0.viewComponent:OnAddMember(slot3.member)
	elseif slot2 == GAME.GUILD_OPEN_EVENT_REPORT then
		slot0:addSubLayers(Context.New({
			viewComponent = GuildEventReportLayer,
			mediator = GuildEventReportMediator
		}))
	elseif slot2 == GAME.SUBMIT_GUILD_REPORT_DONE then
		slot0.viewComponent:emit(BaseUI.ON_ACHIEVE, slot3.awards, slot3.callback)
		slot0.viewComponent:OnReportUpdated()
		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_BATTLE)
		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_MAIN)
	elseif slot2 == GuildProxy.BATTLE_BTN_FLAG_CHANGE or slot2 == GAME.ON_GUILD_JOIN_EVENT_DONE or slot2 == GAME.GUILD_ACTIVE_EVENT_DONE or slot2 == GAME.GUILD_JOIN_MISSION_DONE then
		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_BATTLE)
	elseif slot2 == GAME.BEGIN_STAGE_DONE then
		slot0:sendNotification(GAME.GO_SCENE, SCENE.COMBATLOAD, slot3)
	elseif slot2 == GuildTechnologyMediator.ON_OPEN_OFFICE then
		triggerToggle(slot0.contextData.toggles[GuildMainScene.TOGGLE_TAG[4]], true)
	elseif slot2 == GAME.OPEN_MSGBOX_DONE then
		pg.GuildLayerMgr:GetInstance():OnShowMsgBox()
	elseif slot2 == GuildProxy.TECHNOLOGY_START then
		slot0.viewComponent:UpdateNotices(GuildMainScene.NOTIFY_TYPE_TECH)
	elseif slot2 == GAME.GUILD_START_TECH_DONE then
		slot0.viewComponent:setPlayerVO(getProxy(PlayerProxy):getData())
		slot0.viewComponent:UpdateRes()
	elseif slot2 == GAME.GO_WORLD_BOSS_SCENE then
		slot0.contextData.page = nil
	elseif slot2 == GuildMainMediator.SWITCH_TO_OFFICE then
		slot0.viewComponent:TriggerOfficePage()
	elseif slot2 == GAME.LOAD_LAYERS then
		if slot3.context.mediator == AwardInfoMediator then
			pg.GuildLayerMgr:GetInstance():UnBlurTopPanel()
		end
	elseif slot2 == GAME.REMOVE_LAYERS and slot3.context.mediator == AwardInfoMediator then
		pg.GuildLayerMgr:GetInstance():_BlurTopPanel()
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>