<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guildeventinfopage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>guildeventinfopage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;GuildEventInfoPage&quot;, import(&quot;.GuildEventBasePage&quot;))

slot0.getUIName = function(slot0)
	return &quot;GuildEventInfoPage&quot;
end

slot0.OnLoaded = function(slot0)
	slot0.closeBtn = slot0:findTF(&quot;frame/close&quot;)
	slot0.icon = slot0:findTF(&quot;frame/icon&quot;):GetComponent(typeof(Image))
	slot0.goBtn = slot0:findTF(&quot;frame/go_btn&quot;)
	slot0.joinBtn = slot0:findTF(&quot;frame/join_btn&quot;)
	slot0.descTxt = slot0:findTF(&quot;frame/desc&quot;):GetComponent(typeof(Text))
	slot0.consumeTF = slot0:findTF(&quot;frame/consume&quot;)
	slot0.consumeTxt = slot0:findTF(&quot;frame/consume/Text&quot;):GetComponent(typeof(Text))
	slot0.cntTF = slot0:findTF(&quot;frame/cnt&quot;)
	slot0.cntTxt = slot0:findTF(&quot;frame/cnt/Text&quot;):GetComponent(typeof(Text))
	slot0.nameTxt = slot0:findTF(&quot;frame/title/Text&quot;):GetComponent(typeof(Text))
	slot0.scaleTxt = slot0:findTF(&quot;frame/title/scale&quot;):GetComponent(typeof(Text))
	slot0.scaleCntTxt = slot0:findTF(&quot;frame/title/scale/Text&quot;):GetComponent(typeof(Text))
	slot0.progressTF = slot0:findTF(&quot;frame/cnt/progress&quot;)
	slot0.progressTxt = slot0:findTF(&quot;frame/cnt/progress/Text&quot;):GetComponent(typeof(Text))
	slot0.missionList = UIItemList.New(slot0:findTF(&quot;frame/events/icons&quot;), slot0:findTF(&quot;frame/events/icons/tpl&quot;))
	slot0.awardList = UIItemList.New(slot0:findTF(&quot;frame/award/displays&quot;), slot0:findTF(&quot;frame/award/displays/item&quot;))

	setText(slot0:findTF(&quot;frame/events/Text&quot;), i18n(&quot;guild_word_may_happen_event&quot;))
	setText(slot0:findTF(&quot;frame/award/Text&quot;), i18n(&quot;guild_battle_award&quot;))
	setText(slot0:findTF(&quot;frame/consume/label&quot;), i18n(&quot;guild_word_consume&quot;))
	setText(slot0:findTF(&quot;frame/cnt/label&quot;), i18n(&quot;guild_join_event_cnt_label&quot;))
	setText(slot0:findTF(&quot;frame/cnt/progress/label&quot;), i18n(&quot;guild_join_event_progress_label&quot;))
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.goBtn, function ()
		if not GuildMember.IsAdministrator(uv0.guild:getSelfDuty()) then
			pg.TipsMgr:GetInstance():ShowTips(i18n(&quot;guild_commander_and_sub_op&quot;))

			return
		end

		slot1 = uv0.gevent:GetName()
		slot2 = uv0.gevent:GetConsume()

		pg.MsgboxMgr:GetInstance():ShowMsgBox({
			content = uv0.guild:ShouldTipActiveEvent() and i18n(&quot;guild_start_event_consume_tip&quot;, slot2, slot1) or i18n(&quot;guild_start_event_consume_tip_extra&quot;, slot2, slot1, uv0.guild:GetActiveEventCnt()),
			onYes = function ()
				uv0:emit(GuildEventMediator.ON_ACTIVE_EVENT, uv0.gevent.id)
			end
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.joinBtn, function ()
		if not uv0.activeEvent then
			return
		end

		if uv0.activeEvent:IsLimitedJoin() then
			pg.TipsMgr:GetInstance():ShowTips(i18n(&quot;guild_join_event_max_cnt_tip&quot;))

			return
		end

		uv0:JoinEvent()
	end, SFX_PANEL)
end

slot0.JoinEvent = function(slot0)
	slot1 = function()
		slot0, slot1 = uv0.activeEvent:GetMainMissionCntAndFinishCnt()

		if slot1 ~= 0 then
			pg.MsgboxMgr:GetInstance():ShowMsgBox({
				content = i18n(&quot;guild_join_event_exist_finished_mission_tip&quot;),
				onYes = function ()
					uv0:emit(GuildEventMediator.ON_JOIN_EVENT)
				end
			})
		else
			uv0:emit(GuildEventMediator.ON_JOIN_EVENT)
		end
	end

	if slot0.activeEvent:GetLeftTime() &lt;= 604800 then
		pg.MsgboxMgr:GetInstance():ShowMsgBox({
			content = i18n(&quot;guild_tip_operation_time_is_not_ample&quot;),
			onYes = slot1
		})
	else
		slot1()
	end
end

slot0.Refresh = function(slot0, slot1, slot2)
	slot0:UpdateData(slot1, slot2, slot0.extraData)
	slot0:UpdateBtnState()
end

slot0.OnShow = function(slot0)
	slot0.gevent = slot0.extraData.gevent
	slot1 = slot0.gevent
	slot0.icon.sprite = GetSpriteFromAtlas(&quot;guildevent/i_&quot; .. slot1.id, &quot;&quot;)

	setActive(slot0.icon.gameObject, true)

	slot0.descTxt.text = slot1:GetDesc()
	slot0.consumeTxt.text = &quot;&lt;color=&quot; .. (slot0.guild:getCapital() &lt; slot1:GetConsume() and COLOR_RED or COLOR_GREEN) .. &quot;&gt;&quot; .. slot2 .. &quot;&lt;/color&gt;/&quot; .. slot3
	slot0.nameTxt.text = slot1:GetName()
	slot0.scaleTxt.text = slot1:GetScaleDesc()
	slot0.scaleCntTxt.text = &quot;&quot;

	slot0:UpdateMissions(slot1)
	slot0:UpdateAwards(slot1)
	slot0:UpdateBtnState()
end

slot0.UpdateBtnState = function(slot0)
	slot0.activeEvent = slot0.guild:GetActiveEvent()

	setActive(slot0.goBtn, not slot0.activeEvent)
	setActive(slot0.consumeTF, not slot0.activeEvent)
	setActive(slot0.joinBtn, slot0.activeEvent)
	setActive(slot0.cntTF, slot0.activeEvent)
	setActive(slot0.progressTF, slot0.activeEvent)

	if slot0.activeEvent then
		slot0.cntTxt.text = string.format(&quot;&lt;color=%s&gt;%d&lt;/color&gt;/%d&quot;, slot0.activeEvent:GetMaxJoinCnt() - slot0.activeEvent:GetJoinCnt() + slot0.activeEvent:GetExtraJoinCnt() &lt;= 0 and COLOR_RED or COLOR_WHITE, slot3, slot2)
		slot6, slot7 = slot0.activeEvent:GetMainMissionCntAndFinishCnt()
		slot0.progressTxt.text = slot7 .. &quot;/&quot; .. slot6 + 1
	end
end

slot0.UpdateAwards = function(slot0, slot1)
	slot0.awardList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = uv0[slot1 + 1]

			updateDrop(slot2, {
				id = slot3[2],
				type = slot3[1],
				count = slot3[3]
			})
			onButton(uv1, slot2, function ()
				uv0:emit(BaseUI.ON_DROP, uv1)
			end, SFX_PANEL)
		end
	end)
	slot0.awardList:align(#slot1:GetDisplayAward())
end

slot0.UpdateMissions = function(slot0, slot1)
	slot0.missionList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot2:GetComponent(typeof(Image)).sprite = GetSpriteFromAtlas(&quot;GuildEventIcon&quot;, uv0[slot1 + 1])
		end
	end)
	slot0.missionList:align(#slot1:GetDisplayMission())
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>