<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>playervitaedetailpage.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>playervitaedetailpage.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;PlayerVitaeDetailPage&quot;, import(&quot;...base.BaseSubView&quot;))

slot0.getUIName = function(slot0)
	return &quot;PlayerVitaeDetailPage&quot;
end

slot0.OnPlayerNameChange = function(slot0, slot1)
	slot0.player = slot1
	slot0.nameTxt.text = slot1.name
end

slot0.OnLoaded = function(slot0)
	slot0.medalTpl = slot0:findTF(&quot;medalList/tpl&quot;)
	slot0.emblemIcon = slot0:findTF(&quot;power/medal&quot;):GetComponent(typeof(Image))
	slot0.emblemTxt = slot0:findTF(&quot;power/medal_text&quot;):GetComponent(typeof(Image))
	slot0.highestEmblem = slot0:findTF(&quot;power/rank&quot;):GetComponent(typeof(Text))
	slot0.powerTxt = slot0:findTF(&quot;power/power&quot;):GetComponent(typeof(Text))
	slot0.collectionTxt = slot0:findTF(&quot;power/collection&quot;):GetComponent(typeof(Text))
	slot0.modityNameBtn = slot0:findTF(&quot;info/name&quot;)
	slot0.nameTxt = slot0:findTF(&quot;info/name/Text&quot;):GetComponent(typeof(Text))
	slot0.idTxt = slot0:findTF(&quot;info/uid&quot;):GetComponent(typeof(Text))
	slot0.levelTxt = slot0:findTF(&quot;info/level&quot;):GetComponent(typeof(Text))
	slot0.expTxt = slot0:findTF(&quot;info/exp&quot;):GetComponent(typeof(Text))
	slot0.statisticTpl = slot0:findTF(&quot;statistics/tpl&quot;)
	slot0.shareBtn = slot0:findTF(&quot;btn_share&quot;)
	slot0.attireBtn = slot0:findTF(&quot;btn_attire&quot;)
	slot1 = slot0.attireBtn
	slot0.attireBtnTip = slot1:Find(&quot;tip&quot;)
	slot0.inputField = slot0:findTF(&quot;greet/InputField&quot;)
	slot0.writeBtn = slot0:findTF(&quot;greet/write_btn&quot;)
	slot0.animPanels = {
		slot0:findTF(&quot;info&quot;),
		slot0:findTF(&quot;power&quot;),
		slot0:findTF(&quot;statistics&quot;),
		slot0:findTF(&quot;greet&quot;)
	}

	setText(slot0:findTF(&quot;power/collection_label&quot;), i18n(&quot;friend_resume_collection_rate&quot;))
	setText(slot0:findTF(&quot;power/power_label&quot;), i18n(&quot;friend_resume_fleet_gs&quot;))
	setText(slot0:findTF(&quot;info/title_name&quot;), i18n(&quot;friend_resume_title&quot;))
	setText(slot0:findTF(&quot;statistics/title_name&quot;), i18n(&quot;friend_resume_data_title&quot;))
	setText(slot0:findTF(&quot;greet/InputField/Placeholder&quot;), i18n(&quot;player_manifesto_placeholder&quot;))
	slot0:MatchResolution()
end

slot0.PreCalcAspect = function(slot0, slot1)
	return slot0.rect.height / slot1
end

slot0.MatchResolution = function(slot0)
	slot1 = uv0.PreCalcAspect(slot0._parentTf, slot0._tf.rect.height)
	slot0._tf.localScale = Vector3(slot1, slot1, 1)
end

slot0.OnInit = function(slot0)
	onButton(slot0, slot0.modityNameBtn, function ()
		slot0, slot1 = uv0.player:canModifyName()

		if not slot0 then
			pg.TipsMgr.GetInstance():ShowTips(slot1)

			return
		end

		uv0.contextData.renamePage:ExecuteAction(&quot;Show&quot;, uv0.player)
	end, SFX_PANEL)
	onButton(slot0, slot0.writeBtn, function ()
		activateInputField(uv0.inputField)
	end, SFX_PANEL)
	onButton(slot0, slot0.shareBtn, function ()
		pg.ShareMgr.GetInstance():Share(pg.ShareMgr.TypeAdmira)
	end, SFX_PANEL)
	onButton(slot0, slot0.attireBtn, function ()
		uv0:emit(PlayerVitaeMediator.ON_ATTIRE)
	end, SFX_PANEL)
	setActive(slot0.attireBtnTip, _.any(getProxy(AttireProxy):needTip(), function (slot0)
		return slot0 == true
	end))
	onInputEndEdit(slot0, slot0.inputField, function (slot0)
		if wordVer(slot0) &gt; 0 then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;playerinfo_mask_word&quot;))
			activateInputField(uv0.inputField)

			return
		end

		if not slot0 or uv0.manifesto == slot0 then
			return
		end

		uv0.manifesto = slot0

		uv0:emit(PlayerVitaeMediator.CHANGE_MANIFESTO, slot0)
	end)
	slot0._tf:SetAsFirstSibling()
end

slot0.Show = function(slot0, slot1, slot2)
	uv0.super.Show(slot0)

	slot0.player = slot1

	slot0:UpdateMedals()
	slot0:UpdatePower()
	slot0:UpdateInfo()
	slot0:UpdateStatistics()

	if slot2 then
		slot0:DoEnterAnimation()
	end
end

slot0.DoEnterAnimation = function(slot0)
	for slot4, slot5 in ipairs(slot0.animPanels) do
		slot6 = slot5.localPosition.x
		slot5.localPosition = Vector3(slot6 + 800, slot5.localPosition.y, 0)

		LeanTween.moveLocalX(slot5.gameObject, slot6, 0.2 + (slot4 - 1) * 0.05):setDelay(slot4 * 0.05):setEase(LeanTweenType.easeInOutSine)
	end
end

slot0.UpdateMedals = function(slot0)
	slot3 = 353
	slot4 = 30

	for slot8 = 1, math.min(5, #slot0.player.displayTrophyList) do
		slot9 = slot8 == 1 and slot0.medalTpl or cloneTplTo(slot0.medalTpl, slot0.medalTpl.parent)

		LoadSpriteAsync(&quot;medal/s_&quot; .. pg.medal_template[slot1[slot2 - slot8 + 1]].icon, function (slot0)
			if uv0.exited then
				return
			end

			slot1 = uv1:Find(&quot;icon&quot;):GetComponent(typeof(Image))
			slot1.sprite = slot0

			slot1:SetNativeSize()
		end)

		slot9.anchoredPosition = Vector2(slot3 - (slot8 - 1) * (slot4 + slot9.sizeDelta.x), slot9.anchoredPosition.y)
	end

	setActive(slot0.medalTpl, slot2 ~= 0)
end

slot0.UpdatePower = function(slot0)
	slot1 = getProxy(MilitaryExerciseProxy):RawGetSeasonInfo()
	slot2 = SeasonInfo.getEmblem(slot1.score, slot1.rank)

	LoadSpriteAsync(&quot;emblem/&quot; .. slot2, function (slot0)
		uv0.emblemIcon.sprite = slot0

		uv0.emblemIcon:SetNativeSize()
	end)
	LoadSpriteAsync(&quot;emblem/n_&quot; .. slot2, function (slot0)
		if uv0.exited then
			return
		end

		uv0.emblemTxt.sprite = slot0

		uv0.emblemTxt:SetNativeSize()
	end)

	slot0.highestEmblem.text = i18n(&quot;friend_resume_title_metal&quot;) .. pg.arena_data_rank[math.min(math.max(slot0.player.maxRank, 1), 14)].name

	getProxy(BayProxy):GetBayPowerRootedAsyn(function (slot0)
		if uv0.exited then
			return
		end

		uv0.powerTxt.text = math.floor(slot0)
	end)

	slot0.collectionTxt.text = getProxy(CollectionProxy):getCollectionRate() * 100 .. &quot;%&quot;
end

slot0.UpdateInfo = function(slot0)
	slot0.nameTxt.text = slot0.player.name
	slot0.idTxt.text = slot0.player.id
	slot0.levelTxt.text = &quot;LV.&quot; .. slot0.player.level
	slot0.expTxt.text = slot0.player.exp .. &quot;/&quot; .. getConfigFromLevel1(pg.user_level, slot0.player.level).exp

	setInputText(slot0.inputField, slot0.player:GetManifesto())
end

slot0.UpdateStatistics = function(slot0)
	slot3 = Vector2(355, 25)
	slot4 = slot0.statisticTpl.anchoredPosition
	slot5 = slot0.statisticTpl.sizeDelta.x

	for slot9 = 1, #slot0:GetDisplayStatisticsData(), 2 do
		slot10 = slot4.y - (slot9 - 1) * slot3.y

		for slot14 = 1, slot2 do
			slot15 = slot14 == 1 and slot9 == 1 and slot0.statisticTpl or cloneTplTo(slot0.statisticTpl, slot0.statisticTpl.parent)
			slot16 = slot1[slot9 + slot14 - 1]

			setText(slot15, i18n(slot16[1]))
			setText(slot15:Find(&quot;value&quot;), slot16[2])

			slot15.anchoredPosition = Vector2(slot4.x + (slot14 - 1) * slot3.x, slot10)
		end
	end
end

slot0.GetDisplayStatisticsData = function(slot0)
	slot1 = slot0.player

	return {
		{
			&quot;friend_resume_ship_count&quot;,
			slot1.shipCount
		},
		{
			&quot;friend_event_count&quot;,
			slot1.collect_attack_count
		},
		{
			&quot;friend_resume_attack_count&quot;,
			slot1.attackCount
		},
		{
			&quot;friend_resume_manoeuvre_count&quot;,
			slot1.pvp_attack_count
		},
		{
			&quot;friend_resume_attack_win_rate&quot;,
			string.format(&quot;%0.1f&quot;, slot1.winCount / math.max(slot1.attackCount, 1) * 100) .. &quot;%&quot;
		},
		{
			&quot;friend_resume_manoeuvre_win_rate&quot;,
			string.format(&quot;%0.1f&quot;, slot1.pvp_win_count / math.max(slot1.pvp_attack_count, 1) * 100) .. &quot;%&quot;
		}
	}
end

slot0.OnDestroy = function(slot0)
	for slot4, slot5 in ipairs(slot0.animPanels) do
		if LeanTween.isTweening(slot5.gameObject) then
			LeanTween.cancel(slot5.gameObject)
		end
	end

	slot0.exited = true
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>