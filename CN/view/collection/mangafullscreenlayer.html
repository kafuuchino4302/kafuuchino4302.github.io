<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mangafullscreenlayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>mangafullscreenlayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;MangaFullScreenLayer&quot;, import(&quot;..base.BaseUI&quot;))

slot0.getUIName = function(slot0)
	return &quot;MangaViewUI&quot;
end

slot0.init = function(slot0)
	slot0:findUI()
	slot0:initData()
	slot0:addListener()
end

slot0.didEnter = function(slot0)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0:readManga()
	slot0:updatePicImg()
	slot0:updateLikeBtn()
end

slot0.willExit = function(slot0)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf)
	slot0.resLoader:Clear()

	if slot0.contextData.mangaContext then
		slot0.contextData.mangaContext:updateToMangaID(slot0.mangaIDLIst[slot0.curMangaIndex])
	end
end

slot0.onBackPressed = function(slot0)
	if not slot0.isShowing then
		slot0:closeView()
	end
end

slot0.findUI = function(slot0)
	slot0.bg = slot0:findTF(&quot;BG&quot;)
	slot0.picImg = slot0:findTF(&quot;Manga/Pic&quot;)
	slot0.indexText = slot0:findTF(&quot;Manga/Index&quot;)
	slot0.preBtn = slot0:findTF(&quot;LeftBtn&quot;)
	slot0.rightBtn = slot0:findTF(&quot;RightBtn&quot;)
	slot0.tipText = slot0:findTF(&quot;Tip&quot;)
	slot0.likeOnBtn = slot0:findTF(&quot;Manga/LikeOn&quot;)
	slot0.likeOffBtn = slot0:findTF(&quot;Manga/LikeOff&quot;)

	setText(slot0.tipText, i18n(&quot;world_collection_back&quot;))
end

slot0.initData = function(slot0)
	slot0.resLoader = AutoLoader.New()
	slot0.curMangaIndex = slot0.contextData.mangaIndex
	slot0.mangaIDLIst = slot0.contextData.mangaIDLIst
end

slot0.addListener = function(slot0)
	onButton(slot0, slot0.bg, function ()
		if not uv0.isShowing then
			uv0:closeView()
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.preBtn, function ()
		if uv0.curMangaIndex &gt; 1 then
			uv0.curMangaIndex = uv0.curMangaIndex - 1

			uv0:readManga()
			uv0:updatePicImg()
			uv0:updateLikeBtn()
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.rightBtn, function ()
		if uv0.curMangaIndex &lt; #uv0.mangaIDLIst then
			uv0.curMangaIndex = uv0.curMangaIndex + 1

			uv0:readManga()
			uv0:updatePicImg()
			uv0:updateLikeBtn()
		end
	end, SFX_PANEL)
	onButton(slot0, slot0.likeOnBtn, function ()
		pg.m02:sendNotification(GAME.APPRECIATE_MANGA_LIKE, {
			mangaID = uv0.mangaIDLIst[uv0.curMangaIndex],
			action = MangaConst.CANCEL_MANGA_LIKE
		})
	end, SFX_PANEL)
	onButton(slot0, slot0.likeOffBtn, function ()
		pg.m02:sendNotification(GAME.APPRECIATE_MANGA_LIKE, {
			mangaID = uv0.mangaIDLIst[uv0.curMangaIndex],
			action = MangaConst.SET_MANGA_LIKE
		})
	end, SFX_PANEL)
	addSlip(SLIP_TYPE_HRZ, slot0.picImg, function ()
		triggerButton(uv0.preBtn)
	end, function ()
		triggerButton(uv0.rightBtn)
	end)
	addSlip(SLIP_TYPE_HRZ, slot0.bg, function ()
		triggerButton(uv0.preBtn)
	end, function ()
		triggerButton(uv0.rightBtn)
	end)
end

slot0.updatePicImg = function(slot0)
	slot2 = pg.cartoon[slot0.mangaIDLIst[slot0.curMangaIndex]].resource

	slot0.resLoader:LoadSprite(MangaConst.MANGA_PATH_PREFIX .. slot2, slot2, slot0.picImg, false)

	slot4 = nil

	setText(slot0.indexText, slot0.contextData.isShowingNotRead and &quot;#&quot; .. pg.cartoon[slot1].cartoon_id or &quot;#&quot; .. pg.cartoon[slot1].cartoon_id .. &quot;/&quot; .. #slot0.mangaIDLIst)

	slot0.isShowing = true

	slot0:managedTween(LeanTween.value, nil, go(slot0.picImg), 0, 1, 0.3):setOnUpdate(System.Action_float(function (slot0)
		setImageAlpha(uv0.picImg, slot0)
	end)):setOnComplete(System.Action(function ()
		uv0.isShowing = false

		setImageAlpha(uv0.picImg, 1)
	end))
	setActive(slot0.preBtn, slot0.curMangaIndex &gt; 1)
	setActive(slot0.rightBtn, slot0.curMangaIndex &lt; #slot0.mangaIDLIst)
end

slot0.updateLikeBtn = function(slot0)
	slot2 = MangaConst.isMangaLikeByID(slot0.mangaIDLIst[slot0.curMangaIndex])

	setActive(slot0.likeOnBtn, slot2)
	setActive(slot0.likeOffBtn, not slot2)
end

slot0.readManga = function(slot0)
	if not MangaConst.isMangaEverReadByID(slot0.mangaIDLIst[slot0.curMangaIndex]) then
		pg.m02:sendNotification(GAME.APPRECIATE_MANGA_READ, {
			mangaID = slot1
		})
	end
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>