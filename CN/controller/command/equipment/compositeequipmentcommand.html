<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>compositeequipmentcommand.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>compositeequipmentcommand.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CompositeEquipmentCommand&quot;, pm.SimpleCommand)

slot0.execute = function(slot0, slot1)
	slot2 = slot1:getBody()
	slot6 = getProxy(BagProxy):getData()
	slot9 = pg.compose_data_template[slot2.id]

	if getProxy(PlayerProxy):getData():getMaxEquipmentBag() &lt; getProxy(EquipmentProxy):getCapacity() + slot2.count then
		NoPosMsgBox(i18n(&quot;switch_to_shop_tip_noPos&quot;), openDestroyEquip, gotoChargeScene)

		return
	end

	if slot8.gold &lt; slot9.gold_num * slot3 then
		GoShoppingMsgBox(i18n(&quot;switch_to_shop_tip_2&quot;, i18n(&quot;word_gold&quot;)), ChargeScene.TYPE_ITEM, {
			{
				59001,
				slot9.gold_num * slot3 - slot8.gold,
				slot9.gold_num * slot3
			}
		})

		return
	end

	if not slot6[slot9.material_id] then
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_materal_no_enough&quot;))

		return
	end

	if slot6[slot9.material_id].count &lt; slot9.material_num * slot3 then
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_materal_no_enough&quot;))

		return
	end

	slot12 = pg.ConnectionMgr.GetInstance()

	slot12:Send(14006, {
		id = slot4,
		num = slot3
	}, 14007, function (slot0)
		if slot0.result == 0 then
			uv0:addEquipmentById(uv1.equip_id, uv2)
			uv3:consume({
				gold = uv1.gold_num * uv2
			})
			uv4:updatePlayer(uv3)
			uv5:removeItemById(uv1.material_id, uv1.material_num * uv2)
			uv6:sendNotification(GAME.COMPOSITE_EQUIPMENT_DONE, {
				equipment = Equipment.New({
					id = uv1.equip_id
				}),
				count = uv2,
				composeId = uv7
			})
		else
			pg.TipsMgr.GetInstance():ShowTips(errorTip(&quot;equipment_compositeEquipment&quot;, slot0.result))
		end
	end)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>