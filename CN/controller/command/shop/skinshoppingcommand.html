<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>skinshoppingcommand.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>skinshoppingcommand.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;SkinShoppingCommand&quot;, pm.SimpleCommand)

slot0.execute = function(slot0, slot1)
	slot2 = slot1:getBody()
	slot3 = slot2.id
	slot4 = slot2.count
	slot5 = pg.shop_template[slot3]

	if not slot3 then
		pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_shopId_noFound&quot;))

		return
	end

	if slot4 == 0 then
		return
	end

	slot7 = getProxy(ShopsProxy):getShopStreet()
	slot8 = false
	slot9 = slot5.resource_num * slot4
	slot11 = getProxy(PlayerProxy):getData()

	if slot5.limit_args then
		for slot15, slot16 in ipairs(slot5.limit_args) do
			if type(slot16) == &quot;table&quot; and slot16[1] == &quot;level&quot; and slot11.level &lt; slot16[2] then
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;common_limit_level&quot;, slot16[2]))

				return
			end
		end
	end

	if slot5.discount ~= 0 and CommonCommodity.InCommodityDiscountTime(slot5.id) then
		slot9 = slot9 * (100 - slot5.discount) / 100
	end

	if slot11[id2res(slot5.resource_type)] &lt; slot9 then
		slot12 = Drop.New({
			type = DROP_TYPE_RESOURCE,
			id = slot5.resource_type
		}):getName()

		if slot5.resource_type == 1 then
			GoShoppingMsgBox(i18n(&quot;switch_to_shop_tip_2&quot;, i18n(&quot;word_gold&quot;)), ChargeScene.TYPE_ITEM, {
				{
					59001,
					slot9 - slot11[id2res(slot5.resource_type)],
					slot9
				}
			})
		elseif slot5.resource_type == 4 or slot5.resource_type == 14 then
			GoShoppingMsgBox(i18n(&quot;switch_to_shop_tip_3&quot;, i18n(&quot;word_gem&quot;)), ChargeScene.TYPE_DIAMOND)
			pg.TrackerMgr.GetInstance():Tracking(TRACKING_BUILD_OR_SKIN_FAILD)
		elseif not ItemTipPanel.ShowItemTip(DROP_TYPE_RESOURCE, slot5.resource_type) then
			pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;buyProp_noResource_error&quot;, slot12))
		end

		return
	end

	seriesAsync({}, function ()
		slot0 = pg.ConnectionMgr.GetInstance()

		slot0:Send(16001, {
			id = uv0,
			number = uv1
		}, 16002, function (slot0)
			if slot0.result == 0 then
				slot1 = {}
				slot2 = uv0:getData()

				slot2:consume({
					[id2res(uv1.resource_type)] = uv2
				})

				slot3 = nil

				switch(uv1.genre, {
					[ShopArgs.SkinShop] = function ()
						uv0 = PlayerConst.addTranDrop(uv1.drop_list)

						getProxy(ShipSkinProxy):addSkin(ShipSkin.New({
							id = uv2.effect_args[1]
						}))
					end,
					[ShopArgs.SkinShopTimeLimit] = function ()
						if getProxy(ShipSkinProxy):getSkinById(uv0.effect_args[1]) and slot2:isExpireType() then
							slot1:addSkin(ShipSkin.New({
								id = slot0,
								end_time = uv0.time_second * uv1 + slot2.endTime
							}))
						elseif not slot2 then
							slot1:addSkin(ShipSkin.New({
								id = slot0,
								end_time = uv0.time_second * uv1 + pg.TimeMgr.GetInstance():GetServerTime()
							}))
						end
					end
				})
				uv0:updatePlayer(slot2)

				if uv1.group &gt; 0 then
					uv4:updateNormalGroupList(uv1.group, uv1.group_buy_count)
				end

				uv5:sendNotification(GAME.SKIN_SHOPPIGN_DONE, {
					id = uv6,
					shopType = slot3,
					normalList = uv4:GetNormalList(),
					normalGroupList = uv4:GetNormalGroupList(),
					awards = slot1
				})

				return
			end

			originalPrint(slot0.result)

			if slot0.result == 4400 then
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;shopping_error_time_limit&quot;))
			else
				pg.TipsMgr.GetInstance():ShowTips(errorTip(&quot;&quot;, slot0.result))
			end
		end)
	end)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>