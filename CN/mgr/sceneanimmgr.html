<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sceneanimmgr.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>sceneanimmgr.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">pg = pg or {}
pg.SceneAnimMgr = singletonClass(&quot;SceneAnimMgr&quot;)
slot0 = pg.SceneAnimMgr

slot0.Ctor = function(slot0)
	slot0.dormCallbackList = {}
end

slot0.Init = function(slot0, slot1)
	print(&quot;initializing sceneanim manager...&quot;)
	LoadAndInstantiateAsync(&quot;ui&quot;, &quot;SceneAnimUI&quot;, function (slot0)
		uv0._go = slot0

		uv0._go:SetActive(false)

		uv0._tf = uv0._go.transform

		uv0._tf:SetParent(pg.UIMgr.GetInstance().OverlayToast, false)

		uv0.container = uv0._tf:Find(&quot;container&quot;)

		if uv1 then
			uv1()
		end
	end, true, true)
end

slot0.SixthAnniversaryJPCoverGoScene = function(slot0, slot1)
	slot0.playing = true

	setActive(slot0._tf, true)
	PoolMgr.GetInstance():GetUI(&quot;SixthAnniversaryJPCoverUI&quot;, true, function (slot0)
		slot1 = slot0.transform

		setParent(slot1, uv0.container, false)
		setActive(slot1, true)

		slot2 = slot1:Find(&quot;houshanyunwu&quot;):GetComponent(typeof(SpineAnimUI))

		slot2:SetActionCallBack(function (slot0)
			if slot0 == &quot;finish&quot; then
				PoolMgr.GetInstance():ReturnUI(uv0, uv1)

				uv2.playing = nil

				setActive(uv3, false)
				setActive(uv2._tf, false)
			elseif slot0 == &quot;action&quot; then
				pg.m02:sendNotification(GAME.GO_SCENE, uv4)
			end
		end)
		slot2:SetAction(&quot;action&quot;, 0)
	end)
end

slot0.OtherWorldCoverGoScene = function(slot0, slot1, slot2)
	slot0.playing = true

	setActive(slot0._tf, true)
	PoolMgr.GetInstance():GetUI(&quot;OtherworldCoverUI&quot;, true, function (slot0)
		slot1 = slot0.transform

		setParent(slot1, uv0.container, false)
		setActive(slot1, true)

		slot2 = slot1:Find(&quot;yuncaizhuanchang&quot;):GetComponent(typeof(SpineAnimUI))

		slot2:SetActionCallBack(function (slot0)
			if slot0 == &quot;finish&quot; then
				PoolMgr.GetInstance():ReturnUI(uv0, uv1)

				uv2.playing = nil

				setActive(uv3, false)
				setActive(uv2._tf, false)
			elseif slot0 == &quot;action&quot; then
				pg.m02:sendNotification(GAME.GO_SCENE, uv4, uv5)
			end
		end)
		slot2:SetAction(&quot;action&quot;, 0)
	end)
end

slot0.RegisterDormNextCall = function(slot0, slot1)
	slot0.dormNextCall = function()
		uv0.dormNextCall = nil

		return uv1()
	end
end

slot0.Dorm3DSceneChange = function(slot0, slot1)
	table.insert(slot0.dormCallbackList, slot1)

	if not slot0.playing then
		pg.UIMgr.GetInstance():LoadingOn(false)
		slot0:DoDorm3DSceneChange()
	end

	existCall(slot0.dormNextCall)
end

slot0.DoDorm3DSceneChange = function(slot0, slot1)
	slot0.playing = true

	setActive(slot0._tf, true)

	slot2 = &quot;Dorm3DLoading&quot;
	slot3 = {}

	if not slot1 then
		table.insert(slot3, function (slot0)
			PoolMgr.GetInstance():GetUI(uv0, true, function (slot0)
				uv0 = slot0.transform

				setParent(uv0, uv1.container, false)
				uv2()
			end)
		end)
	end

	seriesAsync(slot3, function ()
		slot1 = uv0:GetComponent(&quot;DftAniEvent&quot;)

		slot1:SetTriggerEvent(function (slot0)
			slot1 = nil

			(function ()
				if #uv0.dormCallbackList &gt; 0 then
					table.remove(uv0.dormCallbackList, 1)(uv1)
				else
					GetComponent(uv2, typeof(Animator)):SetBool(&quot;Finish&quot;, true)
					uv3:SetInt(&quot;_DissolveTexFlip&quot;, 0)
					LeanTween.value(0, 1, 0.6):setOnUpdate(System.Action_float(function (slot0)
						uv0:SetFloat(&quot;_Dissolve&quot;, slot0)
					end)):setEase(LeanTweenType.easeInOutCubic)
				end
			end)()
			pg.CriMgr.GetInstance():PlaySE_V3(&quot;ui-dorm_loading_loop&quot;)
		end)
		slot1:SetEndEvent(function (slot0)
			if #uv0.dormCallbackList &gt; 0 then
				quickPlayAnimator(uv1, &quot;anim_dorm3d_loading_in&quot;)
				uv0:DoDorm3DSceneChange(uv1)
			else
				PoolMgr.GetInstance():ReturnUI(uv2, uv1.gameObject)

				uv0.playing = nil

				setActive(uv0._tf, false)
				pg.UIMgr.GetInstance():LoadingOff()
			end
		end)
		GetComponent(uv0, typeof(Animator)):SetBool(&quot;Finish&quot;, false)
		uv0:Find(&quot;bg&quot;):GetComponent(typeof(Image)).material:SetInt(&quot;_DissolveTexFlip&quot;, 1)
		LeanTween.value(1, 0, 0.6):setOnUpdate(System.Action_float(function (slot0)
			uv0:SetFloat(&quot;_Dissolve&quot;, slot0)
		end)):setEase(LeanTweenType.easeOutCubic)
	end)
end

slot0.IsPlaying = function(slot0)
	return slot0.playing
end

slot0.Dispose = function(slot0)
	setActive(slot0._tf, false)

	slot0.playing = nil
end
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>