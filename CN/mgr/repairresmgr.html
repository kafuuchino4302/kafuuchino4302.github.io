<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>repairresmgr.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>repairresmgr.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">pg = pg or {}
pg.RepairResMgr = singletonClass(&quot;RepairResMgr&quot;)
slot0 = pg.RepairResMgr
slot0.TYPE_DEFAULT_RES = 2
slot0.TYPE_L2D = 4
slot0.TYPE_PAINTING = 8
slot0.TYPE_CIPHER = 16

slot0.Init = function(slot0, slot1)
	LoadAndInstantiateAsync(&quot;ui&quot;, &quot;RepairUI&quot;, function (slot0)
		uv0._go = slot0
		uv0._tf = uv0._go.transform

		uv0._go:SetActive(false)

		uv0.contentTxt = uv0._tf:Find(&quot;window/content/Text&quot;):GetComponent(typeof(Text))
		uv0.parentTr = pg.UIMgr.GetInstance().OverlayToast

		uv0._go.transform:SetParent(uv0.parentTr, false)

		uv0.closeBtn = uv0._tf:Find(&quot;window/top/btnBack&quot;)
		uv0.btns = {
			uv0:InitDefaultResBtn(),
			uv0:InitL2dBtn(),
			uv0:InitPaintingBtn(),
			uv0:InitCipherBtn()
		}
		uv0.uiItemList = UIItemList.New(uv0._tf:Find(&quot;window/buttons&quot;), uv0._tf:Find(&quot;window/buttons/custom_button_1&quot;))

		setText(uv0._tf:Find(&quot;window/top/title&quot;), i18n(&quot;msgbox_repair_title&quot;))
		uv1()
	end, true, true)
end

slot0.InitDefaultResBtn = function(slot0)
	return {
		type = uv0.TYPE_DEFAULT_RES,
		text = i18n(&quot;msgbox_repair&quot;),
		onCallback = function ()
			if PathMgr.FileExists(Application.persistentDataPath .. &quot;/hashes.csv&quot;) then
				BundleWizard.Inst:GetGroupMgr(&quot;DEFAULT_RES&quot;):StartVerifyForLua()
			else
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_no_cache&quot;))
			end
		end
	}
end

slot0.InitL2dBtn = function(slot0)
	return {
		type = uv0.TYPE_L2D,
		text = i18n(&quot;msgbox_repair_l2d&quot;),
		onCallback = function ()
			if PathMgr.FileExists(Application.persistentDataPath .. &quot;/hashes-live2d.csv&quot;) then
				BundleWizard.Inst:GetGroupMgr(&quot;L2D&quot;):StartVerifyForLua()
			else
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_no_cache&quot;))
			end
		end
	}
end

slot0.InitPaintingBtn = function(slot0)
	return {
		type = uv0.TYPE_PAINTING,
		text = i18n(&quot;msgbox_repair_painting&quot;),
		onCallback = function ()
			if PathMgr.FileExists(Application.persistentDataPath .. &quot;/hashes-painting.csv&quot;) then
				BundleWizard.Inst:GetGroupMgr(&quot;PAINTING&quot;):StartVerifyForLua()
			else
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_no_cache&quot;))
			end
		end
	}
end

slot0.InitCipherBtn = function(slot0)
	return {
		type = uv0.TYPE_CIPHER,
		text = i18n(&quot;msgbox_repair_cipher&quot;),
		onCallback = function ()
			if PathMgr.FileExists(Application.persistentDataPath .. &quot;/hashes-cipher.csv&quot;) then
				BundleWizard.Inst:GetGroupMgr(&quot;CIPHER&quot;):StartVerifyForLua()
			else
				pg.TipsMgr.GetInstance():ShowTips(i18n(&quot;word_no_cache&quot;))
			end
		end
	}
end

slot0.Repair = function(slot0, slot1)
	slot2 = slot1 or bit.bor(uv0.TYPE_DEFAULT_RES, uv0.TYPE_L2D, uv0.TYPE_PAINTING, uv0.TYPE_CIPHER)
	slot3 = {}

	for slot7, slot8 in ipairs(slot0.btns) do
		if bit.band(slot8.type, slot2) &gt; 0 then
			table.insert(slot3, slot8)
		end
	end

	slot0:Show(slot3)
end

slot0.Show = function(slot0, slot1)
	pg.DelegateInfo.New(slot0)
	slot0._go:SetActive(true)
	pg.UIMgr.GetInstance():BlurPanel(slot0._tf)
	slot0.uiItemList:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			setText(slot2:Find(&quot;Text&quot;), uv0[slot1 + 1].text)
			onButton(uv1, slot2, function ()
				if uv0.onCallback then
					uv0.onCallback()
				end

				uv1:Hide()
			end, SFX_PANEL)
		end
	end)
	slot0.uiItemList:align(#slot1)

	slot0.contentTxt.text = i18n(&quot;resource_verify_warn&quot;)

	onButton(slot0, slot0._tf, function ()
		uv0:Hide()
	end, SFX_PANEL)
	onButton(slot0, slot0.closeBtn, function ()
		uv0:Hide()
	end, SFX_PANEL)
end

slot0.Hide = function(slot0)
	pg.DelegateInfo.Dispose(slot0)
	slot0._go:SetActive(false)
	pg.UIMgr.GetInstance():UnblurPanel(slot0._tf, slot0.parentTr)
end
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>