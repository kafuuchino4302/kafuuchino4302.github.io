<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>caststoryplayer.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>caststoryplayer.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = class(&quot;CastStoryPlayer&quot;, import(&quot;.StoryPlayer&quot;))

slot0.Ctor = function(slot0, slot1)
	uv0.super.Ctor(slot0, slot1)

	slot0.tpls = {
		slot0._tf:Find(&quot;resource/text_tpl&quot;),
		slot0._tf:Find(&quot;resource/image_tpl&quot;),
		slot0._tf:Find(&quot;resource/list_tpl&quot;),
		slot0._tf:Find(&quot;resource/cast_tpl&quot;)
	}
	slot0.layoutContainer = slot0.castPanel:Find(&quot;Image&quot;)
end

slot0.OnReset = function(slot0, slot1, slot2, slot3)
	setActive(slot0.castPanel, true)
	setAnchoredPosition(slot0.layoutContainer, {
		x = 0,
		y = 0
	})
	slot3()
end

slot0.OnEnter = function(slot0, slot1, slot2, slot3)
	seriesAsync({
		function (slot0)
			uv0:SetLayout(uv1, slot0)
		end,
		function (slot0)
			onNextTick(slot0)
		end,
		function (slot0)
			uv0:StartAnimation(uv1, slot0)
		end
	}, slot3)
end

slot0.SetLayout = function(slot0, slot1, slot2)
	removeAllChildren(slot0.layoutContainer)

	slot0.layoutContainer:GetComponent(typeof(VerticalLayoutGroup)).spacing = slot1:GetSpacing()

	for slot9, slot10 in pairs(slot1:GetLayout()) do
		slot13 = &quot;InitLayoutForType&quot; .. slot10.type

		assert(slot0[slot13], &quot;need function &gt;&gt;&gt;&quot; .. slot13)
		slot0:__slot13_None__(cloneTplTo(slot0.tpls[slot10.type], slot0.layoutContainer), slot10)
	end

	slot2()
end

slot0.InitLayoutForType1 = function(slot0, slot1, slot2)
	setText(slot1, slot2.text)
end

slot0.InitLayoutForType2 = function(slot0, slot1, slot2)
	slot5 = slot1:GetComponent(typeof(LayoutElement))
	slot1:Find(&quot;image&quot;):GetComponent(typeof(Image)).sprite = LoadSprite(&quot;bg/&quot; .. slot2.path)

	if slot2.size == Vector2.zero then
		slot4:SetNativeSize()

		slot5.preferredHeight = slot4.gameObject.transform.sizeDelta.y
	else
		slot4.gameObject.transform.sizeDelta = slot2.size
		slot5.preferredHeight = slot2.size.y
	end
end

slot0.InitLayoutForType3 = function(slot0, slot1, slot2)
	slot4 = slot2.column
	slot5 = slot1:GetComponent(typeof(GridLayoutGroup))
	slot5.constraintCount = slot4
	slot5.cellSize = Vector2(1920 / slot4 - slot5.spacing.x * (slot4 - 1), 30)
	slot8 = slot4 % 2 ~= 0
	slot9 = UIItemList.New(slot1, slot1:Find(&quot;1&quot;))

	slot9:make(function (slot0, slot1, slot2)
		if slot0 == UIItemList.EventUpdate then
			slot3 = slot2:GetComponent(typeof(Text))
			slot4 = COLOR_WHITE

			if uv0 then
				slot3.alignment = TextAnchor.MiddleCenter
			else
				slot5 = slot1 % 2 == 0
				slot3.alignment = slot5 and TextAnchor.MiddleRight or TextAnchor.MiddleLeft

				if slot5 then
					slot4 = uv1.evenColumnColor
				end
			end

			slot3.text = setColorStr(uv2[slot1 + 1], slot4)
		end
	end)
	slot9:align(#slot2.names)
end

slot0.InitLayoutForType4 = function(slot0, slot1, slot2)
end

slot0.StartAnimation = function(slot0, slot1, slot2)
	slot0:PlayAnimation(slot1:GetPlayTime(), slot2)
	onButton(slot0, slot0._tf, function ()
		removeOnButton(uv0._tf)
		uv0:SpeedUp(uv1, uv2)
	end, SFX_PANEL)
end

slot0.PlayAnimation = function(slot0, slot1, slot2)
	slot0:TweenValue(slot0.layoutContainer, getAnchoredPosition(slot0.layoutContainer).y, slot0.castPanel.rect.height + slot0.layoutContainer.sizeDelta.y, slot1, 0, function (slot0)
		setAnchoredPosition(uv0.layoutContainer, {
			y = slot0
		})
	end, function ()
		removeOnButton(uv0._tf)
		uv1()
	end)
end

slot0.SpeedUp = function(slot0, slot1, slot2)
	slot0:CancelTween(slot0.layoutContainer)
	slot0:PlayAnimation(slot1 * 0.2, slot2)
end

slot0.RegisetEvent = function(slot0, slot1, slot2)
	uv0.super.RegisetEvent(slot0, slot1, slot2)
	triggerButton(slot0._go)
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>