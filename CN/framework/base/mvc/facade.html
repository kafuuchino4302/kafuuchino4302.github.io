<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>facade.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>facade.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">ys = ys or {}
slot1 = pg
slot0.MVC = ys.MVC or {}
slot0.MVC.Facade = singletonClass(&quot;MVC.Facade&quot;)
slot0.MVC.Facade.__name = &quot;MVC.Facade&quot;

slot0.MVC.Facade.Ctor = function(slot0)
	slot0:Initialize()
end

slot0.MVC.Facade.AddDataProxy = function(slot0, slot1)
	assert(slot1.__name ~= nil and type(slot1.__name) == &quot;string&quot;, slot0.__name .. &quot;.AddDataProxy: dataProxy.__name expected a string value&quot;)
	assert(slot0._proxyList[slot1.__name] == nil, slot0.__name .. &quot;.AddDataProxy: same dataProxy exist&quot;)

	slot1._state = slot0

	slot1:ActiveProxy()

	slot0._proxyList[slot1.__name] = slot1

	return slot1
end

slot0.MVC.Facade.AddMediator = function(slot0, slot1)
	if slot1.__name == nil or type(slot1.__name) ~= &quot;string&quot; then
		assert(false, slot0.__name .. &quot;.AddMediator: mediator.__name expected a string value&quot;)
	end

	assert(slot0._mediatorList[slot1.__name] == nil, slot0.__name .. &quot;.AddMediator: same mediator exist&quot;)

	slot0._mediatorList[slot1.__name] = slot1
	slot1._state = slot0

	slot1:Initialize()

	return slot1
end

slot0.MVC.Facade.AddCommand = function(slot0, slot1)
	if slot1.__name == nil or type(slot1.__name) ~= &quot;string&quot; then
		assert(false, slot0.__name .. &quot;.AddCommand: command.__name expected a string value&quot;)
	end

	assert(slot0._commandList[slot1.__name] == nil, slot0.__name .. &quot;.AddCommand: same command exist&quot;)

	slot0._commandList[slot1.__name] = slot1
	slot1._state = slot0

	slot1:Initialize()

	return slot1
end

slot0.MVC.Facade.GetProxyByName = function(slot0, slot1)
	assert(type(slot1) == &quot;string&quot;, slot0.__name .. &quot;.GetProxyByName: expect a string value&quot;)

	return slot0._proxyList[slot1]
end

slot0.MVC.Facade.GetMediatorByName = function(slot0, slot1)
	assert(type(slot1) == &quot;string&quot;, slot0.__name .. &quot;.GetMediatorByName: expect a string value&quot;)

	return slot0._mediatorList[slot1]
end

slot0.MVC.Facade.GetCommandByName = function(slot0, slot1)
	assert(type(slot1) == &quot;string&quot;, slot0.__name .. &quot;.GetCommandByName: expect a string value&quot;)

	return slot0._commandList[slot1]
end

slot0.MVC.Facade.RemoveMediator = function(slot0, slot1)
	if type(slot1) == &quot;string&quot; then
		slot1 = slot0._mediatorList[slot1]
	end

	assert(slot1 ~= nil, slot0.__name .. &quot;.RemoveMediator: try to remove a nil mediator&quot;)
	slot1:Dispose()

	slot0._mediatorList[slot1.__name] = nil
end

slot0.MVC.Facade.RemoveCommand = function(slot0, slot1)
	if type(slot1) == &quot;string&quot; then
		slot1 = slot0._commandList[slot1]
	end

	assert(slot1 ~= nil, slot0.__name .. &quot;.RemoveCommand: try to remove a nil command&quot;)
	slot1:Dispose()

	slot0._commandList[slot1.__name] = nil
end

slot0.MVC.Facade.RemoveProxy = function(slot0, slot1)
	if type(slot1) == &quot;string&quot; then
		slot1 = slot0._proxyList[slot1]
	end

	assert(slot1 ~= nil, slot0.__name .. &quot;.RemoveProxy: try to remove a nil proxy&quot;)
	slot1:DeactiveProxy()

	slot0._proxyList[slot1.__name] = nil
end

slot0.MVC.Facade.Initialize = function(slot0)
	slot0._proxyList = {}
	slot0._commandList = {}
	slot0._mediatorList = {}
end

slot0.MVC.Facade.Active = function(slot0)
	if not slot0._isPause then
		return
	end

	slot0._isPause = false

	uv0.TimeMgr.GetInstance():ResumeBattleTimer()
end

slot0.MVC.Facade.Deactive = function(slot0)
	if slot0._isPause then
		return
	end

	slot0._isPause = true

	uv0.TimeMgr.GetInstance():PauseBattleTimer()
end

slot0.MVC.Facade.ActiveEscape = function(slot0)
	slot0._escapeAITimer = uv0.TimeMgr.GetInstance():AddTimer(&quot;escapeTimer&quot;, 0, uv1.Battle.BattleConfig.viewInterval, function ()
		uv0:escapeUpdate()
	end)
end

slot0.MVC.Facade.DeactiveEscape = function(slot0)
	uv0.TimeMgr.GetInstance():RemoveTimer(slot0._escapeAITimer)
end

slot0.MVC.Facade.RemoveAllTimer = function(slot0)
	uv0.TimeMgr.GetInstance():RemoveAllBattleTimer()

	slot0._calcTimer = nil
	slot0._AITimer = nil
end

slot0.MVC.Facade.ResetTimer = function(slot0)
	slot1 = uv0.TimeMgr.GetInstance()

	slot1:ResetCombatTime()
	slot1:RemoveBattleTimer(slot0._calcTimer)
	slot1:RemoveBattleTimer(slot0._AITimer)

	slot0._calcTimer = slot1:AddBattleTimer(&quot;calcTimer&quot;, -1, uv1.Battle.BattleConfig.calcInterval, function ()
		uv0:calcUpdate()
	end)
end

slot0.MVC.Facade.ActiveAutoComponentTimer = function(slot0)
	slot0._AITimer = uv0.TimeMgr.GetInstance():AddBattleTimer(&quot;aiTimer&quot;, -1, uv1.Battle.BattleConfig.AIInterval, function ()
		uv0:aiUpdate()
	end)
end

slot0.MVC.Facade.calcUpdate = function(slot0)
	slot1 = uv0.TimeMgr.GetInstance():GetCombatTime()

	for slot5, slot6 in pairs(slot0._proxyList) do
		slot6:Update(slot1)
	end

	for slot5, slot6 in pairs(slot0._commandList) do
		slot6:Update(slot1)
	end
end

slot0.MVC.Facade.aiUpdate = function(slot0)
	slot0:GetProxyByName(uv0.Battle.BattleDataProxy.__name):UpdateAutoComponent(uv1.TimeMgr.GetInstance():GetCombatTime())
end

slot0.MVC.Facade.escapeUpdate = function(slot0)
	slot2 = uv1.TimeMgr.GetInstance():GetCombatTime()

	slot0:GetProxyByName(uv0.Battle.BattleDataProxy.__name):UpdateEscapeOnly(slot2)
	slot0:GetMediatorByName(uv0.Battle.BattleSceneMediator.__name):UpdateEscapeOnly(slot2)
end
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>