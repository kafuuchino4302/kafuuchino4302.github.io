<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profiler.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>profiler.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = LuaProfiler
slot1 = jit and require(&quot;jit.vmdef&quot;)
slot2 = {
	event = {
		[142.0] = &quot;event.__call&quot;,
		[20.0] = &quot;_xpcall.__call&quot;
	},
	slot = {
		[11.0] = &quot;slot.__call&quot;
	},
	MainScene = {
		[250.0] = &quot;MainScene.Update&quot;
	}
}
slot3 = {
	[&quot;_xpcall.__call&quot;] = 1,
	ipairs_aux = 1,
	unknow = 1
}
slot5 = {}

slot6 = function(slot0)
	slot1 = #uv0 + 1

	for slot5, slot6 in ipairs(uv0) do
		if slot6 == slot0 then
			slot1 = slot5
		end
	end

	return slot1
end

slot7 = function(slot0)
	if #uv0 &gt; 0 and debug.getinfo(5, &quot;f&quot;) then
		if slot1 &lt; uv1(slot2.func) and debug.getinfo(6, &quot;f&quot;) then
			slot4 = uv1(slot2.func) or slot4
		end

		for slot8 = slot4 + 1, slot1 do
			table.remove(uv0)
			uv2.EndSample()
		end
	end
end

slot8 = function(slot0, slot1, slot2)
	uv0()
	table.insert(uv1, slot1)

	if slot2.id == -1 then
		slot2.name = slot0
		slot2.id = uv2.GetID(slot0)
	end

	uv2.BeginSample(slot2.id)
end

slot9 = function(slot0, slot1, slot2)
	uv0()
	table.insert(uv1, slot1)

	slot3 = -1

	if slot2.nick == nil then
		slot2.nick = {}
	end

	if not slot2.nick[slot0] then
		slot2.nick[slot0] = uv2.GetID(slot0)
	end

	uv2.BeginSample(slot3)
end

profiler_hook = function(slot0, slot1)
	if slot0 == &quot;call&quot; then
		slot2 = nil

		if uv0.cache[debug.getinfo(2, &quot;f&quot;).func] then
			slot2 = slot4.name
		end

		if uv1[slot2] then
			return
		end

		if slot2 == &quot;event.__call&quot; then
			uv2(debug.getinfo(2, &quot;n&quot;).name or slot2, slot3, slot4)
		elseif slot2 then
			uv3(slot2, slot3, slot4)
		else
			slot5 = debug.getinfo(2, &quot;Sn&quot;)
			slot6 = slot5.name
			slot7 = slot5.linedefined

			if not slot4 then
				uv0.cache[slot3] = {
					id = -1,
					name = &quot;unknow&quot;
				}
			end

			if slot5.short_src == &quot;[C]&quot; then
				if slot6 == &quot;__index&quot; or slot6 == &quot;__newindex&quot; then
					return
				end

				if not tostring(slot3):match(&quot;function: builtin#(%d+)&quot;) then
					if slot6 then
						slot8 = slot6

						uv3(slot6, slot3, slot4)
					elseif slot7 ~= -1 then
						uv3(slot5.short_src .. slot7, slot3, slot4)
					end
				elseif not uv1[uv4.ffnames[tonumber(slot9)]] then
					uv3(slot8, slot3, slot4)
				end
			elseif slot7 ~= -1 or slot6 then
				slot8 = slot5.short_src
				slot6 = slot6 or slot7
				slot9 = nil
				slot9 = slot8:match(&quot;([^/\\]+)%.%w+$&quot;) or slot8:match(&quot;([^/\\]+)$&quot;)

				uv3((not uv5[slot9] or slot10[slot7]) and slot9 .. &quot;.&quot; .. slot6 or slot8 .. &quot;.&quot; .. slot6, slot3, slot4)
			else
				uv3(slot2, slot3, slot4)
			end
		end
	elseif slot0 == &quot;return&quot; then
		if #uv6 == 0 then
			return
		end

		if debug.getinfo(2, &quot;f&quot;).func == uv6[slot2] then
			table.remove(uv6)
			uv7.EndSample()
		else
			if slot2 &lt; uv8(slot3.func) then
				return
			end

			for slot8 = slot4, slot2 do
				table.remove(uv6)
				uv7.EndSample()
			end
		end
	end
end

return {
	mark = 1,
	cache = 1,
	scan = function (slot0, slot1, slot2)
		if slot0.mark[slot1] then
			return
		end

		slot0.mark[slot1] = true

		for slot6, slot7 in pairs(slot1) do
			if type(slot6) == &quot;string&quot; then
				if type(slot7) == &quot;function&quot; then
					slot8 = slot6

					if slot2 then
						slot8 = slot2 .. &quot;.&quot; .. slot8
					end

					if not uv0[slot8] and slot6 ~= &quot;__index&quot; and slot6 ~= &quot;__newindex&quot; then
						slot0.cache[slot7] = {
							id = -1,
							name = slot8
						}
					end
				elseif type(slot7) == &quot;table&quot; and not slot0.mark[slot7] then
					slot0:scan(slot7, slot6)
				end
			elseif slot2 and slot6 == tolua.gettag or slot6 == tolua.settag then
				slot0:scan(slot7, slot2)
			end
		end
	end,
	scanlibs = function (slot0)
		slot1 = package.loaded
		slot0.mark[slot1] = true

		for slot5, slot6 in pairs(slot1) do
			if type(slot5) == &quot;string&quot; and type(slot6) == &quot;table&quot; then
				slot0:scan(slot6, slot5)

				if getmetatable(slot6) then
					slot0:scan(slot7, slot5)
				end
			end
		end
	end,
	start = function (slot0)
		slot0.mark = {}
		slot0.cache = {
			__mode = &quot;k&quot;
		}

		slot0:scan(_G, nil)
		slot0:scanlibs()

		slot0.mark = nil

		debug.sethook(profiler_hook, &quot;cr&quot;, 0)
	end,
	print = function (slot0)
		for slot4, slot5 in pairs(slot0.cache) do
			print(slot5.name)
		end
	end,
	stop = function (slot0)
		debug.sethook(nil)

		slot0.cache = nil
	end
}
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>