<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>util.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>util.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = require(&quot;cjson&quot;)

slot1 = function(slot0)
	slot1 = 0
	slot2 = 0

	for slot6, slot7 in pairs(slot0) do
		if type(slot6) == &quot;number&quot; then
			if slot1 &lt; slot6 then
				slot1 = slot6
			end

			slot2 = slot2 + 1
		else
			return -1
		end
	end

	if slot1 &gt; slot2 * 2 then
		return -1
	end

	return slot1
end

slot2 = nil

slot3 = function(slot0, slot1, slot2)
	slot3, slot4, slot5 = nil

	if slot1 then
		slot4 = &quot;\n&quot; .. slot1 .. &quot;  &quot;
		slot5 = slot1 .. &quot;  &quot;
	else
		slot5 = false
		slot4 = &quot; &quot;
		slot3 = &quot; &quot;
	end

	if slot2 + 1 &gt; 50 then
		return &quot;Cannot serialise any further: too many nested tables&quot;
	end

	slot7 = false
	slot8 = {
		&quot;{&quot; .. slot4
	}

	if uv0(slot0) &gt; 0 then
		for slot12 = 1, slot6 do
			if slot7 then
				table.insert(slot8, &quot;,&quot; .. slot4)
			end

			table.insert(slot8, uv1(slot0[slot12], slot5, slot2))

			slot7 = true
		end
	elseif slot6 &lt; 0 then
		for slot12, slot13 in pairs(slot0) do
			if slot7 then
				table.insert(slot8, &quot;,&quot; .. slot4)
			end

			table.insert(slot8, (&quot;[%s] = %s&quot;):format(uv1(slot12, slot5, slot2), uv1(slot13, slot5, slot2)))

			slot7 = true
		end
	end

	table.insert(slot8, slot3 .. &quot;}&quot;)

	return table.concat(slot8)
end

slot7 = 0
slot8 = 0

return {
	serialise_value = function (slot0, slot1, slot2)
		if slot1 == nil then
			slot1 = &quot;&quot;
		end

		if slot2 == nil then
			slot2 = 0
		end

		if slot0 == uv0.null then
			return &quot;json.null&quot;
		elseif type(slot0) == &quot;string&quot; then
			return (&quot;%q&quot;):format(slot0)
		elseif type(slot0) == &quot;nil&quot; or type(slot0) == &quot;number&quot; or type(slot0) == &quot;boolean&quot; then
			return tostring(slot0)
		elseif type(slot0) == &quot;table&quot; then
			return uv1(slot0, slot1, slot2)
		else
			return &quot;\&quot;&lt;&quot; .. type(slot0) .. &quot;&gt;\&quot;&quot;
		end
	end,
	file_load = function (slot0)
		slot1 = nil

		if slot0 == nil then
			slot1 = io.stdin
		else
			slot2 = nil
			slot3, slot2 = io.open(slot0, &quot;rb&quot;)

			if slot3 == nil then
				error((&quot;Unable to read &#x27;%s&#x27;: %s&quot;):format(slot0, slot2))
			end
		end

		slot2 = slot1.read(slot1, &quot;*a&quot;)

		if slot0 ~= nil then
			slot1.close(slot1)
		end

		if slot2 == nil then
			error(&quot;Failed to read &quot; .. slot0)
		end

		return slot2
	end,
	file_save = function (slot0, slot1)
		slot2 = nil

		if slot0 == nil then
			slot2 = io.stdout
		else
			slot3 = nil
			slot4, slot3 = io.open(slot0, &quot;wb&quot;)

			if slot4 == nil then
				error((&quot;Unable to write &#x27;%s&#x27;: %s&quot;):format(slot0, slot3))
			end
		end

		slot2.write(slot2, slot1)

		if slot0 ~= nil then
			slot2.close(slot2)
		end
	end,
	compare_values = function (slot0, slot1)
		if type(slot0) ~= type(slot1) then
			return false
		end

		if slot2 == &quot;number&quot; and slot0 ~= slot0 and slot1 ~= slot1 then
			return true
		end

		if slot2 ~= &quot;table&quot; then
			return slot0 == slot1
		end

		slot4 = {}

		for slot8, slot9 in pairs(slot0) do
			slot4[slot8] = true
		end

		for slot8, slot9 in pairs(slot1) do
			if not slot4[slot8] then
				return false
			end

			if not uv0(slot0[slot8], slot1[slot8]) then
				return false
			end

			slot4[slot8] = nil
		end

		for slot8, slot9 in pairs(slot4) do
			return false
		end

		return true
	end,
	run_test_summary = function ()
		return uv0, uv1
	end,
	run_test = function (slot0, slot1, slot2, slot3, slot4)
		slot5 = function(slot0, slot1, slot2)
			slot3 = {
				[true] = &quot;:success&quot;,
				[false] = &quot;:error&quot;
			}

			if slot1 ~= nil then
				slot0 = slot0 .. slot3[slot1]
			end

			print((&quot;[%s] %s&quot;):format(slot0, uv0(slot2, false)))
		end

		slot8 = false

		if table.remove({
			pcall(slot1, unpack(slot2))
		}, 1) == slot3 and uv1(slot6, slot4) then
			slot8 = true
			uv2 = uv2 + 1
		end

		uv3 = uv3 + 1

		print((&quot;==&gt; Test [%d] %s: %s&quot;):format(uv3, slot0, ({
			[true] = &quot;PASS&quot;,
			[false] = &quot;FAIL&quot;
		})[slot8]))
		slot5(&quot;Input&quot;, nil, slot2)

		if not slot8 then
			slot5(&quot;Expected&quot;, slot3, slot4)
		end

		slot5(&quot;Received&quot;, slot7, slot6)
		print()

		return slot8, slot6
	end,
	run_test_group = function (slot0)
		slot1 = function(slot0, slot1, slot2)
			if type(slot0) == &quot;string&quot; and #slot0 &gt; 0 then
				print(&quot;==&gt; &quot; .. slot0)
			end

			slot1(unpack(slot2 or {}))
			print()
		end

		for slot5, slot6 in ipairs(slot0) do
			if slot6[4] == nil then
				slot1(unpack(slot6))
			else
				uv0(unpack(slot6))
			end
		end
	end,
	run_script = function (slot0, slot1)
		slot2 = slot1 or {}
		slot3 = nil

		if _G.setfenv then
			if loadstring(slot0) then
				setfenv(slot3, slot2)
			end
		else
			slot3 = load(slot0, nil, , slot2)
		end

		if slot3 == nil then
			error(&quot;Invalid syntax.&quot;)
		end

		slot3()

		return slot2
	end
}
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>