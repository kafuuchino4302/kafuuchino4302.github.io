<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mbox.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>mbox.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = {}

if module then
	mbox = slot0
end

slot0.split_message = function(slot0)
	slot0 = string.gsub(slot0, &quot;\r\n&quot;, &quot;\n&quot;)

	string.gsub(slot0, &quot;^(.-\n)\n&quot;, function (slot0)
		uv0.headers = slot0
	end)
	string.gsub(slot0, &quot;^.-\n\n(.*)&quot;, function (slot0)
		uv0.body = slot0
	end)

	if not ({}).body then
		string.gsub(slot0, &quot;^\n(.*)&quot;, function (slot0)
			uv0.body = slot0
		end)
	end

	if not slot1.headers and not slot1.body then
		slot1.headers = slot0
	end

	return slot1.headers or &quot;&quot;, slot1.body or &quot;&quot;
end

slot0.split_headers = function(slot0)
	string.gsub(&quot;\n&quot; .. string.gsub(string.gsub(slot0, &quot;\r\n&quot;, &quot;\n&quot;), &quot;\n[ ]+&quot;, &quot; &quot;), &quot;\n([^\n]+)&quot;, function (slot0)
		table.insert(uv0, slot0)
	end)

	return {}
end

slot0.parse_header = function(slot0)
	slot1, slot2, slot3, slot4 = string.find(string.gsub(string.gsub(slot0, &quot;\n[ ]+&quot;, &quot; &quot;), &quot;\n+&quot;, &quot;&quot;), &quot;([^%s:]-):%s*(.*)&quot;)

	return slot3, slot4
end

slot0.parse_headers = function(slot0)
	slot2 = {}

	for slot6 = 1, #uv0.split_headers(slot0) do
		slot7, slot8 = uv0.parse_header(slot1[slot6])

		if slot7 then
			if slot2[string.lower(slot7)] then
				slot2[slot7] = slot2[slot7] .. &quot;, &quot; .. slot8
			else
				slot2[slot7] = slot8
			end
		end
	end

	return slot2
end

slot0.parse_from = function(slot0)
	slot1, slot2, slot3, slot4 = string.find(slot0, &quot;^%s*(.-)%s*%&lt;(.-)%&gt;&quot;)

	if not slot4 then
		slot1, slot2, slot4 = string.find(slot0, &quot;%s*(.+)%s*&quot;)
	end

	slot4 = slot4 or &quot;&quot;

	if (slot3 or &quot;&quot;) == &quot;&quot; then
		slot3 = slot4
	end

	return string.gsub(slot3, &quot;\&quot;&quot;, &quot;&quot;), slot4
end

slot0.split_mbox = function(slot0)
	slot1 = {}
	slot0 = string.gsub(slot0, &quot;\r\n&quot;, &quot;\n&quot;) .. [[


From 
]]
	slot2 = 1
	slot3 = 1
	slot4 = 1

	while true do
		slot5, slot2 = string.find(slot0, [[


From .-
]], slot4)

		if not slot5 then
			break
		end

		table.insert(slot1, string.sub(slot0, slot4, slot3 - 1))

		slot4 = slot2 + 1
	end

	return slot1
end

slot0.parse = function(slot0)
	for slot5 = 1, #uv0.split_mbox(slot0) do
		slot1[slot5] = uv0.parse_message(slot1[slot5])
	end

	return slot1
end

slot0.parse_message = function(slot0)
	slot1 = {
		body = slot3,
		headers = slot2
	}
	slot2, slot3 = uv0.split_message(slot0)
	slot1.headers = uv0.parse_headers(slot1.headers)

	return slot1
end

return slot0
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>