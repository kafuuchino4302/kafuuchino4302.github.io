<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>memprofiler.lua</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
</head>
<body>
    <h1>memprofiler.lua</h1>
    <a href="index.html">返回主页</a>
    <pre><code class="language-lua">slot0 = {}
slot1 = 0
slot2 = true

slot3 = function(slot0, slot1)
	if collectgarbage(&quot;count&quot;) - uv0 &lt;= 1e-06 then
		uv0 = collectgarbage(&quot;count&quot;)

		return
	end

	slot3 = debug.getinfo(2, &quot;S&quot;).source

	if uv1 then
		slot3 = string.format(&quot;%s__%d&quot;, slot3, slot1 - 1)
	end

	if not uv2[slot3] then
		uv2[slot3] = {
			slot3,
			1,
			slot2
		}
	else
		slot4[2] = slot4[2] + 1
		slot4[3] = slot4[3] + slot2
	end

	uv0 = collectgarbage(&quot;count&quot;)
end

return {
	StartRecordAlloc = function (slot0)
		if debug.gethook() then
			SC_MemLeakDetector.SC_StopRecordAllocAndDumpStat()

			return
		end

		uv0 = {}
		uv1 = collectgarbage(&quot;count&quot;)
		uv2 = not slot0

		debug.sethook(uv3, &quot;l&quot;)
	end,
	StopRecordAllocAndDumpStat = function (slot0)
		debug.sethook()

		if not uv0 then
			return
		end

		slot1 = {}

		for slot5, slot6 in pairs(uv0) do
			table.insert(slot1, slot6)
		end

		table.sort(slot1, function (slot0, slot1)
			return slot1[3] &lt; slot0[3]
		end)

		if not io.open(slot0 or &quot;memAlloc.csv&quot;, &quot;w&quot;) then
			logw.error(&quot;can&#x27;t open file:&quot;, slot0)

			return
		end

		slot2.write(slot2, &quot;fileLine, count, mem K, avg K\n&quot;)

		for slot6, slot7 in ipairs(slot1) do
			slot2.write(slot2, string.format(&quot;%s, %d, %f, %f\n&quot;, slot7[1], slot7[2], slot7[3], slot7[3] / slot7[2]))
		end

		slot2.close(slot2)

		uv0 = nil
	end
}
</code></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</body>
</html>